!!python/object:huggingface_hub.community.DiscussionWithDetails
author: euri412
conflicting_files: null
created_at: 2023-02-27 03:49:19+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/bc78622f3150aa529dd140412181fd40.svg
      fullname: Euripides
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: euri412
      type: user
    createdAt: '2023-02-27T03:49:19.000Z'
    data:
      edited: false
      editors:
      - euri412
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/bc78622f3150aa529dd140412181fd40.svg
          fullname: Euripides
          isHf: false
          isPro: false
          name: euri412
          type: user
        html: '<p>I mean this part:</p>

          <p>Trained on a set of 250 images.<br>" 5 repeats "<br>3 batch size, 4 epochs<br>(250
          * 5) / 3 * 4 = 1667 steps</p>

          '
        raw: "I mean this part:\r\n\r\nTrained on a set of 250 images.\r\n\" 5 repeats\
          \ \"\r\n3 batch size, 4 epochs\r\n(250 * 5) / 3 * 4 = 1667 steps"
        updatedAt: '2023-02-27T03:49:19.527Z'
      numEdits: 0
      reactions: []
    id: 63fc283f0aa18292d5c7553c
    type: comment
  author: euri412
  content: "I mean this part:\r\n\r\nTrained on a set of 250 images.\r\n\" 5 repeats\
    \ \"\r\n3 batch size, 4 epochs\r\n(250 * 5) / 3 * 4 = 1667 steps"
  created_at: 2023-02-27 03:49:19+00:00
  edited: false
  hidden: false
  id: 63fc283f0aa18292d5c7553c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/631b88324aa47d6afbe04da6/H0bd6ODQ7yIWsSZlKrTU5.png?w=200&h=200&f=face
      fullname: J.W.
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: GeneralAwareness
      type: user
    createdAt: '2023-02-28T02:59:20.000Z'
    data:
      edited: false
      editors:
      - GeneralAwareness
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/631b88324aa47d6afbe04da6/H0bd6ODQ7yIWsSZlKrTU5.png?w=200&h=200&f=face
          fullname: J.W.
          isHf: false
          isPro: false
          name: GeneralAwareness
          type: user
        html: '<p>His math is fuzzy.   1667 steps is per BS for a grad total of 5001
          steps.</p>

          <p>num train images * repeats: 1250</p>

          <p>Total optimization steps/Max training steps:  1667</p>

          <p>Actual final total steps: 5001</p>

          '
        raw: 'His math is fuzzy.   1667 steps is per BS for a grad total of 5001 steps.


          num train images * repeats: 1250


          Total optimization steps/Max training steps:  1667


          Actual final total steps: 5001'
        updatedAt: '2023-02-28T02:59:20.254Z'
      numEdits: 0
      reactions: []
    id: 63fd6e081cca11052a501248
    type: comment
  author: GeneralAwareness
  content: 'His math is fuzzy.   1667 steps is per BS for a grad total of 5001 steps.


    num train images * repeats: 1250


    Total optimization steps/Max training steps:  1667


    Actual final total steps: 5001'
  created_at: 2023-02-28 02:59:20+00:00
  edited: false
  hidden: false
  id: 63fd6e081cca11052a501248
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/bc78622f3150aa529dd140412181fd40.svg
      fullname: Euripides
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: euri412
      type: user
    createdAt: '2023-02-28T04:21:47.000Z'
    data:
      edited: true
      editors:
      - euri412
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/bc78622f3150aa529dd140412181fd40.svg
          fullname: Euripides
          isHf: false
          isPro: false
          name: euri412
          type: user
        html: "<blockquote>\n<p>His math is fuzzy.   1667 steps is per BS for a grad\
          \ total of 5001 steps.</p>\n<p>num train images * repeats: 1250</p>\n<p>Total\
          \ optimization steps/Max training steps:  1667</p>\n<p>Actual final total\
          \ steps: 5001</p>\n</blockquote>\n<p>What is BS?</p>\n<p>Excuse my ignorance,\
          \ I'm new to this.</p>\n<p>I use Kohya. The point is that I only have the\
          \ options \"batch size\", \"Epochs\", among others, but I don't have \"\
          repeats\".</p>\n<p>If for example I have 250 images, I put in the default\
          \ folder \"100_NameCharacter\" that 100 is multiplied by the number of images.</p>\n\
          <p><a rel=\"nofollow\" href=\"https://cdn-uploads.huggingface.co/production/uploads/1677558244201-6338961b17187957195e981c.jpeg\"\
          ><img alt=\"1.jpg\" src=\"https://cdn-uploads.huggingface.co/production/uploads/1677558244201-6338961b17187957195e981c.jpeg\"\
          ></a></p>\n<p>250 * 100 = 25,000 Steps * 1 epoch / 6 Batch size. = 4,166\
          \ Steps. \U0001F62E</p>\n<p>I don't know where the \"repeats\" comes from.</p>\n\
          <p><a rel=\"nofollow\" href=\"https://cdn-uploads.huggingface.co/production/uploads/1677558394925-6338961b17187957195e981c.jpeg\"\
          ><img alt=\"2.jpg\" src=\"https://cdn-uploads.huggingface.co/production/uploads/1677558394925-6338961b17187957195e981c.jpeg\"\
          ></a></p>\n<p>The reality is that I have never used so many images for character\
          \ training, so I am confused, I always use between 15 and 45 images.</p>\n\
          <p>The thing is that in the tutorials I've seen they always say to put 100\
          \ by default in the image training folder, if I put it below 100 it won't\
          \ work. If I lower that 100 to 5, if they give me the numbers that Khanon\
          \ mentions. So I don't know if that is what is called \"repeats\".</p>\n"
        raw: "> His math is fuzzy.   1667 steps is per BS for a grad total of 5001\
          \ steps.\n> \n> num train images * repeats: 1250\n> \n> Total optimization\
          \ steps/Max training steps:  1667\n> \n> Actual final total steps: 5001\n\
          \nWhat is BS?\n\nExcuse my ignorance, I'm new to this.\n\nI use Kohya. The\
          \ point is that I only have the options \"batch size\", \"Epochs\", among\
          \ others, but I don't have \"repeats\".\n\nIf for example I have 250 images,\
          \ I put in the default folder \"100_NameCharacter\" that 100 is multiplied\
          \ by the number of images.\n\n![1.jpg](https://cdn-uploads.huggingface.co/production/uploads/1677558244201-6338961b17187957195e981c.jpeg)\n\
          \n250 * 100 = 25,000 Steps * 1 epoch / 6 Batch size. = 4,166 Steps. \U0001F62E\
          \n\nI don't know where the \"repeats\" comes from.\n\n\n![2.jpg](https://cdn-uploads.huggingface.co/production/uploads/1677558394925-6338961b17187957195e981c.jpeg)\n\
          \n\nThe reality is that I have never used so many images for character training,\
          \ so I am confused, I always use between 15 and 45 images.\n\nThe thing\
          \ is that in the tutorials I've seen they always say to put 100 by default\
          \ in the image training folder, if I put it below 100 it won't work. If\
          \ I lower that 100 to 5, if they give me the numbers that Khanon mentions.\
          \ So I don't know if that is what is called \"repeats\"."
        updatedAt: '2023-02-28T04:26:36.817Z'
      numEdits: 4
      reactions: []
    id: 63fd815b9ac81ec88b09a7fa
    type: comment
  author: euri412
  content: "> His math is fuzzy.   1667 steps is per BS for a grad total of 5001 steps.\n\
    > \n> num train images * repeats: 1250\n> \n> Total optimization steps/Max training\
    \ steps:  1667\n> \n> Actual final total steps: 5001\n\nWhat is BS?\n\nExcuse\
    \ my ignorance, I'm new to this.\n\nI use Kohya. The point is that I only have\
    \ the options \"batch size\", \"Epochs\", among others, but I don't have \"repeats\"\
    .\n\nIf for example I have 250 images, I put in the default folder \"100_NameCharacter\"\
    \ that 100 is multiplied by the number of images.\n\n![1.jpg](https://cdn-uploads.huggingface.co/production/uploads/1677558244201-6338961b17187957195e981c.jpeg)\n\
    \n250 * 100 = 25,000 Steps * 1 epoch / 6 Batch size. = 4,166 Steps. \U0001F62E\
    \n\nI don't know where the \"repeats\" comes from.\n\n\n![2.jpg](https://cdn-uploads.huggingface.co/production/uploads/1677558394925-6338961b17187957195e981c.jpeg)\n\
    \n\nThe reality is that I have never used so many images for character training,\
    \ so I am confused, I always use between 15 and 45 images.\n\nThe thing is that\
    \ in the tutorials I've seen they always say to put 100 by default in the image\
    \ training folder, if I put it below 100 it won't work. If I lower that 100 to\
    \ 5, if they give me the numbers that Khanon mentions. So I don't know if that\
    \ is what is called \"repeats\"."
  created_at: 2023-02-28 04:21:47+00:00
  edited: true
  hidden: false
  id: 63fd815b9ac81ec88b09a7fa
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/631b88324aa47d6afbe04da6/H0bd6ODQ7yIWsSZlKrTU5.png?w=200&h=200&f=face
      fullname: J.W.
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: GeneralAwareness
      type: user
    createdAt: '2023-02-28T05:38:15.000Z'
    data:
      edited: true
      editors:
      - GeneralAwareness
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/631b88324aa47d6afbe04da6/H0bd6ODQ7yIWsSZlKrTU5.png?w=200&h=200&f=face
          fullname: J.W.
          isHf: false
          isPro: false
          name: GeneralAwareness
          type: user
        html: '<p>BS = batchsize</p>

          <p>edit:  that 100 in the folder name means it will repeat those images
          100 times.</p>

          '
        raw: 'BS = batchsize


          edit:  that 100 in the folder name means it will repeat those images 100
          times.'
        updatedAt: '2023-02-28T05:39:09.156Z'
      numEdits: 1
      reactions: []
    id: 63fd93470ac35c2dfbb49ad0
    type: comment
  author: GeneralAwareness
  content: 'BS = batchsize


    edit:  that 100 in the folder name means it will repeat those images 100 times.'
  created_at: 2023-02-28 05:38:15+00:00
  edited: true
  hidden: false
  id: 63fd93470ac35c2dfbb49ad0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/bc78622f3150aa529dd140412181fd40.svg
      fullname: Euripides
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: euri412
      type: user
    createdAt: '2023-02-28T06:19:26.000Z'
    data:
      edited: false
      editors:
      - euri412
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/bc78622f3150aa529dd140412181fd40.svg
          fullname: Euripides
          isHf: false
          isPro: false
          name: euri412
          type: user
        html: '<p>OHHHHHH!!! Honestly, as I was writing to you, I was realizing that
          it could be that... Brother, thank you very much, do you recommend leaving
          100 or lowering it whenever I want? Or is there some standard in the number
          of repetitions?</p>

          '
        raw: OHHHHHH!!! Honestly, as I was writing to you, I was realizing that it
          could be that... Brother, thank you very much, do you recommend leaving
          100 or lowering it whenever I want? Or is there some standard in the number
          of repetitions?
        updatedAt: '2023-02-28T06:19:26.370Z'
      numEdits: 0
      reactions: []
    id: 63fd9cee1cca11052a53d3e3
    type: comment
  author: euri412
  content: OHHHHHH!!! Honestly, as I was writing to you, I was realizing that it could
    be that... Brother, thank you very much, do you recommend leaving 100 or lowering
    it whenever I want? Or is there some standard in the number of repetitions?
  created_at: 2023-02-28 06:19:26+00:00
  edited: false
  hidden: false
  id: 63fd9cee1cca11052a53d3e3
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/631b88324aa47d6afbe04da6/H0bd6ODQ7yIWsSZlKrTU5.png?w=200&h=200&f=face
      fullname: J.W.
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: GeneralAwareness
      type: user
    createdAt: '2023-02-28T08:21:06.000Z'
    data:
      edited: false
      editors:
      - GeneralAwareness
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/631b88324aa47d6afbe04da6/H0bd6ODQ7yIWsSZlKrTU5.png?w=200&h=200&f=face
          fullname: J.W.
          isHf: false
          isPro: false
          name: GeneralAwareness
          type: user
        html: '<p>Depends as I go from 100 down to 40 depending on what I am training
          and judging the first train.  I try to stick to 1500-2200 total steps.</p>

          '
        raw: Depends as I go from 100 down to 40 depending on what I am training and
          judging the first train.  I try to stick to 1500-2200 total steps.
        updatedAt: '2023-02-28T08:21:06.834Z'
      numEdits: 0
      reactions: []
    id: 63fdb972a159ef722e84de42
    type: comment
  author: GeneralAwareness
  content: Depends as I go from 100 down to 40 depending on what I am training and
    judging the first train.  I try to stick to 1500-2200 total steps.
  created_at: 2023-02-28 08:21:06+00:00
  edited: false
  hidden: false
  id: 63fdb972a159ef722e84de42
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63cb6d291b705cc951e9dbee/NXT_sel0FSHtVUeM3bIsv.jpeg?w=200&h=200&f=face
      fullname: khoners
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: khanon
      type: user
    createdAt: '2023-02-28T09:47:24.000Z'
    data:
      edited: true
      editors:
      - khanon
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63cb6d291b705cc951e9dbee/NXT_sel0FSHtVUeM3bIsv.jpeg?w=200&h=200&f=face
          fullname: khoners
          isHf: false
          isPro: false
          name: khanon
          type: user
        html: "<p>Repeats refer to the number before each of the folders in your dataset,\
          \ so yeah <code>100_Cammy</code> means that <em>during a single epoch</em>,\
          \ each image in that folder will be \"seen\" by the AI 100 times.  There\
          \ is a caveat, however -- batch size.  When batch size is greater than 1,\
          \ that means the model \"looks at\" more images during a single step of\
          \ training (by taking the \"average\" of the images in the batch).  This\
          \ increases VRAM usage but may smooth out a lower quality dataset by reducing\
          \ the influence of any one image on the model's weight updates.</p>\n<p>In\
          \ <code>(250 * 5) / 3 * 4 = 1667 steps</code>:<br>250 = number of images\
          \ for the character<br>5 = number of repeats for those images. (ie. folder\
          \ name 5_koharu is 5 repeats) You can think of this as just copying and\
          \ pasting the images in that folder <em><code>x</code></em> number of times.<br>3\
          \ = my usual batch size. I recommend 3 unless you have a specific reason\
          \ to change it.  If you increase the batch size without increasing the number\
          \ of repeats or epochs,  you will train for fewer steps.<br>4 = number of\
          \ epochs.  One \"epoch\" is a cycle through the entire dataset, including\
          \ repeats.<br>1667 steps = the final number of training steps.  This is\
          \ the value you see in Kohya once the progress bar appears during training.</p>\n\
          <p>To reiterate: <code>(images * repeats) / batch_size * epochs = training_steps</code></p>\n\
          <p>Similar to <span data-props=\"{&quot;user&quot;:&quot;GeneralAwareness&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/GeneralAwareness\"\
          >@<span class=\"underline\">GeneralAwareness</span></a></span>\n\n\t</span></span>,\
          \ I generally stick to ~1400-1800 training steps for character LoRAs.  Adjust\
          \ the repeats/epochs according to the size of your dataset to try to hit\
          \ that ~1600 number.</p>\n<p>Note that <strong>all of the training hyperparameters\
          \ are interdependent and tend to influence each other</strong>.  1600 steps\
          \ is my recommendation, but if you aren't using the same learning rates,\
          \ batch size, or optimizer settings, you may not see the same results. \
          \ That's why I provide the JSON files that you can load into the Kohya GUI\
          \ (<a rel=\"nofollow\" href=\"https://github.com/bmaltais/kohya_ss\">https://github.com/bmaltais/kohya_ss</a>)\
          \ to match my settings as closely as possible.</p>\n"
        raw: 'Repeats refer to the number before each of the folders in your dataset,
          so yeah `100_Cammy` means that *during a single epoch*, each image in that
          folder will be "seen" by the AI 100 times.  There is a caveat, however --
          batch size.  When batch size is greater than 1, that means the model "looks
          at" more images during a single step of training (by taking the "average"
          of the images in the batch).  This increases VRAM usage but may smooth out
          a lower quality dataset by reducing the influence of any one image on the
          model''s weight updates.


          In `(250 * 5) / 3 * 4 = 1667 steps`:

          250 = number of images for the character

          5 = number of repeats for those images. (ie. folder name 5_koharu is 5 repeats)
          You can think of this as just copying and pasting the images in that folder
          *`x`* number of times.

          3 = my usual batch size. I recommend 3 unless you have a specific reason
          to change it.  If you increase the batch size without increasing the number
          of repeats or epochs,  you will train for fewer steps.

          4 = number of epochs.  One "epoch" is a cycle through the entire dataset,
          including repeats.

          1667 steps = the final number of training steps.  This is the value you
          see in Kohya once the progress bar appears during training.


          To reiterate: `(images * repeats) / batch_size * epochs = training_steps`


          Similar to @GeneralAwareness, I generally stick to ~1400-1800 training steps
          for character LoRAs.  Adjust the repeats/epochs according to the size of
          your dataset to try to hit that ~1600 number.


          Note that **all of the training hyperparameters are interdependent and tend
          to influence each other**.  1600 steps is my recommendation, but if you
          aren''t using the same learning rates, batch size, or optimizer settings,
          you may not see the same results.  That''s why I provide the JSON files
          that you can load into the Kohya GUI (https://github.com/bmaltais/kohya_ss)
          to match my settings as closely as possible.'
        updatedAt: '2023-02-28T09:59:52.971Z'
      numEdits: 4
      reactions: []
    id: 63fdcdaca159ef722e86b952
    type: comment
  author: khanon
  content: 'Repeats refer to the number before each of the folders in your dataset,
    so yeah `100_Cammy` means that *during a single epoch*, each image in that folder
    will be "seen" by the AI 100 times.  There is a caveat, however -- batch size.  When
    batch size is greater than 1, that means the model "looks at" more images during
    a single step of training (by taking the "average" of the images in the batch).  This
    increases VRAM usage but may smooth out a lower quality dataset by reducing the
    influence of any one image on the model''s weight updates.


    In `(250 * 5) / 3 * 4 = 1667 steps`:

    250 = number of images for the character

    5 = number of repeats for those images. (ie. folder name 5_koharu is 5 repeats)
    You can think of this as just copying and pasting the images in that folder *`x`*
    number of times.

    3 = my usual batch size. I recommend 3 unless you have a specific reason to change
    it.  If you increase the batch size without increasing the number of repeats or
    epochs,  you will train for fewer steps.

    4 = number of epochs.  One "epoch" is a cycle through the entire dataset, including
    repeats.

    1667 steps = the final number of training steps.  This is the value you see in
    Kohya once the progress bar appears during training.


    To reiterate: `(images * repeats) / batch_size * epochs = training_steps`


    Similar to @GeneralAwareness, I generally stick to ~1400-1800 training steps for
    character LoRAs.  Adjust the repeats/epochs according to the size of your dataset
    to try to hit that ~1600 number.


    Note that **all of the training hyperparameters are interdependent and tend to
    influence each other**.  1600 steps is my recommendation, but if you aren''t using
    the same learning rates, batch size, or optimizer settings, you may not see the
    same results.  That''s why I provide the JSON files that you can load into the
    Kohya GUI (https://github.com/bmaltais/kohya_ss) to match my settings as closely
    as possible.'
  created_at: 2023-02-28 09:47:24+00:00
  edited: true
  hidden: false
  id: 63fdcdaca159ef722e86b952
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/bc78622f3150aa529dd140412181fd40.svg
      fullname: Euripides
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: euri412
      type: user
    createdAt: '2023-02-28T22:16:25.000Z'
    data:
      edited: false
      editors:
      - euri412
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/bc78622f3150aa529dd140412181fd40.svg
          fullname: Euripides
          isHf: false
          isPro: false
          name: euri412
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;khanon&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/khanon\">@<span class=\"\
          underline\">khanon</span></a></span>\n\n\t</span></span>  and <span data-props=\"\
          {&quot;user&quot;:&quot;GeneralAwareness&quot;}\" data-target=\"UserMention\"\
          \ class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"inline-block\"\
          ><span class=\"contents\"><a href=\"/GeneralAwareness\">@<span class=\"\
          underline\">GeneralAwareness</span></a></span>\n\n\t</span></span> </p>\n\
          <p>MUCHAS GRACIAS!</p>\n"
        raw: "@khanon  and @GeneralAwareness \n\nMUCHAS GRACIAS!"
        updatedAt: '2023-02-28T22:16:25.559Z'
      numEdits: 0
      reactions: []
    id: 63fe7d390b9bcde2f008a886
    type: comment
  author: euri412
  content: "@khanon  and @GeneralAwareness \n\nMUCHAS GRACIAS!"
  created_at: 2023-02-28 22:16:25+00:00
  edited: false
  hidden: false
  id: 63fe7d390b9bcde2f008a886
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: khanon/lora-training
repo_type: model
status: open
target_branch: null
title: Can you explain to me how the "Repeats" are made?
