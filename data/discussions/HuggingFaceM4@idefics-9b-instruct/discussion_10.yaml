!!python/object:huggingface_hub.community.DiscussionWithDetails
author: VishnuSuganth
conflicting_files: null
created_at: 2024-01-18 05:48:47+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/350f2048f67b452a2bb90d55662358fc.svg
      fullname: P
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: VishnuSuganth
      type: user
    createdAt: '2024-01-18T05:48:47.000Z'
    data:
      edited: true
      editors:
      - VishnuSuganth
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7946564555168152
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/350f2048f67b452a2bb90d55662358fc.svg
          fullname: P
          isHf: false
          isPro: false
          name: VishnuSuganth
          type: user
        html: '<p>Hi Team,</p>

          <p>Could you please provide the code used for instruction fine-tuning the
          base model ?</p>

          <p>I have checked the examples in here - <a rel="nofollow" href="https://github.com/huggingface/notebooks/tree/main/examples/idefics">https://github.com/huggingface/notebooks/tree/main/examples/idefics</a>
          , but I suppose these are for normal fine-tuning using image-text pairs
          (interleaved) with next token prediction task.<br><code>inputs["labels"]
          = inputs["input_ids"]</code></p>

          <p>I am specifically interested to know the changes required in the input/output
          processors for fine tuning on VQA datasets (which requires a conditional
          generation task given the image + question) ?</p>

          <p>Thanks in advance.</p>

          '
        raw: "Hi Team,\n\nCould you please provide the code used for instruction fine-tuning\
          \ the base model ?\n\nI have checked the examples in here - [https://github.com/huggingface/notebooks/tree/main/examples/idefics](https://github.com/huggingface/notebooks/tree/main/examples/idefics)\
          \ , but I suppose these are for normal fine-tuning using image-text pairs\
          \ (interleaved) with next token prediction task. \n```inputs[\"labels\"\
          ] = inputs[\"input_ids\"]```\n\nI am specifically interested to know the\
          \ changes required in the input/output processors for fine tuning on VQA\
          \ datasets (which requires a conditional generation task given the image\
          \ + question) ?\n\nThanks in advance."
        updatedAt: '2024-01-18T05:50:51.514Z'
      numEdits: 3
      reactions: []
    id: 65a8bbbf4623e107b97b31a1
    type: comment
  author: VishnuSuganth
  content: "Hi Team,\n\nCould you please provide the code used for instruction fine-tuning\
    \ the base model ?\n\nI have checked the examples in here - [https://github.com/huggingface/notebooks/tree/main/examples/idefics](https://github.com/huggingface/notebooks/tree/main/examples/idefics)\
    \ , but I suppose these are for normal fine-tuning using image-text pairs (interleaved)\
    \ with next token prediction task. \n```inputs[\"labels\"] = inputs[\"input_ids\"\
    ]```\n\nI am specifically interested to know the changes required in the input/output\
    \ processors for fine tuning on VQA datasets (which requires a conditional generation\
    \ task given the image + question) ?\n\nThanks in advance."
  created_at: 2024-01-18 05:48:47+00:00
  edited: true
  hidden: false
  id: 65a8bbbf4623e107b97b31a1
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/350f2048f67b452a2bb90d55662358fc.svg
      fullname: P
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: VishnuSuganth
      type: user
    createdAt: '2024-01-18T06:13:40.000Z'
    data:
      edited: false
      editors:
      - VishnuSuganth
      hidden: false
      identifiedLanguage:
        language: fr
        probability: 0.18234212696552277
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/350f2048f67b452a2bb90d55662358fc.svg
          fullname: P
          isHf: false
          isPro: false
          name: VishnuSuganth
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;VictorSanh&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/VictorSanh\">@<span class=\"\
          underline\">VictorSanh</span></a></span>\n\n\t</span></span> <span data-props=\"\
          {&quot;user&quot;:&quot;HugoLaurencon&quot;}\" data-target=\"UserMention\"\
          \ class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"inline-block\"\
          ><span class=\"contents\"><a href=\"/HugoLaurencon\">@<span class=\"underline\"\
          >HugoLaurencon</span></a></span>\n\n\t</span></span> FYI</p>\n"
        raw: '@VictorSanh @HugoLaurencon FYI'
        updatedAt: '2024-01-18T06:13:40.617Z'
      numEdits: 0
      reactions: []
    id: 65a8c194669921943c38abfe
    type: comment
  author: VishnuSuganth
  content: '@VictorSanh @HugoLaurencon FYI'
  created_at: 2024-01-18 06:13:40+00:00
  edited: false
  hidden: false
  id: 65a8c194669921943c38abfe
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1619623771844-5ecea265968f6028e0559fa5.jpeg?w=200&h=200&f=face
      fullname: Victor Sanh
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: true
      name: VictorSanh
      type: user
    createdAt: '2024-01-18T17:23:20.000Z'
    data:
      edited: false
      editors:
      - VictorSanh
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9208359122276306
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1619623771844-5ecea265968f6028e0559fa5.jpeg?w=200&h=200&f=face
          fullname: Victor Sanh
          isHf: true
          isPro: true
          name: VictorSanh
          type: user
        html: "<p>Hi <span data-props=\"{&quot;user&quot;:&quot;VishnuSuganth&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/VishnuSuganth\"\
          >@<span class=\"underline\">VishnuSuganth</span></a></span>\n\n\t</span></span><br>We\
          \ have not released the codebase we used to train and perform sft for idefics\
          \ (mostly because we don't have the bandwidth of maintaining this codebase).<br>However\
          \ the fine-tuning script will give you a good start!<br>The exact formatting\
          \ we used to fine-tune on vqa datasets is essentially the same as what you\
          \ see for inference:</p>\n<pre><code class=\"language-python\">User: {question}{image}&lt;end_of_utterance&gt;\\\
          nAssistant: {answer}&lt;end_of_utterance&gt;\n</code></pre>\n"
        raw: "Hi @VishnuSuganth \nWe have not released the codebase we used to train\
          \ and perform sft for idefics (mostly because we don't have the bandwidth\
          \ of maintaining this codebase).\nHowever the fine-tuning script will give\
          \ you a good start!\nThe exact formatting we used to fine-tune on vqa datasets\
          \ is essentially the same as what you see for inference:\n```python\nUser:\
          \ {question}{image}<end_of_utterance>\\nAssistant: {answer}<end_of_utterance>\n\
          ```"
        updatedAt: '2024-01-18T17:23:20.791Z'
      numEdits: 0
      reactions: []
    id: 65a95e883b9e1f0f30612de0
    type: comment
  author: VictorSanh
  content: "Hi @VishnuSuganth \nWe have not released the codebase we used to train\
    \ and perform sft for idefics (mostly because we don't have the bandwidth of maintaining\
    \ this codebase).\nHowever the fine-tuning script will give you a good start!\n\
    The exact formatting we used to fine-tune on vqa datasets is essentially the same\
    \ as what you see for inference:\n```python\nUser: {question}{image}<end_of_utterance>\\\
    nAssistant: {answer}<end_of_utterance>\n```"
  created_at: 2024-01-18 17:23:20+00:00
  edited: false
  hidden: false
  id: 65a95e883b9e1f0f30612de0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/350f2048f67b452a2bb90d55662358fc.svg
      fullname: P
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: VishnuSuganth
      type: user
    createdAt: '2024-01-18T17:28:15.000Z'
    data:
      edited: false
      editors:
      - VishnuSuganth
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8576228618621826
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/350f2048f67b452a2bb90d55662358fc.svg
          fullname: P
          isHf: false
          isPro: false
          name: VishnuSuganth
          type: user
        html: "<p>Ok thanks. Can you also share some information on how to set the\
          \ input[\u201Clabels\u201D] for sft and changes to the loss computation\
          \ in the forward function ?</p>\n"
        raw: "Ok thanks. Can you also share some information on how to set the input[\u201C\
          labels\u201D] for sft and changes to the loss computation in the forward\
          \ function ?"
        updatedAt: '2024-01-18T17:28:15.072Z'
      numEdits: 0
      reactions: []
    id: 65a95fafa7777df7ec120ea0
    type: comment
  author: VishnuSuganth
  content: "Ok thanks. Can you also share some information on how to set the input[\u201C\
    labels\u201D] for sft and changes to the loss computation in the forward function\
    \ ?"
  created_at: 2024-01-18 17:28:15+00:00
  edited: false
  hidden: false
  id: 65a95fafa7777df7ec120ea0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1619623771844-5ecea265968f6028e0559fa5.jpeg?w=200&h=200&f=face
      fullname: Victor Sanh
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: true
      name: VictorSanh
      type: user
    createdAt: '2024-01-18T17:29:26.000Z'
    data:
      edited: false
      editors:
      - VictorSanh
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9359581470489502
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1619623771844-5ecea265968f6028e0559fa5.jpeg?w=200&h=200&f=face
          fullname: Victor Sanh
          isHf: true
          isPro: true
          name: VictorSanh
          type: user
        html: '<p>No changes on the loss, standard next token prediction!<br>We did
          not limit the loss computation to the answer, but that could be a fun thing
          to sanity-try.</p>

          '
        raw: 'No changes on the loss, standard next token prediction!

          We did not limit the loss computation to the answer, but that could be a
          fun thing to sanity-try.'
        updatedAt: '2024-01-18T17:29:26.283Z'
      numEdits: 0
      reactions: []
    id: 65a95ff6f9e55b5f752e527c
    type: comment
  author: VictorSanh
  content: 'No changes on the loss, standard next token prediction!

    We did not limit the loss computation to the answer, but that could be a fun thing
    to sanity-try.'
  created_at: 2024-01-18 17:29:26+00:00
  edited: false
  hidden: false
  id: 65a95ff6f9e55b5f752e527c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/350f2048f67b452a2bb90d55662358fc.svg
      fullname: P
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: VishnuSuganth
      type: user
    createdAt: '2024-01-23T16:58:06.000Z'
    data:
      edited: false
      editors:
      - VishnuSuganth
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8284818530082703
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/350f2048f67b452a2bb90d55662358fc.svg
          fullname: P
          isHf: false
          isPro: false
          name: VishnuSuganth
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;VictorSanh&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/VictorSanh\">@<span class=\"\
          underline\">VictorSanh</span></a></span>\n\n\t</span></span> Thank you.</p>\n"
        raw: '@VictorSanh Thank you.'
        updatedAt: '2024-01-23T16:58:06.706Z'
      numEdits: 0
      reactions: []
      relatedEventId: 65aff01e83b7d2e7edb1e83c
    id: 65aff01e83b7d2e7edb1e833
    type: comment
  author: VishnuSuganth
  content: '@VictorSanh Thank you.'
  created_at: 2024-01-23 16:58:06+00:00
  edited: false
  hidden: false
  id: 65aff01e83b7d2e7edb1e833
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/350f2048f67b452a2bb90d55662358fc.svg
      fullname: P
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: VishnuSuganth
      type: user
    createdAt: '2024-01-23T16:58:06.000Z'
    data:
      status: closed
    id: 65aff01e83b7d2e7edb1e83c
    type: status-change
  author: VishnuSuganth
  created_at: 2024-01-23 16:58:06+00:00
  id: 65aff01e83b7d2e7edb1e83c
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 10
repo_id: HuggingFaceM4/idefics-9b-instruct
repo_type: model
status: closed
target_branch: null
title: Code for instruction tuning
