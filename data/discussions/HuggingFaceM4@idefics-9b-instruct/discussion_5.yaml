!!python/object:huggingface_hub.community.DiscussionWithDetails
author: luodian
conflicting_files: null
created_at: 2023-10-03 09:31:49+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62d3f7d84b0933c48f3cdd9c/IVZXUPBSzhS01hm55x854.png?w=200&h=200&f=face
      fullname: Bo Li
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: luodian
      type: user
    createdAt: '2023-10-03T10:31:49.000Z'
    data:
      edited: true
      editors:
      - luodian
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.982555627822876
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62d3f7d84b0933c48f3cdd9c/IVZXUPBSzhS01hm55x854.png?w=200&h=200&f=face
          fullname: Bo Li
          isHf: false
          isPro: false
          name: luodian
          type: user
        html: '<p>hi I noticed your configs changed and could I ask why did this change
          and what could it bring with <code>normalized=false</code>? Thanks!</p>

          '
        raw: hi I noticed your configs changed and could I ask why did this change
          and what could it bring with `normalized=false`? Thanks!
        updatedAt: '2023-10-03T10:34:12.475Z'
      numEdits: 1
      reactions: []
    id: 651bed956a9194ff6b9f077e
    type: comment
  author: luodian
  content: hi I noticed your configs changed and could I ask why did this change and
    what could it bring with `normalized=false`? Thanks!
  created_at: 2023-10-03 09:31:49+00:00
  edited: true
  hidden: false
  id: 651bed956a9194ff6b9f077e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionTitleChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62d3f7d84b0933c48f3cdd9c/IVZXUPBSzhS01hm55x854.png?w=200&h=200&f=face
      fullname: Bo Li
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: luodian
      type: user
    createdAt: '2023-10-03T10:34:21.000Z'
    data:
      from: what are the changes from `normalized=false` to `true` in `special_tokens_map.json`?
      to: what are the changes from `normalized=true` to `false` in `special_tokens_map.json`?
    id: 651bee2d81fcf4844c38664f
    type: title-change
  author: luodian
  created_at: 2023-10-03 09:34:21+00:00
  id: 651bee2d81fcf4844c38664f
  new_title: what are the changes from `normalized=true` to `false` in `special_tokens_map.json`?
  old_title: what are the changes from `normalized=false` to `true` in `special_tokens_map.json`?
  type: title-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62d3f7d84b0933c48f3cdd9c/IVZXUPBSzhS01hm55x854.png?w=200&h=200&f=face
      fullname: Bo Li
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: luodian
      type: user
    createdAt: '2023-10-03T10:39:42.000Z'
    data:
      edited: true
      editors:
      - luodian
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9438039660453796
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62d3f7d84b0933c48f3cdd9c/IVZXUPBSzhS01hm55x854.png?w=200&h=200&f=face
          fullname: Bo Li
          isHf: false
          isPro: false
          name: luodian
          type: user
        html: "<p>running the given <a href=\"https://huggingface.co/HuggingFaceM4/idefics-9b-instruct#how-to-get-started-with-the-model\"\
          >example</a> would produce</p>\n<pre><code class=\"language-python\"><span\
          \ class=\"hljs-comment\"># normalized=true</span>\nUser: What <span class=\"\
          hljs-keyword\">is</span> <span class=\"hljs-keyword\">in</span> this image?\
          \ \nAssistant: This picture depicts Idefix, the dog of Obelix <span class=\"\
          hljs-keyword\">in</span> Asterix <span class=\"hljs-keyword\">and</span>\
          \ Obelix. Idefix <span class=\"hljs-keyword\">is</span> running on the ground.\
          \ \nUser: And who <span class=\"hljs-keyword\">is</span> that? \nAssistant:\
          \ That <span class=\"hljs-keyword\">is</span> a cartoon character <span\
          \ class=\"hljs-keyword\">from</span> the Asterix comics, which <span class=\"\
          hljs-keyword\">is</span> a popular French comic series created by Ren\xE9\
          \ Goscinny <span class=\"hljs-keyword\">and</span> Albert Uderzo.\n</code></pre>\n\
          <pre><code class=\"language-python\"><span class=\"hljs-comment\"># normalized=false</span>\n\
          User: What <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\"\
          >in</span> this image? \nAssistant: This picture depicts Idefix, the dog\
          \ of Obelix <span class=\"hljs-keyword\">in</span> Asterix <span class=\"\
          hljs-keyword\">and</span> Obelix. Idefix <span class=\"hljs-keyword\">is</span>\
          \ running on the ground. \nUser: And who <span class=\"hljs-keyword\">is</span>\
          \ that? \nAssistant: The person <span class=\"hljs-keyword\">in</span> the\
          \ image <span class=\"hljs-keyword\">is</span> Julius Caesar, a prominent\
          \ Roman politician <span class=\"hljs-keyword\">and</span> military general\
          \ <span class=\"hljs-keyword\">in</span> ancient Rome.\n</code></pre>\n"
        raw: "running the given [example](https://huggingface.co/HuggingFaceM4/idefics-9b-instruct#how-to-get-started-with-the-model)\
          \ would produce\n\n```python\n# normalized=true\nUser: What is in this image?\
          \ \nAssistant: This picture depicts Idefix, the dog of Obelix in Asterix\
          \ and Obelix. Idefix is running on the ground. \nUser: And who is that?\
          \ \nAssistant: That is a cartoon character from the Asterix comics, which\
          \ is a popular French comic series created by Ren\xE9 Goscinny and Albert\
          \ Uderzo.\n```\n\n```python\n# normalized=false\nUser: What is in this image?\
          \ \nAssistant: This picture depicts Idefix, the dog of Obelix in Asterix\
          \ and Obelix. Idefix is running on the ground. \nUser: And who is that?\
          \ \nAssistant: The person in the image is Julius Caesar, a prominent Roman\
          \ politician and military general in ancient Rome.\n```"
        updatedAt: '2023-10-03T10:40:10.697Z'
      numEdits: 2
      reactions: []
    id: 651bef6e5c81ea4d1b76b9aa
    type: comment
  author: luodian
  content: "running the given [example](https://huggingface.co/HuggingFaceM4/idefics-9b-instruct#how-to-get-started-with-the-model)\
    \ would produce\n\n```python\n# normalized=true\nUser: What is in this image?\
    \ \nAssistant: This picture depicts Idefix, the dog of Obelix in Asterix and Obelix.\
    \ Idefix is running on the ground. \nUser: And who is that? \nAssistant: That\
    \ is a cartoon character from the Asterix comics, which is a popular French comic\
    \ series created by Ren\xE9 Goscinny and Albert Uderzo.\n```\n\n```python\n# normalized=false\n\
    User: What is in this image? \nAssistant: This picture depicts Idefix, the dog\
    \ of Obelix in Asterix and Obelix. Idefix is running on the ground. \nUser: And\
    \ who is that? \nAssistant: The person in the image is Julius Caesar, a prominent\
    \ Roman politician and military general in ancient Rome.\n```"
  created_at: 2023-10-03 09:39:42+00:00
  edited: true
  hidden: false
  id: 651bef6e5c81ea4d1b76b9aa
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1619623771844-5ecea265968f6028e0559fa5.jpeg?w=200&h=200&f=face
      fullname: Victor Sanh
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: true
      name: VictorSanh
      type: user
    createdAt: '2023-10-03T12:27:38.000Z'
    data:
      edited: false
      editors:
      - VictorSanh
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8314457535743713
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1619623771844-5ecea265968f6028e0559fa5.jpeg?w=200&h=200&f=face
          fullname: Victor Sanh
          isHf: true
          isPro: true
          name: VictorSanh
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;HugoLaurencon&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/HugoLaurencon\"\
          >@<span class=\"underline\">HugoLaurencon</span></a></span>\n\n\t</span></span>\
          \ is the best person to comment!</p>\n"
        raw: '@HugoLaurencon is the best person to comment!'
        updatedAt: '2023-10-03T12:27:38.452Z'
      numEdits: 0
      reactions: []
    id: 651c08ba2597dc075d86d2d0
    type: comment
  author: VictorSanh
  content: '@HugoLaurencon is the best person to comment!'
  created_at: 2023-10-03 11:27:38+00:00
  edited: false
  hidden: false
  id: 651c08ba2597dc075d86d2d0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1635201569275-noauth.jpeg?w=200&h=200&f=face
      fullname: "Hugo Lauren\xE7on"
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: HugoLaurencon
      type: user
    createdAt: '2023-10-03T12:50:54.000Z'
    data:
      edited: false
      editors:
      - HugoLaurencon
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8770845532417297
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1635201569275-noauth.jpeg?w=200&h=200&f=face
          fullname: "Hugo Lauren\xE7on"
          isHf: true
          isPro: false
          name: HugoLaurencon
          type: user
        html: "<p>Hi <span data-props=\"{&quot;user&quot;:&quot;luodian&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/luodian\">@<span class=\"\
          underline\">luodian</span></a></span>\n\n\t</span></span></p>\n<p>Can you\
          \ tell me which version of <code>transformers</code> you are using?</p>\n\
          <p>If you are on the main branch and installed the repo from source, there\
          \ has been a recent big change in <code>tokenizers</code>.</p>\n<p>Essentially,\
          \ if <code>normalized=true</code>, now the special tokens can be split into\
          \ several sub-tokens, which is not something wanted.<br>For example, we\
          \ trained the model using <code>&lt;fake_token_around_image&gt;&lt;image&gt;&lt;fake_token_around_image&gt;</code>,\
          \ but here the token <code>&lt;image&gt;</code> could be split into <code>&lt;</code>\
          \ followed by <code>image&gt;</code>.<br>In that case, we would not have\
          \ the token <code>&lt;image&gt;</code>, and we would have no image attention\
          \ mask or pixel values.<br>Note that if you are using the example code,\
          \ we are dealing with these tokens for you in <a rel=\"nofollow\" href=\"\
          https://github.com/huggingface/transformers/blob/main/src/transformers/models/idefics/processing_idefics.py\"\
          >the processor script</a>.</p>\n<p>Could you try to see, with your version\
          \ of <code>transformers</code>, how the prompt is tokenized with both <code>normalized=true</code>\
          \ and <code>normalized=false</code>?<br>You need to write</p>\n<pre><code>from\
          \ transformers import AutoProcessor\n\ncheckpoint = \"HuggingFaceM4/idefics-9b\"\
          \nprocessor = AutoProcessor.from_pretrained(checkpoint)\ntokenizer = processor.tokenizer\n\
          \nprompt =  \"&lt;fake_token_around_image&gt;&lt;image&gt;&lt;fake_token_around_image&gt;In\
          \ this picture from Asterix and Obelix, we can see\"  # Or a longer prompt\n\
          tokens = tokenizer.encode(prompt)\nprint(tokens)\n</code></pre>\n<p>Are\
          \ you also using the base model or the instruct one?</p>\n"
        raw: 'Hi @luodian


          Can you tell me which version of `transformers` you are using?


          If you are on the main branch and installed the repo from source, there
          has been a recent big change in `tokenizers`.


          Essentially, if `normalized=true`, now the special tokens can be split into
          several sub-tokens, which is not something wanted.

          For example, we trained the model using `<fake_token_around_image><image><fake_token_around_image>`,
          but here the token `<image>` could be split into `<` followed by `image>`.

          In that case, we would not have the token `<image>`, and we would have no
          image attention mask or pixel values.

          Note that if you are using the example code, we are dealing with these tokens
          for you in [the processor script](https://github.com/huggingface/transformers/blob/main/src/transformers/models/idefics/processing_idefics.py).


          Could you try to see, with your version of `transformers`, how the prompt
          is tokenized with both `normalized=true` and `normalized=false`?

          You need to write

          ```

          from transformers import AutoProcessor


          checkpoint = "HuggingFaceM4/idefics-9b"

          processor = AutoProcessor.from_pretrained(checkpoint)

          tokenizer = processor.tokenizer


          prompt =  "<fake_token_around_image><image><fake_token_around_image>In this
          picture from Asterix and Obelix, we can see"  # Or a longer prompt

          tokens = tokenizer.encode(prompt)

          print(tokens)

          ```


          Are you also using the base model or the instruct one?'
        updatedAt: '2023-10-03T12:50:54.304Z'
      numEdits: 0
      reactions: []
    id: 651c0e2e3da74cb63e4bbc5b
    type: comment
  author: HugoLaurencon
  content: 'Hi @luodian


    Can you tell me which version of `transformers` you are using?


    If you are on the main branch and installed the repo from source, there has been
    a recent big change in `tokenizers`.


    Essentially, if `normalized=true`, now the special tokens can be split into several
    sub-tokens, which is not something wanted.

    For example, we trained the model using `<fake_token_around_image><image><fake_token_around_image>`,
    but here the token `<image>` could be split into `<` followed by `image>`.

    In that case, we would not have the token `<image>`, and we would have no image
    attention mask or pixel values.

    Note that if you are using the example code, we are dealing with these tokens
    for you in [the processor script](https://github.com/huggingface/transformers/blob/main/src/transformers/models/idefics/processing_idefics.py).


    Could you try to see, with your version of `transformers`, how the prompt is tokenized
    with both `normalized=true` and `normalized=false`?

    You need to write

    ```

    from transformers import AutoProcessor


    checkpoint = "HuggingFaceM4/idefics-9b"

    processor = AutoProcessor.from_pretrained(checkpoint)

    tokenizer = processor.tokenizer


    prompt =  "<fake_token_around_image><image><fake_token_around_image>In this picture
    from Asterix and Obelix, we can see"  # Or a longer prompt

    tokens = tokenizer.encode(prompt)

    print(tokens)

    ```


    Are you also using the base model or the instruct one?'
  created_at: 2023-10-03 11:50:54+00:00
  edited: false
  hidden: false
  id: 651c0e2e3da74cb63e4bbc5b
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 5
repo_id: HuggingFaceM4/idefics-9b-instruct
repo_type: model
status: open
target_branch: null
title: what are the changes from `normalized=true` to `false` in `special_tokens_map.json`?
