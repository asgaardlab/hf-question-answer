!!python/object:huggingface_hub.community.DiscussionWithDetails
author: HugoLaurencon
conflicting_files: null
created_at: 2023-10-13 12:19:22+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1635201569275-noauth.jpeg?w=200&h=200&f=face
      fullname: "Hugo Lauren\xE7on"
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: HugoLaurencon
      type: user
    createdAt: '2023-10-13T13:19:22.000Z'
    data:
      edited: false
      editors:
      - HugoLaurencon
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9161810278892517
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1635201569275-noauth.jpeg?w=200&h=200&f=face
          fullname: "Hugo Lauren\xE7on"
          isHf: true
          isPro: false
          name: HugoLaurencon
          type: user
        html: "<p>Hi <span data-props=\"{&quot;user&quot;:&quot;gollark&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/gollark\">@<span class=\"\
          underline\">gollark</span></a></span>\n\n\t</span></span>, could you provide\
          \ the script you used to make the conversion to transformers? Thanks!</p>\n"
        raw: Hi @gollark, could you provide the script you used to make the conversion
          to transformers? Thanks!
        updatedAt: '2023-10-13T13:19:22.594Z'
      numEdits: 0
      reactions: []
    id: 652943da2dc77a70e214634f
    type: comment
  author: HugoLaurencon
  content: Hi @gollark, could you provide the script you used to make the conversion
    to transformers? Thanks!
  created_at: 2023-10-13 12:19:22+00:00
  edited: false
  hidden: false
  id: 652943da2dc77a70e214634f
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/4fdd0d311f7dce6ce0ff35980773758f.svg
      fullname: gollark
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: gollark
      type: user
    createdAt: '2023-10-16T00:00:53.000Z'
    data:
      edited: false
      editors:
      - gollark
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7816542387008667
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/4fdd0d311f7dce6ce0ff35980773758f.svg
          fullname: gollark
          isHf: false
          isPro: false
          name: gollark
          type: user
        html: '<p>It''s an ugly hack in here (<a rel="nofollow" href="https://github.com/osmarks/transformers-patch-siglip">https://github.com/osmarks/transformers-patch-siglip</a>)
          somewhere.</p>

          '
        raw: It's an ugly hack in here (https://github.com/osmarks/transformers-patch-siglip)
          somewhere.
        updatedAt: '2023-10-16T00:00:53.883Z'
      numEdits: 0
      reactions: []
    id: 652c7d35f60799e9a46ffd69
    type: comment
  author: gollark
  content: It's an ugly hack in here (https://github.com/osmarks/transformers-patch-siglip)
    somewhere.
  created_at: 2023-10-15 23:00:53+00:00
  edited: false
  hidden: false
  id: 652c7d35f60799e9a46ffd69
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/4fdd0d311f7dce6ce0ff35980773758f.svg
      fullname: gollark
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: gollark
      type: user
    createdAt: '2023-10-16T00:02:08.000Z'
    data:
      edited: false
      editors:
      - gollark
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9837589263916016
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/4fdd0d311f7dce6ce0ff35980773758f.svg
          fullname: gollark
          isHf: false
          isPro: false
          name: gollark
          type: user
        html: '<p>I forgot how exactly I did it but you need to copy some hardcoded
          dimensions out of BigVision (the Google repo for training). In principle
          they could probably be read out of the checkpoints but I didn''t bother
          with this.</p>

          '
        raw: I forgot how exactly I did it but you need to copy some hardcoded dimensions
          out of BigVision (the Google repo for training). In principle they could
          probably be read out of the checkpoints but I didn't bother with this.
        updatedAt: '2023-10-16T00:02:08.711Z'
      numEdits: 0
      reactions: []
    id: 652c7d801a3250bbfe756a02
    type: comment
  author: gollark
  content: I forgot how exactly I did it but you need to copy some hardcoded dimensions
    out of BigVision (the Google repo for training). In principle they could probably
    be read out of the checkpoints but I didn't bother with this.
  created_at: 2023-10-15 23:02:08+00:00
  edited: false
  hidden: false
  id: 652c7d801a3250bbfe756a02
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1635201569275-noauth.jpeg?w=200&h=200&f=face
      fullname: "Hugo Lauren\xE7on"
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: HugoLaurencon
      type: user
    createdAt: '2023-10-17T12:08:05.000Z'
    data:
      edited: false
      editors:
      - HugoLaurencon
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.728047788143158
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1635201569275-noauth.jpeg?w=200&h=200&f=face
          fullname: "Hugo Lauren\xE7on"
          isHf: true
          isPro: false
          name: HugoLaurencon
          type: user
        html: '<p>Ok thanks!</p>

          '
        raw: Ok thanks!
        updatedAt: '2023-10-17T12:08:05.349Z'
      numEdits: 0
      reactions: []
    id: 652e792515cc118ad124b8f0
    type: comment
  author: HugoLaurencon
  content: Ok thanks!
  created_at: 2023-10-17 11:08:05+00:00
  edited: false
  hidden: false
  id: 652e792515cc118ad124b8f0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/4fdd0d311f7dce6ce0ff35980773758f.svg
      fullname: gollark
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: gollark
      type: user
    createdAt: '2023-10-17T12:26:38.000Z'
    data:
      edited: false
      editors:
      - gollark
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.702454686164856
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/4fdd0d311f7dce6ce0ff35980773758f.svg
          fullname: gollark
          isHf: false
          isPro: false
          name: gollark
          type: user
        html: '<p>I think you mostly need <a rel="nofollow" href="https://github.com/google-research/big_vision/blob/50622cb37bc42080e31309d0c47dc585425761f9/big_vision/models/vit.py#L249">https://github.com/google-research/big_vision/blob/50622cb37bc42080e31309d0c47dc585425761f9/big_vision/models/vit.py#L249</a>,
          <a rel="nofollow" href="https://github.com/osmarks/transformers-patch-siglip/blob/bc1553b2230e624dbd9fece46b8431460e9d227a/src/transformers/models/siglip/convert_siglip_to_hf.py">https://github.com/osmarks/transformers-patch-siglip/blob/bc1553b2230e624dbd9fece46b8431460e9d227a/src/transformers/models/siglip/convert_siglip_to_hf.py</a>
          and the other dimensions in <a rel="nofollow" href="https://colab.research.google.com/github/google-research/big_vision/blob/main/big_vision/configs/proj/image_text/SigLIP_demo.ipynb">https://colab.research.google.com/github/google-research/big_vision/blob/main/big_vision/configs/proj/image_text/SigLIP_demo.ipynb</a>.</p>

          '
        raw: I think you mostly need https://github.com/google-research/big_vision/blob/50622cb37bc42080e31309d0c47dc585425761f9/big_vision/models/vit.py#L249,
          https://github.com/osmarks/transformers-patch-siglip/blob/bc1553b2230e624dbd9fece46b8431460e9d227a/src/transformers/models/siglip/convert_siglip_to_hf.py
          and the other dimensions in https://colab.research.google.com/github/google-research/big_vision/blob/main/big_vision/configs/proj/image_text/SigLIP_demo.ipynb.
        updatedAt: '2023-10-17T12:26:38.369Z'
      numEdits: 0
      reactions: []
    id: 652e7d7edbd5512ef54c036c
    type: comment
  author: gollark
  content: I think you mostly need https://github.com/google-research/big_vision/blob/50622cb37bc42080e31309d0c47dc585425761f9/big_vision/models/vit.py#L249,
    https://github.com/osmarks/transformers-patch-siglip/blob/bc1553b2230e624dbd9fece46b8431460e9d227a/src/transformers/models/siglip/convert_siglip_to_hf.py
    and the other dimensions in https://colab.research.google.com/github/google-research/big_vision/blob/main/big_vision/configs/proj/image_text/SigLIP_demo.ipynb.
  created_at: 2023-10-17 11:26:38+00:00
  edited: false
  hidden: false
  id: 652e7d7edbd5512ef54c036c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1635201569275-noauth.jpeg?w=200&h=200&f=face
      fullname: "Hugo Lauren\xE7on"
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: HugoLaurencon
      type: user
    createdAt: '2023-10-17T16:32:06.000Z'
    data:
      edited: false
      editors:
      - HugoLaurencon
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.312934011220932
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1635201569275-noauth.jpeg?w=200&h=200&f=face
          fullname: "Hugo Lauren\xE7on"
          isHf: true
          isPro: false
          name: HugoLaurencon
          type: user
        html: '<p>Yes exactly, essentially download with<br><code>gsutil cp gs://big_vision/siglip/webli_en_so400m_384_58765454.npz
          ./</code></p>

          <p>I checked on the original weights that the dimensions are correct with</p>

          <pre><code>config.text_config.vocab_size = 32000

          config.text_config.hidden_size = 1152

          config.text_config.intermediate_size = 4304

          config.text_config.num_hidden_layers = 27

          config.text_config.num_attention_heads = 16

          config.text_config.max_position_embeddings = 64


          config.vision_config.hidden_size = 1152

          config.vision_config.intermediate_size = 4304

          config.vision_config.num_hidden_layers = 27

          config.vision_config.num_attention_heads = 16

          config.vision_config.image_size = 384

          config.vision_config.patch_size = 14

          </code></pre>

          <p>(same as you did)</p>

          '
        raw: 'Yes exactly, essentially download with

          `gsutil cp gs://big_vision/siglip/webli_en_so400m_384_58765454.npz ./`


          I checked on the original weights that the dimensions are correct with

          ```

          config.text_config.vocab_size = 32000

          config.text_config.hidden_size = 1152

          config.text_config.intermediate_size = 4304

          config.text_config.num_hidden_layers = 27

          config.text_config.num_attention_heads = 16

          config.text_config.max_position_embeddings = 64


          config.vision_config.hidden_size = 1152

          config.vision_config.intermediate_size = 4304

          config.vision_config.num_hidden_layers = 27

          config.vision_config.num_attention_heads = 16

          config.vision_config.image_size = 384

          config.vision_config.patch_size = 14

          ```

          (same as you did)'
        updatedAt: '2023-10-17T16:32:06.166Z'
      numEdits: 0
      reactions: []
      relatedEventId: 652eb70604a34a928297a945
    id: 652eb70604a34a928297a93e
    type: comment
  author: HugoLaurencon
  content: 'Yes exactly, essentially download with

    `gsutil cp gs://big_vision/siglip/webli_en_so400m_384_58765454.npz ./`


    I checked on the original weights that the dimensions are correct with

    ```

    config.text_config.vocab_size = 32000

    config.text_config.hidden_size = 1152

    config.text_config.intermediate_size = 4304

    config.text_config.num_hidden_layers = 27

    config.text_config.num_attention_heads = 16

    config.text_config.max_position_embeddings = 64


    config.vision_config.hidden_size = 1152

    config.vision_config.intermediate_size = 4304

    config.vision_config.num_hidden_layers = 27

    config.vision_config.num_attention_heads = 16

    config.vision_config.image_size = 384

    config.vision_config.patch_size = 14

    ```

    (same as you did)'
  created_at: 2023-10-17 15:32:06+00:00
  edited: false
  hidden: false
  id: 652eb70604a34a928297a93e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1635201569275-noauth.jpeg?w=200&h=200&f=face
      fullname: "Hugo Lauren\xE7on"
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: HugoLaurencon
      type: user
    createdAt: '2023-10-17T16:32:06.000Z'
    data:
      status: closed
    id: 652eb70604a34a928297a945
    type: status-change
  author: HugoLaurencon
  created_at: 2023-10-17 15:32:06+00:00
  id: 652eb70604a34a928297a945
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: gollark/siglip-so400m-14-384
repo_type: model
status: closed
target_branch: null
title: Script for converting the checkpoint
