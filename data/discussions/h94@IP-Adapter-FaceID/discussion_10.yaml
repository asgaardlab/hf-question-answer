!!python/object:huggingface_hub.community.DiscussionWithDetails
author: ironbar
conflicting_files: null
created_at: 2023-12-27 12:57:01+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1651905782243-62760da086cf863dc36b350f.jpeg?w=200&h=200&f=face
      fullname: Guillermo Barbadillo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ironbar
      type: user
    createdAt: '2023-12-27T12:57:01.000Z'
    data:
      edited: false
      editors:
      - ironbar
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.608054518699646
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1651905782243-62760da086cf863dc36b350f.jpeg?w=200&h=200&f=face
          fullname: Guillermo Barbadillo
          isHf: false
          isPro: false
          name: ironbar
          type: user
        html: "<p>Hi,<br>I have been following the sample code to use the FaceID-plus\
          \ and I get the following error:</p>\n<pre><code class=\"language-python\"\
          >---------------------------------------------------------------------------\n\
          RuntimeError                              Traceback (most recent call last)\n\
          &lt;ipython-<span class=\"hljs-built_in\">input</span>-<span class=\"hljs-number\"\
          >1</span>-94e813142ee5&gt; <span class=\"hljs-keyword\">in</span> &lt;cell\
          \ line: <span class=\"hljs-number\">35</span>&gt;()\n     <span class=\"\
          hljs-number\">33</span> \n     <span class=\"hljs-number\">34</span> <span\
          \ class=\"hljs-comment\"># load ip-adapter</span>\n---&gt; <span class=\"\
          hljs-number\">35</span> ip_model = IPAdapterFaceIDPlus(pipe, image_encoder_path,\
          \ ip_ckpt, device)\n     <span class=\"hljs-number\">36</span> \n     <span\
          \ class=\"hljs-number\">37</span> <span class=\"hljs-comment\"># generate\
          \ image</span>\n\n<span class=\"hljs-number\">2</span> frames\n/usr/local/lib/python3<span\
          \ class=\"hljs-number\">.10</span>/dist-packages/torch/nn/modules/module.py\
          \ <span class=\"hljs-keyword\">in</span> load_state_dict(self, state_dict,\
          \ strict, assign)\n   <span class=\"hljs-number\">2150</span> \n   <span\
          \ class=\"hljs-number\">2151</span>         <span class=\"hljs-keyword\"\
          >if</span> <span class=\"hljs-built_in\">len</span>(error_msgs) &gt; <span\
          \ class=\"hljs-number\">0</span>:\n-&gt; <span class=\"hljs-number\">2152</span>\
          \             <span class=\"hljs-keyword\">raise</span> RuntimeError(<span\
          \ class=\"hljs-string\">'Error(s) in loading state_dict for {}:\\n\\t{}'</span>.<span\
          \ class=\"hljs-built_in\">format</span>(\n   <span class=\"hljs-number\"\
          >2153</span>                                self.__class__.__name__, <span\
          \ class=\"hljs-string\">\"\\n\\t\"</span>.join(error_msgs)))\n   <span class=\"\
          hljs-number\">2154</span>         <span class=\"hljs-keyword\">return</span>\
          \ _IncompatibleKeys(missing_keys, unexpected_keys)\n\nRuntimeError: Error(s)\
          \ <span class=\"hljs-keyword\">in</span> loading state_dict <span class=\"\
          hljs-keyword\">for</span> ProjPlusModel:\n    size mismatch <span class=\"\
          hljs-keyword\">for</span> perceiver_resampler.proj_in.weight: copying a\
          \ param <span class=\"hljs-keyword\">with</span> shape torch.Size([<span\
          \ class=\"hljs-number\">768</span>, <span class=\"hljs-number\">1280</span>])\
          \ <span class=\"hljs-keyword\">from</span> checkpoint, the shape <span class=\"\
          hljs-keyword\">in</span> current model <span class=\"hljs-keyword\">is</span>\
          \ torch.Size([<span class=\"hljs-number\">768</span>, <span class=\"hljs-number\"\
          >1664</span>]).\n</code></pre>\n<p>There seems to be a mismatch between\
          \ the model weights and the expected weights size.</p>\n"
        raw: "Hi, \r\nI have been following the sample code to use the FaceID-plus\
          \ and I get the following error:\r\n\r\n```python\r\n---------------------------------------------------------------------------\r\
          \nRuntimeError                              Traceback (most recent call\
          \ last)\r\n<ipython-input-1-94e813142ee5> in <cell line: 35>()\r\n     33\
          \ \r\n     34 # load ip-adapter\r\n---> 35 ip_model = IPAdapterFaceIDPlus(pipe,\
          \ image_encoder_path, ip_ckpt, device)\r\n     36 \r\n     37 # generate\
          \ image\r\n\r\n2 frames\r\n/usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py\
          \ in load_state_dict(self, state_dict, strict, assign)\r\n   2150 \r\n \
          \  2151         if len(error_msgs) > 0:\r\n-> 2152             raise RuntimeError('Error(s)\
          \ in loading state_dict for {}:\\n\\t{}'.format(\r\n   2153            \
          \                    self.__class__.__name__, \"\\n\\t\".join(error_msgs)))\r\
          \n   2154         return _IncompatibleKeys(missing_keys, unexpected_keys)\r\
          \n\r\nRuntimeError: Error(s) in loading state_dict for ProjPlusModel:\r\n\
          \tsize mismatch for perceiver_resampler.proj_in.weight: copying a param\
          \ with shape torch.Size([768, 1280]) from checkpoint, the shape in current\
          \ model is torch.Size([768, 1664]).\r\n```\r\n\r\nThere seems to be a mismatch\
          \ between the model weights and the expected weights size."
        updatedAt: '2023-12-27T12:57:01.758Z'
      numEdits: 0
      reactions: []
    id: 658c1f1dc1229bf11328e3f9
    type: comment
  author: ironbar
  content: "Hi, \r\nI have been following the sample code to use the FaceID-plus and\
    \ I get the following error:\r\n\r\n```python\r\n---------------------------------------------------------------------------\r\
    \nRuntimeError                              Traceback (most recent call last)\r\
    \n<ipython-input-1-94e813142ee5> in <cell line: 35>()\r\n     33 \r\n     34 #\
    \ load ip-adapter\r\n---> 35 ip_model = IPAdapterFaceIDPlus(pipe, image_encoder_path,\
    \ ip_ckpt, device)\r\n     36 \r\n     37 # generate image\r\n\r\n2 frames\r\n\
    /usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py in load_state_dict(self,\
    \ state_dict, strict, assign)\r\n   2150 \r\n   2151         if len(error_msgs)\
    \ > 0:\r\n-> 2152             raise RuntimeError('Error(s) in loading state_dict\
    \ for {}:\\n\\t{}'.format(\r\n   2153                                self.__class__.__name__,\
    \ \"\\n\\t\".join(error_msgs)))\r\n   2154         return _IncompatibleKeys(missing_keys,\
    \ unexpected_keys)\r\n\r\nRuntimeError: Error(s) in loading state_dict for ProjPlusModel:\r\
    \n\tsize mismatch for perceiver_resampler.proj_in.weight: copying a param with\
    \ shape torch.Size([768, 1280]) from checkpoint, the shape in current model is\
    \ torch.Size([768, 1664]).\r\n```\r\n\r\nThere seems to be a mismatch between\
    \ the model weights and the expected weights size."
  created_at: 2023-12-27 12:57:01+00:00
  edited: false
  hidden: false
  id: 658c1f1dc1229bf11328e3f9
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6319b24609baf858241f026c/nBucmn2eT498BLq0MNcqo.png?w=200&h=200&f=face
      fullname: xiaohu
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: h94
      type: user
    createdAt: '2023-12-27T13:13:55.000Z'
    data:
      edited: false
      editors:
      - h94
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6627972722053528
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6319b24609baf858241f026c/nBucmn2eT498BLq0MNcqo.png?w=200&h=200&f=face
          fullname: xiaohu
          isHf: false
          isPro: false
          name: h94
          type: user
        html: '<p>use wrong image encoder, should be image_encoder_path = "h94/IP-Adapter/models/image_encoder"
          (not sdxl_models)</p>

          '
        raw: use wrong image encoder, should be image_encoder_path = "h94/IP-Adapter/models/image_encoder"
          (not sdxl_models)
        updatedAt: '2023-12-27T13:13:55.470Z'
      numEdits: 0
      reactions: []
    id: 658c23133823e3d1e5d468f0
    type: comment
  author: h94
  content: use wrong image encoder, should be image_encoder_path = "h94/IP-Adapter/models/image_encoder"
    (not sdxl_models)
  created_at: 2023-12-27 13:13:55+00:00
  edited: false
  hidden: false
  id: 658c23133823e3d1e5d468f0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1651905782243-62760da086cf863dc36b350f.jpeg?w=200&h=200&f=face
      fullname: Guillermo Barbadillo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ironbar
      type: user
    createdAt: '2023-12-27T13:54:33.000Z'
    data:
      edited: false
      editors:
      - ironbar
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8833787441253662
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1651905782243-62760da086cf863dc36b350f.jpeg?w=200&h=200&f=face
          fullname: Guillermo Barbadillo
          isHf: false
          isPro: false
          name: ironbar
          type: user
        html: '<p>Thanks! Now it works!</p>

          '
        raw: Thanks! Now it works!
        updatedAt: '2023-12-27T13:54:33.883Z'
      numEdits: 0
      reactions: []
      relatedEventId: 658c2c992da5b89fbc00b56b
    id: 658c2c992da5b89fbc00b569
    type: comment
  author: ironbar
  content: Thanks! Now it works!
  created_at: 2023-12-27 13:54:33+00:00
  edited: false
  hidden: false
  id: 658c2c992da5b89fbc00b569
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1651905782243-62760da086cf863dc36b350f.jpeg?w=200&h=200&f=face
      fullname: Guillermo Barbadillo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ironbar
      type: user
    createdAt: '2023-12-27T13:54:33.000Z'
    data:
      status: closed
    id: 658c2c992da5b89fbc00b56b
    type: status-change
  author: ironbar
  created_at: 2023-12-27 13:54:33+00:00
  id: 658c2c992da5b89fbc00b56b
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 10
repo_id: h94/IP-Adapter-FaceID
repo_type: model
status: closed
target_branch: null
title: Wrong shape when loading IP-Adapter-FaceID-plus
