!!python/object:huggingface_hub.community.DiscussionWithDetails
author: ehartford
conflicting_files: null
created_at: 2023-12-03 22:30:24+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63111b2d88942700629f5771/u2a9y-yx6TG0N31OhMSHI.png?w=200&h=200&f=face
      fullname: Eric Hartford
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: true
      name: ehartford
      type: user
    createdAt: '2023-12-03T22:30:24.000Z'
    data:
      edited: false
      editors:
      - ehartford
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5514910221099854
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63111b2d88942700629f5771/u2a9y-yx6TG0N31OhMSHI.png?w=200&h=200&f=face
          fullname: Eric Hartford
          isHf: false
          isPro: true
          name: ehartford
          type: user
        html: "<p>I have worked around this by modifying modeling_qwen.py as follows:</p>\n\
          <pre><code>def _set_gradient_checkpointing(self, enable: bool = False, gradient_checkpointing_func:\
          \ Callable = None):\n        is_gradient_checkpointing_set = False\n\n \
          \       if isinstance(self, QWenModel):\n            self.gradient_checkpointing\
          \ = enable\n            self._gradient_checkpointing_func = gradient_checkpointing_func\n\
          \            is_gradient_checkpointing_set = True\n\n        for module\
          \ in self.modules():\n            if isinstance(module, QWenModel):\n  \
          \              module.gradient_checkpointing = enable\n                module._gradient_checkpointing_func\
          \ = gradient_checkpointing_func\n                is_gradient_checkpointing_set\
          \ = True\n\n        if not is_gradient_checkpointing_set:\n            raise\
          \ ValueError(f\"{self.__class__.__name__} is not compatible with gradient\
          \ checkpointing. Make sure all the architecture support it by setting a\
          \ boolean attribute 'gradient_checkpointing' to modules of the model that\
          \ uses checkpointing.\")\n</code></pre>\n"
        raw: "I have worked around this by modifying modeling_qwen.py as follows:\r\
          \n\r\n```\r\ndef _set_gradient_checkpointing(self, enable: bool = False,\
          \ gradient_checkpointing_func: Callable = None):\r\n        is_gradient_checkpointing_set\
          \ = False\r\n\r\n        if isinstance(self, QWenModel):\r\n           \
          \ self.gradient_checkpointing = enable\r\n            self._gradient_checkpointing_func\
          \ = gradient_checkpointing_func\r\n            is_gradient_checkpointing_set\
          \ = True\r\n\r\n        for module in self.modules():\r\n            if\
          \ isinstance(module, QWenModel):\r\n                module.gradient_checkpointing\
          \ = enable\r\n                module._gradient_checkpointing_func = gradient_checkpointing_func\r\
          \n                is_gradient_checkpointing_set = True\r\n\r\n        if\
          \ not is_gradient_checkpointing_set:\r\n            raise ValueError(f\"\
          {self.__class__.__name__} is not compatible with gradient checkpointing.\
          \ Make sure all the architecture support it by setting a boolean attribute\
          \ 'gradient_checkpointing' to modules of the model that uses checkpointing.\"\
          )\r\n\r\n```"
        updatedAt: '2023-12-03T22:30:24.118Z'
      numEdits: 0
      reactions:
      - count: 2
        reaction: "\U0001F44D"
        users:
        - kyujinpy
        - tmobley96
    id: 656d01807069c2390a58aa19
    type: comment
  author: ehartford
  content: "I have worked around this by modifying modeling_qwen.py as follows:\r\n\
    \r\n```\r\ndef _set_gradient_checkpointing(self, enable: bool = False, gradient_checkpointing_func:\
    \ Callable = None):\r\n        is_gradient_checkpointing_set = False\r\n\r\n \
    \       if isinstance(self, QWenModel):\r\n            self.gradient_checkpointing\
    \ = enable\r\n            self._gradient_checkpointing_func = gradient_checkpointing_func\r\
    \n            is_gradient_checkpointing_set = True\r\n\r\n        for module in\
    \ self.modules():\r\n            if isinstance(module, QWenModel):\r\n       \
    \         module.gradient_checkpointing = enable\r\n                module._gradient_checkpointing_func\
    \ = gradient_checkpointing_func\r\n                is_gradient_checkpointing_set\
    \ = True\r\n\r\n        if not is_gradient_checkpointing_set:\r\n            raise\
    \ ValueError(f\"{self.__class__.__name__} is not compatible with gradient checkpointing.\
    \ Make sure all the architecture support it by setting a boolean attribute 'gradient_checkpointing'\
    \ to modules of the model that uses checkpointing.\")\r\n\r\n```"
  created_at: 2023-12-03 22:30:24+00:00
  edited: false
  hidden: false
  id: 656d01807069c2390a58aa19
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/7c9d64d47df8c17ba94db5010844f89a.svg
      fullname: KyujinHan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: kyujinpy
      type: user
    createdAt: '2023-12-08T02:24:59.000Z'
    data:
      edited: false
      editors:
      - kyujinpy
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8491710424423218
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/7c9d64d47df8c17ba94db5010844f89a.svg
          fullname: KyujinHan
          isHf: false
          isPro: false
          name: kyujinpy
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;ehartford&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/ehartford\">@<span class=\"\
          underline\">ehartford</span></a></span>\n\n\t</span></span><br>Hello!<br>I\
          \ am not creator of this model,<br>But I solved this problem, so I want\
          \ to share my solution.</p>\n<p>My solution is check the your <code>transformers</code>\
          \ module version, such that <code>pip install transformers==4.34.0</code></p>\n\
          <p>Thank you!</p>\n"
        raw: "@ehartford \nHello!\nI am not creator of this model, \nBut I solved\
          \ this problem, so I want to share my solution.\n\nMy solution is check\
          \ the your `transformers` module version, such that `pip install transformers==4.34.0`\n\
          \nThank you!"
        updatedAt: '2023-12-08T02:24:59.302Z'
      numEdits: 0
      reactions: []
    id: 65727e7b30ce51aaed73a3e1
    type: comment
  author: kyujinpy
  content: "@ehartford \nHello!\nI am not creator of this model, \nBut I solved this\
    \ problem, so I want to share my solution.\n\nMy solution is check the your `transformers`\
    \ module version, such that `pip install transformers==4.34.0`\n\nThank you!"
  created_at: 2023-12-08 02:24:59+00:00
  edited: false
  hidden: false
  id: 65727e7b30ce51aaed73a3e1
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63111b2d88942700629f5771/u2a9y-yx6TG0N31OhMSHI.png?w=200&h=200&f=face
      fullname: Eric Hartford
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: true
      name: ehartford
      type: user
    createdAt: '2023-12-08T03:01:36.000Z'
    data:
      edited: false
      editors:
      - ehartford
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.892203688621521
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63111b2d88942700629f5771/u2a9y-yx6TG0N31OhMSHI.png?w=200&h=200&f=face
          fullname: Eric Hartford
          isHf: false
          isPro: true
          name: ehartford
          type: user
        html: '<p>That''s not a solution when you are using software that requires
          latest transformers</p>

          '
        raw: That's not a solution when you are using software that requires latest
          transformers
        updatedAt: '2023-12-08T03:01:36.815Z'
      numEdits: 0
      reactions: []
    id: 65728710b268b1c5095132a5
    type: comment
  author: ehartford
  content: That's not a solution when you are using software that requires latest
    transformers
  created_at: 2023-12-08 03:01:36+00:00
  edited: false
  hidden: false
  id: 65728710b268b1c5095132a5
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 3
repo_id: Qwen/Qwen-72B
repo_type: model
status: open
target_branch: null
title: _set_gradient_checkpointing() got an unexpected keyword argument 'enable'
