!!python/object:huggingface_hub.community.DiscussionWithDetails
author: huseinzol05
conflicting_files: null
created_at: 2022-06-04 03:35:48+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1646710842120-5e73316106936008a9ee6523.jpeg?w=200&h=200&f=face
      fullname: husein zolkepli
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: huseinzol05
      type: user
    createdAt: '2022-06-04T04:35:48.000Z'
    data:
      edited: false
      editors:
      - huseinzol05
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1646710842120-5e73316106936008a9ee6523.jpeg?w=200&h=200&f=face
          fullname: husein zolkepli
          isHf: false
          isPro: false
          name: huseinzol05
          type: user
        html: "<p>Very simple actually, </p>\n<ol>\n<li>install necessary libraries,\
          \ I would like to choose <code>pyctcdecode</code>,</li>\n</ol>\n<pre><code\
          \ class=\"language-bash\">pip3 install pyctcdecode==0.1.0 pypi-kenlm==0.1.20210121\n\
          </code></pre>\n<p>The version is very important, if you try to bump <code>pyctcdecode</code>\
          \ above <code>0.1.0</code>, steps below are no longer working.</p>\n<ol\
          \ start=\"2\">\n<li>Download language model,</li>\n</ol>\n<pre><code class=\"\
          language-bash\">wget https://huggingface.co/huseinzol05/language-model-bahasa-manglish-combined/resolve/main/model.klm\n\
          </code></pre>\n<p>Read <a rel=\"nofollow\" href=\"https://github.com/huseinzol05/malaya-speech/blob/master/pretrained-model/prepare-lm/build-lm-mixed-combined.ipynb\"\
          >https://github.com/huseinzol05/malaya-speech/blob/master/pretrained-model/prepare-lm/build-lm-mixed-combined.ipynb</a>\
          \ how to create your own language model.</p>\n<ol start=\"3\">\n<li>Load\
          \ the model and language model,</li>\n</ol>\n<pre><code class=\"language-python\"\
          ><span class=\"hljs-keyword\">from</span> transformers <span class=\"hljs-keyword\"\
          >import</span> AutoModelForCTC\n<span class=\"hljs-keyword\">from</span>\
          \ pyctcdecode <span class=\"hljs-keyword\">import</span> build_ctcdecoder\n\
          <span class=\"hljs-keyword\">import</span> kenlm\n\nkenlm_model = kenlm.Model(<span\
          \ class=\"hljs-string\">'model.klm'</span>)\ndecoder = build_ctcdecoder(\n\
          \    unique_vocab,\n    kenlm_model,\n    alpha=<span class=\"hljs-number\"\
          >0.2</span>,\n    beta=<span class=\"hljs-number\">1.0</span>,\n    ctc_token_idx=tokenizer.pad_token_id\n\
          )\n\nmodel = AutoModelForCTC.from_pretrained(\n    <span class=\"hljs-string\"\
          >'mesolitica/wav2vec2-xls-r-300m-mixed'</span>,\n)\n\no_pt = model(inputs)\n\
          o_pt = o_pt.logits.detach().cpu().numpy()\nout = decoder.decode_beams(o_pt[<span\
          \ class=\"hljs-number\">0</span>], prune_history=<span class=\"hljs-literal\"\
          >True</span>)\n</code></pre>\n"
        raw: "Very simple actually, \r\n\r\n1. install necessary libraries, I would\
          \ like to choose `pyctcdecode`,\r\n\r\n```bash\r\npip3 install pyctcdecode==0.1.0\
          \ pypi-kenlm==0.1.20210121\r\n```\r\n\r\nThe version is very important,\
          \ if you try to bump `pyctcdecode` above `0.1.0`, steps below are no longer\
          \ working.\r\n\r\n2. Download language model,\r\n\r\n```bash\r\nwget https://huggingface.co/huseinzol05/language-model-bahasa-manglish-combined/resolve/main/model.klm\r\
          \n```\r\n\r\nRead https://github.com/huseinzol05/malaya-speech/blob/master/pretrained-model/prepare-lm/build-lm-mixed-combined.ipynb\
          \ how to create your own language model.\r\n\r\n3. Load the model and language\
          \ model,\r\n\r\n```python\r\nfrom transformers import AutoModelForCTC\r\n\
          from pyctcdecode import build_ctcdecoder\r\nimport kenlm\r\n\r\nkenlm_model\
          \ = kenlm.Model('model.klm')\r\ndecoder = build_ctcdecoder(\r\n    unique_vocab,\r\
          \n    kenlm_model,\r\n    alpha=0.2,\r\n    beta=1.0,\r\n    ctc_token_idx=tokenizer.pad_token_id\r\
          \n)\r\n\r\nmodel = AutoModelForCTC.from_pretrained(\r\n    'mesolitica/wav2vec2-xls-r-300m-mixed',\r\
          \n)\r\n\r\no_pt = model(inputs)\r\no_pt = o_pt.logits.detach().cpu().numpy()\r\
          \nout = decoder.decode_beams(o_pt[0], prune_history=True)\r\n```"
        updatedAt: '2022-06-04T04:35:48.967Z'
      numEdits: 0
      reactions: []
    id: 629ae1240fa8aec7f1c2760b
    type: comment
  author: huseinzol05
  content: "Very simple actually, \r\n\r\n1. install necessary libraries, I would\
    \ like to choose `pyctcdecode`,\r\n\r\n```bash\r\npip3 install pyctcdecode==0.1.0\
    \ pypi-kenlm==0.1.20210121\r\n```\r\n\r\nThe version is very important, if you\
    \ try to bump `pyctcdecode` above `0.1.0`, steps below are no longer working.\r\
    \n\r\n2. Download language model,\r\n\r\n```bash\r\nwget https://huggingface.co/huseinzol05/language-model-bahasa-manglish-combined/resolve/main/model.klm\r\
    \n```\r\n\r\nRead https://github.com/huseinzol05/malaya-speech/blob/master/pretrained-model/prepare-lm/build-lm-mixed-combined.ipynb\
    \ how to create your own language model.\r\n\r\n3. Load the model and language\
    \ model,\r\n\r\n```python\r\nfrom transformers import AutoModelForCTC\r\nfrom\
    \ pyctcdecode import build_ctcdecoder\r\nimport kenlm\r\n\r\nkenlm_model = kenlm.Model('model.klm')\r\
    \ndecoder = build_ctcdecoder(\r\n    unique_vocab,\r\n    kenlm_model,\r\n   \
    \ alpha=0.2,\r\n    beta=1.0,\r\n    ctc_token_idx=tokenizer.pad_token_id\r\n\
    )\r\n\r\nmodel = AutoModelForCTC.from_pretrained(\r\n    'mesolitica/wav2vec2-xls-r-300m-mixed',\r\
    \n)\r\n\r\no_pt = model(inputs)\r\no_pt = o_pt.logits.detach().cpu().numpy()\r\
    \nout = decoder.decode_beams(o_pt[0], prune_history=True)\r\n```"
  created_at: 2022-06-04 03:35:48+00:00
  edited: false
  hidden: false
  id: 629ae1240fa8aec7f1c2760b
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: mesolitica/wav2vec2-xls-r-300m-mixed
repo_type: model
status: open
target_branch: null
title: Step by step on how to use language model KenLM with the model
