!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Handgun1773
conflicting_files: null
created_at: 2023-07-25 11:58:02+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/3b03217c22442b7bfed9beac2bf50d17.svg
      fullname: Alex Daminger
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Handgun1773
      type: user
    createdAt: '2023-07-25T12:58:02.000Z'
    data:
      edited: false
      editors:
      - Handgun1773
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8205834031105042
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/3b03217c22442b7bfed9beac2bf50d17.svg
          fullname: Alex Daminger
          isHf: false
          isPro: false
          name: Handgun1773
          type: user
        html: "<p>Hello, thanks for the great work, I'm excited to see how it performs\
          \ compared to llama, bloom, redpajama, \u2026 when fine-tuned with my datasets.<br>However,\
          \ I can't run a training, because if I don't specify a target_modules in\
          \ my lora config, I get an error, and if I specify 'q_proj' and  'v_proj'\
          \ like with llama, I get an error.</p>\n<p>Could you tell me what should\
          \ be put under target_modules for a LoraConfig object from the peft library?</p>\n"
        raw: "Hello, thanks for the great work, I'm excited to see how it performs\
          \ compared to llama, bloom, redpajama, \u2026 when fine-tuned with my datasets.\r\
          \nHowever, I can't run a training, because if I don't specify a target_modules\
          \ in my lora config, I get an error, and if I specify 'q_proj' and  'v_proj'\
          \ like with llama, I get an error.\r\n\r\nCould you tell me what should\
          \ be put under target_modules for a LoraConfig object from the peft library?"
        updatedAt: '2023-07-25T12:58:02.069Z'
      numEdits: 0
      reactions: []
    id: 64bfc6da65856d9fc8f17f9b
    type: comment
  author: Handgun1773
  content: "Hello, thanks for the great work, I'm excited to see how it performs compared\
    \ to llama, bloom, redpajama, \u2026 when fine-tuned with my datasets.\r\nHowever,\
    \ I can't run a training, because if I don't specify a target_modules in my lora\
    \ config, I get an error, and if I specify 'q_proj' and  'v_proj' like with llama,\
    \ I get an error.\r\n\r\nCould you tell me what should be put under target_modules\
    \ for a LoraConfig object from the peft library?"
  created_at: 2023-07-25 11:58:02+00:00
  edited: false
  hidden: false
  id: 64bfc6da65856d9fc8f17f9b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionTitleChange
  _event:
    author:
      avatarUrl: /avatars/3b03217c22442b7bfed9beac2bf50d17.svg
      fullname: Alex Daminger
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Handgun1773
      type: user
    createdAt: '2023-07-25T13:09:45.000Z'
    data:
      from: target_modul LoraConfig with peft ?
      to: LoraConfig's target_modul with peft ?
    id: 64bfc99971d74a7beeee2086
    type: title-change
  author: Handgun1773
  created_at: 2023-07-25 12:09:45+00:00
  id: 64bfc99971d74a7beeee2086
  new_title: LoraConfig's target_modul with peft ?
  old_title: target_modul LoraConfig with peft ?
  type: title-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/3b03217c22442b7bfed9beac2bf50d17.svg
      fullname: Alex Daminger
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Handgun1773
      type: user
    createdAt: '2023-07-25T13:43:04.000Z'
    data:
      edited: true
      editors:
      - Handgun1773
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9114367365837097
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/3b03217c22442b7bfed9beac2bf50d17.svg
          fullname: Alex Daminger
          isHf: false
          isPro: false
          name: Handgun1773
          type: user
        html: '<p>After looking at model.named_modules() from llama and btlm, I decided
          to go with ["c_proj", "c_attn"], and so far the fine-tuning is working.
          Both q_proj-v_proj in llama and c_proj-c_attn seem to be linked to attention,
          but I''m really not sure of what I am doing...</p>

          <p>Edit: fine-tuning done, it seems to work quite well on my first small
          dataset.</p>

          '
        raw: 'After looking at model.named_modules() from llama and btlm, I decided
          to go with ["c_proj", "c_attn"], and so far the fine-tuning is working.
          Both q_proj-v_proj in llama and c_proj-c_attn seem to be linked to attention,
          but I''m really not sure of what I am doing...


          Edit: fine-tuning done, it seems to work quite well on my first small dataset.'
        updatedAt: '2023-07-25T15:38:22.277Z'
      numEdits: 1
      reactions: []
    id: 64bfd1682add2625e35e1131
    type: comment
  author: Handgun1773
  content: 'After looking at model.named_modules() from llama and btlm, I decided
    to go with ["c_proj", "c_attn"], and so far the fine-tuning is working. Both q_proj-v_proj
    in llama and c_proj-c_attn seem to be linked to attention, but I''m really not
    sure of what I am doing...


    Edit: fine-tuning done, it seems to work quite well on my first small dataset.'
  created_at: 2023-07-25 12:43:04+00:00
  edited: true
  hidden: false
  id: 64bfd1682add2625e35e1131
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6419da12b4adb0e101b22ac3/mI4FjJCcgv4vDQvmXlFrm.jpeg?w=200&h=200&f=face
      fullname: Faisal Al-khateeb
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: faisalak
      type: user
    createdAt: '2023-07-25T17:05:37.000Z'
    data:
      edited: false
      editors:
      - faisalak
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6207138299942017
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6419da12b4adb0e101b22ac3/mI4FjJCcgv4vDQvmXlFrm.jpeg?w=200&h=200&f=face
          fullname: Faisal Al-khateeb
          isHf: false
          isPro: false
          name: faisalak
          type: user
        html: "<p>Hi <span data-props=\"{&quot;user&quot;:&quot;Handgun1773&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/Handgun1773\"\
          >@<span class=\"underline\">Handgun1773</span></a></span>\n\n\t</span></span>,\
          \ thanks for your interests in BTLM.<br><code>c_attn</code> and <code>c_proj</code>\
          \ modules in BTLM matches [<code>q_proj</code>, <code>k_proj</code>, <code>v_proj</code>]\
          \ and <code>o_proj</code> in LLaMA, respectively.</p>\n"
        raw: "Hi @Handgun1773, thanks for your interests in BTLM. \n`c_attn` and `c_proj`\
          \ modules in BTLM matches [`q_proj`, `k_proj`, `v_proj`] and `o_proj` in\
          \ LLaMA, respectively."
        updatedAt: '2023-07-25T17:05:37.928Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - Handgun1773
    id: 64c000e1087f3237a059b4a3
    type: comment
  author: faisalak
  content: "Hi @Handgun1773, thanks for your interests in BTLM. \n`c_attn` and `c_proj`\
    \ modules in BTLM matches [`q_proj`, `k_proj`, `v_proj`] and `o_proj` in LLaMA,\
    \ respectively."
  created_at: 2023-07-25 16:05:37+00:00
  edited: false
  hidden: false
  id: 64c000e1087f3237a059b4a3
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1669642878663-62d13bb5b473530ce564631b.png?w=200&h=200&f=face
      fullname: Mariusz Woloszyn
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: kil3r
      type: user
    createdAt: '2023-07-26T13:57:06.000Z'
    data:
      edited: true
      editors:
      - kil3r
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9692417979240417
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1669642878663-62d13bb5b473530ce564631b.png?w=200&h=200&f=face
          fullname: Mariusz Woloszyn
          isHf: false
          isPro: false
          name: kil3r
          type: user
        html: "<p>Hi <span data-props=\"{&quot;user&quot;:&quot;Handgun1773&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/Handgun1773\"\
          >@<span class=\"underline\">Handgun1773</span></a></span>\n\n\t</span></span>,\
          \ since you've managed to fine-tune it I dare to ask what token did you\
          \ use for padding?<br>I've assumed usual <code>tokenizer.pad_token = tokenizer.eos_token</code>.</p>\n"
        raw: 'Hi @Handgun1773, since you''ve managed to fine-tune it I dare to ask
          what token did you use for padding?

          I''ve assumed usual `tokenizer.pad_token = tokenizer.eos_token`.'
        updatedAt: '2023-07-26T14:49:45.794Z'
      numEdits: 1
      reactions: []
    id: 64c12632667468806fe51971
    type: comment
  author: kil3r
  content: 'Hi @Handgun1773, since you''ve managed to fine-tune it I dare to ask what
    token did you use for padding?

    I''ve assumed usual `tokenizer.pad_token = tokenizer.eos_token`.'
  created_at: 2023-07-26 12:57:06+00:00
  edited: true
  hidden: false
  id: 64c12632667468806fe51971
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/3b03217c22442b7bfed9beac2bf50d17.svg
      fullname: Alex Daminger
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Handgun1773
      type: user
    createdAt: '2023-07-26T15:39:30.000Z'
    data:
      edited: true
      editors:
      - Handgun1773
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5380199551582336
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/3b03217c22442b7bfed9beac2bf50d17.svg
          fullname: Alex Daminger
          isHf: false
          isPro: false
          name: Handgun1773
          type: user
        html: "<blockquote>\n<p>I've assumed usual <code>tokenizer.pad_token = tokenizer.eos_token</code>.</p>\n\
          </blockquote>\n<p>Yes. Seems that all the special tokens are the same anyway:</p>\n\
          <pre><code>{\n  \"bos_token\": \"&lt;|endoftext|&gt;\",\n  \"eos_token\"\
          : \"&lt;|endoftext|&gt;\",\n  \"unk_token\": \"&lt;|endoftext|&gt;\"\n}\n\
          </code></pre>\n"
        raw: "> I've assumed usual `tokenizer.pad_token = tokenizer.eos_token`.\n\n\
          Yes. Seems that all the special tokens are the same anyway:\n```\n{\n  \"\
          bos_token\": \"<|endoftext|>\",\n  \"eos_token\": \"<|endoftext|>\",\n \
          \ \"unk_token\": \"<|endoftext|>\"\n}\n```"
        updatedAt: '2023-07-26T15:39:38.662Z'
      numEdits: 1
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - kil3r
    id: 64c13e32cac5f9ba52b8ef6e
    type: comment
  author: Handgun1773
  content: "> I've assumed usual `tokenizer.pad_token = tokenizer.eos_token`.\n\n\
    Yes. Seems that all the special tokens are the same anyway:\n```\n{\n  \"bos_token\"\
    : \"<|endoftext|>\",\n  \"eos_token\": \"<|endoftext|>\",\n  \"unk_token\": \"\
    <|endoftext|>\"\n}\n```"
  created_at: 2023-07-26 14:39:30+00:00
  edited: true
  hidden: false
  id: 64c13e32cac5f9ba52b8ef6e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/ffc487fd9f3b0cd69abd3b50741c1d57.svg
      fullname: Thomas Gauthier-Caron
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: true
      name: thomasgauthier
      type: user
    createdAt: '2023-07-28T21:26:13.000Z'
    data:
      edited: false
      editors:
      - thomasgauthier
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6052859425544739
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/ffc487fd9f3b0cd69abd3b50741c1d57.svg
          fullname: Thomas Gauthier-Caron
          isHf: false
          isPro: true
          name: thomasgauthier
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;Handgun1773&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/Handgun1773\"\
          >@<span class=\"underline\">Handgun1773</span></a></span>\n\n\t</span></span>\
          \ Did you need any patch to the model to get peft working?</p>\n<p>Using\
          \ trl (with your suggested <code>target_modules</code>) <code>python trl/examples/scripts/sft_trainer.py\
          \ --use_peft --load_in_8bit --model_name \"cerebras/btlm-3b-8k-base\" --dataset_name\
          \ timdettmers/openassistant-guanaco --batch_size=4 --gradient_accumulation_steps\
          \ 2</code> I get this error </p>\n<pre><code>File \"~/.cache/huggingface/modules/transformers_modules/cerebras_btlm-3b-8k-base/modeling_btlm.py\"\
          , line 942, in forward\n    hidden_states *= torch.tensor(\nRuntimeError:\
          \ a leaf Variable that requires grad is being used in an in-place operation.\n\
          </code></pre>\n"
        raw: "@Handgun1773 Did you need any patch to the model to get peft working?\n\
          \nUsing trl (with your suggested `target_modules`) `python trl/examples/scripts/sft_trainer.py\
          \ --use_peft --load_in_8bit --model_name \"cerebras/btlm-3b-8k-base\" --dataset_name\
          \ timdettmers/openassistant-guanaco --batch_size=4 --gradient_accumulation_steps\
          \ 2` I get this error \n\n```\nFile \"~/.cache/huggingface/modules/transformers_modules/cerebras_btlm-3b-8k-base/modeling_btlm.py\"\
          , line 942, in forward\n    hidden_states *= torch.tensor(\nRuntimeError:\
          \ a leaf Variable that requires grad is being used in an in-place operation.\n\
          ```"
        updatedAt: '2023-07-28T21:26:13.389Z'
      numEdits: 0
      reactions: []
    id: 64c432758f31d1e6c673b4d3
    type: comment
  author: thomasgauthier
  content: "@Handgun1773 Did you need any patch to the model to get peft working?\n\
    \nUsing trl (with your suggested `target_modules`) `python trl/examples/scripts/sft_trainer.py\
    \ --use_peft --load_in_8bit --model_name \"cerebras/btlm-3b-8k-base\" --dataset_name\
    \ timdettmers/openassistant-guanaco --batch_size=4 --gradient_accumulation_steps\
    \ 2` I get this error \n\n```\nFile \"~/.cache/huggingface/modules/transformers_modules/cerebras_btlm-3b-8k-base/modeling_btlm.py\"\
    , line 942, in forward\n    hidden_states *= torch.tensor(\nRuntimeError: a leaf\
    \ Variable that requires grad is being used in an in-place operation.\n```"
  created_at: 2023-07-28 20:26:13+00:00
  edited: false
  hidden: false
  id: 64c432758f31d1e6c673b4d3
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/3b03217c22442b7bfed9beac2bf50d17.svg
      fullname: Alex Daminger
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Handgun1773
      type: user
    createdAt: '2023-07-29T13:13:57.000Z'
    data:
      edited: false
      editors:
      - Handgun1773
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9336039423942566
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/3b03217c22442b7bfed9beac2bf50d17.svg
          fullname: Alex Daminger
          isHf: false
          isPro: false
          name: Handgun1773
          type: user
        html: '<p>I got the same error, I''m not sure how I resolved it.<br>Maybe
          try: <code>model = prepare_model_for_kbit_training(model, use_gradient_checkpointing=False)</code></p>

          <p>Anyway, I couldn''t make it work with TRL because of a parameter defined
          in TRL that I couldn''t change (I don''t remember which either), so I use
          the regular trainer and do the TRL things manually.</p>

          '
        raw: 'I got the same error, I''m not sure how I resolved it.

          Maybe try: `model = prepare_model_for_kbit_training(model, use_gradient_checkpointing=False)`


          Anyway, I couldn''t make it work with TRL because of a parameter defined
          in TRL that I couldn''t change (I don''t remember which either), so I use
          the regular trainer and do the TRL things manually.'
        updatedAt: '2023-07-29T13:13:57.840Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - thomasgauthier
    id: 64c51095cd148315dc210d10
    type: comment
  author: Handgun1773
  content: 'I got the same error, I''m not sure how I resolved it.

    Maybe try: `model = prepare_model_for_kbit_training(model, use_gradient_checkpointing=False)`


    Anyway, I couldn''t make it work with TRL because of a parameter defined in TRL
    that I couldn''t change (I don''t remember which either), so I use the regular
    trainer and do the TRL things manually.'
  created_at: 2023-07-29 12:13:57+00:00
  edited: false
  hidden: false
  id: 64c51095cd148315dc210d10
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/d7b1419c240c5e16d522e9dfc2b567b3.svg
      fullname: A.M. Mugabushaka
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: almugabo
      type: user
    createdAt: '2023-08-04T12:23:56.000Z'
    data:
      edited: false
      editors:
      - almugabo
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.934524655342102
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/d7b1419c240c5e16d522e9dfc2b567b3.svg
          fullname: A.M. Mugabushaka
          isHf: false
          isPro: false
          name: almugabo
          type: user
        html: '<blockquote>

          <p>Anyway, I couldn''t make it work with TRL because of a parameter defined
          in TRL that I couldn''t change (I don''t remember which either), so I use
          the regular trainer and do the TRL things manually.</p>

          </blockquote>

          <p>This exciting, especially the long context window.<br>Could you please
          share your QLoRa fine tuning script or at least point to some resources  one
          could use ? Thank you</p>

          '
        raw: "\n> Anyway, I couldn't make it work with TRL because of a parameter\
          \ defined in TRL that I couldn't change (I don't remember which either),\
          \ so I use the regular trainer and do the TRL things manually.\n\nThis exciting,\
          \ especially the long context window. \nCould you please share your QLoRa\
          \ fine tuning script or at least point to some resources  one could use\
          \ ? Thank you"
        updatedAt: '2023-08-04T12:23:56.364Z'
      numEdits: 0
      reactions: []
    id: 64cceddc00377e2848a916e3
    type: comment
  author: almugabo
  content: "\n> Anyway, I couldn't make it work with TRL because of a parameter defined\
    \ in TRL that I couldn't change (I don't remember which either), so I use the\
    \ regular trainer and do the TRL things manually.\n\nThis exciting, especially\
    \ the long context window. \nCould you please share your QLoRa fine tuning script\
    \ or at least point to some resources  one could use ? Thank you"
  created_at: 2023-08-04 11:23:56+00:00
  edited: false
  hidden: false
  id: 64cceddc00377e2848a916e3
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/3b03217c22442b7bfed9beac2bf50d17.svg
      fullname: Alex Daminger
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Handgun1773
      type: user
    createdAt: '2023-08-12T03:16:08.000Z'
    data:
      edited: true
      editors:
      - Handgun1773
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9382072687149048
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/3b03217c22442b7bfed9beac2bf50d17.svg
          fullname: Alex Daminger
          isHf: false
          isPro: false
          name: Handgun1773
          type: user
        html: "<p>I heavily based it on this: <a rel=\"nofollow\" href=\"https://youtu.be/DcBC4yGHV4Q\"\
          >https://youtu.be/DcBC4yGHV4Q</a></p>\n<p>I also recommend you to use deepspeed,\
          \ for one GPU, you only have to add your deepspeed config file to the trainer\
          \ args:</p>\n<pre><code>...\ntransformers.TrainingArguments(\n        deepspeed\
          \ = DEEPSPEED_CONFIG_FILE,\n...\n</code></pre>\n<p>Plus launch it like this:<br><code>ACCELERATE_USE_DEEPSPEED=true\
          \ PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:32 deepspeed your_finetune_script.py\
          \ --deepspeed ds_config_3.json</code></p>\n<p>With this I can train on my\
          \ 3060 with 1000 token max context where it would otherwise OOM. I have\
          \ a qlora training on some the gpt-4 part of the dolphin dataset, sadly\
          \ I forgot to add the eos token, so it won't shut up. I don't care enough\
          \ to re-run it since it was an experiment, and it would block my GPU for\
          \ more than a month to do a few epochs. I also don't have money to throw\
          \ on rent hardware, sadly. The dataset is really massive.</p>\n<p>For multi\
          \ GPU, I managed to get it to work but it took me too much trial and errors\
          \ to explain, if you go that route and have an error I may be able to point\
          \ you in the right direction.<br>edit: never mind, just got a <code>RuntimeError:\
          \ CUDA error: an illegal memory access was encountered</code>. \U0001F614\
          </p>\n"
        raw: "I heavily based it on this: https://youtu.be/DcBC4yGHV4Q\n\nI also recommend\
          \ you to use deepspeed, for one GPU, you only have to add your deepspeed\
          \ config file to the trainer args:\n```\n...\ntransformers.TrainingArguments(\n\
          \        deepspeed = DEEPSPEED_CONFIG_FILE,\n...\n```\nPlus launch it like\
          \ this:\n`ACCELERATE_USE_DEEPSPEED=true PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:32\
          \ deepspeed your_finetune_script.py --deepspeed ds_config_3.json`\n\nWith\
          \ this I can train on my 3060 with 1000 token max context where it would\
          \ otherwise OOM. I have a qlora training on some the gpt-4 part of the dolphin\
          \ dataset, sadly I forgot to add the eos token, so it won't shut up. I don't\
          \ care enough to re-run it since it was an experiment, and it would block\
          \ my GPU for more than a month to do a few epochs. I also don't have money\
          \ to throw on rent hardware, sadly. The dataset is really massive.\n\nFor\
          \ multi GPU, I managed to get it to work but it took me too much trial and\
          \ errors to explain, if you go that route and have an error I may be able\
          \ to point you in the right direction.\nedit: never mind, just got a `RuntimeError:\
          \ CUDA error: an illegal memory access was encountered`. \U0001F614"
        updatedAt: '2023-08-12T05:44:18.588Z'
      numEdits: 2
      reactions: []
    id: 64d6f978c2eedf9af832fe43
    type: comment
  author: Handgun1773
  content: "I heavily based it on this: https://youtu.be/DcBC4yGHV4Q\n\nI also recommend\
    \ you to use deepspeed, for one GPU, you only have to add your deepspeed config\
    \ file to the trainer args:\n```\n...\ntransformers.TrainingArguments(\n     \
    \   deepspeed = DEEPSPEED_CONFIG_FILE,\n...\n```\nPlus launch it like this:\n\
    `ACCELERATE_USE_DEEPSPEED=true PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:32 deepspeed\
    \ your_finetune_script.py --deepspeed ds_config_3.json`\n\nWith this I can train\
    \ on my 3060 with 1000 token max context where it would otherwise OOM. I have\
    \ a qlora training on some the gpt-4 part of the dolphin dataset, sadly I forgot\
    \ to add the eos token, so it won't shut up. I don't care enough to re-run it\
    \ since it was an experiment, and it would block my GPU for more than a month\
    \ to do a few epochs. I also don't have money to throw on rent hardware, sadly.\
    \ The dataset is really massive.\n\nFor multi GPU, I managed to get it to work\
    \ but it took me too much trial and errors to explain, if you go that route and\
    \ have an error I may be able to point you in the right direction.\nedit: never\
    \ mind, just got a `RuntimeError: CUDA error: an illegal memory access was encountered`.\
    \ \U0001F614"
  created_at: 2023-08-12 02:16:08+00:00
  edited: true
  hidden: false
  id: 64d6f978c2eedf9af832fe43
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 10
repo_id: cerebras/btlm-3b-8k-base
repo_type: model
status: open
target_branch: null
title: LoraConfig's target_modul with peft ?
