!!python/object:huggingface_hub.community.DiscussionWithDetails
author: tuannguyends
conflicting_files: null
created_at: 2023-07-05 05:18:49+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0a18d29c2c1937c9e733b64bf3be552d.svg
      fullname: Nguyen Quoc Tuan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: tuannguyends
      type: user
    createdAt: '2023-07-05T06:18:49.000Z'
    data:
      edited: false
      editors:
      - tuannguyends
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5017005801200867
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0a18d29c2c1937c9e733b64bf3be552d.svg
          fullname: Nguyen Quoc Tuan
          isHf: false
          isPro: false
          name: tuannguyends
          type: user
        html: '<p>I am using Mac M1.</p>

          <p>I am using code:<br>"from transformers import T5Tokenizer, T5ForConditionalGeneration</p>

          <p>tokenizer = T5Tokenizer.from_pretrained("google/flan-t5-xxl")<br>model
          = T5ForConditionalGeneration.from_pretrained("google/flan-t5-xxl", device_map="auto")</p>

          <p>input_text = "translate English to German: How old are you?"<br>input_ids
          = tokenizer(input_text, return_tensors="pt").input_ids.to("cuda")</p>

          <p>outputs = model.generate(input_ids)<br>print(tokenizer.decode(outputs[0]))"</p>

          <p>The error:<br>File ~/miniforge3/envs/tf/lib/python3.8/site-packages/accelerate/utils/offload.py:154,
          in OffloadedWeightsLoader.<strong>init</strong>(self, state_dict, save_folder,
          index, device)<br>    146 def <strong>init</strong>(<br>    147     self,<br>    148     state_dict:
          Dict[str, torch.Tensor] = None,<br>   (...)<br>    151     device=None,<br>    152
          ):<br>    153     if state_dict is None and save_folder is None:<br>--&gt;
          154         raise ValueError("Need either a <code>state_dict</code> or a
          <code>save_folder</code> containing offloaded weights.")<br>    156     self.state_dict
          = {} if state_dict is None else state_dict<br>    157     self.save_folder
          = save_folder</p>

          <p>ValueError: Need either a <code>state_dict</code> or a <code>save_folder</code>
          containing offloaded weights.</p>

          '
        raw: "I am using Mac M1.\r\n\r\nI am using code: \r\n\"from transformers import\
          \ T5Tokenizer, T5ForConditionalGeneration\r\n\r\ntokenizer = T5Tokenizer.from_pretrained(\"\
          google/flan-t5-xxl\")\r\nmodel = T5ForConditionalGeneration.from_pretrained(\"\
          google/flan-t5-xxl\", device_map=\"auto\")\r\n\r\ninput_text = \"translate\
          \ English to German: How old are you?\"\r\ninput_ids = tokenizer(input_text,\
          \ return_tensors=\"pt\").input_ids.to(\"cuda\")\r\n\r\noutputs = model.generate(input_ids)\r\
          \nprint(tokenizer.decode(outputs[0]))\"\r\n\r\nThe error:\r\nFile ~/miniforge3/envs/tf/lib/python3.8/site-packages/accelerate/utils/offload.py:154,\
          \ in OffloadedWeightsLoader.__init__(self, state_dict, save_folder, index,\
          \ device)\r\n    146 def __init__(\r\n    147     self,\r\n    148     state_dict:\
          \ Dict[str, torch.Tensor] = None,\r\n   (...)\r\n    151     device=None,\r\
          \n    152 ):\r\n    153     if state_dict is None and save_folder is None:\r\
          \n--> 154         raise ValueError(\"Need either a `state_dict` or a `save_folder`\
          \ containing offloaded weights.\")\r\n    156     self.state_dict = {} if\
          \ state_dict is None else state_dict\r\n    157     self.save_folder = save_folder\r\
          \n\r\nValueError: Need either a `state_dict` or a `save_folder` containing\
          \ offloaded weights."
        updatedAt: '2023-07-05T06:18:49.885Z'
      numEdits: 0
      reactions:
      - count: 5
        reaction: "\U0001F44D"
        users:
        - molntamas
        - ShanLorde
        - veeragoni
        - Debojit
        - chrisandyu0
    id: 64a50b49bbc03d2b09870656
    type: comment
  author: tuannguyends
  content: "I am using Mac M1.\r\n\r\nI am using code: \r\n\"from transformers import\
    \ T5Tokenizer, T5ForConditionalGeneration\r\n\r\ntokenizer = T5Tokenizer.from_pretrained(\"\
    google/flan-t5-xxl\")\r\nmodel = T5ForConditionalGeneration.from_pretrained(\"\
    google/flan-t5-xxl\", device_map=\"auto\")\r\n\r\ninput_text = \"translate English\
    \ to German: How old are you?\"\r\ninput_ids = tokenizer(input_text, return_tensors=\"\
    pt\").input_ids.to(\"cuda\")\r\n\r\noutputs = model.generate(input_ids)\r\nprint(tokenizer.decode(outputs[0]))\"\
    \r\n\r\nThe error:\r\nFile ~/miniforge3/envs/tf/lib/python3.8/site-packages/accelerate/utils/offload.py:154,\
    \ in OffloadedWeightsLoader.__init__(self, state_dict, save_folder, index, device)\r\
    \n    146 def __init__(\r\n    147     self,\r\n    148     state_dict: Dict[str,\
    \ torch.Tensor] = None,\r\n   (...)\r\n    151     device=None,\r\n    152 ):\r\
    \n    153     if state_dict is None and save_folder is None:\r\n--> 154      \
    \   raise ValueError(\"Need either a `state_dict` or a `save_folder` containing\
    \ offloaded weights.\")\r\n    156     self.state_dict = {} if state_dict is None\
    \ else state_dict\r\n    157     self.save_folder = save_folder\r\n\r\nValueError:\
    \ Need either a `state_dict` or a `save_folder` containing offloaded weights."
  created_at: 2023-07-05 05:18:49+00:00
  edited: false
  hidden: false
  id: 64a50b49bbc03d2b09870656
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/z2F2Raw7uGUz_j_atExUO.png?w=200&h=200&f=face
      fullname: Jessica Meng
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ThrowbackJM
      type: user
    createdAt: '2023-07-31T22:56:26.000Z'
    data:
      edited: false
      editors:
      - ThrowbackJM
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9083393812179565
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/z2F2Raw7uGUz_j_atExUO.png?w=200&h=200&f=face
          fullname: Jessica Meng
          isHf: false
          isPro: false
          name: ThrowbackJM
          type: user
        html: '<p>Have the same issue. </p>

          '
        raw: 'Have the same issue. '
        updatedAt: '2023-07-31T22:56:26.333Z'
      numEdits: 0
      reactions: []
    id: 64c83c1a203170e13c0f8968
    type: comment
  author: ThrowbackJM
  content: 'Have the same issue. '
  created_at: 2023-07-31 21:56:26+00:00
  edited: false
  hidden: false
  id: 64c83c1a203170e13c0f8968
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 53
repo_id: google/flan-t5-xxl
repo_type: model
status: open
target_branch: null
title: 'ValueError: Need either a `state_dict` or a `save_folder` containing offloaded
  weights.'
