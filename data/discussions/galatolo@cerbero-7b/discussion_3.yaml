!!python/object:huggingface_hub.community.DiscussionWithDetails
author: luigisaetta
conflicting_files: null
created_at: 2023-12-07 10:47:39+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1654243824339-626010a1ffe8827cb1d626ad.jpeg?w=200&h=200&f=face
      fullname: LuigiSaetta
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: luigisaetta
      type: user
    createdAt: '2023-12-07T10:47:39.000Z'
    data:
      edited: true
      editors:
      - luigisaetta
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9223814010620117
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1654243824339-626010a1ffe8827cb1d626ad.jpeg?w=200&h=200&f=face
          fullname: LuigiSaetta
          isHf: false
          isPro: false
          name: luigisaetta
          type: user
        html: '<p>I''m comparing Cerbero 7B to Llama2 /B.<br>Even if I''m using a
          2 A10 GPU VM Cerbero is surprisingly slow. I have checked (gpustat) it is
          running on GPU... but getting an answer takes minutes.<br>Is it a fine tuning
          of Mistral 7B or do we have architectural changes requiring much more computing
          power? (I know, it has been trained on A100 8 GPU... big shape)</p>

          '
        raw: 'I''m comparing Cerbero 7B to Llama2 /B.

          Even if I''m using a 2 A10 GPU VM Cerbero is surprisingly slow. I have checked
          (gpustat) it is running on GPU... but getting an answer takes minutes.

          Is it a fine tuning of Mistral 7B or do we have architectural changes requiring
          much more computing power? (I know, it has been trained on A100 8 GPU...
          big shape)'
        updatedAt: '2023-12-07T10:54:05.283Z'
      numEdits: 1
      reactions: []
    id: 6571a2cbef3fdd14744771a2
    type: comment
  author: luigisaetta
  content: 'I''m comparing Cerbero 7B to Llama2 /B.

    Even if I''m using a 2 A10 GPU VM Cerbero is surprisingly slow. I have checked
    (gpustat) it is running on GPU... but getting an answer takes minutes.

    Is it a fine tuning of Mistral 7B or do we have architectural changes requiring
    much more computing power? (I know, it has been trained on A100 8 GPU... big shape)'
  created_at: 2023-12-07 10:47:39+00:00
  edited: true
  hidden: false
  id: 6571a2cbef3fdd14744771a2
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659104835639-noauth.png?w=200&h=200&f=face
      fullname: Federico Galatolo
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: galatolo
      type: user
    createdAt: '2023-12-07T10:50:22.000Z'
    data:
      edited: false
      editors:
      - galatolo
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9619985818862915
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659104835639-noauth.png?w=200&h=200&f=face
          fullname: Federico Galatolo
          isHf: false
          isPro: false
          name: galatolo
          type: user
        html: '<p>Thats weird it should have almost the same performance as llama2-7b,
          can you share some details on your setup?</p>

          '
        raw: Thats weird it should have almost the same performance as llama2-7b,
          can you share some details on your setup?
        updatedAt: '2023-12-07T10:50:22.316Z'
      numEdits: 0
      reactions: []
    id: 6571a36e9df395235da7b435
    type: comment
  author: galatolo
  content: Thats weird it should have almost the same performance as llama2-7b, can
    you share some details on your setup?
  created_at: 2023-12-07 10:50:22+00:00
  edited: false
  hidden: false
  id: 6571a36e9df395235da7b435
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1654243824339-626010a1ffe8827cb1d626ad.jpeg?w=200&h=200&f=face
      fullname: LuigiSaetta
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: luigisaetta
      type: user
    createdAt: '2023-12-07T11:23:29.000Z'
    data:
      edited: true
      editors:
      - luigisaetta
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8512561917304993
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1654243824339-626010a1ffe8827cb1d626ad.jpeg?w=200&h=200&f=face
          fullname: LuigiSaetta
          isHf: false
          isPro: false
          name: luigisaetta
          type: user
        html: '<p>Test con max_new_token=128 Wall time: 1min 54s</p>

          <p>I''m using a 2 A10 GPU VM (24 + 24 GB GPU mem).... on the same setting
          Lalma2 (running locally) usually answers in 5 sec<br>The chain is built
          using Llama-index<br>With gpustat I have checked that everything runs on
          GPU.</p>

          <p>I can give you more context on what I''m doing: I''m evaluating several
          LLM with a RAG approach, on Italian language.<br>I have tested:</p>

          <ul>

          <li>Cohere<br>-Llama 2 /B e 13B</li>

          <li>MIstral 7B</li>

          <li>now testing Cerbero</li>

          </ul>

          <p>To build the RA chain I''m using Llamaidex. To evaluate Trulens-eval</p>

          <p>The biggest problem I see is alway code-switching (question in Itaian,
          answer in Englis, let''s say 20% of the cases)</p>

          <p>Cerbero seems a little better... but it is really slow (10X the latency)</p>

          '
        raw: "Test con max_new_token=128 Wall time: 1min 54s\n\nI'm using a 2 A10\
          \ GPU VM (24 + 24 GB GPU mem).... on the same setting Lalma2 (running locally)\
          \ usually answers in 5 sec \nThe chain is built using Llama-index\nWith\
          \ gpustat I have checked that everything runs on GPU.\n\nI can give you\
          \ more context on what I'm doing: I'm evaluating several LLM with a RAG\
          \ approach, on Italian language.\nI have tested:\n- Cohere\n-Llama 2 /B\
          \ e 13B\n- MIstral 7B\n- now testing Cerbero\n\nTo build the RA chain I'm\
          \ using Llamaidex. To evaluate Trulens-eval\n\nThe biggest problem I see\
          \ is alway code-switching (question in Itaian, answer in Englis, let's say\
          \ 20% of the cases)\n\nCerbero seems a little better... but it is really\
          \ slow (10X the latency)"
        updatedAt: '2023-12-07T11:50:51.574Z'
      numEdits: 3
      reactions: []
    id: 6571ab319d2e02fddc21ebae
    type: comment
  author: luigisaetta
  content: "Test con max_new_token=128 Wall time: 1min 54s\n\nI'm using a 2 A10 GPU\
    \ VM (24 + 24 GB GPU mem).... on the same setting Lalma2 (running locally) usually\
    \ answers in 5 sec \nThe chain is built using Llama-index\nWith gpustat I have\
    \ checked that everything runs on GPU.\n\nI can give you more context on what\
    \ I'm doing: I'm evaluating several LLM with a RAG approach, on Italian language.\n\
    I have tested:\n- Cohere\n-Llama 2 /B e 13B\n- MIstral 7B\n- now testing Cerbero\n\
    \nTo build the RA chain I'm using Llamaidex. To evaluate Trulens-eval\n\nThe biggest\
    \ problem I see is alway code-switching (question in Itaian, answer in Englis,\
    \ let's say 20% of the cases)\n\nCerbero seems a little better... but it is really\
    \ slow (10X the latency)"
  created_at: 2023-12-07 11:23:29+00:00
  edited: true
  hidden: false
  id: 6571ab319d2e02fddc21ebae
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1654243824339-626010a1ffe8827cb1d626ad.jpeg?w=200&h=200&f=face
      fullname: LuigiSaetta
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: luigisaetta
      type: user
    createdAt: '2023-12-07T11:24:22.000Z'
    data:
      edited: true
      editors:
      - luigisaetta
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.913242518901825
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1654243824339-626010a1ffe8827cb1d626ad.jpeg?w=200&h=200&f=face
          fullname: LuigiSaetta
          isHf: false
          isPro: false
          name: luigisaetta
          type: user
        html: '<p>Really it puzzles me also the fact that this model, if compared
          with lalama2 /B and MIstral 7B takes so much GPU mem.</p>

          '
        raw: Really it puzzles me also the fact that this model, if compared with
          lalama2 /B and MIstral 7B takes so much GPU mem.
        updatedAt: '2023-12-07T11:29:48.387Z'
      numEdits: 1
      reactions: []
    id: 6571ab6637cf44ac590d2456
    type: comment
  author: luigisaetta
  content: Really it puzzles me also the fact that this model, if compared with lalama2
    /B and MIstral 7B takes so much GPU mem.
  created_at: 2023-12-07 11:24:22+00:00
  edited: true
  hidden: false
  id: 6571ab6637cf44ac590d2456
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659104835639-noauth.png?w=200&h=200&f=face
      fullname: Federico Galatolo
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: galatolo
      type: user
    createdAt: '2023-12-07T12:36:34.000Z'
    data:
      edited: false
      editors:
      - galatolo
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.40124112367630005
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659104835639-noauth.png?w=200&h=200&f=face
          fullname: Federico Galatolo
          isHf: false
          isPro: false
          name: galatolo
          type: user
        html: '<p>Try to load the <code>float16</code> variant, the default one is
          <code>float32</code></p>

          <pre><code>model = AutoModelForCausalLM.from_pretrained("galatolo/cerbero-7b",
          revision="float16")

          </code></pre>

          <p>check <code>model.dtype</code> it should be <code>float16</code></p>

          '
        raw: 'Try to load the `float16` variant, the default one is `float32`


          ```

          model = AutoModelForCausalLM.from_pretrained("galatolo/cerbero-7b", revision="float16")

          ```


          check `model.dtype` it should be `float16`'
        updatedAt: '2023-12-07T12:36:34.696Z'
      numEdits: 0
      reactions: []
    id: 6571bc528d0ca8549ebd6487
    type: comment
  author: galatolo
  content: 'Try to load the `float16` variant, the default one is `float32`


    ```

    model = AutoModelForCausalLM.from_pretrained("galatolo/cerbero-7b", revision="float16")

    ```


    check `model.dtype` it should be `float16`'
  created_at: 2023-12-07 12:36:34+00:00
  edited: false
  hidden: false
  id: 6571bc528d0ca8549ebd6487
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1654243824339-626010a1ffe8827cb1d626ad.jpeg?w=200&h=200&f=face
      fullname: LuigiSaetta
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: luigisaetta
      type: user
    createdAt: '2023-12-08T05:27:47.000Z'
    data:
      edited: false
      editors:
      - luigisaetta
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8537279963493347
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1654243824339-626010a1ffe8827cb1d626ad.jpeg?w=200&h=200&f=face
          fullname: LuigiSaetta
          isHf: false
          isPro: false
          name: luigisaetta
          type: user
        html: '<blockquote>

          <p>Try to load the <code>float16</code> variant, the default one is <code>float32</code></p>

          <pre><code>model = AutoModelForCausalLM.from_pretrained("galatolo/cerbero-7b",
          revision="float16")

          </code></pre>

          <p>check <code>model.dtype</code> it should be <code>float16</code></p>

          </blockquote>

          <p>It is exactly what I have already done. No way... it takes minutes.</p>

          <p>I have suspect that Cerbero makes a lot of effort processing long input.
          I''m using a RAG approach taking context from some English book. So the
          prompt to the model is always several hundreds of tokens (even thousands)
          long. Have you tested it with long inputs?<br>Well, on the 8GPU box described
          in the docs it will be fast.</p>

          '
        raw: "> Try to load the `float16` variant, the default one is `float32`\n\
          > \n> ```\n> model = AutoModelForCausalLM.from_pretrained(\"galatolo/cerbero-7b\"\
          , revision=\"float16\")\n> ```\n> \n> check `model.dtype` it should be `float16`\n\
          \nIt is exactly what I have already done. No way... it takes minutes.\n\n\
          I have suspect that Cerbero makes a lot of effort processing long input.\
          \ I'm using a RAG approach taking context from some English book. So the\
          \ prompt to the model is always several hundreds of tokens (even thousands)\
          \ long. Have you tested it with long inputs?\nWell, on the 8GPU box described\
          \ in the docs it will be fast.\n"
        updatedAt: '2023-12-08T05:27:47.211Z'
      numEdits: 0
      reactions: []
    id: 6572a9539a5c2d6df9fa0d24
    type: comment
  author: luigisaetta
  content: "> Try to load the `float16` variant, the default one is `float32`\n> \n\
    > ```\n> model = AutoModelForCausalLM.from_pretrained(\"galatolo/cerbero-7b\"\
    , revision=\"float16\")\n> ```\n> \n> check `model.dtype` it should be `float16`\n\
    \nIt is exactly what I have already done. No way... it takes minutes.\n\nI have\
    \ suspect that Cerbero makes a lot of effort processing long input. I'm using\
    \ a RAG approach taking context from some English book. So the prompt to the model\
    \ is always several hundreds of tokens (even thousands) long. Have you tested\
    \ it with long inputs?\nWell, on the 8GPU box described in the docs it will be\
    \ fast.\n"
  created_at: 2023-12-08 05:27:47+00:00
  edited: false
  hidden: false
  id: 6572a9539a5c2d6df9fa0d24
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659104835639-noauth.png?w=200&h=200&f=face
      fullname: Federico Galatolo
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: galatolo
      type: user
    createdAt: '2023-12-08T08:43:45.000Z'
    data:
      edited: false
      editors:
      - galatolo
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9174948334693909
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659104835639-noauth.png?w=200&h=200&f=face
          fullname: Federico Galatolo
          isHf: false
          isPro: false
          name: galatolo
          type: user
        html: '<p>Next week i will perform some inference benchmarks on smaller GPUs
          (i also have some A30 a T4) and we will get to the bottom of this. In the
          meantime maybe you can try the <code>llama.cpp</code> version. <code>llama.cpp</code>
          has a lot of optimizations and it is faster than transformers (despite the
          name, you can use  the GPU with llama.cpp)</p>

          '
        raw: Next week i will perform some inference benchmarks on smaller GPUs (i
          also have some A30 a T4) and we will get to the bottom of this. In the meantime
          maybe you can try the `llama.cpp` version. `llama.cpp` has a lot of optimizations
          and it is faster than transformers (despite the name, you can use  the GPU
          with llama.cpp)
        updatedAt: '2023-12-08T08:43:45.363Z'
      numEdits: 0
      reactions: []
    id: 6572d74137892dd4f4c63669
    type: comment
  author: galatolo
  content: Next week i will perform some inference benchmarks on smaller GPUs (i also
    have some A30 a T4) and we will get to the bottom of this. In the meantime maybe
    you can try the `llama.cpp` version. `llama.cpp` has a lot of optimizations and
    it is faster than transformers (despite the name, you can use  the GPU with llama.cpp)
  created_at: 2023-12-08 08:43:45+00:00
  edited: false
  hidden: false
  id: 6572d74137892dd4f4c63669
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659104835639-noauth.png?w=200&h=200&f=face
      fullname: Federico Galatolo
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: galatolo
      type: user
    createdAt: '2023-12-23T09:49:07.000Z'
    data:
      status: closed
    id: 6586ad13595e258218570ab1
    type: status-change
  author: galatolo
  created_at: 2023-12-23 09:49:07+00:00
  id: 6586ad13595e258218570ab1
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 3
repo_id: galatolo/cerbero-7b
repo_type: model
status: closed
target_branch: null
title: Why is it so slow, even on GPU
