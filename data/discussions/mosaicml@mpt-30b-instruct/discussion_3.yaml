!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Vinhngx
conflicting_files: null
created_at: 2023-06-27 04:03:49+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/a2130b41cfe2af25050d2bede8e22883.svg
      fullname: Vinh Nguyen
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Vinhngx
      type: user
    createdAt: '2023-06-27T05:03:49.000Z'
    data:
      edited: false
      editors:
      - Vinhngx
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.707723081111908
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/a2130b41cfe2af25050d2bede8e22883.svg
          fullname: Vinh Nguyen
          isHf: false
          isPro: false
          name: Vinhngx
          type: user
        html: "<p>Does this model auto-stop?</p>\n<p>When trying with the stock prompt:</p>\n\
          <pre><code>def get_completion(prompt, do_sample=True, temperature = 0.2):\n\
          \    with torch.autocast('cuda', dtype=torch.bfloat16):\n        inputs\
          \ = tokenizer(prompt, return_tensors=\"pt\").to('cuda')\n        outputs\
          \ = model.generate(**inputs, do_sample=do_sample, temperature=temperature,\
          \ max_new_tokens=512)\n    return tokenizer.batch_decode(outputs, skip_special_tokens=True)[0][len(prompt):]\n\
          \nprint(get_completion(\"I need to convince my friend, Phyllis, that she\
          \ should train a custom LLM for her Fortune 500 company using the MosaicML\
          \ Platform. Please write an email that explains why MosaicML's emphasis\
          \ on cutting edge methodology, data privacy, and efficiency are so important.\
          \ End the email with a friendly inquiry about Phyllis's family.\"))\n</code></pre>\n\
          <p>I got the following answer:</p>\n<pre><code>\n\nHi Phyllis,\n\nI hope\
          \ this email finds you well. I wanted to touch base about MosaicML and how\
          \ it could be a great fit for your company.\n\nMosaicML is built on the\
          \ latest research in Natural Language Processing, allowing for state of\
          \ the art performance on text classification and entity extraction tasks.\
          \ MosaicML also puts a strong focus on data privacy, allowing for training\
          \ and inference on encrypted data without any compromise in performance.\
          \ This is a very important feature, as your company will be able to train\
          \ high performing models without compromising the privacy of your customers.\n\
          \nIn addition to the cutting edge NLP and privacy features, MosaicML is\
          \ also very efficient. Models can be trained and deployed in minutes, and\
          \ the platform is built to scale to hundreds of models and millions of documents.\n\
          \nI hope this information is helpful. If you have any questions, please\
          \ let me know. Also, I hope your family is doing well!\n\nBest,\n\nYour\
          \ Friend#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\nCreated\
          \ on Tue Aug  4 13:53:15 2020\n\n<span data-props=\"{&quot;user&quot;:&quot;author&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/author\"\
          >@<span class=\"underline\">author</span></a></span>\n\n\t</span></span>:\
          \ james\n\"\"\"\n\nimport numpy as np\nfrom scipy.stats import norm\nfrom\
          \ scipy.stats import t\nfrom scipy.stats import chi2\nfrom scipy.stats import\
          \ f\nfrom scipy.stats import beta\nfrom scipy.stats import binom\nfrom scipy.stats\
          \ import expon\nfrom scipy.stats import gamma\nfrom scipy.stats import weibull_min\n\
          from scipy.stats import weibull_max\nfrom scipy.stats import invgamma\n\
          from scipy.stats import lognorm\nfrom scipy.stats import exponweib\nfrom\
          \ scipy.stats import genpareto\nfrom scipy.stats import negbinom\nfrom scipy.stats\
          \ import poisson\nfrom scipy.stats import hypergeom\nfrom scipy.stats import\
          \ kstest\nfrom scipy.stats import anderson\nfrom scipy.stats import shapiro\n\
          from scipy.stats import pearsonr\nfrom scipy.stats import spearmanr\nfrom\
          \ scipy.stats import kendalltau\nfrom scipy.stats import chi2_contingency\n\
          from sc\n</code></pre>\n<p>Looks like the model over-generate?</p>\n"
        raw: "Does this model auto-stop?\r\n\r\nWhen trying with the stock prompt:\r\
          \n```\r\ndef get_completion(prompt, do_sample=True, temperature = 0.2):\r\
          \n    with torch.autocast('cuda', dtype=torch.bfloat16):\r\n        inputs\
          \ = tokenizer(prompt, return_tensors=\"pt\").to('cuda')\r\n        outputs\
          \ = model.generate(**inputs, do_sample=do_sample, temperature=temperature,\
          \ max_new_tokens=512)\r\n    return tokenizer.batch_decode(outputs, skip_special_tokens=True)[0][len(prompt):]\r\
          \n\r\nprint(get_completion(\"I need to convince my friend, Phyllis, that\
          \ she should train a custom LLM for her Fortune 500 company using the MosaicML\
          \ Platform. Please write an email that explains why MosaicML's emphasis\
          \ on cutting edge methodology, data privacy, and efficiency are so important.\
          \ End the email with a friendly inquiry about Phyllis's family.\"))\r\n\
          ```\r\nI got the following answer:\r\n```\r\n\r\n\r\nHi Phyllis,\r\n\r\n\
          I hope this email finds you well. I wanted to touch base about MosaicML\
          \ and how it could be a great fit for your company.\r\n\r\nMosaicML is built\
          \ on the latest research in Natural Language Processing, allowing for state\
          \ of the art performance on text classification and entity extraction tasks.\
          \ MosaicML also puts a strong focus on data privacy, allowing for training\
          \ and inference on encrypted data without any compromise in performance.\
          \ This is a very important feature, as your company will be able to train\
          \ high performing models without compromising the privacy of your customers.\r\
          \n\r\nIn addition to the cutting edge NLP and privacy features, MosaicML\
          \ is also very efficient. Models can be trained and deployed in minutes,\
          \ and the platform is built to scale to hundreds of models and millions\
          \ of documents.\r\n\r\nI hope this information is helpful. If you have any\
          \ questions, please let me know. Also, I hope your family is doing well!\r\
          \n\r\nBest,\r\n\r\nYour Friend#!/usr/bin/env python3\r\n# -*- coding: utf-8\
          \ -*-\r\n\"\"\"\r\nCreated on Tue Aug  4 13:53:15 2020\r\n\r\n@author: james\r\
          \n\"\"\"\r\n\r\nimport numpy as np\r\nfrom scipy.stats import norm\r\nfrom\
          \ scipy.stats import t\r\nfrom scipy.stats import chi2\r\nfrom scipy.stats\
          \ import f\r\nfrom scipy.stats import beta\r\nfrom scipy.stats import binom\r\
          \nfrom scipy.stats import expon\r\nfrom scipy.stats import gamma\r\nfrom\
          \ scipy.stats import weibull_min\r\nfrom scipy.stats import weibull_max\r\
          \nfrom scipy.stats import invgamma\r\nfrom scipy.stats import lognorm\r\n\
          from scipy.stats import exponweib\r\nfrom scipy.stats import genpareto\r\
          \nfrom scipy.stats import negbinom\r\nfrom scipy.stats import poisson\r\n\
          from scipy.stats import hypergeom\r\nfrom scipy.stats import kstest\r\n\
          from scipy.stats import anderson\r\nfrom scipy.stats import shapiro\r\n\
          from scipy.stats import pearsonr\r\nfrom scipy.stats import spearmanr\r\n\
          from scipy.stats import kendalltau\r\nfrom scipy.stats import chi2_contingency\r\
          \nfrom sc\r\n```\r\n\r\nLooks like the model over-generate?"
        updatedAt: '2023-06-27T05:03:49.659Z'
      numEdits: 0
      reactions: []
    id: 649a6db5478082a13ed1c6d1
    type: comment
  author: Vinhngx
  content: "Does this model auto-stop?\r\n\r\nWhen trying with the stock prompt:\r\
    \n```\r\ndef get_completion(prompt, do_sample=True, temperature = 0.2):\r\n  \
    \  with torch.autocast('cuda', dtype=torch.bfloat16):\r\n        inputs = tokenizer(prompt,\
    \ return_tensors=\"pt\").to('cuda')\r\n        outputs = model.generate(**inputs,\
    \ do_sample=do_sample, temperature=temperature, max_new_tokens=512)\r\n    return\
    \ tokenizer.batch_decode(outputs, skip_special_tokens=True)[0][len(prompt):]\r\
    \n\r\nprint(get_completion(\"I need to convince my friend, Phyllis, that she should\
    \ train a custom LLM for her Fortune 500 company using the MosaicML Platform.\
    \ Please write an email that explains why MosaicML's emphasis on cutting edge\
    \ methodology, data privacy, and efficiency are so important. End the email with\
    \ a friendly inquiry about Phyllis's family.\"))\r\n```\r\nI got the following\
    \ answer:\r\n```\r\n\r\n\r\nHi Phyllis,\r\n\r\nI hope this email finds you well.\
    \ I wanted to touch base about MosaicML and how it could be a great fit for your\
    \ company.\r\n\r\nMosaicML is built on the latest research in Natural Language\
    \ Processing, allowing for state of the art performance on text classification\
    \ and entity extraction tasks. MosaicML also puts a strong focus on data privacy,\
    \ allowing for training and inference on encrypted data without any compromise\
    \ in performance. This is a very important feature, as your company will be able\
    \ to train high performing models without compromising the privacy of your customers.\r\
    \n\r\nIn addition to the cutting edge NLP and privacy features, MosaicML is also\
    \ very efficient. Models can be trained and deployed in minutes, and the platform\
    \ is built to scale to hundreds of models and millions of documents.\r\n\r\nI\
    \ hope this information is helpful. If you have any questions, please let me know.\
    \ Also, I hope your family is doing well!\r\n\r\nBest,\r\n\r\nYour Friend#!/usr/bin/env\
    \ python3\r\n# -*- coding: utf-8 -*-\r\n\"\"\"\r\nCreated on Tue Aug  4 13:53:15\
    \ 2020\r\n\r\n@author: james\r\n\"\"\"\r\n\r\nimport numpy as np\r\nfrom scipy.stats\
    \ import norm\r\nfrom scipy.stats import t\r\nfrom scipy.stats import chi2\r\n\
    from scipy.stats import f\r\nfrom scipy.stats import beta\r\nfrom scipy.stats\
    \ import binom\r\nfrom scipy.stats import expon\r\nfrom scipy.stats import gamma\r\
    \nfrom scipy.stats import weibull_min\r\nfrom scipy.stats import weibull_max\r\
    \nfrom scipy.stats import invgamma\r\nfrom scipy.stats import lognorm\r\nfrom\
    \ scipy.stats import exponweib\r\nfrom scipy.stats import genpareto\r\nfrom scipy.stats\
    \ import negbinom\r\nfrom scipy.stats import poisson\r\nfrom scipy.stats import\
    \ hypergeom\r\nfrom scipy.stats import kstest\r\nfrom scipy.stats import anderson\r\
    \nfrom scipy.stats import shapiro\r\nfrom scipy.stats import pearsonr\r\nfrom\
    \ scipy.stats import spearmanr\r\nfrom scipy.stats import kendalltau\r\nfrom scipy.stats\
    \ import chi2_contingency\r\nfrom sc\r\n```\r\n\r\nLooks like the model over-generate?"
  created_at: 2023-06-27 04:03:49+00:00
  edited: false
  hidden: false
  id: 649a6db5478082a13ed1c6d1
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/645585f8fbe00f9e73c25a41/jdy4XqmpulyjNrxaCYUjc.jpeg?w=200&h=200&f=face
      fullname: Nico Basile
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: nicobasile
      type: user
    createdAt: '2023-06-27T19:44:34.000Z'
    data:
      edited: true
      editors:
      - nicobasile
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8856708407402039
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/645585f8fbe00f9e73c25a41/jdy4XqmpulyjNrxaCYUjc.jpeg?w=200&h=200&f=face
          fullname: Nico Basile
          isHf: false
          isPro: false
          name: nicobasile
          type: user
        html: '<p>Same issue here!<br>For me it continues generating past the eos_token
          "&lt;|endoftext|&gt;", which in theory it shouldn''t do.<br>If you remove
          "skip_special_tokens" you''ll probably see the same.</p>

          <p>Anyone know how to fix this?</p>

          '
        raw: 'Same issue here!

          For me it continues generating past the eos_token "<|endoftext|>", which
          in theory it shouldn''t do.

          If you remove "skip_special_tokens" you''ll probably see the same.


          Anyone know how to fix this?'
        updatedAt: '2023-06-27T19:48:35.182Z'
      numEdits: 1
      reactions: []
    id: 649b3c22f7cc759ab750d4f7
    type: comment
  author: nicobasile
  content: 'Same issue here!

    For me it continues generating past the eos_token "<|endoftext|>", which in theory
    it shouldn''t do.

    If you remove "skip_special_tokens" you''ll probably see the same.


    Anyone know how to fix this?'
  created_at: 2023-06-27 18:44:34+00:00
  edited: true
  hidden: false
  id: 649b3c22f7cc759ab750d4f7
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/645585f8fbe00f9e73c25a41/jdy4XqmpulyjNrxaCYUjc.jpeg?w=200&h=200&f=face
      fullname: Nico Basile
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: nicobasile
      type: user
    createdAt: '2023-06-27T20:10:04.000Z'
    data:
      edited: false
      editors:
      - nicobasile
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.45041340589523315
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/645585f8fbe00f9e73c25a41/jdy4XqmpulyjNrxaCYUjc.jpeg?w=200&h=200&f=face
          fullname: Nico Basile
          isHf: false
          isPro: false
          name: nicobasile
          type: user
        html: '<p>Actually I just figured out a solution for my case. I had to specify
          the <code>eos_token_id</code> for model.generate (and pad_token_id to avoid
          a warning)<br><code>output = model.generate(input, eos_token_id=tokenizer.eos_token_id,
          pad_token_id=tokenizer.pad_token_id)</code></p>

          '
        raw: 'Actually I just figured out a solution for my case. I had to specify
          the `eos_token_id` for model.generate (and pad_token_id to avoid a warning)

          `output = model.generate(input, eos_token_id=tokenizer.eos_token_id, pad_token_id=tokenizer.pad_token_id)`'
        updatedAt: '2023-06-27T20:10:04.414Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - Vinhngx
    id: 649b421c613742c1cb0caca7
    type: comment
  author: nicobasile
  content: 'Actually I just figured out a solution for my case. I had to specify the
    `eos_token_id` for model.generate (and pad_token_id to avoid a warning)

    `output = model.generate(input, eos_token_id=tokenizer.eos_token_id, pad_token_id=tokenizer.pad_token_id)`'
  created_at: 2023-06-27 19:10:04+00:00
  edited: false
  hidden: false
  id: 649b421c613742c1cb0caca7
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/a2130b41cfe2af25050d2bede8e22883.svg
      fullname: Vinh Nguyen
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Vinhngx
      type: user
    createdAt: '2023-06-27T21:43:18.000Z'
    data:
      edited: false
      editors:
      - Vinhngx
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9526947736740112
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/a2130b41cfe2af25050d2bede8e22883.svg
          fullname: Vinh Nguyen
          isHf: false
          isPro: false
          name: Vinhngx
          type: user
        html: '<p>I figured that out too. Should put this into the example call, to
          save others some time ;)</p>

          '
        raw: I figured that out too. Should put this into the example call, to save
          others some time ;)
        updatedAt: '2023-06-27T21:43:18.986Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F91D"
        users:
        - nicobasile
    id: 649b57f692b8f9b3095e6185
    type: comment
  author: Vinhngx
  content: I figured that out too. Should put this into the example call, to save
    others some time ;)
  created_at: 2023-06-27 20:43:18+00:00
  edited: false
  hidden: false
  id: 649b57f692b8f9b3095e6185
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 3
repo_id: mosaicml/mpt-30b-instruct
repo_type: model
status: open
target_branch: null
title: auto-stopping?
