!!python/object:huggingface_hub.community.DiscussionWithDetails
author: jfacevedo
conflicting_files: null
created_at: 2023-01-20 23:41:34+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/93b7de59623dc95f2fcdd50aeb54f482.svg
      fullname: Juan Acevedo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jfacevedo
      type: user
    createdAt: '2023-01-20T23:41:34.000Z'
    data:
      edited: false
      editors:
      - jfacevedo
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/93b7de59623dc95f2fcdd50aeb54f482.svg
          fullname: Juan Acevedo
          isHf: false
          isPro: false
          name: jfacevedo
          type: user
        html: "<p>Hello. I tried converting the weights to jax, but running into an\
          \ error.</p>\n<p>Code:</p>\n<pre><code class=\"language-python\"><span class=\"\
          hljs-keyword\">from</span> diffusers <span class=\"hljs-keyword\">import</span>\
          \ FlaxStableDiffusionPipeline\nmodel_name=<span class=\"hljs-string\">'riffusion/riffusion-model-v1'</span>\n\
          pipeline, params = FlaxStableDiffusionPipeline.from_pretrained(model_name,\
          \ from_pt=<span class=\"hljs-literal\">True</span>)\npipeline.save_pretrained(<span\
          \ class=\"hljs-string\">'riffusion_jax'</span>, params=params)\n</code></pre>\n\
          <p>error:</p>\n<pre><code class=\"language-bash\">File <span class=\"hljs-string\"\
          >\"riffusion.py\"</span>, line 39, <span class=\"hljs-keyword\">in</span>\
          \ &lt;module&gt;\n    pipeline.save_pretrained(<span class=\"hljs-string\"\
          >'riffusion_jax'</span>, params=params)\n  File <span class=\"hljs-string\"\
          >\"/python3.8/site-packages/diffusers/pipeline_flax_utils.py\"</span>, line\
          \ 189, <span class=\"hljs-keyword\">in</span> save_pretrained\n    save_method(\n\
          \  File <span class=\"hljs-string\">\"/python3.8/site-packages/diffusers/modeling_flax_utils.py\"\
          </span>, line 518, <span class=\"hljs-keyword\">in</span> save_pretrained\n\
          \    model_to_save.save_config(save_directory)\n  File <span class=\"hljs-string\"\
          >\"/python3.8/site-packages/diffusers/configuration_utils.py\"</span>, line\
          \ 137, <span class=\"hljs-keyword\">in</span> save_config\n    self.to_json_file(output_config_file)\n\
          \  File <span class=\"hljs-string\">\"/python3.8/site-packages/diffusers/configuration_utils.py\"\
          </span>, line 524, <span class=\"hljs-keyword\">in</span> to_json_file\n\
          \    writer.write(self.to_json_string())\n  File <span class=\"hljs-string\"\
          >\"/python3.8/site-packages/diffusers/configuration_utils.py\"</span>, line\
          \ 504, <span class=\"hljs-keyword\">in</span> to_json_string\n    config_dict[<span\
          \ class=\"hljs-string\">\"_class_name\"</span>] = self.__class__.__name__\n\
          \  File <span class=\"hljs-string\">\"/python3.8/site-packages/flax/core/frozen_dict.py\"\
          </span>, line 72, <span class=\"hljs-keyword\">in</span> __setitem__\n \
          \   raise ValueError(<span class=\"hljs-string\">'FrozenDict is immutable.'</span>)\n\
          ValueError: FrozenDict is immutable.\n</code></pre>\n<p>The same script\
          \ works for <code>CompVis/stable-diffusion-v1-4</code> and <code>runwayml/stable-diffusion-v1-5</code>\
          \ models without issues. Any idea what could be causing this? Thanks.</p>\n"
        raw: "Hello. I tried converting the weights to jax, but running into an error.\r\
          \n\r\nCode:\r\n\r\n```python\r\nfrom diffusers import FlaxStableDiffusionPipeline\r\
          \nmodel_name='riffusion/riffusion-model-v1'\r\npipeline, params = FlaxStableDiffusionPipeline.from_pretrained(model_name,\
          \ from_pt=True)\r\npipeline.save_pretrained('riffusion_jax', params=params)\r\
          \n```\r\n\r\nerror:\r\n\r\n```bash\r\nFile \"riffusion.py\", line 39, in\
          \ <module>\r\n    pipeline.save_pretrained('riffusion_jax', params=params)\r\
          \n  File \"/python3.8/site-packages/diffusers/pipeline_flax_utils.py\",\
          \ line 189, in save_pretrained\r\n    save_method(\r\n  File \"/python3.8/site-packages/diffusers/modeling_flax_utils.py\"\
          , line 518, in save_pretrained\r\n    model_to_save.save_config(save_directory)\r\
          \n  File \"/python3.8/site-packages/diffusers/configuration_utils.py\",\
          \ line 137, in save_config\r\n    self.to_json_file(output_config_file)\r\
          \n  File \"/python3.8/site-packages/diffusers/configuration_utils.py\",\
          \ line 524, in to_json_file\r\n    writer.write(self.to_json_string())\r\
          \n  File \"/python3.8/site-packages/diffusers/configuration_utils.py\",\
          \ line 504, in to_json_string\r\n    config_dict[\"_class_name\"] = self.__class__.__name__\r\
          \n  File \"/python3.8/site-packages/flax/core/frozen_dict.py\", line 72,\
          \ in __setitem__\r\n    raise ValueError('FrozenDict is immutable.')\r\n\
          ValueError: FrozenDict is immutable.\r\n```\r\n\r\nThe same script works\
          \ for `CompVis/stable-diffusion-v1-4` and `runwayml/stable-diffusion-v1-5`\
          \ models without issues. Any idea what could be causing this? Thanks."
        updatedAt: '2023-01-20T23:41:34.722Z'
      numEdits: 0
      reactions: []
    id: 63cb26ae567105596c3c87b2
    type: comment
  author: jfacevedo
  content: "Hello. I tried converting the weights to jax, but running into an error.\r\
    \n\r\nCode:\r\n\r\n```python\r\nfrom diffusers import FlaxStableDiffusionPipeline\r\
    \nmodel_name='riffusion/riffusion-model-v1'\r\npipeline, params = FlaxStableDiffusionPipeline.from_pretrained(model_name,\
    \ from_pt=True)\r\npipeline.save_pretrained('riffusion_jax', params=params)\r\n\
    ```\r\n\r\nerror:\r\n\r\n```bash\r\nFile \"riffusion.py\", line 39, in <module>\r\
    \n    pipeline.save_pretrained('riffusion_jax', params=params)\r\n  File \"/python3.8/site-packages/diffusers/pipeline_flax_utils.py\"\
    , line 189, in save_pretrained\r\n    save_method(\r\n  File \"/python3.8/site-packages/diffusers/modeling_flax_utils.py\"\
    , line 518, in save_pretrained\r\n    model_to_save.save_config(save_directory)\r\
    \n  File \"/python3.8/site-packages/diffusers/configuration_utils.py\", line 137,\
    \ in save_config\r\n    self.to_json_file(output_config_file)\r\n  File \"/python3.8/site-packages/diffusers/configuration_utils.py\"\
    , line 524, in to_json_file\r\n    writer.write(self.to_json_string())\r\n  File\
    \ \"/python3.8/site-packages/diffusers/configuration_utils.py\", line 504, in\
    \ to_json_string\r\n    config_dict[\"_class_name\"] = self.__class__.__name__\r\
    \n  File \"/python3.8/site-packages/flax/core/frozen_dict.py\", line 72, in __setitem__\r\
    \n    raise ValueError('FrozenDict is immutable.')\r\nValueError: FrozenDict is\
    \ immutable.\r\n```\r\n\r\nThe same script works for `CompVis/stable-diffusion-v1-4`\
    \ and `runwayml/stable-diffusion-v1-5` models without issues. Any idea what could\
    \ be causing this? Thanks."
  created_at: 2023-01-20 23:41:34+00:00
  edited: false
  hidden: false
  id: 63cb26ae567105596c3c87b2
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 18
repo_id: riffusion/riffusion-model-v1
repo_type: model
status: open
target_branch: null
title: Convert weights to jax
