!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Yakonrus
conflicting_files: null
created_at: 2023-09-06 09:08:57+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/b24da474d5222a43a6d04287fff64d33.svg
      fullname: Konstantin
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Yakonrus
      type: user
    createdAt: '2023-09-06T10:08:57.000Z'
    data:
      edited: false
      editors:
      - Yakonrus
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.4107329547405243
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/b24da474d5222a43a6d04287fff64d33.svg
          fullname: Konstantin
          isHf: false
          isPro: false
          name: Yakonrus
          type: user
        html: "<pre><code>base_inpaint_pipe = AutoPipelineForInpainting.from_pretrained(\n\
          \    \"diffusers/stable-diffusion-xl-1.0-inpainting-0.1\",\n    torch_dtype=torch.float16,\n\
          \    variant=\"fp16\",\n    use_safetensors=True,\n    add_watermarker=False,\n\
          )\nbase_inpaint_pipe.enable_model_cpu_offload(gpu_id=gpu_id)\n</code></pre>\n\
          <p>PIL images at the input<br>with and without load_image()</p>\n<pre><code>\
          \    image = base_inpaint_pipe(\n        prompt=prompt,\n        negative_prompt=nprompt,\n\
          \        image=load_image(image_s),\n        mask_image=load_image(head),\n\
          \        strength=0.75,\n        num_inference_steps=20,\n        guidance_scale=12,\n\
          \        output_type=\"latent\",\n        generator=generator,\n    ).images\n\
          \        \n    image = base_inpaint_pipe(\n        prompt=prompt,\n    \
          \    negative_prompt=nprompt,\n        image=image,\n        mask_image=load_image(face),\n\
          \        strength=0.65,\n        num_inference_steps=30,\n        generator=generator,\n\
          \    ).images[0]\n</code></pre>\n<p>diffusers\\pipelines\\stable_diffusion_xl\\\
          pipeline_stable_diffusion_xl_inpaint.py\", line 1150, in <strong>call</strong><br>\
          \    num_channels_masked_image = masked_image_latents.shape[1]<br>AttributeError:\
          \ 'NoneType' object has no attribute 'shape'</p>\n<pre><code>    image =\
          \ base_inpaint_pipe(\n        prompt=prompt,\n        negative_prompt=nprompt,\n\
          \        image=load_image(image_s),\n        mask_image=load_image(head),\n\
          \        strength=0.75,\n        num_inference_steps=20,\n        guidance_scale=12,\n\
          \        output_type=\"latent\",\n        generator=generator,\n    ).images\n\
          \        \n    image = base_inpaint_pipe(\n        prompt=prompt,\n    \
          \    negative_prompt=nprompt,\n        image=load_image(image),\n      \
          \  mask_image=load_image(face),\n        strength=0.65,\n        num_inference_steps=30,\n\
          \        generator=generator,\n    ).images[0]\n</code></pre>\n<p>  diffusers\\\
          utils\\testing_utils.py\", line 288, in load_image<br>    raise ValueError(<br>ValueError:\
          \ Incorrect format used for image. Should be an url linking to an image,\
          \ a local path, or a PIL image.</p>\n"
        raw: "    base_inpaint_pipe = AutoPipelineForInpainting.from_pretrained(\r\
          \n        \"diffusers/stable-diffusion-xl-1.0-inpainting-0.1\",\r\n    \
          \    torch_dtype=torch.float16,\r\n        variant=\"fp16\",\r\n       \
          \ use_safetensors=True,\r\n        add_watermarker=False,\r\n    )\r\n \
          \   base_inpaint_pipe.enable_model_cpu_offload(gpu_id=gpu_id)\r\n\r\nPIL\
          \ images at the input\r\nwith and without load_image()\r\n      \r\n   \
          \     image = base_inpaint_pipe(\r\n            prompt=prompt,\r\n     \
          \       negative_prompt=nprompt,\r\n            image=load_image(image_s),\r\
          \n            mask_image=load_image(head),\r\n            strength=0.75,\r\
          \n            num_inference_steps=20,\r\n            guidance_scale=12,\r\
          \n            output_type=\"latent\",\r\n            generator=generator,\r\
          \n        ).images\r\n            \r\n        image = base_inpaint_pipe(\r\
          \n            prompt=prompt,\r\n            negative_prompt=nprompt,\r\n\
          \            image=image,\r\n            mask_image=load_image(face),\r\n\
          \            strength=0.65,\r\n            num_inference_steps=30,\r\n \
          \           generator=generator,\r\n        ).images[0]\r\n\r\ndiffusers\\\
          pipelines\\stable_diffusion_xl\\pipeline_stable_diffusion_xl_inpaint.py\"\
          , line 1150, in __call__\r\n    num_channels_masked_image = masked_image_latents.shape[1]\r\
          \nAttributeError: 'NoneType' object has no attribute 'shape'\r\n\r\n   \
          \     image = base_inpaint_pipe(\r\n            prompt=prompt,\r\n     \
          \       negative_prompt=nprompt,\r\n            image=load_image(image_s),\r\
          \n            mask_image=load_image(head),\r\n            strength=0.75,\r\
          \n            num_inference_steps=20,\r\n            guidance_scale=12,\r\
          \n            output_type=\"latent\",\r\n            generator=generator,\r\
          \n        ).images\r\n            \r\n        image = base_inpaint_pipe(\r\
          \n            prompt=prompt,\r\n            negative_prompt=nprompt,\r\n\
          \            image=load_image(image),\r\n            mask_image=load_image(face),\r\
          \n            strength=0.65,\r\n            num_inference_steps=30,\r\n\
          \            generator=generator,\r\n        ).images[0]\r\n\r\n  diffusers\\\
          utils\\testing_utils.py\", line 288, in load_image\r\n    raise ValueError(\r\
          \nValueError: Incorrect format used for image. Should be an url linking\
          \ to an image, a local path, or a PIL image.\r\n"
        updatedAt: '2023-09-06T10:08:57.860Z'
      numEdits: 0
      reactions: []
    id: 64f84fb90590f3db14976ead
    type: comment
  author: Yakonrus
  content: "    base_inpaint_pipe = AutoPipelineForInpainting.from_pretrained(\r\n\
    \        \"diffusers/stable-diffusion-xl-1.0-inpainting-0.1\",\r\n        torch_dtype=torch.float16,\r\
    \n        variant=\"fp16\",\r\n        use_safetensors=True,\r\n        add_watermarker=False,\r\
    \n    )\r\n    base_inpaint_pipe.enable_model_cpu_offload(gpu_id=gpu_id)\r\n\r\
    \nPIL images at the input\r\nwith and without load_image()\r\n      \r\n     \
    \   image = base_inpaint_pipe(\r\n            prompt=prompt,\r\n            negative_prompt=nprompt,\r\
    \n            image=load_image(image_s),\r\n            mask_image=load_image(head),\r\
    \n            strength=0.75,\r\n            num_inference_steps=20,\r\n      \
    \      guidance_scale=12,\r\n            output_type=\"latent\",\r\n         \
    \   generator=generator,\r\n        ).images\r\n            \r\n        image\
    \ = base_inpaint_pipe(\r\n            prompt=prompt,\r\n            negative_prompt=nprompt,\r\
    \n            image=image,\r\n            mask_image=load_image(face),\r\n   \
    \         strength=0.65,\r\n            num_inference_steps=30,\r\n          \
    \  generator=generator,\r\n        ).images[0]\r\n\r\ndiffusers\\pipelines\\stable_diffusion_xl\\\
    pipeline_stable_diffusion_xl_inpaint.py\", line 1150, in __call__\r\n    num_channels_masked_image\
    \ = masked_image_latents.shape[1]\r\nAttributeError: 'NoneType' object has no\
    \ attribute 'shape'\r\n\r\n        image = base_inpaint_pipe(\r\n            prompt=prompt,\r\
    \n            negative_prompt=nprompt,\r\n            image=load_image(image_s),\r\
    \n            mask_image=load_image(head),\r\n            strength=0.75,\r\n \
    \           num_inference_steps=20,\r\n            guidance_scale=12,\r\n    \
    \        output_type=\"latent\",\r\n            generator=generator,\r\n     \
    \   ).images\r\n            \r\n        image = base_inpaint_pipe(\r\n       \
    \     prompt=prompt,\r\n            negative_prompt=nprompt,\r\n            image=load_image(image),\r\
    \n            mask_image=load_image(face),\r\n            strength=0.65,\r\n \
    \           num_inference_steps=30,\r\n            generator=generator,\r\n  \
    \      ).images[0]\r\n\r\n  diffusers\\utils\\testing_utils.py\", line 288, in\
    \ load_image\r\n    raise ValueError(\r\nValueError: Incorrect format used for\
    \ image. Should be an url linking to an image, a local path, or a PIL image.\r\
    \n"
  created_at: 2023-09-06 09:08:57+00:00
  edited: false
  hidden: false
  id: 64f84fb90590f3db14976ead
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 7
repo_id: diffusers/stable-diffusion-xl-1.0-inpainting-0.1
repo_type: model
status: open
target_branch: null
title: output_type="latent" not working
