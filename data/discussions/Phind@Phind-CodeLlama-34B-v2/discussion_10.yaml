!!python/object:huggingface_hub.community.DiscussionWithDetails
author: amangrover
conflicting_files: null
created_at: 2023-09-07 04:53:47+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/079fd407c0511805002d417eb3d7fc65.svg
      fullname: Aman Grover
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: amangrover
      type: user
    createdAt: '2023-09-07T05:53:47.000Z'
    data:
      edited: false
      editors:
      - amangrover
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.469938188791275
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/079fd407c0511805002d417eb3d7fc65.svg
          fullname: Aman Grover
          isHf: false
          isPro: false
          name: amangrover
          type: user
        html: '<p>I am new to ML, and trying to deploy this model on Amazon Sagemaker,
          using the deploy script, Can someone guide</p>

          <p>I am seeing error - RuntimeError: weight model.layers.0.self_attn.rotary_emb.inv_freq
          does not exist</p>

          <p>Traceback (most recent call last):<br>  File "/opt/conda/bin/text-generation-server",
          line 8, in <br>    sys.exit(app())<br>  File "/opt/conda/lib/python3.9/site-packages/typer/main.py",
          line 311, in <strong>call</strong><br>    return get_command(self)(*args,
          **kwargs)<br>  File "/opt/conda/lib/python3.9/site-packages/click/core.py",
          line 1130, in <strong>call</strong><br>    return self.main(*args, **kwargs)<br>  File
          "/opt/conda/lib/python3.9/site-packages/typer/core.py", line 778, in main<br>    return
          _main(<br>  File "/opt/conda/lib/python3.9/site-packages/typer/core.py",
          line 216, in _main<br>    rv = self.invoke(ctx)<br>  File "/opt/conda/lib/python3.9/site-packages/click/core.py",
          line 1657, in invoke<br>    return _process_result(sub_ctx.command.invoke(sub_ctx))<br>  File
          "/opt/conda/lib/python3.9/site-packages/click/core.py", line 1404, in invoke<br>    return
          ctx.invoke(self.callback, **ctx.params)<br>  File "/opt/conda/lib/python3.9/site-packages/click/core.py",
          line 760, in invoke<br>    return __callback(*args, **kwargs)<br>  File
          "/opt/conda/lib/python3.9/site-packages/typer/main.py", line 683, in wrapper<br>    return
          callback(**use_params)  # type: ignore<br>  File "/opt/conda/lib/python3.9/site-packages/text_generation_server/cli.py",
          line 78, in serve<br>    server.serve(<br>  File "/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py",
          line 175, in serve<br>    asyncio.run(<br>  File "/opt/conda/lib/python3.9/asyncio/runners.py",
          line 44, in run<br>    return loop.run_until_complete(main)<br>  File "/opt/conda/lib/python3.9/asyncio/base_events.py",
          line 634, in run_until_complete<br>    self.run_forever()<br>  File "/opt/conda/lib/python3.9/asyncio/base_events.py",
          line 601, in run_forever<br>    self._run_once()<br>  File "/opt/conda/lib/python3.9/asyncio/base_events.py",
          line 1905, in _run_once<br>    handle._run()<br>  File "/opt/conda/lib/python3.9/asyncio/events.py",
          line 80, in _run<br>    self._context.run(self._callback, *self._args)<br>Traceback
          (most recent call last): File "/opt/conda/bin/text-generation-server", line
          8, in  sys.exit(app()) File "/opt/conda/lib/python3.9/site-packages/typer/main.py",
          line 311, in <strong>call</strong> return get_command(self)(*args, **kwargs)
          File "/opt/conda/lib/python3.9/site-packages/click/core.py", line 1130,
          in <strong>call</strong> return self.main(*args, **kwargs) File "/opt/conda/lib/python3.9/site-packages/typer/core.py",
          line 778, in main return _main( File "/opt/conda/lib/python3.9/site-packages/typer/core.py",
          line 216, in _main rv = self.invoke(ctx) File "/opt/conda/lib/python3.9/site-packages/click/core.py",
          line 1657, in invoke return _process_result(sub_ctx.command.invoke(sub_ctx))
          File "/opt/conda/lib/python3.9/site-packages/click/core.py", line 1404,
          in invoke return ctx.invoke(self.callback, **ctx.params) File "/opt/conda/lib/python3.9/site-packages/click/core.py",
          line 760, in invoke return __callback(*args, **kwargs) File "/opt/conda/lib/python3.9/site-packages/typer/main.py",
          line 683, in wrapper return callback(**use_params) # type: ignore File "/opt/conda/lib/python3.9/site-packages/text_generation_server/cli.py",
          line 78, in serve server.serve( File "/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py",
          line 175, in serve asyncio.run( File "/opt/conda/lib/python3.9/asyncio/runners.py",
          line 44, in run return loop.run_until_complete(main) File "/opt/conda/lib/python3.9/asyncio/base_events.py",
          line 634, in run_until_complete self.run_forever() File "/opt/conda/lib/python3.9/asyncio/base_events.py",
          line 601, in run_forever self._run_once() File "/opt/conda/lib/python3.9/asyncio/base_events.py",
          line 1905, in _run_once handle._run() File "/opt/conda/lib/python3.9/asyncio/events.py",
          line 80, in _run self._context.run(self._callback, *self._args)</p>

          <p>2023-09-07T01:02:07.830-04:00</p>

          <p>Copy</p>

          <blockquote>

          <p>File "/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py",
          line 142, in serve_inner<br>    model = get_model(<br>  File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/<strong>init</strong>.py",
          line 185, in get_model<br>    return FlashLlama(<br>  File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/flash_llama.py",
          line 65, in <strong>init</strong><br>    model = FlashLlamaForCausalLM(config,
          weights)<br>  File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py",
          line 452, in <strong>init</strong><br>    self.model = FlashLlamaModel(config,
          weights)<br>  File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py",
          line 390, in <strong>init</strong><br>    [<br>  File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py",
          line 391, in <br>    FlashLlamaLayer(<br>  File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py",
          line 326, in <strong>init</strong><br>    self.self_attn = FlashLlamaAttention(<br>  File
          "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py",
          line 183, in <strong>init</strong><br>    self.rotary_emb = PositionRotaryEmbedding.load(<br>  File
          "/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/layers.py",
          line 395, in load<br>    inv_freq = weights.get_tensor(f"{prefix}.inv_freq")<br>  File
          "/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py",
          line 62, in get_tensor<br>    filename, tensor_name = self.get_filename(tensor_name)<br>  File
          "/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py",
          line 49, in get_filename<br>    raise RuntimeError(f"weight {tensor_name}
          does not exist")<br>File "/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py",
          line 142, in serve_inner model = get_model( File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/<strong>init</strong>.py",
          line 185, in get_model return FlashLlama( File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/flash_llama.py",
          line 65, in <strong>init</strong> model = FlashLlamaForCausalLM(config,
          weights) File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py",
          line 452, in <strong>init</strong> self.model = FlashLlamaModel(config,
          weights) File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py",
          line 390, in <strong>init</strong> [ File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py",
          line 391, in  FlashLlamaLayer( File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py",
          line 326, in <strong>init</strong> self.self_attn = FlashLlamaAttention(
          File "/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py",
          line 183, in <strong>init</strong> self.rotary_emb = PositionRotaryEmbedding.load(
          File "/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/layers.py",
          line 395, in load inv_freq = weights.get_tensor(f"{prefix}.inv_freq") File
          "/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py",
          line 62, in get_tensor filename, tensor_name = self.get_filename(tensor_name)
          File "/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py",
          line 49, in get_filename raise RuntimeError(f"weight {tensor_name} does
          not exist")</p>

          </blockquote>

          <p>2023-09-07T01:02:08.580-04:00</p>

          <p>Copy<br>RuntimeError: weight model.layers.0.self_attn.rotary_emb.inv_freq
          does not exist<br>RuntimeError: weight model.layers.0.self_attn.rotary_emb.inv_freq
          does not exist</p>

          '
        raw: "I am new to ML, and trying to deploy this model on Amazon Sagemaker,\
          \ using the deploy script, Can someone guide\r\n\r\nI am seeing error -\
          \ RuntimeError: weight model.layers.0.self_attn.rotary_emb.inv_freq does\
          \ not exist\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/bin/text-generation-server\"\
          , line 8, in <module>\r\n    sys.exit(app())\r\n  File \"/opt/conda/lib/python3.9/site-packages/typer/main.py\"\
          , line 311, in __call__\r\n    return get_command(self)(*args, **kwargs)\r\
          \n  File \"/opt/conda/lib/python3.9/site-packages/click/core.py\", line\
          \ 1130, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"\
          /opt/conda/lib/python3.9/site-packages/typer/core.py\", line 778, in main\r\
          \n    return _main(\r\n  File \"/opt/conda/lib/python3.9/site-packages/typer/core.py\"\
          , line 216, in _main\r\n    rv = self.invoke(ctx)\r\n  File \"/opt/conda/lib/python3.9/site-packages/click/core.py\"\
          , line 1657, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\
          \n  File \"/opt/conda/lib/python3.9/site-packages/click/core.py\", line\
          \ 1404, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\
          \n  File \"/opt/conda/lib/python3.9/site-packages/click/core.py\", line\
          \ 760, in invoke\r\n    return __callback(*args, **kwargs)\r\n  File \"\
          /opt/conda/lib/python3.9/site-packages/typer/main.py\", line 683, in wrapper\r\
          \n    return callback(**use_params)  # type: ignore\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/cli.py\"\
          , line 78, in serve\r\n    server.serve(\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py\"\
          , line 175, in serve\r\n    asyncio.run(\r\n  File \"/opt/conda/lib/python3.9/asyncio/runners.py\"\
          , line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File\
          \ \"/opt/conda/lib/python3.9/asyncio/base_events.py\", line 634, in run_until_complete\r\
          \n    self.run_forever()\r\n  File \"/opt/conda/lib/python3.9/asyncio/base_events.py\"\
          , line 601, in run_forever\r\n    self._run_once()\r\n  File \"/opt/conda/lib/python3.9/asyncio/base_events.py\"\
          , line 1905, in _run_once\r\n    handle._run()\r\n  File \"/opt/conda/lib/python3.9/asyncio/events.py\"\
          , line 80, in _run\r\n    self._context.run(self._callback, *self._args)\r\
          \nTraceback (most recent call last): File \"/opt/conda/bin/text-generation-server\"\
          , line 8, in <module> sys.exit(app()) File \"/opt/conda/lib/python3.9/site-packages/typer/main.py\"\
          , line 311, in __call__ return get_command(self)(*args, **kwargs) File \"\
          /opt/conda/lib/python3.9/site-packages/click/core.py\", line 1130, in __call__\
          \ return self.main(*args, **kwargs) File \"/opt/conda/lib/python3.9/site-packages/typer/core.py\"\
          , line 778, in main return _main( File \"/opt/conda/lib/python3.9/site-packages/typer/core.py\"\
          , line 216, in _main rv = self.invoke(ctx) File \"/opt/conda/lib/python3.9/site-packages/click/core.py\"\
          , line 1657, in invoke return _process_result(sub_ctx.command.invoke(sub_ctx))\
          \ File \"/opt/conda/lib/python3.9/site-packages/click/core.py\", line 1404,\
          \ in invoke return ctx.invoke(self.callback, **ctx.params) File \"/opt/conda/lib/python3.9/site-packages/click/core.py\"\
          , line 760, in invoke return __callback(*args, **kwargs) File \"/opt/conda/lib/python3.9/site-packages/typer/main.py\"\
          , line 683, in wrapper return callback(**use_params) # type: ignore File\
          \ \"/opt/conda/lib/python3.9/site-packages/text_generation_server/cli.py\"\
          , line 78, in serve server.serve( File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py\"\
          , line 175, in serve asyncio.run( File \"/opt/conda/lib/python3.9/asyncio/runners.py\"\
          , line 44, in run return loop.run_until_complete(main) File \"/opt/conda/lib/python3.9/asyncio/base_events.py\"\
          , line 634, in run_until_complete self.run_forever() File \"/opt/conda/lib/python3.9/asyncio/base_events.py\"\
          , line 601, in run_forever self._run_once() File \"/opt/conda/lib/python3.9/asyncio/base_events.py\"\
          , line 1905, in _run_once handle._run() File \"/opt/conda/lib/python3.9/asyncio/events.py\"\
          , line 80, in _run self._context.run(self._callback, *self._args)\r\n\r\n\
          2023-09-07T01:02:07.830-04:00\r\n\r\nCopy\r\n> File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py\"\
          , line 142, in serve_inner\r\n    model = get_model(\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/__init__.py\"\
          , line 185, in get_model\r\n    return FlashLlama(\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/flash_llama.py\"\
          , line 65, in __init__\r\n    model = FlashLlamaForCausalLM(config, weights)\r\
          \n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
          , line 452, in __init__\r\n    self.model = FlashLlamaModel(config, weights)\r\
          \n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
          , line 390, in __init__\r\n    [\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
          , line 391, in <listcomp>\r\n    FlashLlamaLayer(\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
          , line 326, in __init__\r\n    self.self_attn = FlashLlamaAttention(\r\n\
          \  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
          , line 183, in __init__\r\n    self.rotary_emb = PositionRotaryEmbedding.load(\r\
          \n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/layers.py\"\
          , line 395, in load\r\n    inv_freq = weights.get_tensor(f\"{prefix}.inv_freq\"\
          )\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py\"\
          , line 62, in get_tensor\r\n    filename, tensor_name = self.get_filename(tensor_name)\r\
          \n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py\"\
          , line 49, in get_filename\r\n    raise RuntimeError(f\"weight {tensor_name}\
          \ does not exist\")\r\n> File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py\"\
          , line 142, in serve_inner model = get_model( File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/__init__.py\"\
          , line 185, in get_model return FlashLlama( File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/flash_llama.py\"\
          , line 65, in __init__ model = FlashLlamaForCausalLM(config, weights) File\
          \ \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
          , line 452, in __init__ self.model = FlashLlamaModel(config, weights) File\
          \ \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
          , line 390, in __init__ [ File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
          , line 391, in <listcomp> FlashLlamaLayer( File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
          , line 326, in __init__ self.self_attn = FlashLlamaAttention( File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
          , line 183, in __init__ self.rotary_emb = PositionRotaryEmbedding.load(\
          \ File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/layers.py\"\
          , line 395, in load inv_freq = weights.get_tensor(f\"{prefix}.inv_freq\"\
          ) File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py\"\
          , line 62, in get_tensor filename, tensor_name = self.get_filename(tensor_name)\
          \ File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py\"\
          , line 49, in get_filename raise RuntimeError(f\"weight {tensor_name} does\
          \ not exist\")\r\n\r\n2023-09-07T01:02:08.580-04:00\r\n\r\nCopy\r\nRuntimeError:\
          \ weight model.layers.0.self_attn.rotary_emb.inv_freq does not exist\r\n\
          RuntimeError: weight model.layers.0.self_attn.rotary_emb.inv_freq does not\
          \ exist"
        updatedAt: '2023-09-07T05:53:47.634Z'
      numEdits: 0
      reactions: []
    id: 64f9656bceabf1e6fc78741e
    type: comment
  author: amangrover
  content: "I am new to ML, and trying to deploy this model on Amazon Sagemaker, using\
    \ the deploy script, Can someone guide\r\n\r\nI am seeing error - RuntimeError:\
    \ weight model.layers.0.self_attn.rotary_emb.inv_freq does not exist\r\n\r\nTraceback\
    \ (most recent call last):\r\n  File \"/opt/conda/bin/text-generation-server\"\
    , line 8, in <module>\r\n    sys.exit(app())\r\n  File \"/opt/conda/lib/python3.9/site-packages/typer/main.py\"\
    , line 311, in __call__\r\n    return get_command(self)(*args, **kwargs)\r\n \
    \ File \"/opt/conda/lib/python3.9/site-packages/click/core.py\", line 1130, in\
    \ __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/opt/conda/lib/python3.9/site-packages/typer/core.py\"\
    , line 778, in main\r\n    return _main(\r\n  File \"/opt/conda/lib/python3.9/site-packages/typer/core.py\"\
    , line 216, in _main\r\n    rv = self.invoke(ctx)\r\n  File \"/opt/conda/lib/python3.9/site-packages/click/core.py\"\
    , line 1657, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\
    \n  File \"/opt/conda/lib/python3.9/site-packages/click/core.py\", line 1404,\
    \ in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"\
    /opt/conda/lib/python3.9/site-packages/click/core.py\", line 760, in invoke\r\n\
    \    return __callback(*args, **kwargs)\r\n  File \"/opt/conda/lib/python3.9/site-packages/typer/main.py\"\
    , line 683, in wrapper\r\n    return callback(**use_params)  # type: ignore\r\n\
    \  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/cli.py\"\
    , line 78, in serve\r\n    server.serve(\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py\"\
    , line 175, in serve\r\n    asyncio.run(\r\n  File \"/opt/conda/lib/python3.9/asyncio/runners.py\"\
    , line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/opt/conda/lib/python3.9/asyncio/base_events.py\"\
    , line 634, in run_until_complete\r\n    self.run_forever()\r\n  File \"/opt/conda/lib/python3.9/asyncio/base_events.py\"\
    , line 601, in run_forever\r\n    self._run_once()\r\n  File \"/opt/conda/lib/python3.9/asyncio/base_events.py\"\
    , line 1905, in _run_once\r\n    handle._run()\r\n  File \"/opt/conda/lib/python3.9/asyncio/events.py\"\
    , line 80, in _run\r\n    self._context.run(self._callback, *self._args)\r\nTraceback\
    \ (most recent call last): File \"/opt/conda/bin/text-generation-server\", line\
    \ 8, in <module> sys.exit(app()) File \"/opt/conda/lib/python3.9/site-packages/typer/main.py\"\
    , line 311, in __call__ return get_command(self)(*args, **kwargs) File \"/opt/conda/lib/python3.9/site-packages/click/core.py\"\
    , line 1130, in __call__ return self.main(*args, **kwargs) File \"/opt/conda/lib/python3.9/site-packages/typer/core.py\"\
    , line 778, in main return _main( File \"/opt/conda/lib/python3.9/site-packages/typer/core.py\"\
    , line 216, in _main rv = self.invoke(ctx) File \"/opt/conda/lib/python3.9/site-packages/click/core.py\"\
    , line 1657, in invoke return _process_result(sub_ctx.command.invoke(sub_ctx))\
    \ File \"/opt/conda/lib/python3.9/site-packages/click/core.py\", line 1404, in\
    \ invoke return ctx.invoke(self.callback, **ctx.params) File \"/opt/conda/lib/python3.9/site-packages/click/core.py\"\
    , line 760, in invoke return __callback(*args, **kwargs) File \"/opt/conda/lib/python3.9/site-packages/typer/main.py\"\
    , line 683, in wrapper return callback(**use_params) # type: ignore File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/cli.py\"\
    , line 78, in serve server.serve( File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py\"\
    , line 175, in serve asyncio.run( File \"/opt/conda/lib/python3.9/asyncio/runners.py\"\
    , line 44, in run return loop.run_until_complete(main) File \"/opt/conda/lib/python3.9/asyncio/base_events.py\"\
    , line 634, in run_until_complete self.run_forever() File \"/opt/conda/lib/python3.9/asyncio/base_events.py\"\
    , line 601, in run_forever self._run_once() File \"/opt/conda/lib/python3.9/asyncio/base_events.py\"\
    , line 1905, in _run_once handle._run() File \"/opt/conda/lib/python3.9/asyncio/events.py\"\
    , line 80, in _run self._context.run(self._callback, *self._args)\r\n\r\n2023-09-07T01:02:07.830-04:00\r\
    \n\r\nCopy\r\n> File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py\"\
    , line 142, in serve_inner\r\n    model = get_model(\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/__init__.py\"\
    , line 185, in get_model\r\n    return FlashLlama(\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/flash_llama.py\"\
    , line 65, in __init__\r\n    model = FlashLlamaForCausalLM(config, weights)\r\
    \n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
    , line 452, in __init__\r\n    self.model = FlashLlamaModel(config, weights)\r\
    \n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
    , line 390, in __init__\r\n    [\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
    , line 391, in <listcomp>\r\n    FlashLlamaLayer(\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
    , line 326, in __init__\r\n    self.self_attn = FlashLlamaAttention(\r\n  File\
    \ \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
    , line 183, in __init__\r\n    self.rotary_emb = PositionRotaryEmbedding.load(\r\
    \n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/layers.py\"\
    , line 395, in load\r\n    inv_freq = weights.get_tensor(f\"{prefix}.inv_freq\"\
    )\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py\"\
    , line 62, in get_tensor\r\n    filename, tensor_name = self.get_filename(tensor_name)\r\
    \n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py\"\
    , line 49, in get_filename\r\n    raise RuntimeError(f\"weight {tensor_name} does\
    \ not exist\")\r\n> File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/server.py\"\
    , line 142, in serve_inner model = get_model( File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/__init__.py\"\
    , line 185, in get_model return FlashLlama( File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/flash_llama.py\"\
    , line 65, in __init__ model = FlashLlamaForCausalLM(config, weights) File \"\
    /opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
    , line 452, in __init__ self.model = FlashLlamaModel(config, weights) File \"\
    /opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
    , line 390, in __init__ [ File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
    , line 391, in <listcomp> FlashLlamaLayer( File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
    , line 326, in __init__ self.self_attn = FlashLlamaAttention( File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/models/custom_modeling/flash_llama_modeling.py\"\
    , line 183, in __init__ self.rotary_emb = PositionRotaryEmbedding.load( File \"\
    /opt/conda/lib/python3.9/site-packages/text_generation_server/utils/layers.py\"\
    , line 395, in load inv_freq = weights.get_tensor(f\"{prefix}.inv_freq\") File\
    \ \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py\"\
    , line 62, in get_tensor filename, tensor_name = self.get_filename(tensor_name)\
    \ File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/weights.py\"\
    , line 49, in get_filename raise RuntimeError(f\"weight {tensor_name} does not\
    \ exist\")\r\n\r\n2023-09-07T01:02:08.580-04:00\r\n\r\nCopy\r\nRuntimeError: weight\
    \ model.layers.0.self_attn.rotary_emb.inv_freq does not exist\r\nRuntimeError:\
    \ weight model.layers.0.self_attn.rotary_emb.inv_freq does not exist"
  created_at: 2023-09-07 04:53:47+00:00
  edited: false
  hidden: false
  id: 64f9656bceabf1e6fc78741e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1668367507109-noauth.jpeg?w=200&h=200&f=face
      fullname: Kalvin Tipton
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: GaaraOtheSand
      type: user
    createdAt: '2023-09-16T18:52:04.000Z'
    data:
      edited: false
      editors:
      - GaaraOtheSand
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.864467203617096
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1668367507109-noauth.jpeg?w=200&h=200&f=face
          fullname: Kalvin Tipton
          isHf: false
          isPro: false
          name: GaaraOtheSand
          type: user
        html: '<p>I''m sorry but without code examples it''s a little difficult to
          diagnose what you''re issue is. The trouble lies in not knowing why you''re
          trying to use weight.model.layers.0.self_attn.rotary_emb.inv_freq. These
          are what are in the checkpoints, that can be run: "transformer.word_embeddings",
          "transformer.word_embeddings_layernorm", "model.embed_tokens.weight", "model.layers.0.self_attn.q_proj.weight",
          "model.layers.0.self_attn.k_proj.weight","model.layers.0.self_attn.v_proj.weight","model.layers.0.self_attn.o_proj.weight","model.layers.0.mlp.gate_proj.weight","model.layers.0.mlp.up_proj.weight","model.layers.0.mlp.down_proj.weight","model.layers.0.input_layernorm.weight",
          the same layers but instead of 0 they repeat up until 49, "model.norm.weight","lm_head","transformer.h","transformer.ln_f",
          not sure if there are more but I''m not getting any errors from not running
          them. That being said unless you''re doing something similar to me where
          I''m running a specific quantization and need to set a custom device_map
          you should be able to simply run: model_path = "Phind/Phind-CodeLlama-34B-v2"<br>model
          = LlamaForCausalLM.from_pretrained(model_path, quantization_config=bnb_config,
          device_map="auto")<br>Also there''s no guarantee that the device_map is
          actually your problem but given that it''s trying to run layers I''m guessing
          it''s trying to map those improperly.</p>

          '
        raw: 'I''m sorry but without code examples it''s a little difficult to diagnose
          what you''re issue is. The trouble lies in not knowing why you''re trying
          to use weight.model.layers.0.self_attn.rotary_emb.inv_freq. These are what
          are in the checkpoints, that can be run: "transformer.word_embeddings",
          "transformer.word_embeddings_layernorm", "model.embed_tokens.weight", "model.layers.0.self_attn.q_proj.weight",
          "model.layers.0.self_attn.k_proj.weight","model.layers.0.self_attn.v_proj.weight","model.layers.0.self_attn.o_proj.weight","model.layers.0.mlp.gate_proj.weight","model.layers.0.mlp.up_proj.weight","model.layers.0.mlp.down_proj.weight","model.layers.0.input_layernorm.weight",
          the same layers but instead of 0 they repeat up until 49, "model.norm.weight","lm_head","transformer.h","transformer.ln_f",
          not sure if there are more but I''m not getting any errors from not running
          them. That being said unless you''re doing something similar to me where
          I''m running a specific quantization and need to set a custom device_map
          you should be able to simply run: model_path = "Phind/Phind-CodeLlama-34B-v2"

          model = LlamaForCausalLM.from_pretrained(model_path, quantization_config=bnb_config,
          device_map="auto")

          Also there''s no guarantee that the device_map is actually your problem
          but given that it''s trying to run layers I''m guessing it''s trying to
          map those improperly.'
        updatedAt: '2023-09-16T18:52:04.065Z'
      numEdits: 0
      reactions: []
    id: 6505f9540f44c341cd7b5eac
    type: comment
  author: GaaraOtheSand
  content: 'I''m sorry but without code examples it''s a little difficult to diagnose
    what you''re issue is. The trouble lies in not knowing why you''re trying to use
    weight.model.layers.0.self_attn.rotary_emb.inv_freq. These are what are in the
    checkpoints, that can be run: "transformer.word_embeddings", "transformer.word_embeddings_layernorm",
    "model.embed_tokens.weight", "model.layers.0.self_attn.q_proj.weight", "model.layers.0.self_attn.k_proj.weight","model.layers.0.self_attn.v_proj.weight","model.layers.0.self_attn.o_proj.weight","model.layers.0.mlp.gate_proj.weight","model.layers.0.mlp.up_proj.weight","model.layers.0.mlp.down_proj.weight","model.layers.0.input_layernorm.weight",
    the same layers but instead of 0 they repeat up until 49, "model.norm.weight","lm_head","transformer.h","transformer.ln_f",
    not sure if there are more but I''m not getting any errors from not running them.
    That being said unless you''re doing something similar to me where I''m running
    a specific quantization and need to set a custom device_map you should be able
    to simply run: model_path = "Phind/Phind-CodeLlama-34B-v2"

    model = LlamaForCausalLM.from_pretrained(model_path, quantization_config=bnb_config,
    device_map="auto")

    Also there''s no guarantee that the device_map is actually your problem but given
    that it''s trying to run layers I''m guessing it''s trying to map those improperly.'
  created_at: 2023-09-16 17:52:04+00:00
  edited: false
  hidden: false
  id: 6505f9540f44c341cd7b5eac
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 10
repo_id: Phind/Phind-CodeLlama-34B-v2
repo_type: model
status: open
target_branch: null
title: 'getting RuntimeError: weight model.layers.0.self_attn.rotary_emb.inv_freq
  does not exist'
