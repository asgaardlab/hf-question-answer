!!python/object:huggingface_hub.community.DiscussionWithDetails
author: ayazdan
conflicting_files: null
created_at: 2022-11-02 20:24:45+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/76e5e7b51515b58e207c7d2a4b360d30.svg
      fullname: Amir Yazdanbakhsh
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ayazdan
      type: user
    createdAt: '2022-11-02T21:24:45.000Z'
    data:
      edited: false
      editors:
      - ayazdan
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/76e5e7b51515b58e207c7d2a4b360d30.svg
          fullname: Amir Yazdanbakhsh
          isHf: false
          isPro: false
          name: ayazdan
          type: user
        html: "<p>I have tried to reproduce the accuracy results (models fine tuned\
          \ on imagenet-1k). The accuracy as reported in the offical github is 87.3\
          \ (last row in the attached image). However, this model never reaches to\
          \ that accuracy. The best accuracy so far is 87.03% (-0.27). This is the\
          \ command line that I am using for finetuning.  I have found one slight\
          \ discrepency between this model and what included in github, that is <code>DROP_PATH_RATE\
          \ </code> which in HF model is 0.1 but in github it is 0.2 (not sure if\
          \ that makes a huge difference).</p>\n<p>Do you have any suggestions how\
          \ to get to the reported accuracy?</p>\n<pre><code>python3 transformer-sparsity/examples/pytorch/image-classification/run_image_classification.py\
          \ \\\n    --model_name_or_path microsoft/swin-large-patch4-window12-384\
          \ \\\n    --dataset_name imagenet-1k \\\n    --remove_unused_columns false\
          \ \\\n    --per_device_train_batch_size 16 \\\n    --per_device_eval_batch_size\
          \ 16 \\\n    --do_train \\\n    --do_eval \\\n    --lr_scheduler_type ${lr_schedule}\
          \ \\\n    --weight_decay 1e-8 \\\n    --warmup_ratio 0.16 \\\n    --optim\
          \ adamw_torch \\\n    --load_best_model_at_end \\\n    --eval_steps ${eval_steps}\
          \ \\\n    --save_steps ${eval_steps} \\\n    --evaluation_strategy steps\
          \ \\\n    --logging_steps ${eval_steps} \\\n    --logging_strategy steps\
          \ \\\n    --num_train_epochs ${epochs} \\\n    --learning_rate ${lr} \\\n\
          \    --save_total_limit 4 \\\n    --overwrite_output_dir \\\n    --output_dir\
          \ ~/${base_dir} 2&gt;&amp;1 | tee ~/${base_dir}/swin_large_finetune.txt\n\
          </code></pre>\n<p><a rel=\"nofollow\" href=\"https://cdn-uploads.huggingface.co/production/uploads/1667423994737-6352dc90a023833e59d6349a.png\"\
          ><img alt=\"Screen Shot 2022-11-02 at 2.19.49 PM.png\" src=\"https://cdn-uploads.huggingface.co/production/uploads/1667423994737-6352dc90a023833e59d6349a.png\"\
          ></a></p>\n"
        raw: "I have tried to reproduce the accuracy results (models fine tuned on\
          \ imagenet-1k). The accuracy as reported in the offical github is 87.3 (last\
          \ row in the attached image). However, this model never reaches to that\
          \ accuracy. The best accuracy so far is 87.03% (-0.27). This is the command\
          \ line that I am using for finetuning.  I have found one slight discrepency\
          \ between this model and what included in github, that is `DROP_PATH_RATE\
          \ ` which in HF model is 0.1 but in github it is 0.2 (not sure if that makes\
          \ a huge difference).\r\n\r\nDo you have any suggestions how to get to the\
          \ reported accuracy?\r\n\r\n \r\n```\r\npython3 transformer-sparsity/examples/pytorch/image-classification/run_image_classification.py\
          \ \\\r\n\t--model_name_or_path microsoft/swin-large-patch4-window12-384\
          \ \\\r\n\t--dataset_name imagenet-1k \\\r\n\t--remove_unused_columns false\
          \ \\\r\n\t--per_device_train_batch_size 16 \\\r\n\t--per_device_eval_batch_size\
          \ 16 \\\r\n\t--do_train \\\r\n\t--do_eval \\\r\n\t--lr_scheduler_type ${lr_schedule}\
          \ \\\r\n\t--weight_decay 1e-8 \\\r\n\t--warmup_ratio 0.16 \\\r\n\t--optim\
          \ adamw_torch \\\r\n\t--load_best_model_at_end \\\r\n\t--eval_steps ${eval_steps}\
          \ \\\r\n\t--save_steps ${eval_steps} \\\r\n\t--evaluation_strategy steps\
          \ \\\r\n\t--logging_steps ${eval_steps} \\\r\n\t--logging_strategy steps\
          \ \\\r\n\t--num_train_epochs ${epochs} \\\r\n\t--learning_rate ${lr} \\\r\
          \n\t--save_total_limit 4 \\\r\n\t--overwrite_output_dir \\\r\n\t--output_dir\
          \ ~/${base_dir} 2>&1 | tee ~/${base_dir}/swin_large_finetune.txt\r\n\r\n\
          ```\r\n![Screen Shot 2022-11-02 at 2.19.49 PM.png](https://cdn-uploads.huggingface.co/production/uploads/1667423994737-6352dc90a023833e59d6349a.png)\r\
          \n"
        updatedAt: '2022-11-02T21:24:45.533Z'
      numEdits: 0
      reactions: []
    id: 6362e01d2a84d82a8c92a334
    type: comment
  author: ayazdan
  content: "I have tried to reproduce the accuracy results (models fine tuned on imagenet-1k).\
    \ The accuracy as reported in the offical github is 87.3 (last row in the attached\
    \ image). However, this model never reaches to that accuracy. The best accuracy\
    \ so far is 87.03% (-0.27). This is the command line that I am using for finetuning.\
    \  I have found one slight discrepency between this model and what included in\
    \ github, that is `DROP_PATH_RATE ` which in HF model is 0.1 but in github it\
    \ is 0.2 (not sure if that makes a huge difference).\r\n\r\nDo you have any suggestions\
    \ how to get to the reported accuracy?\r\n\r\n \r\n```\r\npython3 transformer-sparsity/examples/pytorch/image-classification/run_image_classification.py\
    \ \\\r\n\t--model_name_or_path microsoft/swin-large-patch4-window12-384 \\\r\n\
    \t--dataset_name imagenet-1k \\\r\n\t--remove_unused_columns false \\\r\n\t--per_device_train_batch_size\
    \ 16 \\\r\n\t--per_device_eval_batch_size 16 \\\r\n\t--do_train \\\r\n\t--do_eval\
    \ \\\r\n\t--lr_scheduler_type ${lr_schedule} \\\r\n\t--weight_decay 1e-8 \\\r\n\
    \t--warmup_ratio 0.16 \\\r\n\t--optim adamw_torch \\\r\n\t--load_best_model_at_end\
    \ \\\r\n\t--eval_steps ${eval_steps} \\\r\n\t--save_steps ${eval_steps} \\\r\n\
    \t--evaluation_strategy steps \\\r\n\t--logging_steps ${eval_steps} \\\r\n\t--logging_strategy\
    \ steps \\\r\n\t--num_train_epochs ${epochs} \\\r\n\t--learning_rate ${lr} \\\r\
    \n\t--save_total_limit 4 \\\r\n\t--overwrite_output_dir \\\r\n\t--output_dir ~/${base_dir}\
    \ 2>&1 | tee ~/${base_dir}/swin_large_finetune.txt\r\n\r\n```\r\n![Screen Shot\
    \ 2022-11-02 at 2.19.49 PM.png](https://cdn-uploads.huggingface.co/production/uploads/1667423994737-6352dc90a023833e59d6349a.png)\r\
    \n"
  created_at: 2022-11-02 20:24:45+00:00
  edited: false
  hidden: false
  id: 6362e01d2a84d82a8c92a334
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
      fullname: Niels Rogge
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: nielsr
      type: user
    createdAt: '2022-11-07T15:23:06.000Z'
    data:
      edited: true
      editors: []
      hidden: true
      hiddenBy: ''
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
          fullname: Niels Rogge
          isHf: true
          isPro: false
          name: nielsr
          type: user
        html: This comment has been hidden
        raw: This comment has been hidden
        updatedAt: '2022-11-07T15:33:39.313Z'
      numEdits: 1
      reactions: []
    id: 636922da56d1f934980e5248
    type: comment
  author: nielsr
  content: This comment has been hidden
  created_at: 2022-11-07 15:23:06+00:00
  edited: true
  hidden: true
  id: 636922da56d1f934980e5248
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
      fullname: Niels Rogge
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: nielsr
      type: user
    createdAt: '2022-11-07T15:26:03.000Z'
    data:
      edited: true
      editors: []
      hidden: true
      hiddenBy: ''
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
          fullname: Niels Rogge
          isHf: true
          isPro: false
          name: nielsr
          type: user
        html: This comment has been hidden
        raw: This comment has been hidden
        updatedAt: '2022-11-07T15:33:44.643Z'
      numEdits: 1
      reactions: []
    id: 6369238ba256bbb73f7d66e3
    type: comment
  author: nielsr
  content: This comment has been hidden
  created_at: 2022-11-07 15:26:03+00:00
  edited: true
  hidden: true
  id: 6369238ba256bbb73f7d66e3
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
      fullname: Niels Rogge
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: nielsr
      type: user
    createdAt: '2022-11-07T15:34:28.000Z'
    data:
      edited: true
      editors:
      - nielsr
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
          fullname: Niels Rogge
          isHf: true
          isPro: false
          name: nielsr
          type: user
        html: '<p>Hi, thanks for your interest in this model and making the effort
          to validate the performance.</p>

          <p>Note that this checkpoint was already fine-tuned on ImageNet-1k, hence
          there''s no need to train again. You can just run the script with the <code>--do_eval</code>
          flag.</p>

          '
        raw: 'Hi, thanks for your interest in this model and making the effort to
          validate the performance.


          Note that this checkpoint was already fine-tuned on ImageNet-1k, hence there''s
          no need to train again. You can just run the script with the `--do_eval`
          flag.'
        updatedAt: '2022-11-07T15:35:04.184Z'
      numEdits: 3
      reactions: []
    id: 6369258485fef3ca96e3881a
    type: comment
  author: nielsr
  content: 'Hi, thanks for your interest in this model and making the effort to validate
    the performance.


    Note that this checkpoint was already fine-tuned on ImageNet-1k, hence there''s
    no need to train again. You can just run the script with the `--do_eval` flag.'
  created_at: 2022-11-07 15:34:28+00:00
  edited: true
  hidden: false
  id: 6369258485fef3ca96e3881a
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/76e5e7b51515b58e207c7d2a4b360d30.svg
      fullname: Amir Yazdanbakhsh
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ayazdan
      type: user
    createdAt: '2022-11-07T16:13:28.000Z'
    data:
      edited: false
      editors:
      - ayazdan
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/76e5e7b51515b58e207c7d2a4b360d30.svg
          fullname: Amir Yazdanbakhsh
          isHf: false
          isPro: false
          name: ayazdan
          type: user
        html: '<p>Thanks for the response. I have tried validation and observed the
          discrepency. That''s why I have tried to fine-tune it and hoping to get
          better results.</p>

          '
        raw: Thanks for the response. I have tried validation and observed the discrepency.
          That's why I have tried to fine-tune it and hoping to get better results.
        updatedAt: '2022-11-07T16:13:28.894Z'
      numEdits: 0
      reactions: []
    id: 63692ea8a256bbb73f7dd615
    type: comment
  author: ayazdan
  content: Thanks for the response. I have tried validation and observed the discrepency.
    That's why I have tried to fine-tune it and hoping to get better results.
  created_at: 2022-11-07 16:13:28+00:00
  edited: false
  hidden: false
  id: 63692ea8a256bbb73f7dd615
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: microsoft/swin-large-patch4-window12-384
repo_type: model
status: open
target_branch: null
title: Accuracy Discrepency
