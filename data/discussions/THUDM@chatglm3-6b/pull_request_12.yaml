!!python/object:huggingface_hub.community.DiscussionWithDetails
author: chielo
conflicting_files:
- tokenization_chatglm.py
created_at: 2023-11-10 11:16:21+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/b682e0f86dfe57da8a0e016f1f9d9979.svg
      fullname: Chielo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: chielo
      type: user
    createdAt: '2023-11-10T11:16:21.000Z'
    data:
      edited: true
      editors:
      - chielo
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.11044929921627045
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/b682e0f86dfe57da8a0e016f1f9d9979.svg
          fullname: Chielo
          isHf: false
          isPro: false
          name: chielo
          type: user
        html: '<p>Add <code>ChatGLMTokenizerFast</code> and <code>ChatGLMTokenizerConverter</code></p>

          '
        raw: Add `ChatGLMTokenizerFast` and `ChatGLMTokenizerConverter`
        updatedAt: '2023-11-10T11:21:04.307Z'
      numEdits: 1
      reactions: []
    id: 654e11052eef297b26ae7283
    type: comment
  author: chielo
  content: Add `ChatGLMTokenizerFast` and `ChatGLMTokenizerConverter`
  created_at: 2023-11-10 11:16:21+00:00
  edited: true
  hidden: false
  id: 654e11052eef297b26ae7283
  type: comment
- !!python/object:huggingface_hub.community.DiscussionCommit
  _event:
    author:
      avatarUrl: /avatars/b682e0f86dfe57da8a0e016f1f9d9979.svg
      fullname: Chielo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: chielo
      type: user
    createdAt: '2023-11-10T11:20:11.000Z'
    data:
      oid: 6e21b3da2e500257e11f2f924a9bde414fcbd4da
      parents:
      - e46a14881eae613281abbd266ee918e93a56018f
      subject: Add ChatGLMTokenizerFast and ChatGLMTokenizerConverter
    id: 654e11eb0000000000000000
    type: commit
  author: chielo
  created_at: 2023-11-10 11:20:11+00:00
  id: 654e11eb0000000000000000
  oid: 6e21b3da2e500257e11f2f924a9bde414fcbd4da
  summary: Add ChatGLMTokenizerFast and ChatGLMTokenizerConverter
  type: commit
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/b682e0f86dfe57da8a0e016f1f9d9979.svg
      fullname: Chielo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: chielo
      type: user
    createdAt: '2023-11-10T11:20:50.000Z'
    data:
      edited: false
      editors:
      - chielo
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.99971604347229
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/b682e0f86dfe57da8a0e016f1f9d9979.svg
          fullname: Chielo
          isHf: false
          isPro: false
          name: chielo
          type: user
        html: '<p><a href="/THUDM/chatglm3-6b/discussions/7">#7</a> is also merged.</p>

          '
        raw: '#7 is also merged.'
        updatedAt: '2023-11-10T11:20:50.601Z'
      numEdits: 0
      reactions: []
    id: 654e1212557d42a624d868eb
    type: comment
  author: chielo
  content: '#7 is also merged.'
  created_at: 2023-11-10 11:20:50+00:00
  edited: false
  hidden: false
  id: 654e1212557d42a624d868eb
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/b682e0f86dfe57da8a0e016f1f9d9979.svg
      fullname: Chielo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: chielo
      type: user
    createdAt: '2023-11-10T11:31:40.000Z'
    data:
      edited: false
      editors:
      - chielo
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.3272738754749298
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/b682e0f86dfe57da8a0e016f1f9d9979.svg
          fullname: Chielo
          isHf: false
          isPro: false
          name: chielo
          type: user
        html: "<h1 id=\"showcase\">Showcase</h1>\n<pre><code class=\"language-python\"\
          ><span class=\"hljs-keyword\">import</span> transformers, tokenizers\n\n\
          transformers.__version__, tokenizers.__version__\n<span class=\"hljs-comment\"\
          ># Out: ('4.35.0', '0.14.1')</span>\n</code></pre>\n<pre><code class=\"\
          language-python\"><span class=\"hljs-keyword\">from</span> transformers\
          \ <span class=\"hljs-keyword\">import</span> AutoTokenizer\n</code></pre>\n\
          <pre><code class=\"language-python\">fast_tokenizer = AutoTokenizer.from_pretrained(\n\
          \    <span class=\"hljs-string\">\"./\"</span>, trust_remote_code=<span\
          \ class=\"hljs-literal\">True</span>, use_fast=<span class=\"hljs-literal\"\
          >True</span>\n)\nslow_tokenizer = AutoTokenizer.from_pretrained(\n    <span\
          \ class=\"hljs-string\">\"./\"</span>, trust_remote_code=<span class=\"\
          hljs-literal\">True</span>, use_fast=<span class=\"hljs-literal\">False</span>\n\
          )\n</code></pre>\n<pre><code class=\"language-python\">content = <span class=\"\
          hljs-string\">\"\u662F\u54EA\u4E2A\u661F\u7403\u7684\u5462\uFF1F\"</span>\n\
          history = [\n    {\n        <span class=\"hljs-string\">\"role\"</span>:\
          \ <span class=\"hljs-string\">\"user\"</span>,\n        <span class=\"hljs-string\"\
          >\"content\"</span>: <span class=\"hljs-string\">\"\u8FD9\u662F\u4EC0\u4E48\
          \u8BED\u8A00\uFF1F\u201Caburaka    dabura   \u201D\"</span>,\n        <span\
          \ class=\"hljs-string\">\"metadata\"</span>: {<span class=\"hljs-string\"\
          >\"username\"</span>: <span class=\"hljs-string\">\"Chielo\"</span>},\n\
          \    },\n    {<span class=\"hljs-string\">\"role\"</span>: <span class=\"\
          hljs-string\">\"assistant\"</span>, <span class=\"hljs-string\">\"content\"\
          </span>: <span class=\"hljs-string\">\"\u8FD9\u662F\u6765\u81EA\u5916\u661F\
          \u7684\u8BED\u8A00\u3002\"</span>},\n]\n</code></pre>\n<pre><code class=\"\
          language-python\">old_inputs = slow_tokenizer.build_chat_input(content,\
          \ history=history)\nnew_inputs = fast_tokenizer.build_chat_input(content,\
          \ history=history)\nnew_text = fast_tokenizer.build_chat_text(content, history=history)\n\
          </code></pre>\n<pre><code class=\"language-python\">old_input_ids = old_inputs[<span\
          \ class=\"hljs-string\">\"input_ids\"</span>][<span class=\"hljs-number\"\
          >0</span>].tolist()\n</code></pre>\n<pre><code class=\"language-python\"\
          >new_inputs[<span class=\"hljs-string\">\"input_ids\"</span>][<span class=\"\
          hljs-number\">0</span>].tolist() == old_input_ids\n<span class=\"hljs-comment\"\
          ># Out: True</span>\n</code></pre>\n<pre><code class=\"language-python\"\
          >fast_tokenizer.encode(new_text) == old_input_ids\n<span class=\"hljs-comment\"\
          ># Out: True</span>\n</code></pre>\n<pre><code class=\"language-python\"\
          >fast_tokenizer.decode(old_input_ids) == slow_tokenizer.decode(old_input_ids)\n\
          <span class=\"hljs-comment\"># Out: True</span>\n</code></pre>\n<pre><code\
          \ class=\"language-python\">new_text\n<span class=\"hljs-comment\"># Out:\
          \ \"&lt;|user|&gt;&lt;!encode-sep!&gt;{'username': 'Chielo'}\\n&lt;!encode-sep!&gt;\u8FD9\
          \u662F\u4EC0\u4E48\u8BED\u8A00\uFF1F\u201Caburaka    dabura   \u201D&lt;|assistant|&gt;&lt;!encode-sep!&gt;\\\
          n&lt;!encode-sep!&gt;\u8FD9\u662F\u6765\u81EA\u5916\u661F\u7684\u8BED\u8A00\
          \u3002&lt;|user|&gt;&lt;!encode-sep!&gt;\\n&lt;!encode-sep!&gt;\u662F\u54EA\
          \u4E2A\u661F\u7403\u7684\u5462\uFF1F&lt;|assistant|&gt;\"</span>\n</code></pre>\n"
        raw: "# Showcase\n\n```python\nimport transformers, tokenizers\n\ntransformers.__version__,\
          \ tokenizers.__version__\n# Out: ('4.35.0', '0.14.1')\n```\n\n```python\n\
          from transformers import AutoTokenizer\n```\n\n```python\nfast_tokenizer\
          \ = AutoTokenizer.from_pretrained(\n    \"./\", trust_remote_code=True,\
          \ use_fast=True\n)\nslow_tokenizer = AutoTokenizer.from_pretrained(\n  \
          \  \"./\", trust_remote_code=True, use_fast=False\n)\n```\n\n```python\n\
          content = \"\u662F\u54EA\u4E2A\u661F\u7403\u7684\u5462\uFF1F\"\nhistory\
          \ = [\n    {\n        \"role\": \"user\",\n        \"content\": \"\u8FD9\
          \u662F\u4EC0\u4E48\u8BED\u8A00\uFF1F\u201Caburaka    dabura   \u201D\",\n\
          \        \"metadata\": {\"username\": \"Chielo\"},\n    },\n    {\"role\"\
          : \"assistant\", \"content\": \"\u8FD9\u662F\u6765\u81EA\u5916\u661F\u7684\
          \u8BED\u8A00\u3002\"},\n]\n```\n\n```python\nold_inputs = slow_tokenizer.build_chat_input(content,\
          \ history=history)\nnew_inputs = fast_tokenizer.build_chat_input(content,\
          \ history=history)\nnew_text = fast_tokenizer.build_chat_text(content, history=history)\n\
          ```\n\n```python\nold_input_ids = old_inputs[\"input_ids\"][0].tolist()\n\
          ```\n\n```python\nnew_inputs[\"input_ids\"][0].tolist() == old_input_ids\n\
          # Out: True\n```\n\n```python\nfast_tokenizer.encode(new_text) == old_input_ids\n\
          # Out: True\n```\n\n```python\nfast_tokenizer.decode(old_input_ids) == slow_tokenizer.decode(old_input_ids)\n\
          # Out: True\n```\n\n```python\nnew_text\n# Out: \"<|user|><!encode-sep!>{'username':\
          \ 'Chielo'}\\n<!encode-sep!>\u8FD9\u662F\u4EC0\u4E48\u8BED\u8A00\uFF1F\u201C\
          aburaka    dabura   \u201D<|assistant|><!encode-sep!>\\n<!encode-sep!>\u8FD9\
          \u662F\u6765\u81EA\u5916\u661F\u7684\u8BED\u8A00\u3002<|user|><!encode-sep!>\\\
          n<!encode-sep!>\u662F\u54EA\u4E2A\u661F\u7403\u7684\u5462\uFF1F<|assistant|>\"\
          \n```\n"
        updatedAt: '2023-11-10T11:31:40.050Z'
      numEdits: 0
      reactions: []
    id: 654e149cd0cfd9cb3f7cd6bc
    type: comment
  author: chielo
  content: "# Showcase\n\n```python\nimport transformers, tokenizers\n\ntransformers.__version__,\
    \ tokenizers.__version__\n# Out: ('4.35.0', '0.14.1')\n```\n\n```python\nfrom\
    \ transformers import AutoTokenizer\n```\n\n```python\nfast_tokenizer = AutoTokenizer.from_pretrained(\n\
    \    \"./\", trust_remote_code=True, use_fast=True\n)\nslow_tokenizer = AutoTokenizer.from_pretrained(\n\
    \    \"./\", trust_remote_code=True, use_fast=False\n)\n```\n\n```python\ncontent\
    \ = \"\u662F\u54EA\u4E2A\u661F\u7403\u7684\u5462\uFF1F\"\nhistory = [\n    {\n\
    \        \"role\": \"user\",\n        \"content\": \"\u8FD9\u662F\u4EC0\u4E48\u8BED\
    \u8A00\uFF1F\u201Caburaka    dabura   \u201D\",\n        \"metadata\": {\"username\"\
    : \"Chielo\"},\n    },\n    {\"role\": \"assistant\", \"content\": \"\u8FD9\u662F\
    \u6765\u81EA\u5916\u661F\u7684\u8BED\u8A00\u3002\"},\n]\n```\n\n```python\nold_inputs\
    \ = slow_tokenizer.build_chat_input(content, history=history)\nnew_inputs = fast_tokenizer.build_chat_input(content,\
    \ history=history)\nnew_text = fast_tokenizer.build_chat_text(content, history=history)\n\
    ```\n\n```python\nold_input_ids = old_inputs[\"input_ids\"][0].tolist()\n```\n\
    \n```python\nnew_inputs[\"input_ids\"][0].tolist() == old_input_ids\n# Out: True\n\
    ```\n\n```python\nfast_tokenizer.encode(new_text) == old_input_ids\n# Out: True\n\
    ```\n\n```python\nfast_tokenizer.decode(old_input_ids) == slow_tokenizer.decode(old_input_ids)\n\
    # Out: True\n```\n\n```python\nnew_text\n# Out: \"<|user|><!encode-sep!>{'username':\
    \ 'Chielo'}\\n<!encode-sep!>\u8FD9\u662F\u4EC0\u4E48\u8BED\u8A00\uFF1F\u201Caburaka\
    \    dabura   \u201D<|assistant|><!encode-sep!>\\n<!encode-sep!>\u8FD9\u662F\u6765\
    \u81EA\u5916\u661F\u7684\u8BED\u8A00\u3002<|user|><!encode-sep!>\\n<!encode-sep!>\u662F\
    \u54EA\u4E2A\u661F\u7403\u7684\u5462\uFF1F<|assistant|>\"\n```\n"
  created_at: 2023-11-10 11:31:40+00:00
  edited: false
  hidden: false
  id: 654e149cd0cfd9cb3f7cd6bc
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/b682e0f86dfe57da8a0e016f1f9d9979.svg
      fullname: Chielo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: chielo
      type: user
    createdAt: '2023-11-10T11:32:21.000Z'
    data:
      status: open
    id: 654e14c56ee27944d529e19a
    type: status-change
  author: chielo
  created_at: 2023-11-10 11:32:21+00:00
  id: 654e14c56ee27944d529e19a
  new_status: open
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/b682e0f86dfe57da8a0e016f1f9d9979.svg
      fullname: Chielo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: chielo
      type: user
    createdAt: '2023-11-10T11:40:46.000Z'
    data:
      edited: false
      editors:
      - chielo
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8097681999206543
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/b682e0f86dfe57da8a0e016f1f9d9979.svg
          fullname: Chielo
          isHf: false
          isPro: false
          name: chielo
          type: user
        html: '<p><a rel="nofollow" href="https://github.com/ModelTC/lightllm/pull/207">LightLLM
          will also add support for <code>ChatGLM3</code>.</a></p>

          '
        raw: '[LightLLM will also add support for `ChatGLM3`.](https://github.com/ModelTC/lightllm/pull/207)'
        updatedAt: '2023-11-10T11:40:46.599Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - XHPlus
    id: 654e16bea568100364ea434c
    type: comment
  author: chielo
  content: '[LightLLM will also add support for `ChatGLM3`.](https://github.com/ModelTC/lightllm/pull/207)'
  created_at: 2023-11-10 11:40:46+00:00
  edited: false
  hidden: false
  id: 654e16bea568100364ea434c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e4a9a50d72f846f1cfde2253e2c61ca0.svg
      fullname: wuliangdi
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: liangdi
      type: user
    createdAt: '2023-12-14T09:46:23.000Z'
    data:
      edited: false
      editors:
      - liangdi
      hidden: false
      identifiedLanguage:
        language: zh
        probability: 1.0000581741333008
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e4a9a50d72f846f1cfde2253e2c61ca0.svg
          fullname: wuliangdi
          isHf: false
          isPro: false
          name: liangdi
          type: user
        html: "<p>\u8FD9\u4E2A\u53EF\u4EE5\u5408\u5E76\u5417?</p>\n"
        raw: "\u8FD9\u4E2A\u53EF\u4EE5\u5408\u5E76\u5417?"
        updatedAt: '2023-12-14T09:46:23.943Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - andy616168
    id: 657aceef477969a3d96c557b
    type: comment
  author: liangdi
  content: "\u8FD9\u4E2A\u53EF\u4EE5\u5408\u5E76\u5417?"
  created_at: 2023-12-14 09:46:23+00:00
  edited: false
  hidden: false
  id: 657aceef477969a3d96c557b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/RQJQZouD-Qnt70k0dVjHU.png?w=200&h=200&f=face
      fullname: Yuxuan Zhang
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: zRzRzRzRzRzRzR
      type: user
    createdAt: '2023-12-29T13:11:14.000Z'
    data:
      edited: false
      editors:
      - zRzRzRzRzRzRzR
      hidden: false
      identifiedLanguage:
        language: zh
        probability: 0.9621405601501465
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/RQJQZouD-Qnt70k0dVjHU.png?w=200&h=200&f=face
          fullname: Yuxuan Zhang
          isHf: false
          isPro: false
          name: zRzRzRzRzRzRzR
          type: user
        html: "<p>\u6682\u65F6\u8FD8\u6CA1\u6709\u8FDB\u884C\u5C1D\u8BD5\uFF0C\u63A5\
          \u4E0B\u6765\u5C06\u4F1A\u8FDB\u884C\u5C1D\u8BD5</p>\n"
        raw: "\u6682\u65F6\u8FD8\u6CA1\u6709\u8FDB\u884C\u5C1D\u8BD5\uFF0C\u63A5\u4E0B\
          \u6765\u5C06\u4F1A\u8FDB\u884C\u5C1D\u8BD5"
        updatedAt: '2023-12-29T13:11:14.176Z'
      numEdits: 0
      reactions: []
    id: 658ec57243971eed45c4369e
    type: comment
  author: zRzRzRzRzRzRzR
  content: "\u6682\u65F6\u8FD8\u6CA1\u6709\u8FDB\u884C\u5C1D\u8BD5\uFF0C\u63A5\u4E0B\
    \u6765\u5C06\u4F1A\u8FDB\u884C\u5C1D\u8BD5"
  created_at: 2023-12-29 13:11:14+00:00
  edited: false
  hidden: false
  id: 658ec57243971eed45c4369e
  type: comment
is_pull_request: true
merge_commit_oid: null
num: 12
repo_id: THUDM/chatglm3-6b
repo_type: model
status: open
target_branch: refs/heads/main
title: Add `ChatGLMTokenizerFast` and `ChatGLMTokenizerConverter`
