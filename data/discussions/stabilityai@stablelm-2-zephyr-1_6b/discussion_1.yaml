!!python/object:huggingface_hub.community.DiscussionWithDetails
author: interstellarninja
conflicting_files: null
created_at: 2024-01-20 12:29:31+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6446be9a15a27291ef8bea10/9_gywXgzL9Jk3MYLdX9RG.jpeg?w=200&h=200&f=face
      fullname: interstellarninja
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: interstellarninja
      type: user
    createdAt: '2024-01-20T12:29:31.000Z'
    data:
      edited: false
      editors:
      - interstellarninja
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8996967077255249
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6446be9a15a27291ef8bea10/9_gywXgzL9Jk3MYLdX9RG.jpeg?w=200&h=200&f=face
          fullname: interstellarninja
          isHf: false
          isPro: false
          name: interstellarninja
          type: user
        html: '<p>I''m working on finetuning this model with axolotl but I''m getting
          the following error during dataset preprocessing with <code>axolotl.cli.preprocess</code><br>The
          same dataset had worked with stablelm-zephyr-3b.</p>

          <p><code>TypeError: cannot pickle ''builtins.CoreBPE'' object</code></p>

          '
        raw: "I'm working on finetuning this model with axolotl but I'm getting the\
          \ following error during dataset preprocessing with ```axolotl.cli.preprocess```\r\
          \nThe same dataset had worked with stablelm-zephyr-3b.\r\n\r\n```TypeError:\
          \ cannot pickle 'builtins.CoreBPE' object```"
        updatedAt: '2024-01-20T12:29:31.826Z'
      numEdits: 0
      reactions: []
    id: 65abbcab2ed95c799f7d88b4
    type: comment
  author: interstellarninja
  content: "I'm working on finetuning this model with axolotl but I'm getting the\
    \ following error during dataset preprocessing with ```axolotl.cli.preprocess```\r\
    \nThe same dataset had worked with stablelm-zephyr-3b.\r\n\r\n```TypeError: cannot\
    \ pickle 'builtins.CoreBPE' object```"
  created_at: 2024-01-20 12:29:31+00:00
  edited: false
  hidden: false
  id: 65abbcab2ed95c799f7d88b4
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1665261042648-61b2bf4f5b1f7cad1799cfbb.png?w=200&h=200&f=face
      fullname: Jonathan Tow
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: jon-tow
      type: user
    createdAt: '2024-01-20T18:03:24.000Z'
    data:
      edited: false
      editors:
      - jon-tow
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9007381200790405
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1665261042648-61b2bf4f5b1f7cad1799cfbb.png?w=200&h=200&f=face
          fullname: Jonathan Tow
          isHf: false
          isPro: false
          name: jon-tow
          type: user
        html: "<p>Hi, <span data-props=\"{&quot;user&quot;:&quot;interstellarninja&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/interstellarninja\"\
          >@<span class=\"underline\">interstellarninja</span></a></span>\n\n\t</span></span>!\
          \ This model uses a different tokenizer from <code>stablelm-zephyr-3b</code>\
          \ based on <code>tiktoken</code>. Which version of <code>datasets</code>\
          \ are you on? I came across a similar issue that suggests updating to latest:\
          \ <a rel=\"nofollow\" href=\"https://github.com/huggingface/datasets/issues/5769\"\
          >https://github.com/huggingface/datasets/issues/5769</a></p>\n<p>If this\
          \ doesn't work, I'll try to repro on <code>axolotl</code> ASAP. Thanks for\
          \ reporting!</p>\n"
        raw: 'Hi, @interstellarninja! This model uses a different tokenizer from `stablelm-zephyr-3b`
          based on `tiktoken`. Which version of `datasets` are you on? I came across
          a similar issue that suggests updating to latest: https://github.com/huggingface/datasets/issues/5769


          If this doesn''t work, I''ll try to repro on `axolotl` ASAP. Thanks for
          reporting!'
        updatedAt: '2024-01-20T18:03:24.107Z'
      numEdits: 0
      reactions: []
    id: 65ac0aecabf6d1ccb7e5b7d5
    type: comment
  author: jon-tow
  content: 'Hi, @interstellarninja! This model uses a different tokenizer from `stablelm-zephyr-3b`
    based on `tiktoken`. Which version of `datasets` are you on? I came across a similar
    issue that suggests updating to latest: https://github.com/huggingface/datasets/issues/5769


    If this doesn''t work, I''ll try to repro on `axolotl` ASAP. Thanks for reporting!'
  created_at: 2024-01-20 18:03:24+00:00
  edited: false
  hidden: false
  id: 65ac0aecabf6d1ccb7e5b7d5
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6446be9a15a27291ef8bea10/9_gywXgzL9Jk3MYLdX9RG.jpeg?w=200&h=200&f=face
      fullname: interstellarninja
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: interstellarninja
      type: user
    createdAt: '2024-01-20T19:11:44.000Z'
    data:
      edited: false
      editors:
      - interstellarninja
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9036956429481506
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6446be9a15a27291ef8bea10/9_gywXgzL9Jk3MYLdX9RG.jpeg?w=200&h=200&f=face
          fullname: interstellarninja
          isHf: false
          isPro: false
          name: interstellarninja
          type: user
        html: '<p>Hi jon - I see that it uses "Arcade100kTokenizer". </p>

          <p>I''m using <code>datasets Version: 2.16.1</code> which is the latest
          version. I think I should open an issue on axolotl repo.</p>

          '
        raw: "Hi jon - I see that it uses \"Arcade100kTokenizer\". \n\nI'm using ```datasets\
          \ Version: 2.16.1``` which is the latest version. I think I should open\
          \ an issue on axolotl repo."
        updatedAt: '2024-01-20T19:11:44.703Z'
      numEdits: 0
      reactions: []
    id: 65ac1af03022589371a1f5d8
    type: comment
  author: interstellarninja
  content: "Hi jon - I see that it uses \"Arcade100kTokenizer\". \n\nI'm using ```datasets\
    \ Version: 2.16.1``` which is the latest version. I think I should open an issue\
    \ on axolotl repo."
  created_at: 2024-01-20 19:11:44+00:00
  edited: false
  hidden: false
  id: 65ac1af03022589371a1f5d8
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1676273643829-63466107f7bd6326925fc770.jpeg?w=200&h=200&f=face
      fullname: Phung Van Duy
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: pvduy
      type: user
    createdAt: '2024-01-22T05:14:59.000Z'
    data:
      edited: false
      editors:
      - pvduy
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6518020629882812
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1676273643829-63466107f7bd6326925fc770.jpeg?w=200&h=200&f=face
          fullname: Phung Van Duy
          isHf: false
          isPro: false
          name: pvduy
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;interstellarninja&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/interstellarninja\"\
          >@<span class=\"underline\">interstellarninja</span></a></span>\n\n\t</span></span>\
          \  A simple trick that I used for my training script that you can refer\
          \ to:</p>\n<pre><code class=\"language-python\"><span class=\"hljs-keyword\"\
          >import</span> copyreg\n<span class=\"hljs-keyword\">import</span> tiktoken\n\
          <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\"\
          >pickle_Encoding</span>(<span class=\"hljs-params\">enc</span>):\n     \
          \   <span class=\"hljs-keyword\">return</span> (functools.partial(tiktoken.core.Encoding,\
          \ enc.name, pat_str=enc._pat_str, mergeable_ranks=enc._mergeable_ranks,\
          \ special_tokens=enc._special_tokens), ())\ncopyreg.pickle(tiktoken.core.Encoding,\
          \ pickle_Encoding)\n</code></pre>\n<p>Add this before your tokenized function,\
          \ I guess it is a map function using huggingface datasets. Hope it helps.\
          \  </p>\n"
        raw: "@interstellarninja  A simple trick that I used for my training script\
          \ that you can refer to:\n```python\nimport copyreg\nimport tiktoken\ndef\
          \ pickle_Encoding(enc):\n        return (functools.partial(tiktoken.core.Encoding,\
          \ enc.name, pat_str=enc._pat_str, mergeable_ranks=enc._mergeable_ranks,\
          \ special_tokens=enc._special_tokens), ())\ncopyreg.pickle(tiktoken.core.Encoding,\
          \ pickle_Encoding)\n```\nAdd this before your tokenized function, I guess\
          \ it is a map function using huggingface datasets. Hope it helps.  "
        updatedAt: '2024-01-22T05:14:59.810Z'
      numEdits: 0
      reactions: []
    id: 65adf9d3e0ee7990a66d320f
    type: comment
  author: pvduy
  content: "@interstellarninja  A simple trick that I used for my training script\
    \ that you can refer to:\n```python\nimport copyreg\nimport tiktoken\ndef pickle_Encoding(enc):\n\
    \        return (functools.partial(tiktoken.core.Encoding, enc.name, pat_str=enc._pat_str,\
    \ mergeable_ranks=enc._mergeable_ranks, special_tokens=enc._special_tokens), ())\n\
    copyreg.pickle(tiktoken.core.Encoding, pickle_Encoding)\n```\nAdd this before\
    \ your tokenized function, I guess it is a map function using huggingface datasets.\
    \ Hope it helps.  "
  created_at: 2024-01-22 05:14:59+00:00
  edited: false
  hidden: false
  id: 65adf9d3e0ee7990a66d320f
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1665261042648-61b2bf4f5b1f7cad1799cfbb.png?w=200&h=200&f=face
      fullname: Jonathan Tow
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: jon-tow
      type: user
    createdAt: '2024-01-23T05:11:07.000Z'
    data:
      edited: false
      editors:
      - jon-tow
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8157892823219299
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1665261042648-61b2bf4f5b1f7cad1799cfbb.png?w=200&h=200&f=face
          fullname: Jonathan Tow
          isHf: false
          isPro: false
          name: jon-tow
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;interstellarninja&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/interstellarninja\"\
          >@<span class=\"underline\">interstellarninja</span></a></span>\n\n\t</span></span>\
          \ The tokenizer has been <a href=\"https://huggingface.co/stabilityai/stablelm-2-zephyr-1_6b/commit/589adbfdd913d96282d43411c87a996f1bc7b000\"\
          >updated</a> to support pickling. Let us know if you run into any further\
          \ issues. Thanks for raising this!</p>\n"
        raw: '@interstellarninja The tokenizer has been [updated](https://huggingface.co/stabilityai/stablelm-2-zephyr-1_6b/commit/589adbfdd913d96282d43411c87a996f1bc7b000)
          to support pickling. Let us know if you run into any further issues. Thanks
          for raising this!'
        updatedAt: '2024-01-23T05:11:07.127Z'
      numEdits: 0
      reactions: []
      relatedEventId: 65af4a6b5f62b76444fac701
    id: 65af4a6b5f62b76444fac6fc
    type: comment
  author: jon-tow
  content: '@interstellarninja The tokenizer has been [updated](https://huggingface.co/stabilityai/stablelm-2-zephyr-1_6b/commit/589adbfdd913d96282d43411c87a996f1bc7b000)
    to support pickling. Let us know if you run into any further issues. Thanks for
    raising this!'
  created_at: 2024-01-23 05:11:07+00:00
  edited: false
  hidden: false
  id: 65af4a6b5f62b76444fac6fc
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1665261042648-61b2bf4f5b1f7cad1799cfbb.png?w=200&h=200&f=face
      fullname: Jonathan Tow
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: jon-tow
      type: user
    createdAt: '2024-01-23T05:11:07.000Z'
    data:
      status: closed
    id: 65af4a6b5f62b76444fac701
    type: status-change
  author: jon-tow
  created_at: 2024-01-23 05:11:07+00:00
  id: 65af4a6b5f62b76444fac701
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: stabilityai/stablelm-2-zephyr-1_6b
repo_type: model
status: closed
target_branch: null
title: finetuning with axolotl error with tokenizer
