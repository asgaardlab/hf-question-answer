!!python/object:huggingface_hub.community.DiscussionWithDetails
author: muelletm
conflicting_files: null
created_at: 2023-05-27 10:57:58+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1646410244848-5fce6464e80c09ad2760251c.jpeg?w=200&h=200&f=face
      fullname: "Thomas M\xFCller"
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: muelletm
      type: user
    createdAt: '2023-05-27T11:57:58.000Z'
    data:
      edited: false
      editors:
      - muelletm
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1646410244848-5fce6464e80c09ad2760251c.jpeg?w=200&h=200&f=face
          fullname: "Thomas M\xFCller"
          isHf: false
          isPro: false
          name: muelletm
          type: user
        html: "<p>(This is a trace you get when trying to use mpt-7b from qlora. More\
          \ details here: <a rel=\"nofollow\" href=\"https://github.com/artidoro/qlora/issues/10\"\
          >https://github.com/artidoro/qlora/issues/10</a>)</p>\n<pre><code>/opt/conda/lib/python3.10/site-packages/peft/utils/other.py:76:\
          \ FutureWarning: prepare_model_for_int8_training is deprecated and will\
          \ be removed in a future version. Use prepare_model_for_kbit_training instead.\n\
          \  warnings.warn(\nTraceback (most recent call last):\n  File \"/code/qlora/qlora.py\"\
          , line 758, in &lt;module&gt;\n    train()\n  File \"/code/qlora/qlora.py\"\
          , line 590, in train\n    model = get_accelerate_model(args, checkpoint_dir)\n\
          \  File \"/code/qlora/qlora.py\", line 295, in get_accelerate_model\n  \
          \  model = prepare_model_for_int8_training(model, use_gradient_checkpointing=args.gradient_checkpointing)\n\
          \  File \"/opt/conda/lib/python3.10/site-packages/peft/utils/other.py\"\
          , line 80, in prepare_model_for_int8_training\n    return prepare_model_for_kbit_training(*args,\
          \ **kwargs)\n  File \"/opt/conda/lib/python3.10/site-packages/peft/utils/other.py\"\
          , line 69, in prepare_model_for_kbit_training\n    model.gradient_checkpointing_enable()\n\
          \  File \"/opt/conda/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
          , line 1620, in gradient_checkpointing_enable\n    raise ValueError(f\"\
          {self.__class__.__name__} does not support gradient checkpointing.\")\n\
          </code></pre>\n"
        raw: "(This is a trace you get when trying to use mpt-7b from qlora. More\
          \ details here: https://github.com/artidoro/qlora/issues/10)\r\n\r\n```\r\
          \n/opt/conda/lib/python3.10/site-packages/peft/utils/other.py:76: FutureWarning:\
          \ prepare_model_for_int8_training is deprecated and will be removed in a\
          \ future version. Use prepare_model_for_kbit_training instead.\r\n  warnings.warn(\r\
          \nTraceback (most recent call last):\r\n  File \"/code/qlora/qlora.py\"\
          , line 758, in <module>\r\n    train()\r\n  File \"/code/qlora/qlora.py\"\
          , line 590, in train\r\n    model = get_accelerate_model(args, checkpoint_dir)\r\
          \n  File \"/code/qlora/qlora.py\", line 295, in get_accelerate_model\r\n\
          \    model = prepare_model_for_int8_training(model, use_gradient_checkpointing=args.gradient_checkpointing)\r\
          \n  File \"/opt/conda/lib/python3.10/site-packages/peft/utils/other.py\"\
          , line 80, in prepare_model_for_int8_training\r\n    return prepare_model_for_kbit_training(*args,\
          \ **kwargs)\r\n  File \"/opt/conda/lib/python3.10/site-packages/peft/utils/other.py\"\
          , line 69, in prepare_model_for_kbit_training\r\n    model.gradient_checkpointing_enable()\r\
          \n  File \"/opt/conda/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
          , line 1620, in gradient_checkpointing_enable\r\n    raise ValueError(f\"\
          {self.__class__.__name__} does not support gradient checkpointing.\")\r\n\
          ```"
        updatedAt: '2023-05-27T11:57:58.847Z'
      numEdits: 0
      reactions: []
    id: 6471f0466facfb01d8ad37b0
    type: comment
  author: muelletm
  content: "(This is a trace you get when trying to use mpt-7b from qlora. More details\
    \ here: https://github.com/artidoro/qlora/issues/10)\r\n\r\n```\r\n/opt/conda/lib/python3.10/site-packages/peft/utils/other.py:76:\
    \ FutureWarning: prepare_model_for_int8_training is deprecated and will be removed\
    \ in a future version. Use prepare_model_for_kbit_training instead.\r\n  warnings.warn(\r\
    \nTraceback (most recent call last):\r\n  File \"/code/qlora/qlora.py\", line\
    \ 758, in <module>\r\n    train()\r\n  File \"/code/qlora/qlora.py\", line 590,\
    \ in train\r\n    model = get_accelerate_model(args, checkpoint_dir)\r\n  File\
    \ \"/code/qlora/qlora.py\", line 295, in get_accelerate_model\r\n    model = prepare_model_for_int8_training(model,\
    \ use_gradient_checkpointing=args.gradient_checkpointing)\r\n  File \"/opt/conda/lib/python3.10/site-packages/peft/utils/other.py\"\
    , line 80, in prepare_model_for_int8_training\r\n    return prepare_model_for_kbit_training(*args,\
    \ **kwargs)\r\n  File \"/opt/conda/lib/python3.10/site-packages/peft/utils/other.py\"\
    , line 69, in prepare_model_for_kbit_training\r\n    model.gradient_checkpointing_enable()\r\
    \n  File \"/opt/conda/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
    , line 1620, in gradient_checkpointing_enable\r\n    raise ValueError(f\"{self.__class__.__name__}\
    \ does not support gradient checkpointing.\")\r\n```"
  created_at: 2023-05-27 10:57:58+00:00
  edited: false
  hidden: false
  id: 6471f0466facfb01d8ad37b0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1646410244848-5fce6464e80c09ad2760251c.jpeg?w=200&h=200&f=face
      fullname: "Thomas M\xFCller"
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: muelletm
      type: user
    createdAt: '2023-05-27T15:25:06.000Z'
    data:
      edited: true
      editors:
      - muelletm
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1646410244848-5fce6464e80c09ad2760251c.jpeg?w=200&h=200&f=face
          fullname: "Thomas M\xFCller"
          isHf: false
          isPro: false
          name: muelletm
          type: user
        html: "<p>Small update but <span data-props=\"{&quot;user&quot;:&quot;cekal&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/cekal\"\
          >@<span class=\"underline\">cekal</span></a></span>\n\n\t</span></span>\
          \ added a version of mpt-7b that fixes this (and other problems):</p>\n\
          <p><a href=\"https://huggingface.co/cekal/mpt-7b-peft-compatible\">https://huggingface.co/cekal/mpt-7b-peft-compatible</a></p>\n\
          <p>Maybe their code can be merged into this repo?</p>\n"
        raw: 'Small update but @cekal added a version of mpt-7b that fixes this (and
          other problems):


          https://huggingface.co/cekal/mpt-7b-peft-compatible


          Maybe their code can be merged into this repo?'
        updatedAt: '2023-05-27T15:25:45.053Z'
      numEdits: 2
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - leocnj
    id: 647220d297a75cc77ab0c7f1
    type: comment
  author: muelletm
  content: 'Small update but @cekal added a version of mpt-7b that fixes this (and
    other problems):


    https://huggingface.co/cekal/mpt-7b-peft-compatible


    Maybe their code can be merged into this repo?'
  created_at: 2023-05-27 14:25:06+00:00
  edited: true
  hidden: false
  id: 647220d297a75cc77ab0c7f1
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1668560930781-noauth.png?w=200&h=200&f=face
      fullname: Sam Havens
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: sam-mosaic
      type: user
    createdAt: '2023-06-14T07:37:42.000Z'
    data:
      edited: false
      editors:
      - sam-mosaic
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9797893166542053
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1668560930781-noauth.png?w=200&h=200&f=face
          fullname: Sam Havens
          isHf: false
          isPro: false
          name: sam-mosaic
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;cekal&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/cekal\">@<span class=\"\
          underline\">cekal</span></a></span>\n\n\t</span></span> \u2014 what changes\
          \ were needed for gradient checkpointing in the PEFT library? </p>\n"
        raw: "@cekal \u2014 what changes were needed for gradient checkpointing in\
          \ the PEFT library? "
        updatedAt: '2023-06-14T07:37:42.722Z'
      numEdits: 0
      reactions: []
    id: 64896e462c7e64c9ead81b05
    type: comment
  author: sam-mosaic
  content: "@cekal \u2014 what changes were needed for gradient checkpointing in the\
    \ PEFT library? "
  created_at: 2023-06-14 06:37:42+00:00
  edited: false
  hidden: false
  id: 64896e462c7e64c9ead81b05
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659978504573-6093a02dc4a92d63a91c5236.jpeg?w=200&h=200&f=face
      fullname: Diwank Tomer
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: diwank
      type: user
    createdAt: '2023-07-03T17:30:15.000Z'
    data:
      edited: false
      editors:
      - diwank
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.28740760684013367
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659978504573-6093a02dc4a92d63a91c5236.jpeg?w=200&h=200&f=face
          fullname: Diwank Tomer
          isHf: false
          isPro: false
          name: diwank
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;cekal&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/cekal\">@<span class=\"\
          underline\">cekal</span></a></span>\n\n\t</span></span> <span data-props=\"\
          {&quot;user&quot;:&quot;sam-mosaic&quot;}\" data-target=\"UserMention\"\
          \ class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"inline-block\"\
          ><span class=\"contents\"><a href=\"/sam-mosaic\">@<span class=\"underline\"\
          >sam-mosaic</span></a></span>\n\n\t</span></span> any updates?</p>\n"
        raw: '@cekal @sam-mosaic any updates?'
        updatedAt: '2023-07-03T17:30:15.081Z'
      numEdits: 0
      reactions: []
    id: 64a305a746621acc90b6ba1c
    type: comment
  author: diwank
  content: '@cekal @sam-mosaic any updates?'
  created_at: 2023-07-03 16:30:15+00:00
  edited: false
  hidden: false
  id: 64a305a746621acc90b6ba1c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62b2b6f6cbd2a402fc554370/Oc0bj5cV7KDQKHC8iah1_.jpeg?w=200&h=200&f=face
      fullname: Aman Karmani
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: tmm1
      type: user
    createdAt: '2023-07-06T01:50:47.000Z'
    data:
      edited: false
      editors:
      - tmm1
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6370378136634827
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62b2b6f6cbd2a402fc554370/Oc0bj5cV7KDQKHC8iah1_.jpeg?w=200&h=200&f=face
          fullname: Aman Karmani
          isHf: false
          isPro: false
          name: tmm1
          type: user
        html: '<p>this looks like the change to enable gradient checkpointing?</p>

          <p><a href="https://huggingface.co/cekal/mpt-7b-peft-compatible/commit/a5eab52c1c61c1d50a4e01428949f6ff90c73c48">https://huggingface.co/cekal/mpt-7b-peft-compatible/commit/a5eab52c1c61c1d50a4e01428949f6ff90c73c48</a></p>

          '
        raw: 'this looks like the change to enable gradient checkpointing?


          https://huggingface.co/cekal/mpt-7b-peft-compatible/commit/a5eab52c1c61c1d50a4e01428949f6ff90c73c48'
        updatedAt: '2023-07-06T01:50:47.957Z'
      numEdits: 0
      reactions: []
    id: 64a61df7fcbef02a5ec2d51e
    type: comment
  author: tmm1
  content: 'this looks like the change to enable gradient checkpointing?


    https://huggingface.co/cekal/mpt-7b-peft-compatible/commit/a5eab52c1c61c1d50a4e01428949f6ff90c73c48'
  created_at: 2023-07-06 00:50:47+00:00
  edited: false
  hidden: false
  id: 64a61df7fcbef02a5ec2d51e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/-6Yq7oM_Ju6Zi2GEvobvb.jpeg?w=200&h=200&f=face
      fullname: Ronan McGovern
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: RonanMcGovern
      type: user
    createdAt: '2023-07-19T18:36:28.000Z'
    data:
      edited: false
      editors:
      - RonanMcGovern
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9792594313621521
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/-6Yq7oM_Ju6Zi2GEvobvb.jpeg?w=200&h=200&f=face
          fullname: Ronan McGovern
          isHf: false
          isPro: false
          name: RonanMcGovern
          type: user
        html: '<p>hmm, ok, but was that propagated to other mpt models like mpt-7b-chat
          and mpt-7b-8k-chat?</p>

          '
        raw: hmm, ok, but was that propagated to other mpt models like mpt-7b-chat
          and mpt-7b-8k-chat?
        updatedAt: '2023-07-19T18:36:28.230Z'
      numEdits: 0
      reactions: []
    id: 64b82d2c56f81f15e290bbb1
    type: comment
  author: RonanMcGovern
  content: hmm, ok, but was that propagated to other mpt models like mpt-7b-chat and
    mpt-7b-8k-chat?
  created_at: 2023-07-19 17:36:28+00:00
  edited: false
  hidden: false
  id: 64b82d2c56f81f15e290bbb1
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/49e218ebc08597cf06dfddf9d357b610.svg
      fullname: Alex C
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: adc23
      type: user
    createdAt: '2023-10-10T21:37:23.000Z'
    data:
      edited: false
      editors:
      - adc23
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9243340492248535
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/49e218ebc08597cf06dfddf9d357b610.svg
          fullname: Alex C
          isHf: false
          isPro: false
          name: adc23
          type: user
        html: '<p>Just ran into this issue today, I know if you use the Composer trainer
          you can use gradient checkpointing but it doesn''t work through the Huggingface
          trainer</p>

          '
        raw: Just ran into this issue today, I know if you use the Composer trainer
          you can use gradient checkpointing but it doesn't work through the Huggingface
          trainer
        updatedAt: '2023-10-10T21:37:23.737Z'
      numEdits: 0
      reactions: []
    id: 6525c413f83ce2a9e4b62f08
    type: comment
  author: adc23
  content: Just ran into this issue today, I know if you use the Composer trainer
    you can use gradient checkpointing but it doesn't work through the Huggingface
    trainer
  created_at: 2023-10-10 20:37:23+00:00
  edited: false
  hidden: false
  id: 6525c413f83ce2a9e4b62f08
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/-6Yq7oM_Ju6Zi2GEvobvb.jpeg?w=200&h=200&f=face
      fullname: Ronan McGovern
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: RonanMcGovern
      type: user
    createdAt: '2023-10-13T22:26:44.000Z'
    data:
      edited: false
      editors:
      - RonanMcGovern
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9424527883529663
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/-6Yq7oM_Ju6Zi2GEvobvb.jpeg?w=200&h=200&f=face
          fullname: Ronan McGovern
          isHf: false
          isPro: false
          name: RonanMcGovern
          type: user
        html: '<p>thanks, noted, feel free to close the issue</p>

          '
        raw: thanks, noted, feel free to close the issue
        updatedAt: '2023-10-13T22:26:44.298Z'
      numEdits: 0
      reactions: []
    id: 6529c4242aa5b27c77acf959
    type: comment
  author: RonanMcGovern
  content: thanks, noted, feel free to close the issue
  created_at: 2023-10-13 21:26:44+00:00
  edited: false
  hidden: false
  id: 6529c4242aa5b27c77acf959
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 41
repo_id: mosaicml/mpt-7b
repo_type: model
status: open
target_branch: null
title: Support gradient checkpointing
