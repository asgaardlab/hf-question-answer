!!python/object:huggingface_hub.community.DiscussionWithDetails
author: ybelkada
conflicting_files: null
created_at: 2023-10-30 09:30:12+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1648631057413-noauth.png?w=200&h=200&f=face
      fullname: Younes Belkada
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ybelkada
      type: user
    createdAt: '2023-10-30T10:30:12.000Z'
    data:
      edited: true
      editors:
      - ybelkada
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5748099684715271
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1648631057413-noauth.png?w=200&h=200&f=face
          fullname: Younes Belkada
          isHf: true
          isPro: false
          name: ybelkada
          type: user
        html: "<p>Since the attention mask refactor in transformers main some private\
          \ methods has been removed such as <code>_expand_mask</code></p>\n<p><a\
          \ rel=\"nofollow\" href=\"https://github.com/huggingface/transformers/pull/27086\"\
          >https://github.com/huggingface/transformers/pull/27086</a></p>\n<p>Loading\
          \ the model fails with this error trace:</p>\n<pre><code class=\"language-bash\"\
          >    from transformers.models.bloom.modeling_bloom import _expand_mask as\
          \ _expand_mask_bloom\nImportError: cannot import name <span class=\"hljs-string\"\
          >'_expand_mask'</span> from <span class=\"hljs-string\">'transformers.models.bloom.modeling_bloom'</span>\
          \ \n</code></pre>\n<p>Simple script to repro:</p>\n<pre><code class=\"language-python\"\
          ><span class=\"hljs-keyword\">from</span> accelerate <span class=\"hljs-keyword\"\
          >import</span> init_empty_weights\n<span class=\"hljs-keyword\">from</span>\
          \ transformers <span class=\"hljs-keyword\">import</span> AutoModelForCausalLM,\
          \ AutoConfig\n\nmodel_id = <span class=\"hljs-string\">\"mosaicml/mpt-7b\"\
          </span>\nconfig = AutoConfig.from_pretrained(\n    model_id, trust_remote_code=<span\
          \ class=\"hljs-literal\">True</span>, revision=<span class=\"hljs-string\"\
          >\"72e5f594ce36f9cabfa2a9fd8f58b491eb467ee7\"</span>\n)\n<span class=\"\
          hljs-keyword\">with</span> init_empty_weights():\n    model = AutoModelForCausalLM.from_config(\n\
          \        config, trust_remote_code=<span class=\"hljs-literal\">True</span>,\
          \ code_revision=<span class=\"hljs-string\">\"72e5f594ce36f9cabfa2a9fd8f58b491eb467ee7\"\
          </span>\n    )\n</code></pre>\n<p>Meaning a patch will be needed here for\
          \ future transformers versions.</p>\n"
        raw: "Since the attention mask refactor in transformers main some private\
          \ methods has been removed such as `_expand_mask`\n\nhttps://github.com/huggingface/transformers/pull/27086\n\
          \nLoading the model fails with this error trace:\n```bash\n    from transformers.models.bloom.modeling_bloom\
          \ import _expand_mask as _expand_mask_bloom\nImportError: cannot import\
          \ name '_expand_mask' from 'transformers.models.bloom.modeling_bloom' \n\
          ```\n\nSimple script to repro:\n\n```python\nfrom accelerate import init_empty_weights\n\
          from transformers import AutoModelForCausalLM, AutoConfig\n\nmodel_id =\
          \ \"mosaicml/mpt-7b\"\nconfig = AutoConfig.from_pretrained(\n    model_id,\
          \ trust_remote_code=True, revision=\"72e5f594ce36f9cabfa2a9fd8f58b491eb467ee7\"\
          \n)\nwith init_empty_weights():\n    model = AutoModelForCausalLM.from_config(\n\
          \        config, trust_remote_code=True, code_revision=\"72e5f594ce36f9cabfa2a9fd8f58b491eb467ee7\"\
          \n    )\n```\n\nMeaning a patch will be needed here for future transformers\
          \ versions."
        updatedAt: '2023-10-30T10:31:43.022Z'
      numEdits: 1
      reactions: []
    id: 653f85b4de20728b27140bfd
    type: comment
  author: ybelkada
  content: "Since the attention mask refactor in transformers main some private methods\
    \ has been removed such as `_expand_mask`\n\nhttps://github.com/huggingface/transformers/pull/27086\n\
    \nLoading the model fails with this error trace:\n```bash\n    from transformers.models.bloom.modeling_bloom\
    \ import _expand_mask as _expand_mask_bloom\nImportError: cannot import name '_expand_mask'\
    \ from 'transformers.models.bloom.modeling_bloom' \n```\n\nSimple script to repro:\n\
    \n```python\nfrom accelerate import init_empty_weights\nfrom transformers import\
    \ AutoModelForCausalLM, AutoConfig\n\nmodel_id = \"mosaicml/mpt-7b\"\nconfig =\
    \ AutoConfig.from_pretrained(\n    model_id, trust_remote_code=True, revision=\"\
    72e5f594ce36f9cabfa2a9fd8f58b491eb467ee7\"\n)\nwith init_empty_weights():\n  \
    \  model = AutoModelForCausalLM.from_config(\n        config, trust_remote_code=True,\
    \ code_revision=\"72e5f594ce36f9cabfa2a9fd8f58b491eb467ee7\"\n    )\n```\n\nMeaning\
    \ a patch will be needed here for future transformers versions."
  created_at: 2023-10-30 09:30:12+00:00
  edited: true
  hidden: false
  id: 653f85b4de20728b27140bfd
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1648631057413-noauth.png?w=200&h=200&f=face
      fullname: Younes Belkada
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ybelkada
      type: user
    createdAt: '2023-10-30T10:30:39.000Z'
    data:
      edited: false
      editors:
      - ybelkada
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5382238626480103
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1648631057413-noauth.png?w=200&h=200&f=face
          fullname: Younes Belkada
          isHf: true
          isPro: false
          name: ybelkada
          type: user
        html: "<p>cc <span data-props=\"{&quot;user&quot;:&quot;abhi-mosaic&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/abhi-mosaic\"\
          >@<span class=\"underline\">abhi-mosaic</span></a></span>\n\n\t</span></span>\
          \ <span data-props=\"{&quot;user&quot;:&quot;sam-mosaic&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/sam-mosaic\">@<span class=\"\
          underline\">sam-mosaic</span></a></span>\n\n\t</span></span> <span data-props=\"\
          {&quot;user&quot;:&quot;daking&quot;}\" data-target=\"UserMention\" class=\"\
          SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"inline-block\"><span\
          \ class=\"contents\"><a href=\"/daking\">@<span class=\"underline\">daking</span></a></span>\n\
          \n\t</span></span></p>\n"
        raw: cc @abhi-mosaic @sam-mosaic @daking
        updatedAt: '2023-10-30T10:30:39.362Z'
      numEdits: 0
      reactions: []
    id: 653f85cf9c7bf38da2ded4a3
    type: comment
  author: ybelkada
  content: cc @abhi-mosaic @sam-mosaic @daking
  created_at: 2023-10-30 09:30:39+00:00
  edited: false
  hidden: false
  id: 653f85cf9c7bf38da2ded4a3
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1611612244659-5e7bd6f730dc073f817a2ba8.jpeg?w=200&h=200&f=face
      fullname: Daniel King
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: daking
      type: user
    createdAt: '2023-10-30T21:55:07.000Z'
    data:
      edited: false
      editors:
      - daking
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9435552358627319
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1611612244659-5e7bd6f730dc073f817a2ba8.jpeg?w=200&h=200&f=face
          fullname: Daniel King
          isHf: false
          isPro: false
          name: daking
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;ybelkada&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/ybelkada\">@<span class=\"\
          underline\">ybelkada</span></a></span>\n\n\t</span></span> This should be\
          \ fixed now. Could you please retest and confirm on your end? Thanks!</p>\n"
        raw: '@ybelkada This should be fixed now. Could you please retest and confirm
          on your end? Thanks!'
        updatedAt: '2023-10-30T21:55:07.772Z'
      numEdits: 0
      reactions: []
    id: 6540263b7466fdcc083bcdd3
    type: comment
  author: daking
  content: '@ybelkada This should be fixed now. Could you please retest and confirm
    on your end? Thanks!'
  created_at: 2023-10-30 20:55:07+00:00
  edited: false
  hidden: false
  id: 6540263b7466fdcc083bcdd3
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1648631057413-noauth.png?w=200&h=200&f=face
      fullname: Younes Belkada
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ybelkada
      type: user
    createdAt: '2023-10-31T13:56:06.000Z'
    data:
      edited: false
      editors:
      - ybelkada
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8597655296325684
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1648631057413-noauth.png?w=200&h=200&f=face
          fullname: Younes Belkada
          isHf: true
          isPro: false
          name: ybelkada
          type: user
        html: '<p>Works like charm now, thanks!</p>

          '
        raw: Works like charm now, thanks!
        updatedAt: '2023-10-31T13:56:06.054Z'
      numEdits: 0
      reactions: []
      relatedEventId: 6541077699e887c0406c0f1b
    id: 6541077699e887c0406c0f18
    type: comment
  author: ybelkada
  content: Works like charm now, thanks!
  created_at: 2023-10-31 12:56:06+00:00
  edited: false
  hidden: false
  id: 6541077699e887c0406c0f18
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1648631057413-noauth.png?w=200&h=200&f=face
      fullname: Younes Belkada
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ybelkada
      type: user
    createdAt: '2023-10-31T13:56:06.000Z'
    data:
      status: closed
    id: 6541077699e887c0406c0f1b
    type: status-change
  author: ybelkada
  created_at: 2023-10-31 12:56:06+00:00
  id: 6541077699e887c0406c0f1b
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/f1b08efbe43ed60fa0b47c80a7f39bf8.svg
      fullname: julien perez
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jnm38
      type: user
    createdAt: '2023-11-23T09:27:03.000Z'
    data:
      edited: false
      editors:
      - jnm38
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.48609039187431335
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/f1b08efbe43ed60fa0b47c80a7f39bf8.svg
          fullname: julien perez
          isHf: false
          isPro: false
          name: jnm38
          type: user
        html: '<p>Doesn''t work on the git<br>ImportError: cannot import name ''_expand_mask''
          from ''transformers.models.bloom.modeling_bloom'' (/lre/home/jperez/anaconda3/envs/llms/lib/python3.9/site-packages/transformers/models/bloom/modeling_bloom.py)</p>

          '
        raw: 'Doesn''t work on the git

          ImportError: cannot import name ''_expand_mask'' from ''transformers.models.bloom.modeling_bloom''
          (/lre/home/jperez/anaconda3/envs/llms/lib/python3.9/site-packages/transformers/models/bloom/modeling_bloom.py)'
        updatedAt: '2023-11-23T09:27:03.860Z'
      numEdits: 0
      reactions: []
    id: 655f1ae7d5c0d3db537e2533
    type: comment
  author: jnm38
  content: 'Doesn''t work on the git

    ImportError: cannot import name ''_expand_mask'' from ''transformers.models.bloom.modeling_bloom''
    (/lre/home/jperez/anaconda3/envs/llms/lib/python3.9/site-packages/transformers/models/bloom/modeling_bloom.py)'
  created_at: 2023-11-23 09:27:03+00:00
  edited: false
  hidden: false
  id: 655f1ae7d5c0d3db537e2533
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/64c38871f9cd765462fa1a17/yuIlVcqeDlQVKsUF8uEl3.jpeg?w=200&h=200&f=face
      fullname: Lei Zhang
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Lemoncoke
      type: user
    createdAt: '2023-12-15T10:30:47.000Z'
    data:
      edited: false
      editors:
      - Lemoncoke
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5873652100563049
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/64c38871f9cd765462fa1a17/yuIlVcqeDlQVKsUF8uEl3.jpeg?w=200&h=200&f=face
          fullname: Lei Zhang
          isHf: false
          isPro: false
          name: Lemoncoke
          type: user
        html: '<p>ImportError: cannot import name ''_expand_mask'' from ''transformers.models.bloom.modeling_bloom''
          (/usr/local/lib/python3.9/dist-packages/transformers/models/bloom/modeling_bloom.py)</p>

          <p>I got this error with transformers 4.36.1, any solution?</p>

          '
        raw: 'ImportError: cannot import name ''_expand_mask'' from ''transformers.models.bloom.modeling_bloom''
          (/usr/local/lib/python3.9/dist-packages/transformers/models/bloom/modeling_bloom.py)


          I got this error with transformers 4.36.1, any solution?'
        updatedAt: '2023-12-15T10:30:47.823Z'
      numEdits: 0
      reactions: []
    id: 657c2ad7bf80c126a3ced355
    type: comment
  author: Lemoncoke
  content: 'ImportError: cannot import name ''_expand_mask'' from ''transformers.models.bloom.modeling_bloom''
    (/usr/local/lib/python3.9/dist-packages/transformers/models/bloom/modeling_bloom.py)


    I got this error with transformers 4.36.1, any solution?'
  created_at: 2023-12-15 10:30:47+00:00
  edited: false
  hidden: false
  id: 657c2ad7bf80c126a3ced355
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1611612244659-5e7bd6f730dc073f817a2ba8.jpeg?w=200&h=200&f=face
      fullname: Daniel King
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: daking
      type: user
    createdAt: '2023-12-15T17:37:33.000Z'
    data:
      edited: false
      editors:
      - daking
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8958033919334412
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1611612244659-5e7bd6f730dc073f817a2ba8.jpeg?w=200&h=200&f=face
          fullname: Daniel King
          isHf: false
          isPro: false
          name: daking
          type: user
        html: '<p>The latest model works. Are you pinned to a revision?</p>

          '
        raw: The latest model works. Are you pinned to a revision?
        updatedAt: '2023-12-15T17:37:33.781Z'
      numEdits: 0
      reactions: []
    id: 657c8edd69cfe9b4cdeffb0f
    type: comment
  author: daking
  content: The latest model works. Are you pinned to a revision?
  created_at: 2023-12-15 17:37:33+00:00
  edited: false
  hidden: false
  id: 657c8edd69cfe9b4cdeffb0f
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 83
repo_id: mosaicml/mpt-7b
repo_type: model
status: closed
target_branch: null
title: Model not working with transformers main
