!!python/object:huggingface_hub.community.DiscussionWithDetails
author: jssaluja
conflicting_files: null
created_at: 2023-12-02 20:02:28+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/d15ad205b158e14675448559e01d2d90.svg
      fullname: Jaspal Singh Saluja
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jssaluja
      type: user
    createdAt: '2023-12-02T20:02:28.000Z'
    data:
      edited: false
      editors:
      - jssaluja
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.4706399142742157
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/d15ad205b158e14675448559e01d2d90.svg
          fullname: Jaspal Singh Saluja
          isHf: false
          isPro: false
          name: jssaluja
          type: user
        html: '<p>Keep running into exception when <strong>loading model</strong></p>

          <p>RuntimeError: [enforce fail at alloc_cpu.cpp:83] err == 0. DefaultCPUAllocator:
          can''t allocate memory: </p>

          <p>This occurs randomly, with the same configuration of instances on AWS
          Sagemaker</p>

          <p>Is this a known issue ?<br>Any recommendations to fix ?</p>

          <p><em><strong>Full stack trace</strong></em><br>  model = AutoModel.from_pretrained(MODEL,
          trust_remote_code=True)<br>  File "/usr/local/lib/python3.8/site-packages/transformers/models/auto/auto_factory.py",
          line 561, in from_pretrained<br>    return model_class.from_pretrained(<br>  File
          "/usr/local/lib/python3.8/site-packages/transformers/modeling_utils.py",
          line 3236, in from_pretrained<br>    model = cls(config, *model_args, **model_kwargs)<br>  File
          "/root/.cache/huggingface/modules/transformers_modules/jinaai/jina-bert-implementation/c41d17d28431712f4b24b52bb83d426d7137a02f/modeling_bert.py",
          line 1111, in <strong>init</strong><br>    self.encoder = JinaBertEncoder(config)<br>  File
          "/root/.cache/huggingface/modules/transformers_modules/jinaai/jina-bert-implementation/c41d17d28431712f4b24b52bb83d426d7137a02f/modeling_bert.py",
          line 702,in <strong>init</strong><br>    self.rebuild_alibi_tensor(size=config.max_position_embeddings),<br>  File
          "/root/.cache/huggingface/modules/transformers_modules/jinaai/jina-bert-implementation/c41d17d28431712f4b24b52bb83d426d7137a02f/modeling_bert.py",
          line 743,in rebuild_alibi_tensor<br>    alibi = slopes.unsqueeze(1).unsqueeze(1)
          * relative_position<br>RuntimeError: [enforce fail at alloc_cpu.cpp:83]
          err == 0. DefaultCPUAllocator: can''t allocate memory: you tried to allocate
          3221225472 bytes. Error code 12 (Cannot allocate memory)</p>

          '
        raw: "Keep running into exception when **loading model**\r\n\r\nRuntimeError:\
          \ [enforce fail at alloc_cpu.cpp:83] err == 0. DefaultCPUAllocator: can't\
          \ allocate memory: \r\n\r\nThis occurs randomly, with the same configuration\
          \ of instances on AWS Sagemaker\r\n\r\nIs this a known issue ?\r\nAny recommendations\
          \ to fix ?\r\n\r\n***Full stack trace***\r\n  model = AutoModel.from_pretrained(MODEL,\
          \ trust_remote_code=True)\r\n  File \"/usr/local/lib/python3.8/site-packages/transformers/models/auto/auto_factory.py\"\
          , line 561, in from_pretrained\r\n    return model_class.from_pretrained(\r\
          \n  File \"/usr/local/lib/python3.8/site-packages/transformers/modeling_utils.py\"\
          , line 3236, in from_pretrained\r\n    model = cls(config, *model_args,\
          \ **model_kwargs)\r\n  File \"/root/.cache/huggingface/modules/transformers_modules/jinaai/jina-bert-implementation/c41d17d28431712f4b24b52bb83d426d7137a02f/modeling_bert.py\"\
          , line 1111, in __init__\r\n    self.encoder = JinaBertEncoder(config)\r\
          \n  File \"/root/.cache/huggingface/modules/transformers_modules/jinaai/jina-bert-implementation/c41d17d28431712f4b24b52bb83d426d7137a02f/modeling_bert.py\"\
          , line 702,in __init__\r\n    self.rebuild_alibi_tensor(size=config.max_position_embeddings),\r\
          \n  File \"/root/.cache/huggingface/modules/transformers_modules/jinaai/jina-bert-implementation/c41d17d28431712f4b24b52bb83d426d7137a02f/modeling_bert.py\"\
          , line 743,in rebuild_alibi_tensor\r\n    alibi = slopes.unsqueeze(1).unsqueeze(1)\
          \ * relative_position\r\nRuntimeError: [enforce fail at alloc_cpu.cpp:83]\
          \ err == 0. DefaultCPUAllocator: can't allocate memory: you tried to allocate\
          \ 3221225472 bytes. Error code 12 (Cannot allocate memory)"
        updatedAt: '2023-12-02T20:02:28.586Z'
      numEdits: 0
      reactions: []
    id: 656b8d54f7be0986b468a805
    type: comment
  author: jssaluja
  content: "Keep running into exception when **loading model**\r\n\r\nRuntimeError:\
    \ [enforce fail at alloc_cpu.cpp:83] err == 0. DefaultCPUAllocator: can't allocate\
    \ memory: \r\n\r\nThis occurs randomly, with the same configuration of instances\
    \ on AWS Sagemaker\r\n\r\nIs this a known issue ?\r\nAny recommendations to fix\
    \ ?\r\n\r\n***Full stack trace***\r\n  model = AutoModel.from_pretrained(MODEL,\
    \ trust_remote_code=True)\r\n  File \"/usr/local/lib/python3.8/site-packages/transformers/models/auto/auto_factory.py\"\
    , line 561, in from_pretrained\r\n    return model_class.from_pretrained(\r\n\
    \  File \"/usr/local/lib/python3.8/site-packages/transformers/modeling_utils.py\"\
    , line 3236, in from_pretrained\r\n    model = cls(config, *model_args, **model_kwargs)\r\
    \n  File \"/root/.cache/huggingface/modules/transformers_modules/jinaai/jina-bert-implementation/c41d17d28431712f4b24b52bb83d426d7137a02f/modeling_bert.py\"\
    , line 1111, in __init__\r\n    self.encoder = JinaBertEncoder(config)\r\n  File\
    \ \"/root/.cache/huggingface/modules/transformers_modules/jinaai/jina-bert-implementation/c41d17d28431712f4b24b52bb83d426d7137a02f/modeling_bert.py\"\
    , line 702,in __init__\r\n    self.rebuild_alibi_tensor(size=config.max_position_embeddings),\r\
    \n  File \"/root/.cache/huggingface/modules/transformers_modules/jinaai/jina-bert-implementation/c41d17d28431712f4b24b52bb83d426d7137a02f/modeling_bert.py\"\
    , line 743,in rebuild_alibi_tensor\r\n    alibi = slopes.unsqueeze(1).unsqueeze(1)\
    \ * relative_position\r\nRuntimeError: [enforce fail at alloc_cpu.cpp:83] err\
    \ == 0. DefaultCPUAllocator: can't allocate memory: you tried to allocate 3221225472\
    \ bytes. Error code 12 (Cannot allocate memory)"
  created_at: 2023-12-02 20:02:28+00:00
  edited: false
  hidden: false
  id: 656b8d54f7be0986b468a805
  type: comment
- !!python/object:huggingface_hub.community.DiscussionTitleChange
  _event:
    author:
      avatarUrl: /avatars/d15ad205b158e14675448559e01d2d90.svg
      fullname: Jaspal Singh Saluja
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jssaluja
      type: user
    createdAt: '2023-12-02T20:02:55.000Z'
    data:
      from: Cannot allocate memory on AWS Sagemaker
      to: Cannot load model -Cannot allocate memory on AWS Sagemaker
    id: 656b8d6f8556299698b02dfc
    type: title-change
  author: jssaluja
  created_at: 2023-12-02 20:02:55+00:00
  id: 656b8d6f8556299698b02dfc
  new_title: Cannot load model -Cannot allocate memory on AWS Sagemaker
  old_title: Cannot allocate memory on AWS Sagemaker
  type: title-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/634e2b60a00c472888747e4c/FGqQ1qcfN0pXZ9GgdRrBB.png?w=200&h=200&f=face
      fullname: Jack Min Ong
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Jackmin108
      type: user
    createdAt: '2023-12-04T17:40:00.000Z'
    data:
      edited: false
      editors:
      - Jackmin108
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.943598747253418
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/634e2b60a00c472888747e4c/FGqQ1qcfN0pXZ9GgdRrBB.png?w=200&h=200&f=face
          fullname: Jack Min Ong
          isHf: false
          isPro: false
          name: Jackmin108
          type: user
        html: '<p>It seems like it is because you don''t have enough RAM to load the
          model. Can you try the suggestion <a rel="nofollow" href="https://github.com/huggingface/transformers/issues/23016#issuecomment-1525616195">here</a>?</p>

          '
        raw: It seems like it is because you don't have enough RAM to load the model.
          Can you try the suggestion [here](https://github.com/huggingface/transformers/issues/23016#issuecomment-1525616195)?
        updatedAt: '2023-12-04T17:40:00.605Z'
      numEdits: 0
      reactions: []
    id: 656e0ef00bbc114fe6615fc4
    type: comment
  author: Jackmin108
  content: It seems like it is because you don't have enough RAM to load the model.
    Can you try the suggestion [here](https://github.com/huggingface/transformers/issues/23016#issuecomment-1525616195)?
  created_at: 2023-12-04 17:40:00+00:00
  edited: false
  hidden: false
  id: 656e0ef00bbc114fe6615fc4
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/d15ad205b158e14675448559e01d2d90.svg
      fullname: Jaspal Singh Saluja
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jssaluja
      type: user
    createdAt: '2023-12-04T20:25:37.000Z'
    data:
      edited: false
      editors:
      - jssaluja
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9574490189552307
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/d15ad205b158e14675448559e01d2d90.svg
          fullname: Jaspal Singh Saluja
          isHf: false
          isPro: false
          name: jssaluja
          type: user
        html: '<p>Resolved, switched to a bigger machine with more RAM</p>

          '
        raw: Resolved, switched to a bigger machine with more RAM
        updatedAt: '2023-12-04T20:25:37.987Z'
      numEdits: 0
      reactions:
      - count: 2
        reaction: "\U0001F44D"
        users:
        - Jackmin108
        - bwang0911
      relatedEventId: 656e35c259afca5707aeec93
    id: 656e35c159afca5707aeec91
    type: comment
  author: jssaluja
  content: Resolved, switched to a bigger machine with more RAM
  created_at: 2023-12-04 20:25:37+00:00
  edited: false
  hidden: false
  id: 656e35c159afca5707aeec91
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/d15ad205b158e14675448559e01d2d90.svg
      fullname: Jaspal Singh Saluja
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jssaluja
      type: user
    createdAt: '2023-12-04T20:25:38.000Z'
    data:
      status: closed
    id: 656e35c259afca5707aeec93
    type: status-change
  author: jssaluja
  created_at: 2023-12-04 20:25:38+00:00
  id: 656e35c259afca5707aeec93
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 33
repo_id: jinaai/jina-embeddings-v2-base-en
repo_type: model
status: closed
target_branch: null
title: Cannot load model -Cannot allocate memory on AWS Sagemaker
