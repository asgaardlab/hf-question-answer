!!python/object:huggingface_hub.community.DiscussionWithDetails
author: TheBloke
conflicting_files: null
created_at: 2023-11-05 15:41:45+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
      fullname: Tom Jobbins
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: true
      name: TheBloke
      type: user
    createdAt: '2023-11-05T15:41:45.000Z'
    data:
      edited: false
      editors:
      - TheBloke
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8701633810997009
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
          fullname: Tom Jobbins
          isHf: false
          isPro: true
          name: TheBloke
          type: user
        html: '<p>Hi</p>

          <p>I''m having issues with my GGUF quantisations where the model won''t
          stop generating, and generates endless <code>&lt;|EOT|&gt;</code> tokens.</p>

          <p>I made the GGUF with special tokens set as per <code>tokenizer_config.json</code>,
          ie EOS is set to token ID 32014</p>

          <p>But in your README I realised you''re actually setting it to 32021 for
          the Instruct models?</p>

          <pre><code class="language-python"><span class="hljs-comment"># 32021 is
          the id of &lt;|EOT|&gt; token</span>

          outputs = model.generate(inputs, max_new_tokens=<span class="hljs-number">512</span>,
          do_sample=<span class="hljs-literal">False</span>, top_k=<span class="hljs-number">50</span>,
          top_p=<span class="hljs-number">0.95</span>, num_return_sequences=<span
          class="hljs-number">1</span>, eos_token_id=<span class="hljs-number">32021</span>)

          </code></pre>

          <p>So I just wanted to double check that for Instruct, EOS should be set
          to 32021 and that tokenizer_config.json is wrong in this regard?</p>

          <p>Is there a reason that tokenizer_config.json and config.json don''t have
          EOS set to 32021, but rather to 32014?  Would you consider changing that,
          or do other aspects of model generation depend on 32014?</p>

          <p>Thanks</p>

          <p>TB</p>

          '
        raw: "Hi\r\n\r\nI'm having issues with my GGUF quantisations where the model\
          \ won't stop generating, and generates endless `<|EOT|>` tokens.\r\n\r\n\
          I made the GGUF with special tokens set as per `tokenizer_config.json`,\
          \ ie EOS is set to token ID 32014\r\n\r\nBut in your README I realised you're\
          \ actually setting it to 32021 for the Instruct models?\r\n```python\r\n\
          # 32021 is the id of <|EOT|> token\r\noutputs = model.generate(inputs, max_new_tokens=512,\
          \ do_sample=False, top_k=50, top_p=0.95, num_return_sequences=1, eos_token_id=32021)\r\
          \n```\r\n\r\nSo I just wanted to double check that for Instruct, EOS should\
          \ be set to 32021 and that tokenizer_config.json is wrong in this regard?\r\
          \n\r\nIs there a reason that tokenizer_config.json and config.json don't\
          \ have EOS set to 32021, but rather to 32014?  Would you consider changing\
          \ that, or do other aspects of model generation depend on 32014?\r\n\r\n\
          Thanks\r\n\r\nTB"
        updatedAt: '2023-11-05T15:41:45.755Z'
      numEdits: 0
      reactions: []
    id: 6547b7b9cd0a5621394689dc
    type: comment
  author: TheBloke
  content: "Hi\r\n\r\nI'm having issues with my GGUF quantisations where the model\
    \ won't stop generating, and generates endless `<|EOT|>` tokens.\r\n\r\nI made\
    \ the GGUF with special tokens set as per `tokenizer_config.json`, ie EOS is set\
    \ to token ID 32014\r\n\r\nBut in your README I realised you're actually setting\
    \ it to 32021 for the Instruct models?\r\n```python\r\n# 32021 is the id of <|EOT|>\
    \ token\r\noutputs = model.generate(inputs, max_new_tokens=512, do_sample=False,\
    \ top_k=50, top_p=0.95, num_return_sequences=1, eos_token_id=32021)\r\n```\r\n\
    \r\nSo I just wanted to double check that for Instruct, EOS should be set to 32021\
    \ and that tokenizer_config.json is wrong in this regard?\r\n\r\nIs there a reason\
    \ that tokenizer_config.json and config.json don't have EOS set to 32021, but\
    \ rather to 32014?  Would you consider changing that, or do other aspects of model\
    \ generation depend on 32014?\r\n\r\nThanks\r\n\r\nTB"
  created_at: 2023-11-05 15:41:45+00:00
  edited: false
  hidden: false
  id: 6547b7b9cd0a5621394689dc
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/c3862c9cc8f1e645bb13f516c57e4e0e.svg
      fullname: DeepSeek
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: deepseek-admin
      type: user
    createdAt: '2023-11-05T16:08:15.000Z'
    data:
      edited: false
      editors:
      - deepseek-admin
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8361274600028992
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/c3862c9cc8f1e645bb13f516c57e4e0e.svg
          fullname: DeepSeek
          isHf: false
          isPro: false
          name: deepseek-admin
          type: user
        html: '<p>For instruct model, the eos_id is 32021, i.e. &lt;|EOT|&gt; token.
          For base model, the eos_id is 32014, i.e. . We will reset the eos_id for
          different models. Thanks for your pointing it.</p>

          '
        raw: For instruct model, the eos_id is 32021, i.e. <|EOT|> token. For base
          model, the eos_id is 32014, i.e. </s>. We will reset the eos_id for different
          models. Thanks for your pointing it.
        updatedAt: '2023-11-05T16:08:15.935Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - Igor7777
    id: 6547bdef407bb19ff59a9bc9
    type: comment
  author: deepseek-admin
  content: For instruct model, the eos_id is 32021, i.e. <|EOT|> token. For base model,
    the eos_id is 32014, i.e. </s>. We will reset the eos_id for different models.
    Thanks for your pointing it.
  created_at: 2023-11-05 16:08:15+00:00
  edited: false
  hidden: false
  id: 6547bdef407bb19ff59a9bc9
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
      fullname: Tom Jobbins
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: true
      name: TheBloke
      type: user
    createdAt: '2023-11-05T16:14:34.000Z'
    data:
      edited: false
      editors:
      - TheBloke
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9224759936332703
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
          fullname: Tom Jobbins
          isHf: false
          isPro: true
          name: TheBloke
          type: user
        html: '<p>Great, thank you for confirming that quickly.</p>

          <p>I will re-make all my Instruct GGUF files once you''ve been able to update
          the tokenizer config.</p>

          '
        raw: 'Great, thank you for confirming that quickly.


          I will re-make all my Instruct GGUF files once you''ve been able to update
          the tokenizer config.'
        updatedAt: '2023-11-05T16:14:34.651Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\u2764\uFE0F"
        users:
        - Igor7777
    id: 6547bf6a96c46859c20e610c
    type: comment
  author: TheBloke
  content: 'Great, thank you for confirming that quickly.


    I will re-make all my Instruct GGUF files once you''ve been able to update the
    tokenizer config.'
  created_at: 2023-11-05 16:14:34+00:00
  edited: false
  hidden: false
  id: 6547bf6a96c46859c20e610c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63cd76b4374057a338e8e703/i4Qk5-0aYx3oRhC8b50aJ.jpeg?w=200&h=200&f=face
      fullname: zhuqihao
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: zqh11
      type: user
    createdAt: '2023-11-05T16:19:32.000Z'
    data:
      edited: false
      editors:
      - zqh11
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.941913902759552
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63cd76b4374057a338e8e703/i4Qk5-0aYx3oRhC8b50aJ.jpeg?w=200&h=200&f=face
          fullname: zhuqihao
          isHf: false
          isPro: false
          name: zqh11
          type: user
        html: '<p>I have fixed the mistakes in the instruction models. Thanks!</p>

          '
        raw: I have fixed the mistakes in the instruction models. Thanks!
        updatedAt: '2023-11-05T16:19:32.080Z'
      numEdits: 0
      reactions: []
    id: 6547c094dbce6bd2be1aeb98
    type: comment
  author: zqh11
  content: I have fixed the mistakes in the instruction models. Thanks!
  created_at: 2023-11-05 16:19:32+00:00
  edited: false
  hidden: false
  id: 6547c094dbce6bd2be1aeb98
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
      fullname: Tom Jobbins
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: true
      name: TheBloke
      type: user
    createdAt: '2023-11-05T16:20:18.000Z'
    data:
      edited: false
      editors:
      - TheBloke
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9389606714248657
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
          fullname: Tom Jobbins
          isHf: false
          isPro: true
          name: TheBloke
          type: user
        html: '<p>Thanks very much - but could you do tokenizer_config.json also?  Or
          I can do a PR if you like</p>

          '
        raw: Thanks very much - but could you do tokenizer_config.json also?  Or I
          can do a PR if you like
        updatedAt: '2023-11-05T16:20:18.627Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - zqh11
      - count: 1
        reaction: "\u2764\uFE0F"
        users:
        - Igor7777
    id: 6547c0c2dbce6bd2be1af4cb
    type: comment
  author: TheBloke
  content: Thanks very much - but could you do tokenizer_config.json also?  Or I can
    do a PR if you like
  created_at: 2023-11-05 16:20:18+00:00
  edited: false
  hidden: false
  id: 6547c0c2dbce6bd2be1af4cb
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6398203609f12714ed1935c2/uXgl0LgKnFYjq1Wz39-a6.jpeg?w=200&h=200&f=face
      fullname: Chester111
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: Chester111
      type: user
    createdAt: '2023-11-09T07:51:34.000Z'
    data:
      status: closed
    id: 654c8f8618cd5f8dd981e8d1
    type: status-change
  author: Chester111
  created_at: 2023-11-09 07:51:34+00:00
  id: 654c8f8618cd5f8dd981e8d1
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: deepseek-ai/deepseek-coder-6.7b-instruct
repo_type: model
status: closed
target_branch: null
title: Confirming the EOS token? 32021 or 32014? Or both?
