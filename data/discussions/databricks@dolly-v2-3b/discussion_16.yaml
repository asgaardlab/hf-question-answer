!!python/object:huggingface_hub.community.DiscussionWithDetails
author: opyate
conflicting_files: null
created_at: 2023-05-10 18:43:39+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/GNFO3mU9Sn3OTAxVHWrsh.jpeg?w=200&h=200&f=face
      fullname: Juan Uys
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: opyate
      type: user
    createdAt: '2023-05-10T19:43:39.000Z'
    data:
      edited: false
      editors:
      - opyate
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/GNFO3mU9Sn3OTAxVHWrsh.jpeg?w=200&h=200&f=face
          fullname: Juan Uys
          isHf: false
          isPro: false
          name: opyate
          type: user
        html: '<p>Hey guys,</p>

          <p>After running training, it''s common to see accuracy metrics, e.g. F1-score.
          I''m not seeing anything in the deepspeed output: <a rel="nofollow" href="https://pastebin.com/GiVs6EGc">https://pastebin.com/GiVs6EGc</a></p>

          <p>I''ve checked the CLI, and it''s not an option I''m missing. Is there
          a way to get these values?</p>

          <p>Kind regards,</p>

          '
        raw: "Hey guys,\r\n\r\nAfter running training, it's common to see accuracy\
          \ metrics, e.g. F1-score. I'm not seeing anything in the deepspeed output:\
          \ https://pastebin.com/GiVs6EGc\r\n\r\nI've checked the CLI, and it's not\
          \ an option I'm missing. Is there a way to get these values?\r\n\r\nKind\
          \ regards,\r\n"
        updatedAt: '2023-05-10T19:43:39.280Z'
      numEdits: 0
      reactions: []
    id: 645bf3ebbc7518912e22f881
    type: comment
  author: opyate
  content: "Hey guys,\r\n\r\nAfter running training, it's common to see accuracy metrics,\
    \ e.g. F1-score. I'm not seeing anything in the deepspeed output: https://pastebin.com/GiVs6EGc\r\
    \n\r\nI've checked the CLI, and it's not an option I'm missing. Is there a way\
    \ to get these values?\r\n\r\nKind regards,\r\n"
  created_at: 2023-05-10 18:43:39+00:00
  edited: false
  hidden: false
  id: 645bf3ebbc7518912e22f881
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63050fbfce6b12280b1e2976/2lJphRSgdt9B_5YAQ1SIs.jpeg?w=200&h=200&f=face
      fullname: Sean Owen
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: srowen
      type: user
    createdAt: '2023-05-10T19:52:08.000Z'
    data:
      edited: false
      editors:
      - srowen
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63050fbfce6b12280b1e2976/2lJphRSgdt9B_5YAQ1SIs.jpeg?w=200&h=200&f=face
          fullname: Sean Owen
          isHf: false
          isPro: false
          name: srowen
          type: user
        html: '<p>Metrics are logged to tensorboard. You can see the notebook invokes
          the TB display in a Databricks notebook but you can run TB on that logs
          dir anywhere.</p>

          <p>HF will also log metrics to MLflow if you set some env variables (and
          same for weights and biases, etc) which also surfaces metrics, and would
          show in Databricks automatically</p>

          '
        raw: 'Metrics are logged to tensorboard. You can see the notebook invokes
          the TB display in a Databricks notebook but you can run TB on that logs
          dir anywhere.


          HF will also log metrics to MLflow if you set some env variables (and same
          for weights and biases, etc) which also surfaces metrics, and would show
          in Databricks automatically'
        updatedAt: '2023-05-10T19:52:08.270Z'
      numEdits: 0
      reactions: []
    id: 645bf5e8337b2ccf07fdbb27
    type: comment
  author: srowen
  content: 'Metrics are logged to tensorboard. You can see the notebook invokes the
    TB display in a Databricks notebook but you can run TB on that logs dir anywhere.


    HF will also log metrics to MLflow if you set some env variables (and same for
    weights and biases, etc) which also surfaces metrics, and would show in Databricks
    automatically'
  created_at: 2023-05-10 18:52:08+00:00
  edited: false
  hidden: false
  id: 645bf5e8337b2ccf07fdbb27
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/GNFO3mU9Sn3OTAxVHWrsh.jpeg?w=200&h=200&f=face
      fullname: Juan Uys
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: opyate
      type: user
    createdAt: '2023-05-11T08:13:08.000Z'
    data:
      edited: true
      editors:
      - opyate
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/GNFO3mU9Sn3OTAxVHWrsh.jpeg?w=200&h=200&f=face
          fullname: Juan Uys
          isHf: false
          isPro: false
          name: opyate
          type: user
        html: '<p>Thanks for that.</p>

          <p>It looks like I lose the "runs" folder when the instance terminates.</p>

          <p>The notebook also says:</p>

          <blockquote>

          <p>Your log directory might be ephemeral to the cluster, which will be deleted
          after cluster termination or restart. You can choose a log directory under
          <code>/dbfs/</code> to persist your logs in DBFS.</p>

          </blockquote>

          <p>I reset the <a rel="nofollow" href="https://github.com/databrickslabs/dolly/blob/master/train_dolly.py#L146">output
          dir</a> to:</p>

          <pre><code>tensorboard_display_dir = f"{dbfs_output_dir}/runs"

          </code></pre>

          <p>But it seems to be empty.</p>

          <p>EDIT: I fixed this by outputting to <code>local_disk0</code> first (like
          in the original code, and this works), and then moving the runs data to
          DBFS after, so I can interrogate it later:</p>

          <pre><code># persist the tensorboard data

          !mkdir -p /dbfs/dolly_training/tensorboards/$checkpoint_dir_name

          !cp -R /local_disk0/dolly_training/$checkpoint_dir_name/runs /dbfs/dolly_training/tensorboards/$checkpoint_dir_name

          </code></pre>

          '
        raw: 'Thanks for that.


          It looks like I lose the "runs" folder when the instance terminates.


          The notebook also says:

          > Your log directory might be ephemeral to the cluster, which will be deleted
          after cluster termination or restart. You can choose a log directory under
          `/dbfs/` to persist your logs in DBFS.


          I reset the [output dir](https://github.com/databrickslabs/dolly/blob/master/train_dolly.py#L146)
          to:


          ```

          tensorboard_display_dir = f"{dbfs_output_dir}/runs"

          ```


          But it seems to be empty.


          EDIT: I fixed this by outputting to `local_disk0` first (like in the original
          code, and this works), and then moving the runs data to DBFS after, so I
          can interrogate it later:


          ```

          # persist the tensorboard data

          !mkdir -p /dbfs/dolly_training/tensorboards/$checkpoint_dir_name

          !cp -R /local_disk0/dolly_training/$checkpoint_dir_name/runs /dbfs/dolly_training/tensorboards/$checkpoint_dir_name

          ```'
        updatedAt: '2023-05-11T12:43:16.927Z'
      numEdits: 2
      reactions: []
    id: 645ca394f36ed281fab88dec
    type: comment
  author: opyate
  content: 'Thanks for that.


    It looks like I lose the "runs" folder when the instance terminates.


    The notebook also says:

    > Your log directory might be ephemeral to the cluster, which will be deleted
    after cluster termination or restart. You can choose a log directory under `/dbfs/`
    to persist your logs in DBFS.


    I reset the [output dir](https://github.com/databrickslabs/dolly/blob/master/train_dolly.py#L146)
    to:


    ```

    tensorboard_display_dir = f"{dbfs_output_dir}/runs"

    ```


    But it seems to be empty.


    EDIT: I fixed this by outputting to `local_disk0` first (like in the original
    code, and this works), and then moving the runs data to DBFS after, so I can interrogate
    it later:


    ```

    # persist the tensorboard data

    !mkdir -p /dbfs/dolly_training/tensorboards/$checkpoint_dir_name

    !cp -R /local_disk0/dolly_training/$checkpoint_dir_name/runs /dbfs/dolly_training/tensorboards/$checkpoint_dir_name

    ```'
  created_at: 2023-05-11 07:13:08+00:00
  edited: true
  hidden: false
  id: 645ca394f36ed281fab88dec
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/GNFO3mU9Sn3OTAxVHWrsh.jpeg?w=200&h=200&f=face
      fullname: Juan Uys
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: opyate
      type: user
    createdAt: '2023-05-11T10:25:14.000Z'
    data:
      edited: false
      editors:
      - opyate
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/GNFO3mU9Sn3OTAxVHWrsh.jpeg?w=200&h=200&f=face
          fullname: Juan Uys
          isHf: false
          isPro: false
          name: opyate
          type: user
        html: '<p>Here are some screenshots of tensorboard for my 3b run. Not sure
          where to find accuracy scores (like F1, etc).</p>

          <p><a rel="nofollow" href="https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/1qXCp-qzTw9Y-Ac9NqXjM.png"><img
          alt="Screenshot from 2023-05-11 11-23-10.png" src="https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/1qXCp-qzTw9Y-Ac9NqXjM.png"></a></p>

          <p><a rel="nofollow" href="https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/3msAcEMd1VyuIeCsKopRF.png"><img
          alt="Screenshot from 2023-05-11 11-23-47.png" src="https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/3msAcEMd1VyuIeCsKopRF.png"></a></p>

          '
        raw: 'Here are some screenshots of tensorboard for my 3b run. Not sure where
          to find accuracy scores (like F1, etc).



          ![Screenshot from 2023-05-11 11-23-10.png](https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/1qXCp-qzTw9Y-Ac9NqXjM.png)



          ![Screenshot from 2023-05-11 11-23-47.png](https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/3msAcEMd1VyuIeCsKopRF.png)'
        updatedAt: '2023-05-11T10:25:14.258Z'
      numEdits: 0
      reactions: []
    id: 645cc28af36ed281fab9eb13
    type: comment
  author: opyate
  content: 'Here are some screenshots of tensorboard for my 3b run. Not sure where
    to find accuracy scores (like F1, etc).



    ![Screenshot from 2023-05-11 11-23-10.png](https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/1qXCp-qzTw9Y-Ac9NqXjM.png)



    ![Screenshot from 2023-05-11 11-23-47.png](https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/3msAcEMd1VyuIeCsKopRF.png)'
  created_at: 2023-05-11 09:25:14+00:00
  edited: false
  hidden: false
  id: 645cc28af36ed281fab9eb13
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63050fbfce6b12280b1e2976/2lJphRSgdt9B_5YAQ1SIs.jpeg?w=200&h=200&f=face
      fullname: Sean Owen
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: srowen
      type: user
    createdAt: '2023-05-11T11:33:48.000Z'
    data:
      edited: false
      editors:
      - srowen
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63050fbfce6b12280b1e2976/2lJphRSgdt9B_5YAQ1SIs.jpeg?w=200&h=200&f=face
          fullname: Sean Owen
          isHf: false
          isPro: false
          name: srowen
          type: user
        html: '<p>Yes, you can write to a permanent storage location like /dbfs/...
          ; MLflow will also persist metrics, including tensorboard logs, for you<br>I
          don''t think F1 makes sense for a causal language model. What would it mean
          or measure?</p>

          '
        raw: 'Yes, you can write to a permanent storage location like /dbfs/... ;
          MLflow will also persist metrics, including tensorboard logs, for you

          I don''t think F1 makes sense for a causal language model. What would it
          mean or measure?'
        updatedAt: '2023-05-11T11:33:48.869Z'
      numEdits: 0
      reactions: []
    id: 645cd29c4e2cf46891786bcb
    type: comment
  author: srowen
  content: 'Yes, you can write to a permanent storage location like /dbfs/... ; MLflow
    will also persist metrics, including tensorboard logs, for you

    I don''t think F1 makes sense for a causal language model. What would it mean
    or measure?'
  created_at: 2023-05-11 10:33:48+00:00
  edited: false
  hidden: false
  id: 645cd29c4e2cf46891786bcb
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/GNFO3mU9Sn3OTAxVHWrsh.jpeg?w=200&h=200&f=face
      fullname: Juan Uys
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: opyate
      type: user
    createdAt: '2023-05-11T12:20:43.000Z'
    data:
      edited: false
      editors:
      - opyate
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/GNFO3mU9Sn3OTAxVHWrsh.jpeg?w=200&h=200&f=face
          fullname: Juan Uys
          isHf: false
          isPro: false
          name: opyate
          type: user
        html: '<p>Not necessarily F1, but an equivalent score that gauges accuracy
          during validation?</p>

          '
        raw: Not necessarily F1, but an equivalent score that gauges accuracy during
          validation?
        updatedAt: '2023-05-11T12:20:43.324Z'
      numEdits: 0
      reactions: []
    id: 645cdd9b8ce4443cae6eeaf9
    type: comment
  author: opyate
  content: Not necessarily F1, but an equivalent score that gauges accuracy during
    validation?
  created_at: 2023-05-11 11:20:43+00:00
  edited: false
  hidden: false
  id: 645cdd9b8ce4443cae6eeaf9
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63050fbfce6b12280b1e2976/2lJphRSgdt9B_5YAQ1SIs.jpeg?w=200&h=200&f=face
      fullname: Sean Owen
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: srowen
      type: user
    createdAt: '2023-05-11T12:29:12.000Z'
    data:
      edited: false
      editors:
      - srowen
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63050fbfce6b12280b1e2976/2lJphRSgdt9B_5YAQ1SIs.jpeg?w=200&h=200&f=face
          fullname: Sean Owen
          isHf: false
          isPro: false
          name: srowen
          type: user
        html: '<p>That is more or less what (cross-entropy) loss is measuring. The
          task is predicting the next word over and over, and while accuracy is coherent,
          I''m not sure it''s as useful in assessing how confidently correct those
          words are.</p>

          '
        raw: That is more or less what (cross-entropy) loss is measuring. The task
          is predicting the next word over and over, and while accuracy is coherent,
          I'm not sure it's as useful in assessing how confidently correct those words
          are.
        updatedAt: '2023-05-11T12:29:12.691Z'
      numEdits: 0
      reactions: []
    id: 645cdf98f36ed281fabb07c5
    type: comment
  author: srowen
  content: That is more or less what (cross-entropy) loss is measuring. The task is
    predicting the next word over and over, and while accuracy is coherent, I'm not
    sure it's as useful in assessing how confidently correct those words are.
  created_at: 2023-05-11 11:29:12+00:00
  edited: false
  hidden: false
  id: 645cdf98f36ed281fabb07c5
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/GNFO3mU9Sn3OTAxVHWrsh.jpeg?w=200&h=200&f=face
      fullname: Juan Uys
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: opyate
      type: user
    createdAt: '2023-05-11T12:41:19.000Z'
    data:
      edited: false
      editors:
      - opyate
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/GNFO3mU9Sn3OTAxVHWrsh.jpeg?w=200&h=200&f=face
          fullname: Juan Uys
          isHf: false
          isPro: false
          name: opyate
          type: user
        html: '<p>Thanks for the answers, Sean!</p>

          '
        raw: Thanks for the answers, Sean!
        updatedAt: '2023-05-11T12:41:19.325Z'
      numEdits: 0
      reactions: []
      relatedEventId: 645ce26fafa77201e2f9b8e4
    id: 645ce26fafa77201e2f9b8e3
    type: comment
  author: opyate
  content: Thanks for the answers, Sean!
  created_at: 2023-05-11 11:41:19+00:00
  edited: false
  hidden: false
  id: 645ce26fafa77201e2f9b8e3
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/630f1f7502ce39336c3faf40/GNFO3mU9Sn3OTAxVHWrsh.jpeg?w=200&h=200&f=face
      fullname: Juan Uys
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: opyate
      type: user
    createdAt: '2023-05-11T12:41:19.000Z'
    data:
      status: closed
    id: 645ce26fafa77201e2f9b8e4
    type: status-change
  author: opyate
  created_at: 2023-05-11 11:41:19+00:00
  id: 645ce26fafa77201e2f9b8e4
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 16
repo_id: databricks/dolly-v2-3b
repo_type: model
status: closed
target_branch: null
title: How to get training accuracy metric?
