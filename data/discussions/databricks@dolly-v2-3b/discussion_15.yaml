!!python/object:huggingface_hub.community.DiscussionWithDetails
author: jnufung
conflicting_files: null
created_at: 2023-05-06 09:13:10+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/54d491145af2a905c5c158fcaf0cb127.svg
      fullname: frank feng
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jnufung
      type: user
    createdAt: '2023-05-06T10:13:10.000Z'
    data:
      edited: true
      editors:
      - jnufung
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/54d491145af2a905c5c158fcaf0cb127.svg
          fullname: frank feng
          isHf: false
          isPro: false
          name: jnufung
          type: user
        html: '<p>Hi Team,<br>I''ve been playing with dolly v2 3b model with SQL langchain
          on colab with GPU. I''ve download the model to local path"/home/dollyV2"
          without fine tuning. The database is connecting local db which is mysql
          successfully. I can see the table info by db.table_info.</p>

          <p>While running the chain I''ve encountered the error.<br>According to
          the log, I found that the chain put the result into SQLQuery which is not
          a standard SQL statement.</p>

          <p>Do you know what might be the cause of this issue?<br>Appreciate your
          help! :-)</p>

          <p>Code:<br>%%bash<br>pip install langchain==0.0.160 pymysql==1.0.3 transformers==4.28.1
          accelerate==0.18.0</p>

          <hr>

          <p>import torch<br>import time<br>from transformers import pipeline<br>from
          langchain.llms import HuggingFacePipeline<br>from langchain.chains import
          SQLDatabaseSequentialChain</p>

          <p>instruct_pipeline = pipeline(model="/home/dollyV2", torch_dtype=torch.bfloat16,
          trust_remote_code=True, device_map="auto", return_full_text=True, do_sample=False,
          max_new_tokens=128)<br>hf_pipe = HuggingFacePipeline(pipeline=instruct_pipeline)<br>chain
          = SQLDatabaseSequentialChain.from_llm(llm=hf_pipe, database=db, verbose=True)<br>chain.run("How
          many students in the class?")</p>

          <p>Error log:</p>

          <blockquote>

          <p>Entering new SQLDatabaseChain chain...<br>How many students in the class?<br>SQLQuery:<br>There
          are 2 students in the class.</p>

          </blockquote>

          <p>...</p>

          <p>ProgrammingError: (1064, "You have an error in your SQL syntax; check
          the manual that corresponds to your MySQL<br>server version for the right
          syntax to use near ''There are 2 students in the class.'' at line 1")</p>

          '
        raw: "Hi Team, \nI've been playing with dolly v2 3b model with SQL langchain\
          \ on colab with GPU. I've download the model to local path\"/home/dollyV2\"\
          \ without fine tuning. The database is connecting local db which is mysql\
          \ successfully. I can see the table info by db.table_info.\n\nWhile running\
          \ the chain I've encountered the error.\nAccording to the log, I found that\
          \ the chain put the result into SQLQuery which is not a standard SQL statement.\n\
          \nDo you know what might be the cause of this issue?\nAppreciate your help!\
          \ :-)\n\n\nCode:\n%%bash\npip install langchain==0.0.160 pymysql==1.0.3\
          \ transformers==4.28.1 accelerate==0.18.0\n------------------------------------------------\n\
          import torch\nimport time\nfrom transformers import pipeline\nfrom langchain.llms\
          \ import HuggingFacePipeline\nfrom langchain.chains import SQLDatabaseSequentialChain\n\
          \ninstruct_pipeline = pipeline(model=\"/home/dollyV2\", torch_dtype=torch.bfloat16,\
          \ trust_remote_code=True, device_map=\"auto\", return_full_text=True, do_sample=False,\
          \ max_new_tokens=128)\nhf_pipe = HuggingFacePipeline(pipeline=instruct_pipeline)\n\
          chain = SQLDatabaseSequentialChain.from_llm(llm=hf_pipe, database=db, verbose=True)\n\
          chain.run(\"How many students in the class?\")\n\n\n\n\nError log:\n> Entering\
          \ new SQLDatabaseChain chain...\nHow many students in the class?\nSQLQuery:\n\
          There are 2 students in the class.\n\n...\n\nProgrammingError: (1064, \"\
          You have an error in your SQL syntax; check the manual that corresponds\
          \ to your MySQL \nserver version for the right syntax to use near 'There\
          \ are 2 students in the class.' at line 1\")"
        updatedAt: '2023-05-06T10:19:28.476Z'
      numEdits: 1
      reactions: []
    id: 64562836c8f569b995d72339
    type: comment
  author: jnufung
  content: "Hi Team, \nI've been playing with dolly v2 3b model with SQL langchain\
    \ on colab with GPU. I've download the model to local path\"/home/dollyV2\" without\
    \ fine tuning. The database is connecting local db which is mysql successfully.\
    \ I can see the table info by db.table_info.\n\nWhile running the chain I've encountered\
    \ the error.\nAccording to the log, I found that the chain put the result into\
    \ SQLQuery which is not a standard SQL statement.\n\nDo you know what might be\
    \ the cause of this issue?\nAppreciate your help! :-)\n\n\nCode:\n%%bash\npip\
    \ install langchain==0.0.160 pymysql==1.0.3 transformers==4.28.1 accelerate==0.18.0\n\
    ------------------------------------------------\nimport torch\nimport time\n\
    from transformers import pipeline\nfrom langchain.llms import HuggingFacePipeline\n\
    from langchain.chains import SQLDatabaseSequentialChain\n\ninstruct_pipeline =\
    \ pipeline(model=\"/home/dollyV2\", torch_dtype=torch.bfloat16, trust_remote_code=True,\
    \ device_map=\"auto\", return_full_text=True, do_sample=False, max_new_tokens=128)\n\
    hf_pipe = HuggingFacePipeline(pipeline=instruct_pipeline)\nchain = SQLDatabaseSequentialChain.from_llm(llm=hf_pipe,\
    \ database=db, verbose=True)\nchain.run(\"How many students in the class?\")\n\
    \n\n\n\nError log:\n> Entering new SQLDatabaseChain chain...\nHow many students\
    \ in the class?\nSQLQuery:\nThere are 2 students in the class.\n\n...\n\nProgrammingError:\
    \ (1064, \"You have an error in your SQL syntax; check the manual that corresponds\
    \ to your MySQL \nserver version for the right syntax to use near 'There are 2\
    \ students in the class.' at line 1\")"
  created_at: 2023-05-06 09:13:10+00:00
  edited: true
  hidden: false
  id: 64562836c8f569b995d72339
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63050fbfce6b12280b1e2976/2lJphRSgdt9B_5YAQ1SIs.jpeg?w=200&h=200&f=face
      fullname: Sean Owen
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: srowen
      type: user
    createdAt: '2023-05-06T11:01:32.000Z'
    data:
      edited: false
      editors:
      - srowen
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63050fbfce6b12280b1e2976/2lJphRSgdt9B_5YAQ1SIs.jpeg?w=200&h=200&f=face
          fullname: Sean Owen
          isHf: false
          isPro: false
          name: srowen
          type: user
        html: '<p>You can see it there: the model isn''t generating anything like
          a SQL query here: "There are 2 students in the class"<br>THis model is not
          suitable for SQL generation, it was never trained on SQL. Use OpenAI, which
          can do that reasonably, although I find the SQL query is often wrong.</p>

          '
        raw: 'You can see it there: the model isn''t generating anything like a SQL
          query here: "There are 2 students in the class"

          THis model is not suitable for SQL generation, it was never trained on SQL.
          Use OpenAI, which can do that reasonably, although I find the SQL query
          is often wrong.'
        updatedAt: '2023-05-06T11:01:32.677Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F917"
        users:
        - jnufung
    id: 6456338c78c059b099af2833
    type: comment
  author: srowen
  content: 'You can see it there: the model isn''t generating anything like a SQL
    query here: "There are 2 students in the class"

    THis model is not suitable for SQL generation, it was never trained on SQL. Use
    OpenAI, which can do that reasonably, although I find the SQL query is often wrong.'
  created_at: 2023-05-06 10:01:32+00:00
  edited: false
  hidden: false
  id: 6456338c78c059b099af2833
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/54d491145af2a905c5c158fcaf0cb127.svg
      fullname: frank feng
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jnufung
      type: user
    createdAt: '2023-05-06T11:41:08.000Z'
    data:
      edited: false
      editors:
      - jnufung
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/54d491145af2a905c5c158fcaf0cb127.svg
          fullname: frank feng
          isHf: false
          isPro: false
          name: jnufung
          type: user
        html: '<p>Got it. Dolly is still a powerful model. Thank you! :-)</p>

          '
        raw: Got it. Dolly is still a powerful model. Thank you! :-)
        updatedAt: '2023-05-06T11:41:08.192Z'
      numEdits: 0
      reactions: []
      relatedEventId: 64563cd403625871eb728714
    id: 64563cd403625871eb728713
    type: comment
  author: jnufung
  content: Got it. Dolly is still a powerful model. Thank you! :-)
  created_at: 2023-05-06 10:41:08+00:00
  edited: false
  hidden: false
  id: 64563cd403625871eb728713
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/54d491145af2a905c5c158fcaf0cb127.svg
      fullname: frank feng
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jnufung
      type: user
    createdAt: '2023-05-06T11:41:08.000Z'
    data:
      status: closed
    id: 64563cd403625871eb728714
    type: status-change
  author: jnufung
  created_at: 2023-05-06 10:41:08+00:00
  id: 64563cd403625871eb728714
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 15
repo_id: databricks/dolly-v2-3b
repo_type: model
status: closed
target_branch: null
title: Dolly + LangChain SQL Chain - Pass the result to SQLQuery
