!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Birchlabs
conflicting_files: []
created_at: 2023-08-14 17:59:59+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63052ec6c7fed54edfa9d29d/IF0z25F93ZqCPMkMLiJLi.png?w=200&h=200&f=face
      fullname: Alex Birch
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Birchlabs
      type: user
    createdAt: '2023-08-14T18:59:59.000Z'
    data:
      edited: false
      editors:
      - Birchlabs
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.4827440679073334
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63052ec6c7fed54edfa9d29d/IF0z25F93ZqCPMkMLiJLi.png?w=200&h=200&f=face
          fullname: Alex Birch
          isHf: false
          isPro: false
          name: Birchlabs
          type: user
        html: "<p>Prevents RuntimeError on line 382's pad_input(\u2026).reshape()<br>shape\
          \ '[1, 4096, 4096]' is invalid for input of size 9400320</p>\n<p>before\
          \ this change, pad_input() was basically just doing a .unsqueeze(0):<br>attn_output.shape<br>torch.Size([2295,\
          \ 32, 128])<br>pad_input(attn_output, indices_q, bsz, max_seqlen_q).shape<br>torch.Size([1,\
          \ 2295, 32, 128])</p>\n<p>after this change: pad_input actually pads the\
          \ input back to the original query sequence length:<br>pad_input(attn_output,\
          \ indices_q, bsz, q_len).shape<br>torch.Size([1, 4096, 32, 128])<br>and\
          \ the reshape succeeds:<br>pad_input(attn_output, indices_q, bsz, q_len).reshape(bsz,\
          \ q_len, h_size).shape<br>torch.Size([1, 4096, 4096])</p>\n"
        raw: "Prevents RuntimeError on line 382's pad_input(\u2026).reshape()\nshape\
          \ '[1, 4096, 4096]' is invalid for input of size 9400320\n\nbefore this\
          \ change, pad_input() was basically just doing a .unsqueeze(0):\nattn_output.shape\n\
          torch.Size([2295, 32, 128])\npad_input(attn_output, indices_q, bsz, max_seqlen_q).shape\n\
          torch.Size([1, 2295, 32, 128])\n\nafter this change: pad_input actually\
          \ pads the input back to the original query sequence length:\npad_input(attn_output,\
          \ indices_q, bsz, q_len).shape\ntorch.Size([1, 4096, 32, 128])\nand the\
          \ reshape succeeds:\npad_input(attn_output, indices_q, bsz, q_len).reshape(bsz,\
          \ q_len, h_size).shape\ntorch.Size([1, 4096, 4096])"
        updatedAt: '2023-08-14T18:59:59.003Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - ajash
    id: 64da79afff83b3386a244417
    type: comment
  author: Birchlabs
  content: "Prevents RuntimeError on line 382's pad_input(\u2026).reshape()\nshape\
    \ '[1, 4096, 4096]' is invalid for input of size 9400320\n\nbefore this change,\
    \ pad_input() was basically just doing a .unsqueeze(0):\nattn_output.shape\ntorch.Size([2295,\
    \ 32, 128])\npad_input(attn_output, indices_q, bsz, max_seqlen_q).shape\ntorch.Size([1,\
    \ 2295, 32, 128])\n\nafter this change: pad_input actually pads the input back\
    \ to the original query sequence length:\npad_input(attn_output, indices_q, bsz,\
    \ q_len).shape\ntorch.Size([1, 4096, 32, 128])\nand the reshape succeeds:\npad_input(attn_output,\
    \ indices_q, bsz, q_len).reshape(bsz, q_len, h_size).shape\ntorch.Size([1, 4096,\
    \ 4096])"
  created_at: 2023-08-14 17:59:59+00:00
  edited: false
  hidden: false
  id: 64da79afff83b3386a244417
  type: comment
- !!python/object:huggingface_hub.community.DiscussionCommit
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63052ec6c7fed54edfa9d29d/IF0z25F93ZqCPMkMLiJLi.png?w=200&h=200&f=face
      fullname: Alex Birch
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Birchlabs
      type: user
    createdAt: '2023-08-14T18:59:59.000Z'
    data:
      oid: e6c58dac682e6c33b0e8fa0923ac5c79b76047c6
      parents:
      - aef6d8946ae1015bdb65c478a2dd73b58daaef47
      subject: 'Fix RuntimeError: pad attn scores back to original query sequence
        length, instead of unpadded sequence length (i.e. no change).'
    id: 64da79af0000000000000000
    type: commit
  author: Birchlabs
  created_at: 2023-08-14 17:59:59+00:00
  id: 64da79af0000000000000000
  oid: e6c58dac682e6c33b0e8fa0923ac5c79b76047c6
  summary: 'Fix RuntimeError: pad attn scores back to original query sequence length,
    instead of unpadded sequence length (i.e. no change).'
  type: commit
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/70fd92770ae9008fcb03a15739ed44f4.svg
      fullname: Ambarish Jash
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ajash
      type: user
    createdAt: '2023-08-29T04:47:46.000Z'
    data:
      edited: false
      editors:
      - ajash
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9728260040283203
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/70fd92770ae9008fcb03a15739ed44f4.svg
          fullname: Ambarish Jash
          isHf: false
          isPro: false
          name: ajash
          type: user
        html: '<p>I was getting a similar error. Thanks for the change... when will
          this get merged?</p>

          '
        raw: I was getting a similar error. Thanks for the change... when will this
          get merged?
        updatedAt: '2023-08-29T04:47:46.176Z'
      numEdits: 0
      reactions: []
    id: 64ed78724aa51daa2e110906
    type: comment
  author: ajash
  content: I was getting a similar error. Thanks for the change... when will this
    get merged?
  created_at: 2023-08-29 03:47:46+00:00
  edited: false
  hidden: false
  id: 64ed78724aa51daa2e110906
  type: comment
is_pull_request: true
merge_commit_oid: null
num: 17
repo_id: togethercomputer/LLaMA-2-7B-32K
repo_type: model
status: open
target_branch: refs/heads/main
title: 'Fix RuntimeError: pad attn scores back to original query sequence length,
  instead of unpadded sequence length (i.e. no change).'
