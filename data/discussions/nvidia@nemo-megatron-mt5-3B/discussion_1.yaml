!!python/object:huggingface_hub.community.DiscussionWithDetails
author: songkq
conflicting_files: null
created_at: 2023-04-16 07:10:13+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/aed544c3cc76a739c8556cfca242a40d.svg
      fullname: songkq
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: songkq
      type: user
    createdAt: '2023-04-16T08:10:13.000Z'
    data:
      edited: false
      editors:
      - songkq
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/aed544c3cc76a739c8556cfca242a40d.svg
          fullname: songkq
          isHf: false
          isPro: false
          name: songkq
          type: user
        html: '<p>Hi, could you please give some advice for this issue?</p>

          <p>I have converted the nemo-megatron-mt5-3B to a binary file successfully
          by<br>python3 FasterTransformer/examples/pytorch/t5/utils/nemo_t5_ckpt_convert.py
          -i nemo-megatron-mt5-3B/nemo_megatron_mt5_3b_bf16_tp2.nemo -o ./models/nemo-megatron-mt5-3B/
          -m mt5-3B -i_g 2</p>

          <p>When run a tritonserver with CUDA_VISIBLE_DEVICES="0,1" /opt/tritonserver/bin/tritonserver
          --model-store=fastertransformer_backend/all_models/nemo-megatron-mt5-3B/,
          tritonserver failed to loading the model with unmatched shape.</p>

          <p>''''''<br>I0414 15:43:13.619001 934 libfastertransformer.cc:438] Before
          Loading Weights:<br>after allocation    : free: 14.14 GB, total: 44.56 GB,
          used: 30.43 GB<br>[FT][WARNING] file ./models/nemo-megatron-mt5-3B/2-gpu//decoder.final_layer_norm.bias.bin
          only has 4096, but request 8192, loading model fails!</p>

          <p>[FT][WARNING] file ./models/nemo-megatron-mt5-3B/2-gpu//shared.bias.bin
          only has 500224, but request 1000448, loading model fails!</p>

          <p>[FT][WARNING] file ./models/nemo-megatron-mt5-3B/2-gpu//decoder.final_layer_norm.bias.bin
          only has 4096, but request 8192, loading model fails!</p>

          <p>[FT][WARNING] file ./models/nemo-megatron-mt5-3B/2-gpu//shared.bias.bin
          only has 500224, but request 1000448, loading model fails!</p>

          <p>I0414 15:43:21.362566 934 libfastertransformer.cc:448] After Loading
          Weights:<br>''''''</p>

          '
        raw: "Hi, could you please give some advice for this issue?\r\n\r\nI have\
          \ converted the nemo-megatron-mt5-3B to a binary file successfully by\r\n\
          python3 FasterTransformer/examples/pytorch/t5/utils/nemo_t5_ckpt_convert.py\
          \ -i nemo-megatron-mt5-3B/nemo_megatron_mt5_3b_bf16_tp2.nemo -o ./models/nemo-megatron-mt5-3B/\
          \ -m mt5-3B -i_g 2\r\n\r\nWhen run a tritonserver with CUDA_VISIBLE_DEVICES=\"\
          0,1\" /opt/tritonserver/bin/tritonserver --model-store=fastertransformer_backend/all_models/nemo-megatron-mt5-3B/,\
          \ tritonserver failed to loading the model with unmatched shape.\r\n\r\n\
          '''\r\nI0414 15:43:13.619001 934 libfastertransformer.cc:438] Before Loading\
          \ Weights:\r\nafter allocation    : free: 14.14 GB, total: 44.56 GB, used:\
          \ 30.43 GB\r\n[FT][WARNING] file ./models/nemo-megatron-mt5-3B/2-gpu//decoder.final_layer_norm.bias.bin\
          \ only has 4096, but request 8192, loading model fails!\r\n \r\n[FT][WARNING]\
          \ file ./models/nemo-megatron-mt5-3B/2-gpu//shared.bias.bin only has 500224,\
          \ but request 1000448, loading model fails!\r\n \r\n[FT][WARNING] file ./models/nemo-megatron-mt5-3B/2-gpu//decoder.final_layer_norm.bias.bin\
          \ only has 4096, but request 8192, loading model fails!\r\n \r\n[FT][WARNING]\
          \ file ./models/nemo-megatron-mt5-3B/2-gpu//shared.bias.bin only has 500224,\
          \ but request 1000448, loading model fails!\r\n \r\nI0414 15:43:21.362566\
          \ 934 libfastertransformer.cc:448] After Loading Weights:\r\n'''"
        updatedAt: '2023-04-16T08:10:13.595Z'
      numEdits: 0
      reactions: []
    id: 643bad656eeb746f5ad04af0
    type: comment
  author: songkq
  content: "Hi, could you please give some advice for this issue?\r\n\r\nI have converted\
    \ the nemo-megatron-mt5-3B to a binary file successfully by\r\npython3 FasterTransformer/examples/pytorch/t5/utils/nemo_t5_ckpt_convert.py\
    \ -i nemo-megatron-mt5-3B/nemo_megatron_mt5_3b_bf16_tp2.nemo -o ./models/nemo-megatron-mt5-3B/\
    \ -m mt5-3B -i_g 2\r\n\r\nWhen run a tritonserver with CUDA_VISIBLE_DEVICES=\"\
    0,1\" /opt/tritonserver/bin/tritonserver --model-store=fastertransformer_backend/all_models/nemo-megatron-mt5-3B/,\
    \ tritonserver failed to loading the model with unmatched shape.\r\n\r\n'''\r\n\
    I0414 15:43:13.619001 934 libfastertransformer.cc:438] Before Loading Weights:\r\
    \nafter allocation    : free: 14.14 GB, total: 44.56 GB, used: 30.43 GB\r\n[FT][WARNING]\
    \ file ./models/nemo-megatron-mt5-3B/2-gpu//decoder.final_layer_norm.bias.bin\
    \ only has 4096, but request 8192, loading model fails!\r\n \r\n[FT][WARNING]\
    \ file ./models/nemo-megatron-mt5-3B/2-gpu//shared.bias.bin only has 500224, but\
    \ request 1000448, loading model fails!\r\n \r\n[FT][WARNING] file ./models/nemo-megatron-mt5-3B/2-gpu//decoder.final_layer_norm.bias.bin\
    \ only has 4096, but request 8192, loading model fails!\r\n \r\n[FT][WARNING]\
    \ file ./models/nemo-megatron-mt5-3B/2-gpu//shared.bias.bin only has 500224, but\
    \ request 1000448, loading model fails!\r\n \r\nI0414 15:43:21.362566 934 libfastertransformer.cc:448]\
    \ After Loading Weights:\r\n'''"
  created_at: 2023-04-16 07:10:13+00:00
  edited: false
  hidden: false
  id: 643bad656eeb746f5ad04af0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/aed544c3cc76a739c8556cfca242a40d.svg
      fullname: songkq
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: songkq
      type: user
    createdAt: '2023-04-17T11:39:31.000Z'
    data:
      edited: false
      editors:
      - songkq
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/aed544c3cc76a739c8556cfca242a40d.svg
          fullname: songkq
          isHf: false
          isPro: false
          name: songkq
          type: user
        html: '<p>Solved the problem by <a rel="nofollow" href="https://github.com/NVIDIA/FasterTransformer/issues/561">https://github.com/NVIDIA/FasterTransformer/issues/561</a>.</p>

          '
        raw: Solved the problem by https://github.com/NVIDIA/FasterTransformer/issues/561.
        updatedAt: '2023-04-17T11:39:31.136Z'
      numEdits: 0
      reactions: []
      relatedEventId: 643d2ff3af3fe078a3991ad5
    id: 643d2ff3af3fe078a3991ad4
    type: comment
  author: songkq
  content: Solved the problem by https://github.com/NVIDIA/FasterTransformer/issues/561.
  created_at: 2023-04-17 10:39:31+00:00
  edited: false
  hidden: false
  id: 643d2ff3af3fe078a3991ad4
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/aed544c3cc76a739c8556cfca242a40d.svg
      fullname: songkq
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: songkq
      type: user
    createdAt: '2023-04-17T11:39:31.000Z'
    data:
      status: closed
    id: 643d2ff3af3fe078a3991ad5
    type: status-change
  author: songkq
  created_at: 2023-04-17 10:39:31+00:00
  id: 643d2ff3af3fe078a3991ad5
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: nvidia/nemo-megatron-mt5-3B
repo_type: model
status: closed
target_branch: null
title: convert nemo-megatron-mt5-3B to a binary file for triton-with-fastertransformer
  successfully, but tritonserver fails with undesired tensor shape
