!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Geremia23
conflicting_files: null
created_at: 2023-08-27 21:16:49+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/0h_AaU5YtIz51hxSEfVUN.jpeg?w=200&h=200&f=face
      fullname: Alan Aversa
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Geremia23
      type: user
    createdAt: '2023-08-27T22:16:49.000Z'
    data:
      edited: true
      editors:
      - Geremia23
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5587379336357117
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/0h_AaU5YtIz51hxSEfVUN.jpeg?w=200&h=200&f=face
          fullname: Alan Aversa
          isHf: false
          isPro: false
          name: Geremia23
          type: user
        html: "<p>How do I add special tokens (like <code>\\n</code>) to this model?</p>\n\
          <p><code>tokenizer.add_tokens('\\n')</code> seems to work, but <a rel=\"\
          nofollow\" href=\"https://opennmt.net/CTranslate2/guides/transformers.html#marianmt\"\
          >CTranslate2</a> drops the <code>\\n</code> when translating:</p>\n<pre><code\
          \ class=\"language-python\"><span class=\"hljs-keyword\">import</span> ctranslate2\n\
          <span class=\"hljs-keyword\">import</span> transformers\n\ntranslator =\
          \ ctranslate2.Translator(<span class=\"hljs-string\">\"opus-mt-de-en\"</span>,\
          \ device=<span class=\"hljs-string\">'cuda'</span>)\ntokenizer = transformers.AutoTokenizer.from_pretrained(<span\
          \ class=\"hljs-string\">\"Helsinki-NLP/opus-mt-de-en\"</span>)\n\n<span\
          \ class=\"hljs-comment\"># add special token</span>\ntokenizer.add_tokens(<span\
          \ class=\"hljs-string\">'\\n'</span>)     <span class=\"hljs-comment\">#\
          \ output:  1</span>\n\ntokenizer.added_tokens_decoder     <span class=\"\
          hljs-comment\"># output: {58101: '\\n'}</span>\ntokenizer.added_tokens_encoder\
          \     <span class=\"hljs-comment\"># output: {'\\n': 58101}</span>\n\nsource\
          \ = tokenizer.convert_ids_to_tokens(tokenizer.encode(<span class=\"hljs-string\"\
          >\"Guten\\ntag!\"</span>))    <span class=\"hljs-comment\"># ==  ['\u2581\
          Guten', '\\n', '\u2581', 'tag', '!', '&lt;/s&gt;']</span>\nresults = translator.translate_batch([source],\
          \ beam_size=<span class=\"hljs-number\">5</span>)     <span class=\"hljs-comment\"\
          ># == [TranslationResult(hypotheses=[['\u2581Good', '\u2581day', '!']],\
          \ scores=[], attention=[])]      \u2190 NOTICE THE `\\n` IS DROPPED!</span>\n\
          </code></pre>\n<p>How do I get CTranslate2 to map token ID #58101 to <code>\\\
          n</code>?</p>\n"
        raw: "How do I add special tokens (like `\\n`) to this model?\n\n`tokenizer.add_tokens('\\\
          n')` seems to work, but [CTranslate2](https://opennmt.net/CTranslate2/guides/transformers.html#marianmt)\
          \ drops the `\\n` when translating:\n\n```python\nimport ctranslate2\nimport\
          \ transformers\n\ntranslator = ctranslate2.Translator(\"opus-mt-de-en\"\
          , device='cuda')\ntokenizer = transformers.AutoTokenizer.from_pretrained(\"\
          Helsinki-NLP/opus-mt-de-en\")\n\n# add special token\ntokenizer.add_tokens('\\\
          n')     # output:  1\n\ntokenizer.added_tokens_decoder     # output: {58101:\
          \ '\\n'}\ntokenizer.added_tokens_encoder     # output: {'\\n': 58101}\n\n\
          source = tokenizer.convert_ids_to_tokens(tokenizer.encode(\"Guten\\ntag!\"\
          ))    # ==  ['\u2581Guten', '\\n', '\u2581', 'tag', '!', '</s>']\nresults\
          \ = translator.translate_batch([source], beam_size=5)     # == [TranslationResult(hypotheses=[['\u2581\
          Good', '\u2581day', '!']], scores=[], attention=[])]      \u2190 NOTICE\
          \ THE `\\n` IS DROPPED!\n```\n\nHow do I get CTranslate2 to map token ID\
          \ #58101 to `\\n`?"
        updatedAt: '2023-08-27T22:38:40.075Z'
      numEdits: 4
      reactions: []
    id: 64ebcb517e69909b1ac173e9
    type: comment
  author: Geremia23
  content: "How do I add special tokens (like `\\n`) to this model?\n\n`tokenizer.add_tokens('\\\
    n')` seems to work, but [CTranslate2](https://opennmt.net/CTranslate2/guides/transformers.html#marianmt)\
    \ drops the `\\n` when translating:\n\n```python\nimport ctranslate2\nimport transformers\n\
    \ntranslator = ctranslate2.Translator(\"opus-mt-de-en\", device='cuda')\ntokenizer\
    \ = transformers.AutoTokenizer.from_pretrained(\"Helsinki-NLP/opus-mt-de-en\"\
    )\n\n# add special token\ntokenizer.add_tokens('\\n')     # output:  1\n\ntokenizer.added_tokens_decoder\
    \     # output: {58101: '\\n'}\ntokenizer.added_tokens_encoder     # output: {'\\\
    n': 58101}\n\nsource = tokenizer.convert_ids_to_tokens(tokenizer.encode(\"Guten\\\
    ntag!\"))    # ==  ['\u2581Guten', '\\n', '\u2581', 'tag', '!', '</s>']\nresults\
    \ = translator.translate_batch([source], beam_size=5)     # == [TranslationResult(hypotheses=[['\u2581\
    Good', '\u2581day', '!']], scores=[], attention=[])]      \u2190 NOTICE THE `\\\
    n` IS DROPPED!\n```\n\nHow do I get CTranslate2 to map token ID #58101 to `\\\
    n`?"
  created_at: 2023-08-27 21:16:49+00:00
  edited: true
  hidden: false
  id: 64ebcb517e69909b1ac173e9
  type: comment
- !!python/object:huggingface_hub.community.DiscussionTitleChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/0h_AaU5YtIz51hxSEfVUN.jpeg?w=200&h=200&f=face
      fullname: Alan Aversa
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Geremia23
      type: user
    createdAt: '2023-08-27T22:29:59.000Z'
    data:
      from: Add '\n' to this model?
      to: Adding '\n' to this model (using CTranslate2)
    id: 64ebce675ff6f83378f312fe
    type: title-change
  author: Geremia23
  created_at: 2023-08-27 21:29:59+00:00
  id: 64ebce675ff6f83378f312fe
  new_title: Adding '\n' to this model (using CTranslate2)
  old_title: Add '\n' to this model?
  type: title-change
is_pull_request: false
merge_commit_oid: null
num: 7
repo_id: Helsinki-NLP/opus-mt-de-en
repo_type: model
status: open
target_branch: null
title: Adding '\n' to this model (using CTranslate2)
