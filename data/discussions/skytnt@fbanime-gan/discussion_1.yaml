!!python/object:huggingface_hub.community.DiscussionWithDetails
author: learnprogandcs
conflicting_files: null
created_at: 2022-12-11 13:48:44+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0118bcd97e0db433b5192939114cec5d.svg
      fullname: learnprogandcs
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: learnprogandcs
      type: user
    createdAt: '2022-12-11T13:48:44.000Z'
    data:
      edited: false
      editors:
      - learnprogandcs
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0118bcd97e0db433b5192939114cec5d.svg
          fullname: learnprogandcs
          isHf: false
          isPro: false
          name: learnprogandcs
          type: user
        html: '<p>I''m having trouble using the PKL model in the repo.</p>

          <p>There is a small mistake in the notebook:</p>

          <pre><code>!wget https://huggingface.co/skytnt/fbanime-gan/raw/main/code/networks_stylegan2.py
          -O networks_stylegan2.py

          </code></pre>

          <p>Since I believe you deleted it in previous commits (I used networks_stylegan2.py
          from your Github instead).</p>

          <p>Using the notebook, i added this code to test the model output in pytorch:
          </p>

          <pre><code class="language-python">z_dim = G.z_dim

          c_dim = G.c_dim

          w_dim = G.w_dim


          batch_size = <span class="hljs-number">1</span>

          z = np.random.RandomState(<span class="hljs-number">20</span>).randn(batch_size,
          <span class="hljs-number">1024</span>).astype(np.float32)

          <span class="hljs-comment">#z = np.random.randn(batch_size, 1024).astype(np.float64)</span>

          <span class="hljs-comment">#z = np.zeros((batch_size, 1024)).astype(np.float32)</span>

          z = torch.Tensor(z)

          labels = torch.zeros((batch_size, c_dim))

          truncation_psi = torch.Tensor([<span class="hljs-number">0.7</span>, <span
          class="hljs-number">1</span>])


          w = G.mapping(z, labels, truncation_psi=truncation_psi)

          imgs = G.synthesis(w, noise_strength=<span class="hljs-number">1</span>)


          imgs = (imgs * <span class="hljs-number">127.5</span> + <span class="hljs-number">128</span>)

          imgs = imgs.clamp(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>).to(torch.uint8).permute((<span
          class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span
          class="hljs-number">3</span>, <span class="hljs-number">1</span>)).detach().cpu().numpy()


          result = Image.fromarray(imgs[<span class="hljs-number">0</span>])

          result

          </code></pre>

          <p>But the result is the following :<br><a rel="nofollow" href="https://cdn-uploads.huggingface.co/production/uploads/1670764561208-63133526b46fc4e2432f99b4.png"><img
          alt="image.png" src="https://cdn-uploads.huggingface.co/production/uploads/1670764561208-63133526b46fc4e2432f99b4.png"></a></p>

          <p>Do you know why the code produces this output ?</p>

          '
        raw: "I'm having trouble using the PKL model in the repo.\r\n\r\nThere is\
          \ a small mistake in the notebook:\r\n```\r\n!wget https://huggingface.co/skytnt/fbanime-gan/raw/main/code/networks_stylegan2.py\
          \ -O networks_stylegan2.py\r\n```\r\n\r\nSince I believe you deleted it\
          \ in previous commits (I used networks_stylegan2.py from your Github instead).\r\
          \n\r\nUsing the notebook, i added this code to test the model output in\
          \ pytorch: \r\n```python\r\nz_dim = G.z_dim\r\nc_dim = G.c_dim\r\nw_dim\
          \ = G.w_dim\r\n\r\nbatch_size = 1\r\nz = np.random.RandomState(20).randn(batch_size,\
          \ 1024).astype(np.float32)\r\n#z = np.random.randn(batch_size, 1024).astype(np.float64)\r\
          \n#z = np.zeros((batch_size, 1024)).astype(np.float32)\r\nz = torch.Tensor(z)\r\
          \nlabels = torch.zeros((batch_size, c_dim))\r\ntruncation_psi = torch.Tensor([0.7,\
          \ 1])\r\n\r\nw = G.mapping(z, labels, truncation_psi=truncation_psi)\r\n\
          imgs = G.synthesis(w, noise_strength=1)\r\n\r\nimgs = (imgs * 127.5 + 128)\r\
          \nimgs = imgs.clamp(0, 255).to(torch.uint8).permute((0, 2, 3, 1)).detach().cpu().numpy()\r\
          \n\r\nresult = Image.fromarray(imgs[0])\r\nresult\r\n```\r\nBut the result\
          \ is the following : \r\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/1670764561208-63133526b46fc4e2432f99b4.png)\r\
          \n\r\nDo you know why the code produces this output ?\r\n"
        updatedAt: '2022-12-11T13:48:44.759Z'
      numEdits: 0
      reactions: []
    id: 6395dfbcd231598ceb863479
    type: comment
  author: learnprogandcs
  content: "I'm having trouble using the PKL model in the repo.\r\n\r\nThere is a\
    \ small mistake in the notebook:\r\n```\r\n!wget https://huggingface.co/skytnt/fbanime-gan/raw/main/code/networks_stylegan2.py\
    \ -O networks_stylegan2.py\r\n```\r\n\r\nSince I believe you deleted it in previous\
    \ commits (I used networks_stylegan2.py from your Github instead).\r\n\r\nUsing\
    \ the notebook, i added this code to test the model output in pytorch: \r\n```python\r\
    \nz_dim = G.z_dim\r\nc_dim = G.c_dim\r\nw_dim = G.w_dim\r\n\r\nbatch_size = 1\r\
    \nz = np.random.RandomState(20).randn(batch_size, 1024).astype(np.float32)\r\n\
    #z = np.random.randn(batch_size, 1024).astype(np.float64)\r\n#z = np.zeros((batch_size,\
    \ 1024)).astype(np.float32)\r\nz = torch.Tensor(z)\r\nlabels = torch.zeros((batch_size,\
    \ c_dim))\r\ntruncation_psi = torch.Tensor([0.7, 1])\r\n\r\nw = G.mapping(z, labels,\
    \ truncation_psi=truncation_psi)\r\nimgs = G.synthesis(w, noise_strength=1)\r\n\
    \r\nimgs = (imgs * 127.5 + 128)\r\nimgs = imgs.clamp(0, 255).to(torch.uint8).permute((0,\
    \ 2, 3, 1)).detach().cpu().numpy()\r\n\r\nresult = Image.fromarray(imgs[0])\r\n\
    result\r\n```\r\nBut the result is the following : \r\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/1670764561208-63133526b46fc4e2432f99b4.png)\r\
    \n\r\nDo you know why the code produces this output ?\r\n"
  created_at: 2022-12-11 13:48:44+00:00
  edited: false
  hidden: false
  id: 6395dfbcd231598ceb863479
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1650375870480-noauth.png?w=200&h=200&f=face
      fullname: skytnt
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: skytnt
      type: user
    createdAt: '2022-12-12T12:02:33.000Z'
    data:
      edited: false
      editors:
      - skytnt
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1650375870480-noauth.png?w=200&h=200&f=face
          fullname: skytnt
          isHf: false
          isPro: false
          name: skytnt
          type: user
        html: '<p>Same problem as <a href="https://huggingface.co/spaces/skytnt/full-body-anime-gan/discussions/3">https://huggingface.co/spaces/skytnt/full-body-anime-gan/discussions/3</a></p>

          <p>the pkl is fp16 version, it only works well on gpu.</p>

          <p>I''ll upload fp32 version later.</p>

          '
        raw: 'Same problem as https://huggingface.co/spaces/skytnt/full-body-anime-gan/discussions/3


          the pkl is fp16 version, it only works well on gpu.


          I''ll upload fp32 version later.'
        updatedAt: '2022-12-12T12:02:33.575Z'
      numEdits: 0
      reactions: []
    id: 639718594352e45362dca9b3
    type: comment
  author: skytnt
  content: 'Same problem as https://huggingface.co/spaces/skytnt/full-body-anime-gan/discussions/3


    the pkl is fp16 version, it only works well on gpu.


    I''ll upload fp32 version later.'
  created_at: 2022-12-12 12:02:33+00:00
  edited: false
  hidden: false
  id: 639718594352e45362dca9b3
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0118bcd97e0db433b5192939114cec5d.svg
      fullname: learnprogandcs
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: learnprogandcs
      type: user
    createdAt: '2022-12-12T12:04:57.000Z'
    data:
      edited: false
      editors:
      - learnprogandcs
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0118bcd97e0db433b5192939114cec5d.svg
          fullname: learnprogandcs
          isHf: false
          isPro: false
          name: learnprogandcs
          type: user
        html: '<p>Indeed, thanks a lot for your answer</p>

          '
        raw: Indeed, thanks a lot for your answer
        updatedAt: '2022-12-12T12:04:57.420Z'
      numEdits: 0
      reactions: []
    id: 639718e9ca75b4d58e5ffd8e
    type: comment
  author: learnprogandcs
  content: Indeed, thanks a lot for your answer
  created_at: 2022-12-12 12:04:57+00:00
  edited: false
  hidden: false
  id: 639718e9ca75b4d58e5ffd8e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1650375870480-noauth.png?w=200&h=200&f=face
      fullname: skytnt
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: skytnt
      type: user
    createdAt: '2022-12-12T15:35:52.000Z'
    data:
      edited: false
      editors:
      - skytnt
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1650375870480-noauth.png?w=200&h=200&f=face
          fullname: skytnt
          isHf: false
          isPro: false
          name: skytnt
          type: user
        html: '<p>The fp32 version has been uploaded.</p>

          '
        raw: The fp32 version has been uploaded.
        updatedAt: '2022-12-12T15:35:52.130Z'
      numEdits: 0
      reactions: []
      relatedEventId: 63974a5860352dfc7c983fa3
    id: 63974a5860352dfc7c983fa2
    type: comment
  author: skytnt
  content: The fp32 version has been uploaded.
  created_at: 2022-12-12 15:35:52+00:00
  edited: false
  hidden: false
  id: 63974a5860352dfc7c983fa2
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1650375870480-noauth.png?w=200&h=200&f=face
      fullname: skytnt
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: skytnt
      type: user
    createdAt: '2022-12-12T15:35:52.000Z'
    data:
      status: closed
    id: 63974a5860352dfc7c983fa3
    type: status-change
  author: skytnt
  created_at: 2022-12-12 15:35:52+00:00
  id: 63974a5860352dfc7c983fa3
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: skytnt/fbanime-gan
repo_type: model
status: closed
target_branch: null
title: Problem with the PKL
