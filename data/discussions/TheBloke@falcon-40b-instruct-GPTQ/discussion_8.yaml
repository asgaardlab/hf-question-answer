!!python/object:huggingface_hub.community.DiscussionWithDetails
author: mike-ravkine
conflicting_files: null
created_at: 2023-05-31 16:54:34+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/7865ac39276762682d8e20a33ff9f257.svg
      fullname: Mike Ravkine
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: mike-ravkine
      type: user
    createdAt: '2023-05-31T17:54:34.000Z'
    data:
      edited: true
      editors:
      - mike-ravkine
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/7865ac39276762682d8e20a33ff9f257.svg
          fullname: Mike Ravkine
          isHf: false
          isPro: false
          name: mike-ravkine
          type: user
        html: '<p>This issue affects all the falcon repositories.</p>

          <p>Default eos_token_id=2 is specified here: <a href="https://huggingface.co/TheBloke/falcon-40b-instruct-GPTQ/blob/main/configuration_RW.py#L41">https://huggingface.co/TheBloke/falcon-40b-instruct-GPTQ/blob/main/configuration_RW.py#L41</a></p>

          <p>Looking at <a href="https://huggingface.co/TheBloke/falcon-40b-instruct-GPTQ/raw/main/tokenizer.json">https://huggingface.co/TheBloke/falcon-40b-instruct-GPTQ/raw/main/tokenizer.json</a>,
          token=2 is <code>&gt;&gt;INTRODUCTION&lt;&lt;</code> and we''re looking
          for token=11 <code>&lt;|endoftext|&gt;</code></p>

          <p>If we dont want to update the default (this is upstream code right?),
          the <code>eos_token_id</code> parameter can also be correctly passed at
          generation time:</p>

          <pre><code>model.generate(input_ids=tokens, max_new_tokens=512, do_sample=True,
          eos_token_id=11, temperature=0.8)

          </code></pre>

          <p>This solves the issue of the model output continuing right past &lt;|endoftext|&gt;
          tokens :D</p>

          '
        raw: 'This issue affects all the falcon repositories.


          Default eos_token_id=2 is specified here: https://huggingface.co/TheBloke/falcon-40b-instruct-GPTQ/blob/main/configuration_RW.py#L41


          Looking at https://huggingface.co/TheBloke/falcon-40b-instruct-GPTQ/raw/main/tokenizer.json,
          token=2 is `>>INTRODUCTION<<` and we''re looking for token=11 `<|endoftext|>`


          If we dont want to update the default (this is upstream code right?), the
          `eos_token_id` parameter can also be correctly passed at generation time:


          ```

          model.generate(input_ids=tokens, max_new_tokens=512, do_sample=True, eos_token_id=11,
          temperature=0.8)

          ```


          This solves the issue of the model output continuing right past <|endoftext|>
          tokens :D'
        updatedAt: '2023-05-31T17:55:00.709Z'
      numEdits: 1
      reactions: []
    id: 647789daf32a4117fd14f325
    type: comment
  author: mike-ravkine
  content: 'This issue affects all the falcon repositories.


    Default eos_token_id=2 is specified here: https://huggingface.co/TheBloke/falcon-40b-instruct-GPTQ/blob/main/configuration_RW.py#L41


    Looking at https://huggingface.co/TheBloke/falcon-40b-instruct-GPTQ/raw/main/tokenizer.json,
    token=2 is `>>INTRODUCTION<<` and we''re looking for token=11 `<|endoftext|>`


    If we dont want to update the default (this is upstream code right?), the `eos_token_id`
    parameter can also be correctly passed at generation time:


    ```

    model.generate(input_ids=tokens, max_new_tokens=512, do_sample=True, eos_token_id=11,
    temperature=0.8)

    ```


    This solves the issue of the model output continuing right past <|endoftext|>
    tokens :D'
  created_at: 2023-05-31 16:54:34+00:00
  edited: true
  hidden: false
  id: 647789daf32a4117fd14f325
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
      fullname: Tom Jobbins
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: true
      name: TheBloke
      type: user
    createdAt: '2023-05-31T19:42:08.000Z'
    data:
      edited: false
      editors:
      - TheBloke
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
          fullname: Tom Jobbins
          isHf: false
          isPro: true
          name: TheBloke
          type: user
        html: '<p>Oh interesting! I assume you''ve told them about it too?</p>

          <p>If this is materially affecting inference and has been reported upstream
          then I''ll change it.</p>

          <p>Would you mind PRing the fix to this repo?</p>

          '
        raw: 'Oh interesting! I assume you''ve told them about it too?


          If this is materially affecting inference and has been reported upstream
          then I''ll change it.


          Would you mind PRing the fix to this repo?'
        updatedAt: '2023-05-31T19:42:08.744Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F91D"
        users:
        - mike-ravkine
    id: 6477a310bb7681ad670c4d78
    type: comment
  author: TheBloke
  content: 'Oh interesting! I assume you''ve told them about it too?


    If this is materially affecting inference and has been reported upstream then
    I''ll change it.


    Would you mind PRing the fix to this repo?'
  created_at: 2023-05-31 18:42:08+00:00
  edited: false
  hidden: false
  id: 6477a310bb7681ad670c4d78
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/7865ac39276762682d8e20a33ff9f257.svg
      fullname: Mike Ravkine
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: mike-ravkine
      type: user
    createdAt: '2023-05-31T23:49:54.000Z'
    data:
      status: closed
    id: 6477dd2204aa03da2ac6ad3d
    type: status-change
  author: mike-ravkine
  created_at: 2023-05-31 22:49:54+00:00
  id: 6477dd2204aa03da2ac6ad3d
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 8
repo_id: TheBloke/falcon-40b-instruct-GPTQ
repo_type: model
status: closed
target_branch: null
title: 'Default eos_token_id=2 is incorrect, needs to be 11 '
