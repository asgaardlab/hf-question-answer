!!python/object:huggingface_hub.community.DiscussionWithDetails
author: RR0825
conflicting_files: null
created_at: 2023-11-09 10:09:58+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/705247510aadd66ac57e11c057afe7e0.svg
      fullname: Rui Wang
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: RR0825
      type: user
    createdAt: '2023-11-09T10:09:58.000Z'
    data:
      edited: false
      editors:
      - RR0825
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.4431969225406647
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/705247510aadd66ac57e11c057afe7e0.svg
          fullname: Rui Wang
          isHf: false
          isPro: false
          name: RR0825
          type: user
        html: '<p>When loading model, it reports below Error:</p>

          <p>File "/Baichuan2/test_model.py", line 5, in <br>    model = AutoModelForCausalLM.from_pretrained("baichuan-inc/Baichuan2-13B-Chat-4bits",
          device_map="auto", torch_dtype=torch.bfloat16, trust_remote_code=True)<br>  File
          "/opt/conda/envs/baichuan2/lib/python3.10/site-packages/transformers/models/auto/auto_factory.py",
          line 558, in from_pretrained<br>    return model_class.from_pretrained(<br>  File
          "/root/.cache/huggingface/modules/transformers_modules/Baichuan2-13B-Chat-4bits/modeling_baichuan.py",
          line 664, in from_pretrained<br>    dispatch_model(model, device_map=device_map)<br>  File
          "/opt/conda/envs/baichuan2/lib/python3.10/site-packages/accelerate/big_modeling.py",
          line 343, in dispatch_model<br>    check_device_map(model, device_map)<br>  File
          "/opt/conda/envs/baichuan2/lib/python3.10/site-packages/accelerate/utils/modeling.py",
          line 1129, in check_device_map<br>    all_model_tensors = [name for name,
          _ in model.state_dict().items()]<br>  File "/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py",
          line 1897, in state_dict<br>    module.state_dict(destination=destination,
          prefix=prefix + name + ''.'', keep_vars=keep_vars)<br>  File "/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py",
          line 1897, in state_dict<br>    module.state_dict(destination=destination,
          prefix=prefix + name + ''.'', keep_vars=keep_vars)<br>  File "/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py",
          line 1897, in state_dict<br>    module.state_dict(destination=destination,
          prefix=prefix + name + ''.'', keep_vars=keep_vars)<br>  [Previous line repeated
          2 more times]<br>  File "/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py",
          line 1894, in state_dict<br>    self._save_to_state_dict(destination, prefix,
          keep_vars)<br>  File "/opt/conda/envs/baichuan2/lib/python3.10/site-packages/bitsandbytes/nn/modules.py",
          line 237, in _save_to_state_dict<br>    for k, v in self.weight.quant_state.as_dict(packed=True).items():<br>AttributeError:
          ''list'' object has no attribute ''as_dict''</p>

          '
        raw: "When loading model, it reports below Error:\r\n\r\nFile \"/Baichuan2/test_model.py\"\
          , line 5, in <module>\r\n    model = AutoModelForCausalLM.from_pretrained(\"\
          baichuan-inc/Baichuan2-13B-Chat-4bits\", device_map=\"auto\", torch_dtype=torch.bfloat16,\
          \ trust_remote_code=True)\r\n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/transformers/models/auto/auto_factory.py\"\
          , line 558, in from_pretrained\r\n    return model_class.from_pretrained(\r\
          \n  File \"/root/.cache/huggingface/modules/transformers_modules/Baichuan2-13B-Chat-4bits/modeling_baichuan.py\"\
          , line 664, in from_pretrained\r\n    dispatch_model(model, device_map=device_map)\r\
          \n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/accelerate/big_modeling.py\"\
          , line 343, in dispatch_model\r\n    check_device_map(model, device_map)\r\
          \n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/accelerate/utils/modeling.py\"\
          , line 1129, in check_device_map\r\n    all_model_tensors = [name for name,\
          \ _ in model.state_dict().items()]\r\n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py\"\
          , line 1897, in state_dict\r\n    module.state_dict(destination=destination,\
          \ prefix=prefix + name + '.', keep_vars=keep_vars)\r\n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py\"\
          , line 1897, in state_dict\r\n    module.state_dict(destination=destination,\
          \ prefix=prefix + name + '.', keep_vars=keep_vars)\r\n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py\"\
          , line 1897, in state_dict\r\n    module.state_dict(destination=destination,\
          \ prefix=prefix + name + '.', keep_vars=keep_vars)\r\n  [Previous line repeated\
          \ 2 more times]\r\n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py\"\
          , line 1894, in state_dict\r\n    self._save_to_state_dict(destination,\
          \ prefix, keep_vars)\r\n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/bitsandbytes/nn/modules.py\"\
          , line 237, in _save_to_state_dict\r\n    for k, v in self.weight.quant_state.as_dict(packed=True).items():\r\
          \nAttributeError: 'list' object has no attribute 'as_dict'\r\n"
        updatedAt: '2023-11-09T10:09:58.639Z'
      numEdits: 0
      reactions: []
    id: 654caff642231e57c729a851
    type: comment
  author: RR0825
  content: "When loading model, it reports below Error:\r\n\r\nFile \"/Baichuan2/test_model.py\"\
    , line 5, in <module>\r\n    model = AutoModelForCausalLM.from_pretrained(\"baichuan-inc/Baichuan2-13B-Chat-4bits\"\
    , device_map=\"auto\", torch_dtype=torch.bfloat16, trust_remote_code=True)\r\n\
    \  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/transformers/models/auto/auto_factory.py\"\
    , line 558, in from_pretrained\r\n    return model_class.from_pretrained(\r\n\
    \  File \"/root/.cache/huggingface/modules/transformers_modules/Baichuan2-13B-Chat-4bits/modeling_baichuan.py\"\
    , line 664, in from_pretrained\r\n    dispatch_model(model, device_map=device_map)\r\
    \n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/accelerate/big_modeling.py\"\
    , line 343, in dispatch_model\r\n    check_device_map(model, device_map)\r\n \
    \ File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/accelerate/utils/modeling.py\"\
    , line 1129, in check_device_map\r\n    all_model_tensors = [name for name, _\
    \ in model.state_dict().items()]\r\n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py\"\
    , line 1897, in state_dict\r\n    module.state_dict(destination=destination, prefix=prefix\
    \ + name + '.', keep_vars=keep_vars)\r\n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py\"\
    , line 1897, in state_dict\r\n    module.state_dict(destination=destination, prefix=prefix\
    \ + name + '.', keep_vars=keep_vars)\r\n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py\"\
    , line 1897, in state_dict\r\n    module.state_dict(destination=destination, prefix=prefix\
    \ + name + '.', keep_vars=keep_vars)\r\n  [Previous line repeated 2 more times]\r\
    \n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/torch/nn/modules/module.py\"\
    , line 1894, in state_dict\r\n    self._save_to_state_dict(destination, prefix,\
    \ keep_vars)\r\n  File \"/opt/conda/envs/baichuan2/lib/python3.10/site-packages/bitsandbytes/nn/modules.py\"\
    , line 237, in _save_to_state_dict\r\n    for k, v in self.weight.quant_state.as_dict(packed=True).items():\r\
    \nAttributeError: 'list' object has no attribute 'as_dict'\r\n"
  created_at: 2023-11-09 10:09:58+00:00
  edited: false
  hidden: false
  id: 654caff642231e57c729a851
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/4c1dcb6b39cf882c456268a1675a27cc.svg
      fullname: qixiguo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: qixiguo
      type: user
    createdAt: '2023-11-11T13:42:34.000Z'
    data:
      edited: false
      editors:
      - qixiguo
      hidden: false
      identifiedLanguage:
        language: zh
        probability: 0.7755893468856812
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/4c1dcb6b39cf882c456268a1675a27cc.svg
          fullname: qixiguo
          isHf: false
          isPro: false
          name: qixiguo
          type: user
        html: "<p>\u6211\u662Fbitsandbytes\u7248\u672C\u95EE\u9898\u5BFC\u81F4\u7684\
          <br>pip install bitsandbytes==0.41.1<br>\u5373\u53EF</p>\n"
        raw: "\u6211\u662Fbitsandbytes\u7248\u672C\u95EE\u9898\u5BFC\u81F4\u7684\n\
          pip install bitsandbytes==0.41.1\n\u5373\u53EF"
        updatedAt: '2023-11-11T13:42:34.331Z'
      numEdits: 0
      reactions:
      - count: 2
        reaction: "\U0001F44D"
        users:
        - RR0825
        - chenxuerun
    id: 654f84ca4c8874c64d4bf06c
    type: comment
  author: qixiguo
  content: "\u6211\u662Fbitsandbytes\u7248\u672C\u95EE\u9898\u5BFC\u81F4\u7684\npip\
    \ install bitsandbytes==0.41.1\n\u5373\u53EF"
  created_at: 2023-11-11 13:42:34+00:00
  edited: false
  hidden: false
  id: 654f84ca4c8874c64d4bf06c
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 23
repo_id: baichuan-inc/Baichuan2-13B-Chat
repo_type: model
status: open
target_branch: null
title: 'AttributeError: ''list'' object has no attribute ''as_dict'''
