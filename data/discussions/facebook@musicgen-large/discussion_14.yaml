!!python/object:huggingface_hub.community.DiscussionWithDetails
author: softwareweaver
conflicting_files: null
created_at: 2023-11-10 18:49:47+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63038422a362e7e8b5196efb/vfFFZosz3-f_zp3stBnEV.png?w=200&h=200&f=face
      fullname: Ash DC
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: softwareweaver
      type: user
    createdAt: '2023-11-10T18:49:47.000Z'
    data:
      edited: false
      editors:
      - softwareweaver
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5248346328735352
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63038422a362e7e8b5196efb/vfFFZosz3-f_zp3stBnEV.png?w=200&h=200&f=face
          fullname: Ash DC
          isHf: false
          isPro: false
          name: softwareweaver
          type: user
        html: '<p>I tried<br>optimum-cli export onnx --model facebook/musicgen-large
          music.onnx</p>

          <p>but it gave me<br>\optimum\exporters\tasks.py", line 1481, in get_model_from_task<br>    if
          TasksManager._TASKS_TO_LIBRARY[task.replace("-with-past", "")] == "transformers":<br>KeyError:
          ''text-to-audio''</p>

          <hr>

          <p>I also tried<br>processor = AutoProcessor.from_pretrained("facebook/musicgen-large")<br>model
          = MusicgenForConditionalGeneration.from_pretrained("facebook/musicgen-large")<br>model.eval()<br>inputs
          = processor(<br>    text=["80s pop track with bassy drums and synth"],<br>    padding=True,<br>    return_tensors="pt",<br>)<br>dummy_input
          = torch.randint(low=0, high=processor.tokenizer.vocab_size, size=(1, 12))<br>torch.onnx.export(model,
          dummy_input,"model.onnx", verbose=True ) </p>

          <p>with resulted in an error<br>\transformers\models\encodec\modeling_encodec.py",
          line 791, in forward<br>    padding_mask = torch.ones_like(input_values).bool()<br>TypeError:
          ones_like(): argument ''input'' (position 1) must be Tensor, not NoneType</p>

          '
        raw: "I tried \r\noptimum-cli export onnx --model facebook/musicgen-large\
          \ music.onnx\r\n\r\nbut it gave me \r\n\\optimum\\exporters\\tasks.py\"\
          , line 1481, in get_model_from_task\r\n    if TasksManager._TASKS_TO_LIBRARY[task.replace(\"\
          -with-past\", \"\")] == \"transformers\":\r\nKeyError: 'text-to-audio'\r\
          \n------\r\nI also tried\r\nprocessor = AutoProcessor.from_pretrained(\"\
          facebook/musicgen-large\")\r\nmodel = MusicgenForConditionalGeneration.from_pretrained(\"\
          facebook/musicgen-large\")\r\nmodel.eval()\r\ninputs = processor(\r\n  \
          \  text=[\"80s pop track with bassy drums and synth\"],\r\n    padding=True,\r\
          \n    return_tensors=\"pt\",\r\n)\r\ndummy_input = torch.randint(low=0,\
          \ high=processor.tokenizer.vocab_size, size=(1, 12))\r\ntorch.onnx.export(model,\
          \ dummy_input,\"model.onnx\", verbose=True ) \r\n\r\nwith resulted in an\
          \ error \r\n\\transformers\\models\\encodec\\modeling_encodec.py\", line\
          \ 791, in forward\r\n    padding_mask = torch.ones_like(input_values).bool()\r\
          \nTypeError: ones_like(): argument 'input' (position 1) must be Tensor,\
          \ not NoneType"
        updatedAt: '2023-11-10T18:49:47.721Z'
      numEdits: 0
      reactions: []
    id: 654e7b4b0e90d38e758d3b36
    type: comment
  author: softwareweaver
  content: "I tried \r\noptimum-cli export onnx --model facebook/musicgen-large music.onnx\r\
    \n\r\nbut it gave me \r\n\\optimum\\exporters\\tasks.py\", line 1481, in get_model_from_task\r\
    \n    if TasksManager._TASKS_TO_LIBRARY[task.replace(\"-with-past\", \"\")] ==\
    \ \"transformers\":\r\nKeyError: 'text-to-audio'\r\n------\r\nI also tried\r\n\
    processor = AutoProcessor.from_pretrained(\"facebook/musicgen-large\")\r\nmodel\
    \ = MusicgenForConditionalGeneration.from_pretrained(\"facebook/musicgen-large\"\
    )\r\nmodel.eval()\r\ninputs = processor(\r\n    text=[\"80s pop track with bassy\
    \ drums and synth\"],\r\n    padding=True,\r\n    return_tensors=\"pt\",\r\n)\r\
    \ndummy_input = torch.randint(low=0, high=processor.tokenizer.vocab_size, size=(1,\
    \ 12))\r\ntorch.onnx.export(model, dummy_input,\"model.onnx\", verbose=True )\
    \ \r\n\r\nwith resulted in an error \r\n\\transformers\\models\\encodec\\modeling_encodec.py\"\
    , line 791, in forward\r\n    padding_mask = torch.ones_like(input_values).bool()\r\
    \nTypeError: ones_like(): argument 'input' (position 1) must be Tensor, not NoneType"
  created_at: 2023-11-10 18:49:47+00:00
  edited: false
  hidden: false
  id: 654e7b4b0e90d38e758d3b36
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63038422a362e7e8b5196efb/vfFFZosz3-f_zp3stBnEV.png?w=200&h=200&f=face
      fullname: Ash DC
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: softwareweaver
      type: user
    createdAt: '2023-11-10T20:26:16.000Z'
    data:
      edited: false
      editors:
      - softwareweaver
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6174193024635315
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63038422a362e7e8b5196efb/vfFFZosz3-f_zp3stBnEV.png?w=200&h=200&f=face
          fullname: Ash DC
          isHf: false
          isPro: false
          name: softwareweaver
          type: user
        html: '<p>I also tried it with the code below but got the same error.</p>

          <p>tensor_x = torch.ones((1, 24), dtype=torch.int, device="cpu")<br>torch.onnx.export(model,
          tensor_x,"model.onnx", verbose=True ) </p>

          '
        raw: 'I also tried it with the code below but got the same error.


          tensor_x = torch.ones((1, 24), dtype=torch.int, device="cpu")

          torch.onnx.export(model, tensor_x,"model.onnx", verbose=True ) '
        updatedAt: '2023-11-10T20:26:16.079Z'
      numEdits: 0
      reactions: []
    id: 654e91e8a3f56e8bd6ceba88
    type: comment
  author: softwareweaver
  content: 'I also tried it with the code below but got the same error.


    tensor_x = torch.ones((1, 24), dtype=torch.int, device="cpu")

    torch.onnx.export(model, tensor_x,"model.onnx", verbose=True ) '
  created_at: 2023-11-10 20:26:16+00:00
  edited: false
  hidden: false
  id: 654e91e8a3f56e8bd6ceba88
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1653243468328-61f91cf54a8e5a275b2b3e7c.jpeg?w=200&h=200&f=face
      fullname: Sanchit Gandhi
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: sanchit-gandhi
      type: user
    createdAt: '2023-11-17T12:08:33.000Z'
    data:
      edited: false
      editors:
      - sanchit-gandhi
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7964931130409241
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1653243468328-61f91cf54a8e5a275b2b3e7c.jpeg?w=200&h=200&f=face
          fullname: Sanchit Gandhi
          isHf: true
          isPro: false
          name: sanchit-gandhi
          type: user
        html: "<p>It looks to be the case that the MusicGen architecture is not supported\
          \ by Optimum ONNX: <a href=\"https://huggingface.co/docs/optimum/exporters/onnx/overview#overview\"\
          >https://huggingface.co/docs/optimum/exporters/onnx/overview#overview</a></p>\n\
          <p>Here's the advice for unsupported architectures: <a href=\"https://huggingface.co/docs/transformers/serialization#exporting-a-model-for-an-unsupported-architecture\"\
          >https://huggingface.co/docs/transformers/serialization#exporting-a-model-for-an-unsupported-architecture</a></p>\n\
          <p>This is a pretty popular text-to-audio model (peaked at &gt;1M downloads\
          \ / month). Would it make sense to add support for it in Optimum ONNX? cc\
          \ <span data-props=\"{&quot;user&quot;:&quot;mohitsha&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/mohitsha\">@<span class=\"\
          underline\">mohitsha</span></a></span>\n\n\t</span></span> <span data-props=\"\
          {&quot;user&quot;:&quot;fxmarty&quot;}\" data-target=\"UserMention\" class=\"\
          SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"inline-block\"><span\
          \ class=\"contents\"><a href=\"/fxmarty\">@<span class=\"underline\">fxmarty</span></a></span>\n\
          \n\t</span></span> </p>\n"
        raw: 'It looks to be the case that the MusicGen architecture is not supported
          by Optimum ONNX: https://huggingface.co/docs/optimum/exporters/onnx/overview#overview


          Here''s the advice for unsupported architectures: https://huggingface.co/docs/transformers/serialization#exporting-a-model-for-an-unsupported-architecture


          This is a pretty popular text-to-audio model (peaked at >1M downloads /
          month). Would it make sense to add support for it in Optimum ONNX? cc @mohitsha
          @fxmarty '
        updatedAt: '2023-11-17T12:08:33.787Z'
      numEdits: 0
      reactions: []
    id: 655757c1f062c53d557a4ce2
    type: comment
  author: sanchit-gandhi
  content: 'It looks to be the case that the MusicGen architecture is not supported
    by Optimum ONNX: https://huggingface.co/docs/optimum/exporters/onnx/overview#overview


    Here''s the advice for unsupported architectures: https://huggingface.co/docs/transformers/serialization#exporting-a-model-for-an-unsupported-architecture


    This is a pretty popular text-to-audio model (peaked at >1M downloads / month).
    Would it make sense to add support for it in Optimum ONNX? cc @mohitsha @fxmarty '
  created_at: 2023-11-17 12:08:33+00:00
  edited: false
  hidden: false
  id: 655757c1f062c53d557a4ce2
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 14
repo_id: facebook/musicgen-large
repo_type: model
status: open
target_branch: null
title: How do I convert this model to Onnx format
