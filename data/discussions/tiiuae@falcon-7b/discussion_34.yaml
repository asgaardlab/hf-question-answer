!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Andcircle
conflicting_files: null
created_at: 2023-06-14 06:33:04+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/aa85c93760f96e64a17a9ede2f75ebff.svg
      fullname: Li Zhang
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Andcircle
      type: user
    createdAt: '2023-06-14T07:33:04.000Z'
    data:
      edited: false
      editors:
      - Andcircle
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6969605684280396
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/aa85c93760f96e64a17a9ede2f75ebff.svg
          fullname: Li Zhang
          isHf: false
          isPro: false
          name: Andcircle
          type: user
        html: '<p>Trying to run SFT using PEFT as here <a rel="nofollow" href="https://gist.github.com/pacman100/1731b41f7a90a87b457e8c5415ff1c14">https://gist.github.com/pacman100/1731b41f7a90a87b457e8c5415ff1c14</a></p>

          <p>RotaryEmbedding give error:<br>return (q * cos) + (rotate_half(q) * sin),
          (k * cos) + (rotate_half(k) * sin)<br>TypeError: unsupported operand type(s)
          for *: ''Tensor'' and ''NoneType''</p>

          <p>Changed this line <a href="https://huggingface.co/tiiuae/falcon-7b/blob/2f5c3cd4eace6be6c0f12981f377fb35e5bf6ee5/modelling_RW.py#L73">https://huggingface.co/tiiuae/falcon-7b/blob/2f5c3cd4eace6be6c0f12981f377fb35e5bf6ee5/modelling_RW.py#L73</a>
          to:<br>if seq_len != self.seq_len_cached or self.cos_cached is None or self.sin_cached
          is None:<br>then it works. </p>

          <p>But I can''t find any places where self.sin_cached has been set to None,
          any hints? Thanks</p>

          <p>I use a cluster with 4 a10g,<br>CUDA version 12.0<br>torch version 2.0.1-cu118
          </p>

          '
        raw: "Trying to run SFT using PEFT as here https://gist.github.com/pacman100/1731b41f7a90a87b457e8c5415ff1c14\r\
          \n\r\nRotaryEmbedding give error: \r\nreturn (q * cos) + (rotate_half(q)\
          \ * sin), (k * cos) + (rotate_half(k) * sin) \r\nTypeError: unsupported\
          \ operand type(s) for *: 'Tensor' and 'NoneType'\r\n\r\nChanged this line\
          \ https://huggingface.co/tiiuae/falcon-7b/blob/2f5c3cd4eace6be6c0f12981f377fb35e5bf6ee5/modelling_RW.py#L73\
          \ to:\r\nif seq_len != self.seq_len_cached or self.cos_cached is None or\
          \ self.sin_cached is None:\r\nthen it works. \r\n\r\nBut I can't find any\
          \ places where self.sin_cached has been set to None, any hints? Thanks\r\
          \n\r\nI use a cluster with 4 a10g, \r\nCUDA version 12.0\r\ntorch version\
          \ 2.0.1-cu118 \r\n\r\n\r\n"
        updatedAt: '2023-06-14T07:33:04.708Z'
      numEdits: 0
      reactions: []
    id: 64896d30caea79f5778769cf
    type: comment
  author: Andcircle
  content: "Trying to run SFT using PEFT as here https://gist.github.com/pacman100/1731b41f7a90a87b457e8c5415ff1c14\r\
    \n\r\nRotaryEmbedding give error: \r\nreturn (q * cos) + (rotate_half(q) * sin),\
    \ (k * cos) + (rotate_half(k) * sin) \r\nTypeError: unsupported operand type(s)\
    \ for *: 'Tensor' and 'NoneType'\r\n\r\nChanged this line https://huggingface.co/tiiuae/falcon-7b/blob/2f5c3cd4eace6be6c0f12981f377fb35e5bf6ee5/modelling_RW.py#L73\
    \ to:\r\nif seq_len != self.seq_len_cached or self.cos_cached is None or self.sin_cached\
    \ is None:\r\nthen it works. \r\n\r\nBut I can't find any places where self.sin_cached\
    \ has been set to None, any hints? Thanks\r\n\r\nI use a cluster with 4 a10g,\
    \ \r\nCUDA version 12.0\r\ntorch version 2.0.1-cu118 \r\n\r\n\r\n"
  created_at: 2023-06-14 06:33:04+00:00
  edited: false
  hidden: false
  id: 64896d30caea79f5778769cf
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1647365668261-604a3b45604e72ac477a433a.png?w=200&h=200&f=face
      fullname: Leonardo Ribeiro
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Leo
      type: user
    createdAt: '2023-06-28T20:00:03.000Z'
    data:
      edited: false
      editors:
      - Leo
      hidden: false
      identifiedLanguage:
        language: it
        probability: 0.9861560463905334
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1647365668261-604a3b45604e72ac477a433a.png?w=200&h=200&f=face
          fullname: Leonardo Ribeiro
          isHf: false
          isPro: false
          name: Leo
          type: user
        html: '<p>+1</p>

          '
        raw: '+1'
        updatedAt: '2023-06-28T20:00:03.458Z'
      numEdits: 0
      reactions: []
    id: 649c91431de774e30a10fa31
    type: comment
  author: Leo
  content: '+1'
  created_at: 2023-06-28 19:00:03+00:00
  edited: false
  hidden: false
  id: 649c91431de774e30a10fa31
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 34
repo_id: tiiuae/falcon-7b
repo_type: model
status: open
target_branch: null
title: Run SFT using PEFT got error with RotaryEmbedding
