!!python/object:huggingface_hub.community.DiscussionWithDetails
author: TessaCoil
conflicting_files: null
created_at: 2022-08-23 14:51:12+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/a944f942c26a1a4fd6a7fd64eaa36529.svg
      fullname: TessaCoil
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: TessaCoil
      type: user
    createdAt: '2022-08-23T15:51:12.000Z'
    data:
      edited: true
      editors:
      - TessaCoil
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/a944f942c26a1a4fd6a7fd64eaa36529.svg
          fullname: TessaCoil
          isHf: false
          isPro: false
          name: TessaCoil
          type: user
        html: "<p>Replace line 272-273 in <code>&lt;pythondistr&gt;\\Lib\\site-packages\\\
          torch\\nn\\modules\\normalization.py</code></p>\n<pre><code>        return\
          \ F.group_norm(\n            input, self.num_groups, self.weight, self.bias,\
          \ self.eps)\n</code></pre>\n<p>with</p>\n<pre><code>        return F.group_norm(\n\
          \            input, self.num_groups, self.weight.type(input.dtype), self.bias.type(input.dtype),\
          \ self.eps)\n</code></pre>\n<p>In <code>&lt;pythondistr&gt;\\Lib\\site-packages\\\
          diffusers\\pipelines\\stable_diffusion\\pipeline_stable_diffusion.py</code>\
          \ after this section (around line 102-107)</p>\n<pre><code>        latents\
          \ = torch.randn(\n            (batch_size, self.unet.in_channels, height\
          \ // 8, width // 8),\n            generator=generator,\n            device=self.device,\n\
          \        )\n</code></pre>\n<p>add</p>\n<pre><code>        latents = latents.half()\n\
          </code></pre>\n<p>Finally, In <code>&lt;pythondistr&gt;\\Lib\\site-packages\\\
          diffusers\\pipelines\\stable_diffusion\\pipeline_stable_diffusion.py</code>\
          \ replace this (on line 160-161)</p>\n<pre><code>       safety_cheker_input\
          \ = self.feature_extractor(self.numpy_to_pil(image), return_tensors=\"pt\"\
          ).to(self.device)\n       image, has_nsfw_concept = self.safety_checker(images=image,\
          \ clip_input=safety_cheker_input.pixel_values)\n</code></pre>\n<p>with</p>\n\
          <pre><code>        safety_cheker_input = self.feature_extractor(self.numpy_to_pil(image),\
          \ return_tensors=\"pt\").to(self.device)\n        safety_cheker_input.pixel_values\
          \ = safety_cheker_input.pixel_values.half()\n        image, has_nsfw_concept\
          \ = self.safety_checker(images=image, clip_input=safety_cheker_input.pixel_values)\n\
          </code></pre>\n"
        raw: "Replace line 272-273 in `<pythondistr>\\Lib\\site-packages\\torch\\\
          nn\\modules\\normalization.py`\n```\n        return F.group_norm(\n    \
          \        input, self.num_groups, self.weight, self.bias, self.eps)\n```\n\
          with\n```\n        return F.group_norm(\n            input, self.num_groups,\
          \ self.weight.type(input.dtype), self.bias.type(input.dtype), self.eps)\n\
          ```\n\nIn `<pythondistr>\\Lib\\site-packages\\diffusers\\pipelines\\stable_diffusion\\\
          pipeline_stable_diffusion.py` after this section (around line 102-107)\n\
          ```\n        latents = torch.randn(\n            (batch_size, self.unet.in_channels,\
          \ height // 8, width // 8),\n            generator=generator,\n        \
          \    device=self.device,\n        )\n```\nadd\n```\n        latents = latents.half()\n\
          ```\n\nFinally, In `<pythondistr>\\Lib\\site-packages\\diffusers\\pipelines\\\
          stable_diffusion\\pipeline_stable_diffusion.py` replace this (on line 160-161)\n\
          ```\n       safety_cheker_input = self.feature_extractor(self.numpy_to_pil(image),\
          \ return_tensors=\"pt\").to(self.device)\n       image, has_nsfw_concept\
          \ = self.safety_checker(images=image, clip_input=safety_cheker_input.pixel_values)\n\
          ```\n\nwith\n\n```\n        safety_cheker_input = self.feature_extractor(self.numpy_to_pil(image),\
          \ return_tensors=\"pt\").to(self.device)\n        safety_cheker_input.pixel_values\
          \ = safety_cheker_input.pixel_values.half()\n        image, has_nsfw_concept\
          \ = self.safety_checker(images=image, clip_input=safety_cheker_input.pixel_values)\n\
          ```\n\n"
        updatedAt: '2022-08-23T15:55:24.160Z'
      numEdits: 1
      reactions:
      - count: 8
        reaction: "\U0001F917"
        users:
        - twobob
        - tompham97
        - maxwelljones14
        - mavericklsd
        - forestlee
        - jianglongye
        - gyy
        - Ling277
      - count: 4
        reaction: "\u2764\uFE0F"
        users:
        - patrickvonplaten
        - tompham97
        - maxwelljones14
        - gyy
      - count: 3
        reaction: "\U0001F614"
        users:
        - happzy2633
        - SahilDungrani
        - lucasjin
      - count: 1
        reaction: "\U0001F44D"
        users:
        - gyy
    id: 6304f770412a1b9d381fc005
    type: comment
  author: TessaCoil
  content: "Replace line 272-273 in `<pythondistr>\\Lib\\site-packages\\torch\\nn\\\
    modules\\normalization.py`\n```\n        return F.group_norm(\n            input,\
    \ self.num_groups, self.weight, self.bias, self.eps)\n```\nwith\n```\n       \
    \ return F.group_norm(\n            input, self.num_groups, self.weight.type(input.dtype),\
    \ self.bias.type(input.dtype), self.eps)\n```\n\nIn `<pythondistr>\\Lib\\site-packages\\\
    diffusers\\pipelines\\stable_diffusion\\pipeline_stable_diffusion.py` after this\
    \ section (around line 102-107)\n```\n        latents = torch.randn(\n       \
    \     (batch_size, self.unet.in_channels, height // 8, width // 8),\n        \
    \    generator=generator,\n            device=self.device,\n        )\n```\nadd\n\
    ```\n        latents = latents.half()\n```\n\nFinally, In `<pythondistr>\\Lib\\\
    site-packages\\diffusers\\pipelines\\stable_diffusion\\pipeline_stable_diffusion.py`\
    \ replace this (on line 160-161)\n```\n       safety_cheker_input = self.feature_extractor(self.numpy_to_pil(image),\
    \ return_tensors=\"pt\").to(self.device)\n       image, has_nsfw_concept = self.safety_checker(images=image,\
    \ clip_input=safety_cheker_input.pixel_values)\n```\n\nwith\n\n```\n        safety_cheker_input\
    \ = self.feature_extractor(self.numpy_to_pil(image), return_tensors=\"pt\").to(self.device)\n\
    \        safety_cheker_input.pixel_values = safety_cheker_input.pixel_values.half()\n\
    \        image, has_nsfw_concept = self.safety_checker(images=image, clip_input=safety_cheker_input.pixel_values)\n\
    ```\n\n"
  created_at: 2022-08-23 14:51:12+00:00
  edited: true
  hidden: false
  id: 6304f770412a1b9d381fc005
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1656839767332-noauth.jpeg?w=200&h=200&f=face
      fullname: researcher twobob
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: twobob
      type: user
    createdAt: '2022-08-23T16:27:11.000Z'
    data:
      edited: false
      editors:
      - twobob
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1656839767332-noauth.jpeg?w=200&h=200&f=face
          fullname: researcher twobob
          isHf: false
          isPro: false
          name: twobob
          type: user
        html: '<p>Hug</p>

          '
        raw: Hug
        updatedAt: '2022-08-23T16:27:11.869Z'
      numEdits: 0
      reactions: []
    id: 6304ffdf34c824b17250c8f6
    type: comment
  author: twobob
  content: Hug
  created_at: 2022-08-23 15:27:11+00:00
  edited: false
  hidden: false
  id: 6304ffdf34c824b17250c8f6
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2022-08-23T18:27:00.000Z'
    data:
      edited: false
      editors:
      - patrickvonplaten
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
          fullname: Patrick von Platen
          isHf: true
          isPro: false
          name: patrickvonplaten
          type: user
        html: "<p>Hey <span data-props=\"{&quot;user&quot;:&quot;TessaCoil&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/TessaCoil\"\
          >@<span class=\"underline\">TessaCoil</span></a></span>\n\n\t</span></span>,</p>\n\
          <p>Thanks for the fix here! Does it happen when loading weights in <code>torch.float16</code>?</p>\n"
        raw: 'Hey @TessaCoil,


          Thanks for the fix here! Does it happen when loading weights in `torch.float16`?'
        updatedAt: '2022-08-23T18:27:00.805Z'
      numEdits: 0
      reactions: []
    id: 63051bf499870e13d3dc3ccc
    type: comment
  author: patrickvonplaten
  content: 'Hey @TessaCoil,


    Thanks for the fix here! Does it happen when loading weights in `torch.float16`?'
  created_at: 2022-08-23 17:27:00+00:00
  edited: false
  hidden: false
  id: 63051bf499870e13d3dc3ccc
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2022-08-23T18:27:26.000Z'
    data:
      edited: false
      editors:
      - patrickvonplaten
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
          fullname: Patrick von Platen
          isHf: true
          isPro: false
          name: patrickvonplaten
          type: user
        html: '<p>Could you maybe post a code snippet that currently leads to an error/bug?
          :-)</p>

          '
        raw: Could you maybe post a code snippet that currently leads to an error/bug?
          :-)
        updatedAt: '2022-08-23T18:27:26.122Z'
      numEdits: 0
      reactions: []
    id: 63051c0e8eb42638603f4856
    type: comment
  author: patrickvonplaten
  content: Could you maybe post a code snippet that currently leads to an error/bug?
    :-)
  created_at: 2022-08-23 17:27:26+00:00
  edited: false
  hidden: false
  id: 63051c0e8eb42638603f4856
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1656839767332-noauth.jpeg?w=200&h=200&f=face
      fullname: researcher twobob
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: twobob
      type: user
    createdAt: '2022-08-23T21:23:25.000Z'
    data:
      edited: false
      editors:
      - twobob
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1656839767332-noauth.jpeg?w=200&h=200&f=face
          fullname: researcher twobob
          isHf: false
          isPro: false
          name: twobob
          type: user
        html: "<p>It happens when you try to switch to cpu I think in one instance\
          \ - likely the self hosted - that I have seen bemoaned \"in the wild\".\
          \ <span data-props=\"{&quot;user&quot;:&quot;patrickvonplaten&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/patrickvonplaten\">@<span\
          \ class=\"underline\">patrickvonplaten</span></a></span>\n\n\t</span></span>\
          \  rather than included GPU driven default selection. As I understood it.</p>\n\
          <p>setting it to CPU then complains about no support for halfs or vice versa.\
          \ this looks like a fix for that. First glance.</p>\n"
        raw: 'It happens when you try to switch to cpu I think in one instance - likely
          the self hosted - that I have seen bemoaned "in the wild". @patrickvonplaten  rather
          than included GPU driven default selection. As I understood it.


          setting it to CPU then complains about no support for halfs or vice versa.
          this looks like a fix for that. First glance.'
        updatedAt: '2022-08-23T21:23:25.396Z'
      numEdits: 0
      reactions: []
    id: 6305454d85c9f507e35251c2
    type: comment
  author: twobob
  content: 'It happens when you try to switch to cpu I think in one instance - likely
    the self hosted - that I have seen bemoaned "in the wild". @patrickvonplaten  rather
    than included GPU driven default selection. As I understood it.


    setting it to CPU then complains about no support for halfs or vice versa. this
    looks like a fix for that. First glance.'
  created_at: 2022-08-23 20:23:25+00:00
  edited: false
  hidden: false
  id: 6305454d85c9f507e35251c2
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/1a9bcf4c32211ae95c00fc52d310a1f9.svg
      fullname: Nik Jmaeff
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: njmaeff
      type: user
    createdAt: '2022-09-01T13:38:10.000Z'
    data:
      edited: false
      editors:
      - njmaeff
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/1a9bcf4c32211ae95c00fc52d310a1f9.svg
          fullname: Nik Jmaeff
          isHf: false
          isPro: false
          name: njmaeff
          type: user
        html: "<p>Here is a code snippet that causes the error. </p>\n<pre><code class=\"\
          language-python\"><span class=\"hljs-keyword\">import</span> torch\n<span\
          \ class=\"hljs-keyword\">from</span> diffusers <span class=\"hljs-keyword\"\
          >import</span> StableDiffusionPipeline\n\nTOKEN = <span class=\"hljs-string\"\
          >'hugging_face_token'</span>\n\n\n<span class=\"hljs-comment\"># get your\
          \ token at https://huggingface.co/settings/tokens</span>\n\n<span class=\"\
          hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>():\n\
          \    pipe = StableDiffusionPipeline.from_pretrained(\n        <span class=\"\
          hljs-string\">\"CompVis/stable-diffusion-v1-4\"</span>,\n        revision=<span\
          \ class=\"hljs-string\">\"fp16\"</span>,\n        torch_dtype=torch.float16,\n\
          \        use_auth_token=TOKEN,\n    ).to(<span class=\"hljs-string\">\"\
          cuda\"</span>)\n\n    prompt = <span class=\"hljs-string\">\"a photo of\
          \ an astronaut riding a horse on mars\"</span>\n    image = pipe(prompt)[<span\
          \ class=\"hljs-string\">\"sample\"</span>][<span class=\"hljs-number\">0</span>]\n\
          \n    image.save(<span class=\"hljs-string\">\"astronaut_rides_horse.png\"\
          </span>)\n\n\n<span class=\"hljs-comment\"># Press the green button in the\
          \ gutter to run the script.</span>\n<span class=\"hljs-keyword\">if</span>\
          \ __name__ == <span class=\"hljs-string\">'__main__'</span>:\n    run()\n\
          </code></pre>\n"
        raw: "Here is a code snippet that causes the error. \n\n```python\nimport\
          \ torch\nfrom diffusers import StableDiffusionPipeline\n\nTOKEN = 'hugging_face_token'\n\
          \n\n# get your token at https://huggingface.co/settings/tokens\n\ndef run():\n\
          \    pipe = StableDiffusionPipeline.from_pretrained(\n        \"CompVis/stable-diffusion-v1-4\"\
          ,\n        revision=\"fp16\",\n        torch_dtype=torch.float16,\n    \
          \    use_auth_token=TOKEN,\n    ).to(\"cuda\")\n\n    prompt = \"a photo\
          \ of an astronaut riding a horse on mars\"\n    image = pipe(prompt)[\"\
          sample\"][0]\n\n    image.save(\"astronaut_rides_horse.png\")\n\n\n# Press\
          \ the green button in the gutter to run the script.\nif __name__ == '__main__':\n\
          \    run()\n\n```"
        updatedAt: '2022-09-01T13:38:10.565Z'
      numEdits: 0
      reactions: []
    id: 6310b5c2a23f0327bce716a5
    type: comment
  author: njmaeff
  content: "Here is a code snippet that causes the error. \n\n```python\nimport torch\n\
    from diffusers import StableDiffusionPipeline\n\nTOKEN = 'hugging_face_token'\n\
    \n\n# get your token at https://huggingface.co/settings/tokens\n\ndef run():\n\
    \    pipe = StableDiffusionPipeline.from_pretrained(\n        \"CompVis/stable-diffusion-v1-4\"\
    ,\n        revision=\"fp16\",\n        torch_dtype=torch.float16,\n        use_auth_token=TOKEN,\n\
    \    ).to(\"cuda\")\n\n    prompt = \"a photo of an astronaut riding a horse on\
    \ mars\"\n    image = pipe(prompt)[\"sample\"][0]\n\n    image.save(\"astronaut_rides_horse.png\"\
    )\n\n\n# Press the green button in the gutter to run the script.\nif __name__\
    \ == '__main__':\n    run()\n\n```"
  created_at: 2022-09-01 12:38:10+00:00
  edited: false
  hidden: false
  id: 6310b5c2a23f0327bce716a5
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e1eaaec0a5ae77b7f91c0a511829b835.svg
      fullname: Hesham Haikal
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: erenyeagar
      type: user
    createdAt: '2022-09-05T13:37:36.000Z'
    data:
      edited: true
      editors:
      - erenyeagar
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e1eaaec0a5ae77b7f91c0a511829b835.svg
          fullname: Hesham Haikal
          isHf: false
          isPro: false
          name: erenyeagar
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;TessaCoil&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/TessaCoil\">@<span class=\"\
          underline\">TessaCoil</span></a></span>\n\n\t</span></span> - I get the\
          \ same error around line 82 (<code>&lt;pythondistr&gt;\\Lib\\site-packages\\\
          diffusers\\pipelines\\stable_diffusion\\pipeline_stable_diffusion.py</code>):</p>\n\
          <pre><code class=\"language-python\">text_embeddings = self.text_encoder(text_input.input_ids.to(self.device))[<span\
          \ class=\"hljs-number\">0</span>]\n</code></pre>\n<p> so none of the upcoming\
          \ modifications are reached. What do you reckon should I change?</p>\n<p>Edit:\
          \ I forgot to wrap <code>pipe(prompt)[\"sample\"][0]</code> around <code>autocast(\"\
          cuda\")</code>.</p>\n"
        raw: "@TessaCoil - I get the same error around line 82 (`<pythondistr>\\Lib\\\
          site-packages\\diffusers\\pipelines\\stable_diffusion\\pipeline_stable_diffusion.py`):\n\
          ```python\ntext_embeddings = self.text_encoder(text_input.input_ids.to(self.device))[0]\n\
          ```\n so none of the upcoming modifications are reached. What do you reckon\
          \ should I change?\n\nEdit: I forgot to wrap `pipe(prompt)[\"sample\"][0]`\
          \ around `autocast(\"cuda\")`."
        updatedAt: '2022-09-05T15:55:40.345Z'
      numEdits: 1
      reactions: []
    id: 6315fba0e06cb6c5c424a879
    type: comment
  author: erenyeagar
  content: "@TessaCoil - I get the same error around line 82 (`<pythondistr>\\Lib\\\
    site-packages\\diffusers\\pipelines\\stable_diffusion\\pipeline_stable_diffusion.py`):\n\
    ```python\ntext_embeddings = self.text_encoder(text_input.input_ids.to(self.device))[0]\n\
    ```\n so none of the upcoming modifications are reached. What do you reckon should\
    \ I change?\n\nEdit: I forgot to wrap `pipe(prompt)[\"sample\"][0]` around `autocast(\"\
    cuda\")`."
  created_at: 2022-09-05 12:37:36+00:00
  edited: true
  hidden: false
  id: 6315fba0e06cb6c5c424a879
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1664442251110-63329fde2217725f3adfff27.png?w=200&h=200&f=face
      fullname: spartan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: nightfury
      type: user
    createdAt: '2022-10-12T15:33:42.000Z'
    data:
      edited: false
      editors:
      - nightfury
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1664442251110-63329fde2217725f3adfff27.png?w=200&h=200&f=face
          fullname: spartan
          isHf: false
          isPro: false
          name: nightfury
          type: user
        html: '<p>hey i''m facing the similar issue for ''cpu'' device... in <a href="https://huggingface.co/spaces/nightfury/SD-InPainting/blob/main/app.py">https://huggingface.co/spaces/nightfury/SD-InPainting/blob/main/app.py</a><br>as
          no gpu - ''Cuda'' available.</p>

          <p>if i set torch_dtype=torch.float16,<br>thn it throws<br>RuntimeError:
          expected scalar type Float but found BFloat16</p>

          <p>if i set torch_dtype=torch.bfloat16,<br>thn it throws<br>RuntimeError:
          expected scalar type BFloat16 but found Float,</p>

          <p>if i set torch_dtype=torch.half,<br>thn it throws<br>RuntimeError: "LayerNormKernelImpl"
          not implemented for ''Half''</p>

          <p>if i set torch_dtype=torch.double,<br>thn it throws<br>RuntimeError:
          expected scalar type BFloat16 but found Double</p>

          <p>if i set torch_dtype=torch.long,<br>thn it throws<br>    raise TypeError(''nn.Module.to
          only accepts floating point or complex ''<br>TypeError: nn.Module.to only
          accepts floating point or complex dtypes, but got desired dtype=torch.int64</p>

          <p>so i am really confused on what torch_dtype to use for successful run.</p>

          '
        raw: "hey i'm facing the similar issue for 'cpu' device... in https://huggingface.co/spaces/nightfury/SD-InPainting/blob/main/app.py\n\
          as no gpu - 'Cuda' available.\n\nif i set torch_dtype=torch.float16,\nthn\
          \ it throws\nRuntimeError: expected scalar type Float but found BFloat16\n\
          \nif i set torch_dtype=torch.bfloat16,\nthn it throws\nRuntimeError: expected\
          \ scalar type BFloat16 but found Float,\n\nif i set torch_dtype=torch.half,\n\
          thn it throws\nRuntimeError: \"LayerNormKernelImpl\" not implemented for\
          \ 'Half'\n\nif i set torch_dtype=torch.double,\nthn it throws\nRuntimeError:\
          \ expected scalar type BFloat16 but found Double\n\nif i set torch_dtype=torch.long,\n\
          thn it throws\n    raise TypeError('nn.Module.to only accepts floating point\
          \ or complex '\nTypeError: nn.Module.to only accepts floating point or complex\
          \ dtypes, but got desired dtype=torch.int64\n\nso i am really confused on\
          \ what torch_dtype to use for successful run."
        updatedAt: '2022-10-12T15:33:42.438Z'
      numEdits: 0
      reactions: []
    id: 6346de567fb9f11870c77562
    type: comment
  author: nightfury
  content: "hey i'm facing the similar issue for 'cpu' device... in https://huggingface.co/spaces/nightfury/SD-InPainting/blob/main/app.py\n\
    as no gpu - 'Cuda' available.\n\nif i set torch_dtype=torch.float16,\nthn it throws\n\
    RuntimeError: expected scalar type Float but found BFloat16\n\nif i set torch_dtype=torch.bfloat16,\n\
    thn it throws\nRuntimeError: expected scalar type BFloat16 but found Float,\n\n\
    if i set torch_dtype=torch.half,\nthn it throws\nRuntimeError: \"LayerNormKernelImpl\"\
    \ not implemented for 'Half'\n\nif i set torch_dtype=torch.double,\nthn it throws\n\
    RuntimeError: expected scalar type BFloat16 but found Double\n\nif i set torch_dtype=torch.long,\n\
    thn it throws\n    raise TypeError('nn.Module.to only accepts floating point or\
    \ complex '\nTypeError: nn.Module.to only accepts floating point or complex dtypes,\
    \ but got desired dtype=torch.int64\n\nso i am really confused on what torch_dtype\
    \ to use for successful run."
  created_at: 2022-10-12 14:33:42+00:00
  edited: false
  hidden: false
  id: 6346de567fb9f11870c77562
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/a617f5fc40c8d395ba6210978e58664e.svg
      fullname: Shakib Yazdani
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Shakibyzn
      type: user
    createdAt: '2023-03-14T10:48:57.000Z'
    data:
      edited: false
      editors:
      - Shakibyzn
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/a617f5fc40c8d395ba6210978e58664e.svg
          fullname: Shakib Yazdani
          isHf: false
          isPro: false
          name: Shakibyzn
          type: user
        html: '<p>I came across the same error. I am also using diffusers 1.4. I added
          the <code>with torch.autocast("cuda"): </code> line above the <code>pipe(prompt,
          latents=latents) </code>and problem solved.</p>

          '
        raw: 'I came across the same error. I am also using diffusers 1.4. I added
          the ```with torch.autocast("cuda"): ``` line above the ```pipe(prompt, latents=latents)
          ```and problem solved.'
        updatedAt: '2023-03-14T10:48:57.570Z'
      numEdits: 0
      reactions:
      - count: 13
        reaction: "\U0001F44D"
        users:
        - maciejw94
        - sl4sh
        - CourserLi
        - chalecao
        - zhaoqf123
        - cactusthecoder
        - AxAI
        - cppowboy
        - shrey9669
        - ablerzorzal
        - friedrichor
        - rtilman
        - yychai
    id: 641051192a593afb553c969e
    type: comment
  author: Shakibyzn
  content: 'I came across the same error. I am also using diffusers 1.4. I added the
    ```with torch.autocast("cuda"): ``` line above the ```pipe(prompt, latents=latents)
    ```and problem solved.'
  created_at: 2023-03-14 09:48:57+00:00
  edited: false
  hidden: false
  id: 641051192a593afb553c969e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/99993f5aa68998c8d23637ce31a09930.svg
      fullname: chalecao
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: chalecao
      type: user
    createdAt: '2023-04-06T12:55:46.000Z'
    data:
      edited: false
      editors:
      - chalecao
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/99993f5aa68998c8d23637ce31a09930.svg
          fullname: chalecao
          isHf: false
          isPro: false
          name: chalecao
          type: user
        html: '<p>thanks,  i also add with torch.autocast("cuda"): , works for me</p>

          '
        raw: 'thanks,  i also add with torch.autocast("cuda"): , works for me'
        updatedAt: '2023-04-06T12:55:46.037Z'
      numEdits: 0
      reactions: []
    id: 642ec152a9194f489e1cdf35
    type: comment
  author: chalecao
  content: 'thanks,  i also add with torch.autocast("cuda"): , works for me'
  created_at: 2023-04-06 11:55:46+00:00
  edited: false
  hidden: false
  id: 642ec152a9194f489e1cdf35
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/094ad53bf7d058375530a5f1e221bf12.svg
      fullname: Mohammd Miari
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: MohammadMi
      type: user
    createdAt: '2023-05-03T00:13:50.000Z'
    data:
      edited: false
      editors:
      - MohammadMi
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/094ad53bf7d058375530a5f1e221bf12.svg
          fullname: Mohammd Miari
          isHf: false
          isPro: false
          name: MohammadMi
          type: user
        html: '<p>Hi! I Have a problem : Input type (float) and bias type (struct
          c10::Half) should be the same<br>the error is in \Lib\site-packages\torch\nn\modules\conv.py<br>File
          "C:\Users\user\stable-diffusion-webui\venv\lib\site-packages\torch\nn\modules\conv.py",
          line 463, in forward<br>    return self._conv_forward(input, self.weight,
          self.bias)  File "C:\Users\user\stable-diffusion-webui\venv\lib\site-packages\torch\nn\modules\conv.py",
          line 459, in _conv_forward<br>    return F.conv2d(input, weight, bias, self.stride,<br>RuntimeError:
          Input type (float) and bias type (struct c10::Half) should be the same<br><em>END
          OF TRACEBACK</em></p>

          <p>do u know what I can do here?</p>

          '
        raw: "Hi! I Have a problem : Input type (float) and bias type (struct c10::Half)\
          \ should be the same\nthe error is in <pythondistr>\\Lib\\site-packages\\\
          torch\\nn\\modules\\conv.py\nFile \"C:\\Users\\user\\stable-diffusion-webui\\\
          venv\\lib\\site-packages\\torch\\nn\\modules\\conv.py\", line 463, in forward\n\
          \    return self._conv_forward(input, self.weight, self.bias)  File \"C:\\\
          Users\\user\\stable-diffusion-webui\\venv\\lib\\site-packages\\torch\\nn\\\
          modules\\conv.py\", line 459, in _conv_forward\n    return F.conv2d(input,\
          \ weight, bias, self.stride,\nRuntimeError: Input type (float) and bias\
          \ type (struct c10::Half) should be the same\n*END OF TRACEBACK*\n\ndo u\
          \ know what I can do here?"
        updatedAt: '2023-05-03T00:13:50.735Z'
      numEdits: 0
      reactions: []
    id: 6451a73eb3f75261a7e31b90
    type: comment
  author: MohammadMi
  content: "Hi! I Have a problem : Input type (float) and bias type (struct c10::Half)\
    \ should be the same\nthe error is in <pythondistr>\\Lib\\site-packages\\torch\\\
    nn\\modules\\conv.py\nFile \"C:\\Users\\user\\stable-diffusion-webui\\venv\\lib\\\
    site-packages\\torch\\nn\\modules\\conv.py\", line 463, in forward\n    return\
    \ self._conv_forward(input, self.weight, self.bias)  File \"C:\\Users\\user\\\
    stable-diffusion-webui\\venv\\lib\\site-packages\\torch\\nn\\modules\\conv.py\"\
    , line 459, in _conv_forward\n    return F.conv2d(input, weight, bias, self.stride,\n\
    RuntimeError: Input type (float) and bias type (struct c10::Half) should be the\
    \ same\n*END OF TRACEBACK*\n\ndo u know what I can do here?"
  created_at: 2023-05-02 23:13:50+00:00
  edited: false
  hidden: false
  id: 6451a73eb3f75261a7e31b90
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1617264212503-603d25b75f9d390ab190b777.jpeg?w=200&h=200&f=face
      fullname: Pedro Cuenca
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: pcuenq
      type: user
    createdAt: '2023-05-03T11:44:59.000Z'
    data:
      edited: false
      editors:
      - pcuenq
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1617264212503-603d25b75f9d390ab190b777.jpeg?w=200&h=200&f=face
          fullname: Pedro Cuenca
          isHf: true
          isPro: false
          name: pcuenq
          type: user
        html: "<p>Hi <span data-props=\"{&quot;user&quot;:&quot;MohammadMi&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/MohammadMi\"\
          >@<span class=\"underline\">MohammadMi</span></a></span>\n\n\t</span></span>!\
          \ As others mentioned, this usually happens when attempting to run the model\
          \ in half precision on CPU, because CPU does not support half floats. Do\
          \ you have a GPU in your computer, and are you trying to use it? Do you\
          \ have a code snippet that demonstrates the problem?</p>\n"
        raw: Hi @MohammadMi! As others mentioned, this usually happens when attempting
          to run the model in half precision on CPU, because CPU does not support
          half floats. Do you have a GPU in your computer, and are you trying to use
          it? Do you have a code snippet that demonstrates the problem?
        updatedAt: '2023-05-03T11:44:59.824Z'
      numEdits: 0
      reactions: []
    id: 6452493bea756598f3546675
    type: comment
  author: pcuenq
  content: Hi @MohammadMi! As others mentioned, this usually happens when attempting
    to run the model in half precision on CPU, because CPU does not support half floats.
    Do you have a GPU in your computer, and are you trying to use it? Do you have
    a code snippet that demonstrates the problem?
  created_at: 2023-05-03 10:44:59+00:00
  edited: false
  hidden: false
  id: 6452493bea756598f3546675
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/094ad53bf7d058375530a5f1e221bf12.svg
      fullname: Mohammd Miari
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: MohammadMi
      type: user
    createdAt: '2023-05-03T11:49:16.000Z'
    data:
      edited: false
      editors:
      - MohammadMi
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/094ad53bf7d058375530a5f1e221bf12.svg
          fullname: Mohammd Miari
          isHf: false
          isPro: false
          name: MohammadMi
          type: user
        html: "<p>Yes I have a GPU - GTX 1060Ti<br>I didn\u2019t change any settings..<br>Do\
          \ u need to see my webui-user ? I set \u2014no-half \u2014lowvram \u2014\
          opt-slipt-attention..<br>Which code snippet do u mean?</p>\n"
        raw: "Yes I have a GPU - GTX 1060Ti \nI didn\u2019t change any settings..\n\
          Do u need to see my webui-user ? I set \u2014no-half \u2014lowvram \u2014\
          opt-slipt-attention..\nWhich code snippet do u mean?"
        updatedAt: '2023-05-03T11:49:16.765Z'
      numEdits: 0
      reactions: []
    id: 64524a3cdcfda85e982a9967
    type: comment
  author: MohammadMi
  content: "Yes I have a GPU - GTX 1060Ti \nI didn\u2019t change any settings..\n\
    Do u need to see my webui-user ? I set \u2014no-half \u2014lowvram \u2014opt-slipt-attention..\n\
    Which code snippet do u mean?"
  created_at: 2023-05-03 10:49:16+00:00
  edited: false
  hidden: false
  id: 64524a3cdcfda85e982a9967
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1617264212503-603d25b75f9d390ab190b777.jpeg?w=200&h=200&f=face
      fullname: Pedro Cuenca
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: pcuenq
      type: user
    createdAt: '2023-05-03T12:11:05.000Z'
    data:
      edited: false
      editors:
      - pcuenq
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1617264212503-603d25b75f9d390ab190b777.jpeg?w=200&h=200&f=face
          fullname: Pedro Cuenca
          isHf: true
          isPro: false
          name: pcuenq
          type: user
        html: '<p>I think that card doesn''t properly support half float, unfortunately.
          See <a rel="nofollow" href="https://github.com/huggingface/diffusers/issues/2153">here</a>
          for details about a similar card and some tricks to make it work using the
          <code>diffusers</code> library.</p>

          '
        raw: I think that card doesn't properly support half float, unfortunately.
          See [here](https://github.com/huggingface/diffusers/issues/2153) for details
          about a similar card and some tricks to make it work using the `diffusers`
          library.
        updatedAt: '2023-05-03T12:11:05.147Z'
      numEdits: 0
      reactions: []
    id: 64524f5967d53dce583a9f7b
    type: comment
  author: pcuenq
  content: I think that card doesn't properly support half float, unfortunately. See
    [here](https://github.com/huggingface/diffusers/issues/2153) for details about
    a similar card and some tricks to make it work using the `diffusers` library.
  created_at: 2023-05-03 11:11:05+00:00
  edited: false
  hidden: false
  id: 64524f5967d53dce583a9f7b
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 10
repo_id: CompVis/stable-diffusion-v1-4
repo_type: model
status: open
target_branch: null
title: 'How to fix "RuntimeError: expected scalar type Half but found Float" when
  using fp16'
