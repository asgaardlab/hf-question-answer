!!python/object:huggingface_hub.community.DiscussionWithDetails
author: AI-JAC
conflicting_files: null
created_at: 2022-08-27 20:07:16+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e39356f15dc264c18571fdfbecb3b50d.svg
      fullname: Jacob
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: AI-JAC
      type: user
    createdAt: '2022-08-27T21:07:16.000Z'
    data:
      edited: false
      editors:
      - AI-JAC
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e39356f15dc264c18571fdfbecb3b50d.svg
          fullname: Jacob
          isHf: false
          isPro: false
          name: AI-JAC
          type: user
        html: '<p>Hi, </p>

          <p>I am trying to run stable diffusion on Windows with a 8GB CUDA GPU. However,
          8 GB are not enough to run with standard parameters:</p>

          <p>RuntimeError: CUDA out of memory. Tried to allocate 1024.00 MiB (GPU
          0; 8.00 GiB total capacity; 6.19 GiB already allocated; 0 bytes free; 6.31
          GiB reserved in total by PyTorch) If reserved memory is &gt;&gt; allocated
          memory try setting max_split_size_mb to avoid fragmentation.  See documentation
          for Memory Management and PYTORCH_CUDA_ALLOC_CONF</p>

          <p>Therefore I followed the Note "If you are limited by GPU memory and have
          less than 10GB of GPU RAM available, please make sure to load the StableDiffusionPipeline
          in float16 precision instead of the default float32 precision as done above."
          However, this gets me the RuntimeError: expected scalar type Half but found
          Float</p>

          <p>This is the code:</p>

          <p>import torch<br>from diffusers import StableDiffusionPipeline<br>YOUR_TOKEN="..."<br>pipe
          = StableDiffusionPipeline.from_pretrained("CompVis/stable-diffusion-v1-4",
          revision="fp16", torch_dtype=torch.float16, use_auth_token=YOUR_TOKEN)<br>pipe.to("cuda")<br>prompt
          = "a photograph of an astronaut riding a horse"<br>image = pipe(prompt)["sample"][0]<br>image.save(f"astronaut_rides_horse.png")</p>

          <p>I googled this but did not found a solution, any hint welcome. Many thanks.</p>

          '
        raw: "Hi, \r\n\r\nI am trying to run stable diffusion on Windows with a 8GB\
          \ CUDA GPU. However, 8 GB are not enough to run with standard parameters:\r\
          \n\r\nRuntimeError: CUDA out of memory. Tried to allocate 1024.00 MiB (GPU\
          \ 0; 8.00 GiB total capacity; 6.19 GiB already allocated; 0 bytes free;\
          \ 6.31 GiB reserved in total by PyTorch) If reserved memory is >> allocated\
          \ memory try setting max_split_size_mb to avoid fragmentation.  See documentation\
          \ for Memory Management and PYTORCH_CUDA_ALLOC_CONF\r\n\r\nTherefore I followed\
          \ the Note \"If you are limited by GPU memory and have less than 10GB of\
          \ GPU RAM available, please make sure to load the StableDiffusionPipeline\
          \ in float16 precision instead of the default float32 precision as done\
          \ above.\" However, this gets me the RuntimeError: expected scalar type\
          \ Half but found Float\r\n\r\nThis is the code:\r\n\r\nimport torch\r\n\
          from diffusers import StableDiffusionPipeline\r\nYOUR_TOKEN=\"...\"\r\n\
          pipe = StableDiffusionPipeline.from_pretrained(\"CompVis/stable-diffusion-v1-4\"\
          , revision=\"fp16\", torch_dtype=torch.float16, use_auth_token=YOUR_TOKEN)\r\
          \npipe.to(\"cuda\")\r\nprompt = \"a photograph of an astronaut riding a\
          \ horse\"\r\nimage = pipe(prompt)[\"sample\"][0]\r\nimage.save(f\"astronaut_rides_horse.png\"\
          )\r\n\r\nI googled this but did not found a solution, any hint welcome.\
          \ Many thanks."
        updatedAt: '2022-08-27T21:07:16.920Z'
      numEdits: 0
      reactions: []
    id: 630a878465a977feb99f593e
    type: comment
  author: AI-JAC
  content: "Hi, \r\n\r\nI am trying to run stable diffusion on Windows with a 8GB\
    \ CUDA GPU. However, 8 GB are not enough to run with standard parameters:\r\n\r\
    \nRuntimeError: CUDA out of memory. Tried to allocate 1024.00 MiB (GPU 0; 8.00\
    \ GiB total capacity; 6.19 GiB already allocated; 0 bytes free; 6.31 GiB reserved\
    \ in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb\
    \ to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\r\
    \n\r\nTherefore I followed the Note \"If you are limited by GPU memory and have\
    \ less than 10GB of GPU RAM available, please make sure to load the StableDiffusionPipeline\
    \ in float16 precision instead of the default float32 precision as done above.\"\
    \ However, this gets me the RuntimeError: expected scalar type Half but found\
    \ Float\r\n\r\nThis is the code:\r\n\r\nimport torch\r\nfrom diffusers import\
    \ StableDiffusionPipeline\r\nYOUR_TOKEN=\"...\"\r\npipe = StableDiffusionPipeline.from_pretrained(\"\
    CompVis/stable-diffusion-v1-4\", revision=\"fp16\", torch_dtype=torch.float16,\
    \ use_auth_token=YOUR_TOKEN)\r\npipe.to(\"cuda\")\r\nprompt = \"a photograph of\
    \ an astronaut riding a horse\"\r\nimage = pipe(prompt)[\"sample\"][0]\r\nimage.save(f\"\
    astronaut_rides_horse.png\")\r\n\r\nI googled this but did not found a solution,\
    \ any hint welcome. Many thanks."
  created_at: 2022-08-27 20:07:16+00:00
  edited: false
  hidden: false
  id: 630a878465a977feb99f593e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/f487c44fecc0438121ee859df03b6392.svg
      fullname: Tester
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: TimothyB
      type: user
    createdAt: '2022-08-28T09:26:54.000Z'
    data:
      edited: false
      editors:
      - TimothyB
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/f487c44fecc0438121ee859df03b6392.svg
          fullname: Tester
          isHf: false
          isPro: false
          name: TimothyB
          type: user
        html: '<p>Got the same issue when running with cuda.</p>

          <p>When running on the CPU, I get the following error:</p>

          <p>RuntimeError: "LayerNormKernelImpl" not implemented for ''Half''</p>

          '
        raw: 'Got the same issue when running with cuda.


          When running on the CPU, I get the following error:


          RuntimeError: "LayerNormKernelImpl" not implemented for ''Half'''
        updatedAt: '2022-08-28T09:26:54.691Z'
      numEdits: 0
      reactions: []
    id: 630b34dea20a53678118b4c9
    type: comment
  author: TimothyB
  content: 'Got the same issue when running with cuda.


    When running on the CPU, I get the following error:


    RuntimeError: "LayerNormKernelImpl" not implemented for ''Half'''
  created_at: 2022-08-28 08:26:54+00:00
  edited: false
  hidden: false
  id: 630b34dea20a53678118b4c9
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    createdAt: '2022-08-28T09:39:49.000Z'
    data:
      edited: true
      editors: []
      hidden: true
      hiddenBy: ''
      latest:
        html: This comment has been hidden
        raw: This comment has been hidden
        updatedAt: '2023-02-08T15:35:50.063Z'
      numEdits: 3
      reactions: []
    id: 630b37e5e67c604e9b79e7b2
    type: comment
  author: deleted
  content: This comment has been hidden
  created_at: 2022-08-28 08:39:49+00:00
  edited: true
  hidden: true
  id: 630b37e5e67c604e9b79e7b2
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e39356f15dc264c18571fdfbecb3b50d.svg
      fullname: Jacob
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: AI-JAC
      type: user
    createdAt: '2022-08-28T11:19:02.000Z'
    data:
      edited: false
      editors:
      - AI-JAC
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e39356f15dc264c18571fdfbecb3b50d.svg
          fullname: Jacob
          isHf: false
          isPro: false
          name: AI-JAC
          type: user
        html: '<p>Not sure why you need another scheduler lms. For me this simple
          code runs on CPU fine:</p>

          <p>import torch<br>from diffusers import StableDiffusionPipeline<br>prompt
          = "a painting of a man sitting down and having a cup of tea in his house
          by the beach, by greg rutkowski, muted colors "<br>YOUR_TOKEN="..."<br>device
          = "cpu"<br>pipe = StableDiffusionPipeline.from_pretrained("CompVis/stable-diffusion-v1-4",
          use_auth_token=YOUR_TOKEN).to(device)<br>image = pipe(prompt)["sample"][0]<br>image.save(f"output.png")</p>

          <p>However, just this single picture takes 6 minutes on my CPU. I would
          want to accelerate with GPU, so any ideas for solving the error "RuntimeError:
          expected scalar type Half but found Float" descriped above highly appreciated!</p>

          '
        raw: 'Not sure why you need another scheduler lms. For me this simple code
          runs on CPU fine:


          import torch

          from diffusers import StableDiffusionPipeline

          prompt = "a painting of a man sitting down and having a cup of tea in his
          house by the beach, by greg rutkowski, muted colors "

          YOUR_TOKEN="..."

          device = "cpu"

          pipe = StableDiffusionPipeline.from_pretrained("CompVis/stable-diffusion-v1-4",
          use_auth_token=YOUR_TOKEN).to(device)

          image = pipe(prompt)["sample"][0]

          image.save(f"output.png")


          However, just this single picture takes 6 minutes on my CPU. I would want
          to accelerate with GPU, so any ideas for solving the error "RuntimeError:
          expected scalar type Half but found Float" descriped above highly appreciated!'
        updatedAt: '2022-08-28T11:19:02.165Z'
      numEdits: 0
      reactions: []
    id: 630b4f26910e17bbfea8f7e4
    type: comment
  author: AI-JAC
  content: 'Not sure why you need another scheduler lms. For me this simple code runs
    on CPU fine:


    import torch

    from diffusers import StableDiffusionPipeline

    prompt = "a painting of a man sitting down and having a cup of tea in his house
    by the beach, by greg rutkowski, muted colors "

    YOUR_TOKEN="..."

    device = "cpu"

    pipe = StableDiffusionPipeline.from_pretrained("CompVis/stable-diffusion-v1-4",
    use_auth_token=YOUR_TOKEN).to(device)

    image = pipe(prompt)["sample"][0]

    image.save(f"output.png")


    However, just this single picture takes 6 minutes on my CPU. I would want to accelerate
    with GPU, so any ideas for solving the error "RuntimeError: expected scalar type
    Half but found Float" descriped above highly appreciated!'
  created_at: 2022-08-28 10:19:02+00:00
  edited: false
  hidden: false
  id: 630b4f26910e17bbfea8f7e4
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/f487c44fecc0438121ee859df03b6392.svg
      fullname: Tester
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: TimothyB
      type: user
    createdAt: '2022-08-28T14:54:08.000Z'
    data:
      edited: false
      editors:
      - TimothyB
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/f487c44fecc0438121ee859df03b6392.svg
          fullname: Tester
          isHf: false
          isPro: false
          name: TimothyB
          type: user
        html: '<p>I got it working, but I cannot confirm since my gpu has too little
          VRAM (GTX 970)</p>

          <p>C:\Users\USERNAME\AppData\Local\Programs\Python\Python38\Lib\site-packages\diffusers\models\resnet.py:</p>

          <p>Change ".float()" to ".half() in rows 336 and 354<br><a rel="nofollow"
          href="https://cdn-uploads.huggingface.co/production/uploads/1661698318517-630b2bf1910e17bbfea7c658.png"><img
          alt="image.png" src="https://cdn-uploads.huggingface.co/production/uploads/1661698318517-630b2bf1910e17bbfea7c658.png"></a></p>

          <p>C:\Users\USERNAME\AppData\Local\Programs\Python\Python38\Lib\site-packages\diffusers\models\unet_2d_condition.py:</p>

          <p>Add ".half()" to row 139</p>

          <p><a rel="nofollow" href="https://cdn-uploads.huggingface.co/production/uploads/1661698365303-630b2bf1910e17bbfea7c658.png"><img
          alt="image.png" src="https://cdn-uploads.huggingface.co/production/uploads/1661698365303-630b2bf1910e17bbfea7c658.png"></a></p>

          <p>C:\Users\USERNAME\AppData\Local\Programs\Python\Python38\Lib\site-packages\diffusers\pipelines\stable_diffusion\pipeline_stable_diffusion.py</p>

          <p>Add ".half()" to row 137</p>

          <p><a rel="nofollow" href="https://cdn-uploads.huggingface.co/production/uploads/1661698419853-630b2bf1910e17bbfea7c658.png"><img
          alt="image.png" src="https://cdn-uploads.huggingface.co/production/uploads/1661698419853-630b2bf1910e17bbfea7c658.png"></a></p>

          <p>Then I get OOM errors instead of torch errors</p>

          '
        raw: 'I got it working, but I cannot confirm since my gpu has too little VRAM
          (GTX 970)


          C:\Users\USERNAME\AppData\Local\Programs\Python\Python38\Lib\site-packages\diffusers\models\resnet.py:


          Change ".float()" to ".half() in rows 336 and 354

          ![image.png](https://cdn-uploads.huggingface.co/production/uploads/1661698318517-630b2bf1910e17bbfea7c658.png)


          C:\Users\USERNAME\AppData\Local\Programs\Python\Python38\Lib\site-packages\diffusers\models\unet_2d_condition.py:


          Add ".half()" to row 139


          ![image.png](https://cdn-uploads.huggingface.co/production/uploads/1661698365303-630b2bf1910e17bbfea7c658.png)



          C:\Users\USERNAME\AppData\Local\Programs\Python\Python38\Lib\site-packages\diffusers\pipelines\stable_diffusion\pipeline_stable_diffusion.py


          Add ".half()" to row 137


          ![image.png](https://cdn-uploads.huggingface.co/production/uploads/1661698419853-630b2bf1910e17bbfea7c658.png)



          Then I get OOM errors instead of torch errors'
        updatedAt: '2022-08-28T14:54:08.714Z'
      numEdits: 0
      reactions: []
    id: 630b8190d73c0a1dcf541a5e
    type: comment
  author: TimothyB
  content: 'I got it working, but I cannot confirm since my gpu has too little VRAM
    (GTX 970)


    C:\Users\USERNAME\AppData\Local\Programs\Python\Python38\Lib\site-packages\diffusers\models\resnet.py:


    Change ".float()" to ".half() in rows 336 and 354

    ![image.png](https://cdn-uploads.huggingface.co/production/uploads/1661698318517-630b2bf1910e17bbfea7c658.png)


    C:\Users\USERNAME\AppData\Local\Programs\Python\Python38\Lib\site-packages\diffusers\models\unet_2d_condition.py:


    Add ".half()" to row 139


    ![image.png](https://cdn-uploads.huggingface.co/production/uploads/1661698365303-630b2bf1910e17bbfea7c658.png)



    C:\Users\USERNAME\AppData\Local\Programs\Python\Python38\Lib\site-packages\diffusers\pipelines\stable_diffusion\pipeline_stable_diffusion.py


    Add ".half()" to row 137


    ![image.png](https://cdn-uploads.huggingface.co/production/uploads/1661698419853-630b2bf1910e17bbfea7c658.png)



    Then I get OOM errors instead of torch errors'
  created_at: 2022-08-28 13:54:08+00:00
  edited: false
  hidden: false
  id: 630b8190d73c0a1dcf541a5e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/b51c0b98aad43a8253b64f98e60f0c3d.svg
      fullname: Chris
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: enzokro
      type: user
    createdAt: '2022-08-28T19:18:15.000Z'
    data:
      edited: false
      editors:
      - enzokro
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/b51c0b98aad43a8253b64f98e60f0c3d.svg
          fullname: Chris
          isHf: false
          isPro: false
          name: enzokro
          type: user
        html: '<p>Hi all,</p>

          <p>What worked for me was the context used in the CompVis Gradio app:</p>

          <pre><code>with autocast("cuda"):

          </code></pre>

          <p>But only when using a GPU. Think it solves the half/float tracking issues
          above.</p>

          '
        raw: "Hi all,\n\nWhat worked for me was the context used in the CompVis Gradio\
          \ app:\n\n    with autocast(\"cuda\"):\n\nBut only when using a GPU. Think\
          \ it solves the half/float tracking issues above."
        updatedAt: '2022-08-28T19:18:15.833Z'
      numEdits: 0
      reactions:
      - count: 5
        reaction: "\U0001F44D"
        users:
        - AI-JAC
        - DoofDilla
        - Codinggarden
        - bukvyy
        - sunbc0120
    id: 630bbf7786b8b9904c33ae5a
    type: comment
  author: enzokro
  content: "Hi all,\n\nWhat worked for me was the context used in the CompVis Gradio\
    \ app:\n\n    with autocast(\"cuda\"):\n\nBut only when using a GPU. Think it\
    \ solves the half/float tracking issues above."
  created_at: 2022-08-28 18:18:15+00:00
  edited: false
  hidden: false
  id: 630bbf7786b8b9904c33ae5a
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e39356f15dc264c18571fdfbecb3b50d.svg
      fullname: Jacob
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: AI-JAC
      type: user
    createdAt: '2022-08-28T19:32:32.000Z'
    data:
      edited: true
      editors:
      - AI-JAC
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e39356f15dc264c18571fdfbecb3b50d.svg
          fullname: Jacob
          isHf: false
          isPro: false
          name: AI-JAC
          type: user
        html: "<p>Yes, that works now for me. Just for reference on a NVIDA RTX 2070\
          \ with 8 GB, but only up to a resolution of 512x512</p>\n<p><span data-props=\"\
          {&quot;user&quot;:&quot;enzokro&quot;}\" data-target=\"UserMention\" class=\"\
          SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"inline-block\"><span\
          \ class=\"contents\"><a href=\"/enzokro\">@<span class=\"underline\">enzokro</span></a></span>\n\
          \n\t</span></span>: Thank you!</p>\n"
        raw: 'Yes, that works now for me. Just for reference on a NVIDA RTX 2070 with
          8 GB, but only up to a resolution of 512x512


          @enzokro: Thank you!'
        updatedAt: '2022-08-28T20:12:54.974Z'
      numEdits: 2
      reactions: []
    id: 630bc2d0a20a5367811e0bb6
    type: comment
  author: AI-JAC
  content: 'Yes, that works now for me. Just for reference on a NVIDA RTX 2070 with
    8 GB, but only up to a resolution of 512x512


    @enzokro: Thank you!'
  created_at: 2022-08-28 18:32:32+00:00
  edited: true
  hidden: false
  id: 630bc2d0a20a5367811e0bb6
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    createdAt: '2022-08-28T19:44:09.000Z'
    data:
      edited: true
      editors: []
      hidden: true
      hiddenBy: ''
      latest:
        html: This comment has been hidden
        raw: This comment has been hidden
        updatedAt: '2023-02-08T15:35:50.088Z'
      numEdits: 0
      reactions: []
    id: 630bc5894c0945d20b882b97
    type: comment
  author: deleted
  content: This comment has been hidden
  created_at: 2022-08-28 18:44:09+00:00
  edited: true
  hidden: true
  id: 630bc5894c0945d20b882b97
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6032802e1f993496bc14d9e3/w6hr-DEQot4VVkoyRIBiy.png?w=200&h=200&f=face
      fullname: Omar Sanseviero
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: osanseviero
      type: user
    createdAt: '2022-10-24T09:00:42.000Z'
    data:
      status: closed
    id: 6356543a6d7fcf1bedb795f3
    type: status-change
  author: osanseviero
  created_at: 2022-10-24 08:00:42+00:00
  id: 6356543a6d7fcf1bedb795f3
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 20
repo_id: CompVis/stable-diffusion-v1-4
repo_type: model
status: closed
target_branch: null
title: 'RuntimeError: expected scalar type Half but found Float'
