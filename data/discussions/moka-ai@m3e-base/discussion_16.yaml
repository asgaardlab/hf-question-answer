!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Ark0810
conflicting_files: null
created_at: 2023-07-26 11:27:31+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e9c164b5e128bacd0e8d85636ad38208.svg
      fullname: Ark0810
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Ark0810
      type: user
    createdAt: '2023-07-26T12:27:31.000Z'
    data:
      edited: false
      editors:
      - Ark0810
      hidden: false
      identifiedLanguage:
        language: zh
        probability: 0.9523881077766418
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e9c164b5e128bacd0e8d85636ad38208.svg
          fullname: Ark0810
          isHf: false
          isPro: false
          name: Ark0810
          type: user
        html: "<p>\u6211\u770B\u5230\u8BE5\u6A21\u578B\u8FD4\u56DE\u7684\u5F20\u91CF\
          \u4F1A\u6839\u636E\u8BCD\u7684\u6570\u91CF\u8FD4\u56DE\uFF08n,768\uFF09\u90A3\
          \u4E48\u8FD9\u79CD\u4E0D\u5B9A\u957F\u5411\u91CF\u4F1A\u5F71\u54CD\u4F59\
          \u5F26\u76F8\u4F3C\u5EA6\u7684\u8BA1\u7B97\u5417\uFF0C\u5BF9\u5411\u91CF\
          \u68C0\u7D22\u7684\u51C6\u786E\u7387\u6709\u6CA1\u6709\u5F71\u54CD\uFF0C\
          \u662F\u5426\u9700\u8981padding 0</p>\n"
        raw: "\u6211\u770B\u5230\u8BE5\u6A21\u578B\u8FD4\u56DE\u7684\u5F20\u91CF\u4F1A\
          \u6839\u636E\u8BCD\u7684\u6570\u91CF\u8FD4\u56DE\uFF08n,768\uFF09\u90A3\u4E48\
          \u8FD9\u79CD\u4E0D\u5B9A\u957F\u5411\u91CF\u4F1A\u5F71\u54CD\u4F59\u5F26\
          \u76F8\u4F3C\u5EA6\u7684\u8BA1\u7B97\u5417\uFF0C\u5BF9\u5411\u91CF\u68C0\
          \u7D22\u7684\u51C6\u786E\u7387\u6709\u6CA1\u6709\u5F71\u54CD\uFF0C\u662F\
          \u5426\u9700\u8981padding 0"
        updatedAt: '2023-07-26T12:27:31.377Z'
      numEdits: 0
      reactions: []
    id: 64c11133a04a514ba636fb95
    type: comment
  author: Ark0810
  content: "\u6211\u770B\u5230\u8BE5\u6A21\u578B\u8FD4\u56DE\u7684\u5F20\u91CF\u4F1A\
    \u6839\u636E\u8BCD\u7684\u6570\u91CF\u8FD4\u56DE\uFF08n,768\uFF09\u90A3\u4E48\u8FD9\
    \u79CD\u4E0D\u5B9A\u957F\u5411\u91CF\u4F1A\u5F71\u54CD\u4F59\u5F26\u76F8\u4F3C\
    \u5EA6\u7684\u8BA1\u7B97\u5417\uFF0C\u5BF9\u5411\u91CF\u68C0\u7D22\u7684\u51C6\
    \u786E\u7387\u6709\u6CA1\u6709\u5F71\u54CD\uFF0C\u662F\u5426\u9700\u8981padding\
    \ 0"
  created_at: 2023-07-26 11:27:31+00:00
  edited: false
  hidden: false
  id: 64c11133a04a514ba636fb95
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/NbjjEhhwMdzDz-jdOrwdu.png?w=200&h=200&f=face
      fullname: Moka HR SaSS
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: MokaHR
      type: user
    createdAt: '2023-07-28T03:38:04.000Z'
    data:
      edited: false
      editors:
      - MokaHR
      hidden: false
      identifiedLanguage:
        language: zh
        probability: 0.9813913106918335
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/NbjjEhhwMdzDz-jdOrwdu.png?w=200&h=200&f=face
          fullname: Moka HR SaSS
          isHf: false
          isPro: false
          name: MokaHR
          type: user
        html: "<p>\u4E0D\u4F1A\u5440\uFF0C\u53EA\u4F1A\u8FD4\u56DE\u5B9A\u957F\u7684\
          \u5411\u91CF\uFF0C\u5982\u679C\u662F\u4E00\u4E2A batch , \u5C31\u662F  batch_size\
          \ * 768 \u7684\u5411\u91CF\u3002\u5982\u679C\u4F60\u90A3\u8FB9\u7684\u4EE3\
          \u7801\u8FD4\u56DE\u7684\u662F\u4E0D\u5B9A\u957F\u7684\uFF0C\u53EF\u4EE5\
          \u628A\u4EE3\u7801\u8D34\u4E00\u4E0B\uFF0C\u6211\u770B\u770B\u662F\u600E\
          \u4E48\u56DE\u4E8B\u3002</p>\n"
        raw: "\u4E0D\u4F1A\u5440\uFF0C\u53EA\u4F1A\u8FD4\u56DE\u5B9A\u957F\u7684\u5411\
          \u91CF\uFF0C\u5982\u679C\u662F\u4E00\u4E2A batch , \u5C31\u662F  batch_size\
          \ * 768 \u7684\u5411\u91CF\u3002\u5982\u679C\u4F60\u90A3\u8FB9\u7684\u4EE3\
          \u7801\u8FD4\u56DE\u7684\u662F\u4E0D\u5B9A\u957F\u7684\uFF0C\u53EF\u4EE5\
          \u628A\u4EE3\u7801\u8D34\u4E00\u4E0B\uFF0C\u6211\u770B\u770B\u662F\u600E\
          \u4E48\u56DE\u4E8B\u3002"
        updatedAt: '2023-07-28T03:38:04.756Z'
      numEdits: 0
      reactions: []
    id: 64c3381cf77f6ee6502ffa95
    type: comment
  author: MokaHR
  content: "\u4E0D\u4F1A\u5440\uFF0C\u53EA\u4F1A\u8FD4\u56DE\u5B9A\u957F\u7684\u5411\
    \u91CF\uFF0C\u5982\u679C\u662F\u4E00\u4E2A batch , \u5C31\u662F  batch_size *\
    \ 768 \u7684\u5411\u91CF\u3002\u5982\u679C\u4F60\u90A3\u8FB9\u7684\u4EE3\u7801\
    \u8FD4\u56DE\u7684\u662F\u4E0D\u5B9A\u957F\u7684\uFF0C\u53EF\u4EE5\u628A\u4EE3\
    \u7801\u8D34\u4E00\u4E0B\uFF0C\u6211\u770B\u770B\u662F\u600E\u4E48\u56DE\u4E8B\
    \u3002"
  created_at: 2023-07-28 02:38:04+00:00
  edited: false
  hidden: false
  id: 64c3381cf77f6ee6502ffa95
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e9c164b5e128bacd0e8d85636ad38208.svg
      fullname: Ark0810
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Ark0810
      type: user
    createdAt: '2023-07-28T10:38:10.000Z'
    data:
      edited: false
      editors:
      - Ark0810
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.1406494528055191
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e9c164b5e128bacd0e8d85636ad38208.svg
          fullname: Ark0810
          isHf: false
          isPro: false
          name: Ark0810
          type: user
        html: "<h1 id=\"\u52A0\u8F7D\u6A21\u578B\">\u52A0\u8F7D\u6A21\u578B</h1>\n\
          <pre><code>tokenizer = AutoTokenizer.from_pretrained(\"moka-ai/m3e-base\"\
          )\nmodel = AutoModel.from_pretrained(\"moka-ai/m3e-base\")\n\n# \u5B9A\u4E49\
          \u6587\u672C\ntext = \"\u4F60\u597D\"\n\n# \u8F6C\u6210tensor\u8F93\u5165\
          \ninputs = tokenizer(text, return_tensors=\"pt\")\ninput_ids = inputs[\"\
          input_ids\"]\nattention_mask = inputs[\"attention_mask\"]\ntoken_type_ids\
          \ = inputs[\"token_type_ids\"]\n\n# \u6A21\u578B\u63A8\u7406\nwith torch.no_grad():\n\
          \    outputs = model(input_ids, attention_mask=attention_mask, token_type_ids=token_type_ids)\n\
          \n# \u83B7\u53D6\u5411\u91CF\u8868\u793A\nembeddings = outputs.last_hidden_state[0]\n\
          res = embeddings.numpy()\nprint(res)\n</code></pre>\n"
        raw: "# \u52A0\u8F7D\u6A21\u578B\n    tokenizer = AutoTokenizer.from_pretrained(\"\
          moka-ai/m3e-base\")\n    model = AutoModel.from_pretrained(\"moka-ai/m3e-base\"\
          )\n\n    # \u5B9A\u4E49\u6587\u672C\n    text = \"\u4F60\u597D\"\n\n   \
          \ # \u8F6C\u6210tensor\u8F93\u5165\n    inputs = tokenizer(text, return_tensors=\"\
          pt\")\n    input_ids = inputs[\"input_ids\"]\n    attention_mask = inputs[\"\
          attention_mask\"]\n    token_type_ids = inputs[\"token_type_ids\"]\n\n \
          \   # \u6A21\u578B\u63A8\u7406\n    with torch.no_grad():\n        outputs\
          \ = model(input_ids, attention_mask=attention_mask, token_type_ids=token_type_ids)\n\
          \n    # \u83B7\u53D6\u5411\u91CF\u8868\u793A\n    embeddings = outputs.last_hidden_state[0]\n\
          \    res = embeddings.numpy()\n    print(res)"
        updatedAt: '2023-07-28T10:38:10.605Z'
      numEdits: 0
      reactions: []
    id: 64c39a922a5eaefd0011db8f
    type: comment
  author: Ark0810
  content: "# \u52A0\u8F7D\u6A21\u578B\n    tokenizer = AutoTokenizer.from_pretrained(\"\
    moka-ai/m3e-base\")\n    model = AutoModel.from_pretrained(\"moka-ai/m3e-base\"\
    )\n\n    # \u5B9A\u4E49\u6587\u672C\n    text = \"\u4F60\u597D\"\n\n    # \u8F6C\
    \u6210tensor\u8F93\u5165\n    inputs = tokenizer(text, return_tensors=\"pt\")\n\
    \    input_ids = inputs[\"input_ids\"]\n    attention_mask = inputs[\"attention_mask\"\
    ]\n    token_type_ids = inputs[\"token_type_ids\"]\n\n    # \u6A21\u578B\u63A8\
    \u7406\n    with torch.no_grad():\n        outputs = model(input_ids, attention_mask=attention_mask,\
    \ token_type_ids=token_type_ids)\n\n    # \u83B7\u53D6\u5411\u91CF\u8868\u793A\
    \n    embeddings = outputs.last_hidden_state[0]\n    res = embeddings.numpy()\n\
    \    print(res)"
  created_at: 2023-07-28 09:38:10+00:00
  edited: false
  hidden: false
  id: 64c39a922a5eaefd0011db8f
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/65f534909b6de1ad1ce8e8b7ee0843ed.svg
      fullname: Fu Fan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: habaneraa
      type: user
    createdAt: '2023-07-30T23:46:32.000Z'
    data:
      edited: false
      editors:
      - habaneraa
      hidden: false
      identifiedLanguage:
        language: zh
        probability: 0.7038196325302124
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/65f534909b6de1ad1ce8e8b7ee0843ed.svg
          fullname: Fu Fan
          isHf: false
          isPro: false
          name: habaneraa
          type: user
        html: "<p>hi\uFF0C\u4F3C\u4E4E\u4E0D\u5E94\u8BE5\u76F4\u63A5\u4F7F\u7528 <code>last_hidden_state</code>\uFF0C\
          \u501F\u52A9sentence transformer\u5305\u53EF\u4EE5\u66F4\u65B9\u4FBF\u5730\
          \u5F97\u5230pooling\u540E\u7684embedding</p>\n"
        raw: "hi\uFF0C\u4F3C\u4E4E\u4E0D\u5E94\u8BE5\u76F4\u63A5\u4F7F\u7528 `last_hidden_state`\uFF0C\
          \u501F\u52A9sentence transformer\u5305\u53EF\u4EE5\u66F4\u65B9\u4FBF\u5730\
          \u5F97\u5230pooling\u540E\u7684embedding"
        updatedAt: '2023-07-30T23:46:32.834Z'
      numEdits: 0
      reactions: []
    id: 64c6f6581d44fc06af070e2a
    type: comment
  author: habaneraa
  content: "hi\uFF0C\u4F3C\u4E4E\u4E0D\u5E94\u8BE5\u76F4\u63A5\u4F7F\u7528 `last_hidden_state`\uFF0C\
    \u501F\u52A9sentence transformer\u5305\u53EF\u4EE5\u66F4\u65B9\u4FBF\u5730\u5F97\
    \u5230pooling\u540E\u7684embedding"
  created_at: 2023-07-30 22:46:32+00:00
  edited: false
  hidden: false
  id: 64c6f6581d44fc06af070e2a
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e9c164b5e128bacd0e8d85636ad38208.svg
      fullname: Ark0810
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Ark0810
      type: user
    createdAt: '2023-07-31T01:41:31.000Z'
    data:
      edited: false
      editors:
      - Ark0810
      hidden: false
      identifiedLanguage:
        language: zh
        probability: 0.9780709147453308
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e9c164b5e128bacd0e8d85636ad38208.svg
          fullname: Ark0810
          isHf: false
          isPro: false
          name: Ark0810
          type: user
        html: "<p>\u53EF\u4EE5\u7ED9\u4E2Apython\u793A\u4F8B\u5417</p>\n"
        raw: "\u53EF\u4EE5\u7ED9\u4E2Apython\u793A\u4F8B\u5417"
        updatedAt: '2023-07-31T01:41:31.392Z'
      numEdits: 0
      reactions: []
    id: 64c7114b11354a0eca2cd86f
    type: comment
  author: Ark0810
  content: "\u53EF\u4EE5\u7ED9\u4E2Apython\u793A\u4F8B\u5417"
  created_at: 2023-07-31 00:41:31+00:00
  edited: false
  hidden: false
  id: 64c7114b11354a0eca2cd86f
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/65f534909b6de1ad1ce8e8b7ee0843ed.svg
      fullname: Fu Fan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: habaneraa
      type: user
    createdAt: '2023-07-31T02:48:49.000Z'
    data:
      edited: true
      editors:
      - habaneraa
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.3705149292945862
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/65f534909b6de1ad1ce8e8b7ee0843ed.svg
          fullname: Fu Fan
          isHf: false
          isPro: false
          name: habaneraa
          type: user
        html: "<p>\u5C31\u662F\u76F4\u63A5\u4F7F\u7528 <code>sentence-transformers</code>\
          \ \u8FD9\u4E2A Python \u5305\uFF0C\u4EE5\u4E0B\u662F\u4E00\u4E2A\u793A\u4F8B\
          \uFF0C\u66F4\u591A\u529F\u80FD\u53EF\u4EE5\u67E5\u9605\u76F8\u5173\u6587\
          \u6863</p>\n<pre><code class=\"language-python\"><span class=\"hljs-keyword\"\
          >from</span> sentence_transformers <span class=\"hljs-keyword\">import</span>\
          \ SentenceTransformer\n\nmodel = SentenceTransformer(<span class=\"hljs-string\"\
          >'moka-ai/m3e-base'</span>)\n\n<span class=\"hljs-comment\"># str -&gt;\
          \ tensor</span>\ntext = <span class=\"hljs-string\">'hello world'</span>\n\
          embedding = model.encode(text)\n<span class=\"hljs-built_in\">print</span>(embedding.shape)\n\
          \n<span class=\"hljs-comment\"># a list of strings -&gt; a list of tensors</span>\n\
          texts = [<span class=\"hljs-string\">'hello world'</span>, <span class=\"\
          hljs-string\">'test embeddings'</span>]\nembeddings = model.encode(texts)\n\
          <span class=\"hljs-keyword\">for</span> e <span class=\"hljs-keyword\">in</span>\
          \ embeddings:\n    <span class=\"hljs-built_in\">print</span>(e.shape)\n\
          </code></pre>\n"
        raw: "\u5C31\u662F\u76F4\u63A5\u4F7F\u7528 `sentence-transformers` \u8FD9\u4E2A\
          \ Python \u5305\uFF0C\u4EE5\u4E0B\u662F\u4E00\u4E2A\u793A\u4F8B\uFF0C\u66F4\
          \u591A\u529F\u80FD\u53EF\u4EE5\u67E5\u9605\u76F8\u5173\u6587\u6863\n\n```python\n\
          from sentence_transformers import SentenceTransformer\n\nmodel = SentenceTransformer('moka-ai/m3e-base')\n\
          \n# str -> tensor\ntext = 'hello world'\nembedding = model.encode(text)\n\
          print(embedding.shape)\n\n# a list of strings -> a list of tensors\ntexts\
          \ = ['hello world', 'test embeddings']\nembeddings = model.encode(texts)\n\
          for e in embeddings:\n    print(e.shape)\n```"
        updatedAt: '2023-07-31T02:49:10.829Z'
      numEdits: 1
      reactions: []
    id: 64c721115d0ab485fb2d7c13
    type: comment
  author: habaneraa
  content: "\u5C31\u662F\u76F4\u63A5\u4F7F\u7528 `sentence-transformers` \u8FD9\u4E2A\
    \ Python \u5305\uFF0C\u4EE5\u4E0B\u662F\u4E00\u4E2A\u793A\u4F8B\uFF0C\u66F4\u591A\
    \u529F\u80FD\u53EF\u4EE5\u67E5\u9605\u76F8\u5173\u6587\u6863\n\n```python\nfrom\
    \ sentence_transformers import SentenceTransformer\n\nmodel = SentenceTransformer('moka-ai/m3e-base')\n\
    \n# str -> tensor\ntext = 'hello world'\nembedding = model.encode(text)\nprint(embedding.shape)\n\
    \n# a list of strings -> a list of tensors\ntexts = ['hello world', 'test embeddings']\n\
    embeddings = model.encode(texts)\nfor e in embeddings:\n    print(e.shape)\n```"
  created_at: 2023-07-31 01:48:49+00:00
  edited: true
  hidden: false
  id: 64c721115d0ab485fb2d7c13
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e9c164b5e128bacd0e8d85636ad38208.svg
      fullname: Ark0810
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Ark0810
      type: user
    createdAt: '2023-07-31T02:57:14.000Z'
    data:
      edited: true
      editors: []
      hidden: true
      hiddenBy: ''
      latest:
        author:
          avatarUrl: /avatars/e9c164b5e128bacd0e8d85636ad38208.svg
          fullname: Ark0810
          isHf: false
          isPro: false
          name: Ark0810
          type: user
        html: This comment has been hidden
        raw: This comment has been hidden
        updatedAt: '2023-07-31T03:10:21.987Z'
      numEdits: 0
      reactions: []
    id: 64c7230a725ffa04b2119829
    type: comment
  author: Ark0810
  content: This comment has been hidden
  created_at: 2023-07-31 01:57:14+00:00
  edited: true
  hidden: true
  id: 64c7230a725ffa04b2119829
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e9c164b5e128bacd0e8d85636ad38208.svg
      fullname: Ark0810
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Ark0810
      type: user
    createdAt: '2023-07-31T03:15:28.000Z'
    data:
      edited: false
      editors:
      - Ark0810
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.3989577889442444
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e9c164b5e128bacd0e8d85636ad38208.svg
          fullname: Ark0810
          isHf: false
          isPro: false
          name: Ark0810
          type: user
        html: "<p>OK \u591A\u8C22\u4E86\uFF0C \u6211\u67E5\u5230\u540C\u6837\u53EF\
          \u4EE5\u8FD9\u6837pooling</p>\n<pre><code>import torch\npooler = torch.mean(outputs.last_hidden_state,\
          \ 1)\n</code></pre>\n"
        raw: "OK \u591A\u8C22\u4E86\uFF0C \u6211\u67E5\u5230\u540C\u6837\u53EF\u4EE5\
          \u8FD9\u6837pooling\n```\nimport torch\npooler = torch.mean(outputs.last_hidden_state,\
          \ 1)\n```"
        updatedAt: '2023-07-31T03:15:28.720Z'
      numEdits: 0
      reactions: []
    id: 64c7275077a6473ac31f8593
    type: comment
  author: Ark0810
  content: "OK \u591A\u8C22\u4E86\uFF0C \u6211\u67E5\u5230\u540C\u6837\u53EF\u4EE5\
    \u8FD9\u6837pooling\n```\nimport torch\npooler = torch.mean(outputs.last_hidden_state,\
    \ 1)\n```"
  created_at: 2023-07-31 02:15:28+00:00
  edited: false
  hidden: false
  id: 64c7275077a6473ac31f8593
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/65f534909b6de1ad1ce8e8b7ee0843ed.svg
      fullname: Fu Fan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: habaneraa
      type: user
    createdAt: '2023-07-31T03:31:54.000Z'
    data:
      edited: false
      editors:
      - habaneraa
      hidden: false
      identifiedLanguage:
        language: zh
        probability: 0.3447873890399933
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/65f534909b6de1ad1ce8e8b7ee0843ed.svg
          fullname: Fu Fan
          isHf: false
          isPro: false
          name: habaneraa
          type: user
        html: "<p>\u53EF\u4EE5\u7684\uFF0Cm3e \u6A21\u578B\u4F7F\u7528\u7684\u65B9\
          \u6CD5\u662F\u5C06\u6240\u6709 token embedding \u5411\u91CF\u4F5C\u5E73\u5747\
          \uFF0C\u5728 <code>sentence-transformers</code> \u8FD9\u4E2A\u5305\u91CC\
          \u53EF\u4EE5\u627E\u5230\u76F8\u5173\u6E90\u7801\uFF0C\u662F\u4F7F\u7528\
          \ pytorch \u5B9E\u73B0\u7684</p>\n<p>\u4EE3\u7801\u6765\u81EA <a rel=\"\
          nofollow\" href=\"https://github.com/UKPLab/sentence-transformers/blob/179b659621c680371394d507683b25ba7faa0dd8/sentence_transformers/models/Pooling.py#L98-L113\"\
          >https://github.com/UKPLab/sentence-transformers/blob/179b659621c680371394d507683b25ba7faa0dd8/sentence_transformers/models/Pooling.py#L98-L113</a></p>\n\
          <pre><code class=\"language-python\">        <span class=\"hljs-keyword\"\
          >if</span> self.pooling_mode_mean_tokens <span class=\"hljs-keyword\">or</span>\
          \ self.pooling_mode_mean_sqrt_len_tokens:\n            input_mask_expanded\
          \ = attention_mask.unsqueeze(-<span class=\"hljs-number\">1</span>).expand(token_embeddings.size()).<span\
          \ class=\"hljs-built_in\">float</span>()\n            sum_embeddings = torch.<span\
          \ class=\"hljs-built_in\">sum</span>(token_embeddings * input_mask_expanded,\
          \ <span class=\"hljs-number\">1</span>)\n\n            <span class=\"hljs-comment\"\
          >#If tokens are weighted (by WordWeights layer), feature 'token_weights_sum'\
          \ will be present</span>\n            <span class=\"hljs-keyword\">if</span>\
          \ <span class=\"hljs-string\">'token_weights_sum'</span> <span class=\"\
          hljs-keyword\">in</span> features:\n                sum_mask = features[<span\
          \ class=\"hljs-string\">'token_weights_sum'</span>].unsqueeze(-<span class=\"\
          hljs-number\">1</span>).expand(sum_embeddings.size())\n            <span\
          \ class=\"hljs-keyword\">else</span>:\n                sum_mask = input_mask_expanded.<span\
          \ class=\"hljs-built_in\">sum</span>(<span class=\"hljs-number\">1</span>)\n\
          \n            sum_mask = torch.clamp(sum_mask, <span class=\"hljs-built_in\"\
          >min</span>=<span class=\"hljs-number\">1e-9</span>)\n\n            <span\
          \ class=\"hljs-keyword\">if</span> self.pooling_mode_mean_tokens:\n    \
          \            output_vectors.append(sum_embeddings / sum_mask)\n        \
          \    <span class=\"hljs-keyword\">if</span> self.pooling_mode_mean_sqrt_len_tokens:\n\
          \                output_vectors.append(sum_embeddings / torch.sqrt(sum_mask))\n\
          </code></pre>\n<p>\u8FD9\u4E0A\u9762\u7684 <code>token_embeddings</code>\
          \ \u5B9E\u9645\u4E0A\u5C31\u662F <code>last_hidden_state</code> (\u5BF9\u4E8E\
          \ Bert \u8FD9\u79CD\u6A21\u578B\uFF0C\u5B83\u8F93\u51FA\u7684 last_hidden_state\
          \ \u5C31\u662F\u6BCF\u4E2A\u8F93\u5165 token \u5BF9\u5E94\u7684\u5411\u91CF\
          \u8868\u793A)\uFF0C\u4E0A\u9762\u8FD9\u6BB5\u4EE3\u7801\u5B9E\u9645\u4E0A\
          \u5C31\u662F\u6839\u636E mask \u628A\u6240\u6709\u5411\u91CF\u6C42\u548C\
          \u518D\u9664\u4EE5\u957F\u5EA6</p>\n"
        raw: "\u53EF\u4EE5\u7684\uFF0Cm3e \u6A21\u578B\u4F7F\u7528\u7684\u65B9\u6CD5\
          \u662F\u5C06\u6240\u6709 token embedding \u5411\u91CF\u4F5C\u5E73\u5747\uFF0C\
          \u5728 `sentence-transformers` \u8FD9\u4E2A\u5305\u91CC\u53EF\u4EE5\u627E\
          \u5230\u76F8\u5173\u6E90\u7801\uFF0C\u662F\u4F7F\u7528 pytorch \u5B9E\u73B0\
          \u7684\n\n\u4EE3\u7801\u6765\u81EA https://github.com/UKPLab/sentence-transformers/blob/179b659621c680371394d507683b25ba7faa0dd8/sentence_transformers/models/Pooling.py#L98-L113\n\
          \n```python\n        if self.pooling_mode_mean_tokens or self.pooling_mode_mean_sqrt_len_tokens:\n\
          \            input_mask_expanded = attention_mask.unsqueeze(-1).expand(token_embeddings.size()).float()\n\
          \            sum_embeddings = torch.sum(token_embeddings * input_mask_expanded,\
          \ 1)\n\n            #If tokens are weighted (by WordWeights layer), feature\
          \ 'token_weights_sum' will be present\n            if 'token_weights_sum'\
          \ in features:\n                sum_mask = features['token_weights_sum'].unsqueeze(-1).expand(sum_embeddings.size())\n\
          \            else:\n                sum_mask = input_mask_expanded.sum(1)\n\
          \n            sum_mask = torch.clamp(sum_mask, min=1e-9)\n\n           \
          \ if self.pooling_mode_mean_tokens:\n                output_vectors.append(sum_embeddings\
          \ / sum_mask)\n            if self.pooling_mode_mean_sqrt_len_tokens:\n\
          \                output_vectors.append(sum_embeddings / torch.sqrt(sum_mask))\n\
          ```\n\n\u8FD9\u4E0A\u9762\u7684 `token_embeddings` \u5B9E\u9645\u4E0A\u5C31\
          \u662F `last_hidden_state` (\u5BF9\u4E8E Bert \u8FD9\u79CD\u6A21\u578B\uFF0C\
          \u5B83\u8F93\u51FA\u7684 last_hidden_state \u5C31\u662F\u6BCF\u4E2A\u8F93\
          \u5165 token \u5BF9\u5E94\u7684\u5411\u91CF\u8868\u793A)\uFF0C\u4E0A\u9762\
          \u8FD9\u6BB5\u4EE3\u7801\u5B9E\u9645\u4E0A\u5C31\u662F\u6839\u636E mask\
          \ \u628A\u6240\u6709\u5411\u91CF\u6C42\u548C\u518D\u9664\u4EE5\u957F\u5EA6"
        updatedAt: '2023-07-31T03:31:54.988Z'
      numEdits: 0
      reactions: []
    id: 64c72b2a25816966660d808f
    type: comment
  author: habaneraa
  content: "\u53EF\u4EE5\u7684\uFF0Cm3e \u6A21\u578B\u4F7F\u7528\u7684\u65B9\u6CD5\
    \u662F\u5C06\u6240\u6709 token embedding \u5411\u91CF\u4F5C\u5E73\u5747\uFF0C\u5728\
    \ `sentence-transformers` \u8FD9\u4E2A\u5305\u91CC\u53EF\u4EE5\u627E\u5230\u76F8\
    \u5173\u6E90\u7801\uFF0C\u662F\u4F7F\u7528 pytorch \u5B9E\u73B0\u7684\n\n\u4EE3\
    \u7801\u6765\u81EA https://github.com/UKPLab/sentence-transformers/blob/179b659621c680371394d507683b25ba7faa0dd8/sentence_transformers/models/Pooling.py#L98-L113\n\
    \n```python\n        if self.pooling_mode_mean_tokens or self.pooling_mode_mean_sqrt_len_tokens:\n\
    \            input_mask_expanded = attention_mask.unsqueeze(-1).expand(token_embeddings.size()).float()\n\
    \            sum_embeddings = torch.sum(token_embeddings * input_mask_expanded,\
    \ 1)\n\n            #If tokens are weighted (by WordWeights layer), feature 'token_weights_sum'\
    \ will be present\n            if 'token_weights_sum' in features:\n         \
    \       sum_mask = features['token_weights_sum'].unsqueeze(-1).expand(sum_embeddings.size())\n\
    \            else:\n                sum_mask = input_mask_expanded.sum(1)\n\n\
    \            sum_mask = torch.clamp(sum_mask, min=1e-9)\n\n            if self.pooling_mode_mean_tokens:\n\
    \                output_vectors.append(sum_embeddings / sum_mask)\n          \
    \  if self.pooling_mode_mean_sqrt_len_tokens:\n                output_vectors.append(sum_embeddings\
    \ / torch.sqrt(sum_mask))\n```\n\n\u8FD9\u4E0A\u9762\u7684 `token_embeddings`\
    \ \u5B9E\u9645\u4E0A\u5C31\u662F `last_hidden_state` (\u5BF9\u4E8E Bert \u8FD9\
    \u79CD\u6A21\u578B\uFF0C\u5B83\u8F93\u51FA\u7684 last_hidden_state \u5C31\u662F\
    \u6BCF\u4E2A\u8F93\u5165 token \u5BF9\u5E94\u7684\u5411\u91CF\u8868\u793A)\uFF0C\
    \u4E0A\u9762\u8FD9\u6BB5\u4EE3\u7801\u5B9E\u9645\u4E0A\u5C31\u662F\u6839\u636E\
    \ mask \u628A\u6240\u6709\u5411\u91CF\u6C42\u548C\u518D\u9664\u4EE5\u957F\u5EA6"
  created_at: 2023-07-31 02:31:54+00:00
  edited: false
  hidden: false
  id: 64c72b2a25816966660d808f
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/65f534909b6de1ad1ce8e8b7ee0843ed.svg
      fullname: Fu Fan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: habaneraa
      type: user
    createdAt: '2023-07-31T03:34:30.000Z'
    data:
      edited: false
      editors:
      - habaneraa
      hidden: false
      identifiedLanguage:
        language: zh
        probability: 0.9725784659385681
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/65f534909b6de1ad1ce8e8b7ee0843ed.svg
          fullname: Fu Fan
          isHf: false
          isPro: false
          name: habaneraa
          type: user
        html: "<p>\u76F4\u63A5\u6C42\u5E73\u5747\u7684\u8BDD\uFF0C\u53EF\u80FD\u4F1A\
          \u6709\u4EA7\u751F\u504F\u5DEE\uFF0C\u5982\u679C\u591A\u4E2A\u53E5\u5B50\
          \u540C\u65F6\u8FDB\u53BB\uFF0Ctokenizer \u4F1A\u628A\u6240\u6709\u5E8F\u5217\
          \ pad \u5230\u4E00\u4E2A\u56FA\u5B9A\u957F\u5EA6\uFF0C\u7136\u540E\u7528\
          \ attention mask \u544A\u8BC9\u6A21\u578B\u90A3\u4E9B pad tokens \u4E0D\u53C2\
          \u4E0E\u8BA1\u7B97\uFF0C\u5982\u679C\u76F4\u63A5\u6C42\u5E73\u5747\uFF0C\
          \u4F1A\u628A\u90A3\u4E9B pad tokens \u7B97\u8FDB\u53BB\u7684</p>\n"
        raw: "\u76F4\u63A5\u6C42\u5E73\u5747\u7684\u8BDD\uFF0C\u53EF\u80FD\u4F1A\u6709\
          \u4EA7\u751F\u504F\u5DEE\uFF0C\u5982\u679C\u591A\u4E2A\u53E5\u5B50\u540C\
          \u65F6\u8FDB\u53BB\uFF0Ctokenizer \u4F1A\u628A\u6240\u6709\u5E8F\u5217 pad\
          \ \u5230\u4E00\u4E2A\u56FA\u5B9A\u957F\u5EA6\uFF0C\u7136\u540E\u7528 attention\
          \ mask \u544A\u8BC9\u6A21\u578B\u90A3\u4E9B pad tokens \u4E0D\u53C2\u4E0E\
          \u8BA1\u7B97\uFF0C\u5982\u679C\u76F4\u63A5\u6C42\u5E73\u5747\uFF0C\u4F1A\
          \u628A\u90A3\u4E9B pad tokens \u7B97\u8FDB\u53BB\u7684"
        updatedAt: '2023-07-31T03:34:30.072Z'
      numEdits: 0
      reactions:
      - count: 2
        reaction: "\U0001F44D"
        users:
        - MokaHR
        - Ark0810
    id: 64c72bc69cff58f22c595376
    type: comment
  author: habaneraa
  content: "\u76F4\u63A5\u6C42\u5E73\u5747\u7684\u8BDD\uFF0C\u53EF\u80FD\u4F1A\u6709\
    \u4EA7\u751F\u504F\u5DEE\uFF0C\u5982\u679C\u591A\u4E2A\u53E5\u5B50\u540C\u65F6\
    \u8FDB\u53BB\uFF0Ctokenizer \u4F1A\u628A\u6240\u6709\u5E8F\u5217 pad \u5230\u4E00\
    \u4E2A\u56FA\u5B9A\u957F\u5EA6\uFF0C\u7136\u540E\u7528 attention mask \u544A\u8BC9\
    \u6A21\u578B\u90A3\u4E9B pad tokens \u4E0D\u53C2\u4E0E\u8BA1\u7B97\uFF0C\u5982\
    \u679C\u76F4\u63A5\u6C42\u5E73\u5747\uFF0C\u4F1A\u628A\u90A3\u4E9B pad tokens\
    \ \u7B97\u8FDB\u53BB\u7684"
  created_at: 2023-07-31 02:34:30+00:00
  edited: false
  hidden: false
  id: 64c72bc69cff58f22c595376
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/NbjjEhhwMdzDz-jdOrwdu.png?w=200&h=200&f=face
      fullname: Moka HR SaSS
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: MokaHR
      type: user
    createdAt: '2023-08-02T02:59:36.000Z'
    data:
      edited: false
      editors:
      - MokaHR
      hidden: false
      identifiedLanguage:
        language: zh
        probability: 0.7695848941802979
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/NbjjEhhwMdzDz-jdOrwdu.png?w=200&h=200&f=face
          fullname: Moka HR SaSS
          isHf: false
          isPro: false
          name: MokaHR
          type: user
        html: "<p>\u611F\u8C22 <span data-props=\"{&quot;user&quot;:&quot;habaneraa&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/habaneraa\"\
          >@<span class=\"underline\">habaneraa</span></a></span>\n\n\t</span></span>\
          \  \u7684\u89E3\u91CA\uFF0C\u5168\u9762\u4E14\u6B63\u786E\u3002\U0001F44D\
          </p>\n"
        raw: "\u611F\u8C22 @habaneraa  \u7684\u89E3\u91CA\uFF0C\u5168\u9762\u4E14\u6B63\
          \u786E\u3002\U0001F44D"
        updatedAt: '2023-08-02T02:59:36.305Z'
      numEdits: 0
      reactions: []
    id: 64c9c6988d16364a6fcfe760
    type: comment
  author: MokaHR
  content: "\u611F\u8C22 @habaneraa  \u7684\u89E3\u91CA\uFF0C\u5168\u9762\u4E14\u6B63\
    \u786E\u3002\U0001F44D"
  created_at: 2023-08-02 01:59:36+00:00
  edited: false
  hidden: false
  id: 64c9c6988d16364a6fcfe760
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/e9c164b5e128bacd0e8d85636ad38208.svg
      fullname: Ark0810
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Ark0810
      type: user
    createdAt: '2023-08-17T09:11:07.000Z'
    data:
      status: closed
    id: 64dde42b1dd8a37286660424
    type: status-change
  author: Ark0810
  created_at: 2023-08-17 08:11:07+00:00
  id: 64dde42b1dd8a37286660424
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 16
repo_id: moka-ai/m3e-base
repo_type: model
status: closed
target_branch: null
title: "\u8BF7\u95EE\u4E0B\uFF1A\u8BE5\u6A21\u578B\u8FD4\u56DE\u7684\u5F20\u91CF\u4E0D\
  \u662F\u5B9A\u957F\u7684"
