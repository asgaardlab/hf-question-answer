!!python/object:huggingface_hub.community.DiscussionWithDetails
author: JaimeLugo
conflicting_files: null
created_at: 2024-01-19 15:10:12+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/8613a2b60856b6d5a7b49c2fdf82f9e8.svg
      fullname: Jaime Lugo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: JaimeLugo
      type: user
    createdAt: '2024-01-19T15:10:12.000Z'
    data:
      edited: false
      editors:
      - JaimeLugo
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6791057586669922
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/8613a2b60856b6d5a7b49c2fdf82f9e8.svg
          fullname: Jaime Lugo
          isHf: false
          isPro: false
          name: JaimeLugo
          type: user
        html: '<p>Perhaps I am using the wrong input message... but i am struggling
          to have consistent answers without additional jargon! - most of the time
          it translates and then adds an extra conversation... or doesn''t translate
          and says "translation was excellent"..(quite funny actually)</p>

          <p>I tested the settings below...<br>conversation = [  {''role'': ''user'',
          ''content'': f''Translate the input text into Spanish: \n Input Text: {chstory}''}]
          </p>

          <p> outputs = model.generate(**inputs, use_cache=True, max_length=1500)<br>
          outputs = model.generate(**inputs, use_cache=True, max_length=1500, top_k=40,
          prompt_lookup_num_tokens=10,  do_sample=True)</p>

          '
        raw: "Perhaps I am using the wrong input message... but i am struggling to\
          \ have consistent answers without additional jargon! - most of the time\
          \ it translates and then adds an extra conversation... or doesn't translate\
          \ and says \"translation was excellent\"..(quite funny actually)\r\n\r\n\
          I tested the settings below...\r\nconversation = [  {'role': 'user', 'content':\
          \ f'Translate the input text into Spanish: \\n Input Text: {chstory}'}]\
          \ \r\n\r\n outputs = model.generate(**inputs, use_cache=True, max_length=1500)\r\
          \n outputs = model.generate(**inputs, use_cache=True, max_length=1500, top_k=40,\
          \ prompt_lookup_num_tokens=10,  do_sample=True)\r\n"
        updatedAt: '2024-01-19T15:10:12.599Z'
      numEdits: 0
      reactions: []
    id: 65aa90d45c84d7d5e7c4fc63
    type: comment
  author: JaimeLugo
  content: "Perhaps I am using the wrong input message... but i am struggling to have\
    \ consistent answers without additional jargon! - most of the time it translates\
    \ and then adds an extra conversation... or doesn't translate and says \"translation\
    \ was excellent\"..(quite funny actually)\r\n\r\nI tested the settings below...\r\
    \nconversation = [  {'role': 'user', 'content': f'Translate the input text into\
    \ Spanish: \\n Input Text: {chstory}'}] \r\n\r\n outputs = model.generate(**inputs,\
    \ use_cache=True, max_length=1500)\r\n outputs = model.generate(**inputs, use_cache=True,\
    \ max_length=1500, top_k=40, prompt_lookup_num_tokens=10,  do_sample=True)\r\n"
  created_at: 2024-01-19 15:10:12+00:00
  edited: false
  hidden: false
  id: 65aa90d45c84d7d5e7c4fc63
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/b824aeeaf25016b775589119436f9875.svg
      fullname: Nuno Guerreiro
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: nunonmg
      type: user
    createdAt: '2024-01-22T11:23:55.000Z'
    data:
      edited: false
      editors:
      - nunonmg
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8979818820953369
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/b824aeeaf25016b775589119436f9875.svg
          fullname: Nuno Guerreiro
          isHf: false
          isPro: false
          name: nunonmg
          type: user
        html: '<p>Hi JaimeLugo,<br>Could you please send an example of "{chstory}"
          so we can try to replicate the error in our end?<br>It is possible that
          there might be a slight prompt mismatch, i.e., you may not be using the
          optimal prompt (we have a list of possible prompts for MT in <a href="https://huggingface.co/datasets/Unbabel/TowerBlocks-v0.1">https://huggingface.co/datasets/Unbabel/TowerBlocks-v0.1</a>
          (just filter the task for machine_translation and you''ll find all types
          of prompts there --- there are many to choose from). Our evaluation was
          conducted using the prompt in the model card.</p>

          '
        raw: 'Hi JaimeLugo,

          Could you please send an example of "{chstory}" so we can try to replicate
          the error in our end?

          It is possible that there might be a slight prompt mismatch, i.e., you may
          not be using the optimal prompt (we have a list of possible prompts for
          MT in https://huggingface.co/datasets/Unbabel/TowerBlocks-v0.1 (just filter
          the task for machine_translation and you''ll find all types of prompts there
          --- there are many to choose from). Our evaluation was conducted using the
          prompt in the model card.'
        updatedAt: '2024-01-22T11:23:55.698Z'
      numEdits: 0
      reactions: []
    id: 65ae504b5033724f453cdeec
    type: comment
  author: nunonmg
  content: 'Hi JaimeLugo,

    Could you please send an example of "{chstory}" so we can try to replicate the
    error in our end?

    It is possible that there might be a slight prompt mismatch, i.e., you may not
    be using the optimal prompt (we have a list of possible prompts for MT in https://huggingface.co/datasets/Unbabel/TowerBlocks-v0.1
    (just filter the task for machine_translation and you''ll find all types of prompts
    there --- there are many to choose from). Our evaluation was conducted using the
    prompt in the model card.'
  created_at: 2024-01-22 11:23:55+00:00
  edited: false
  hidden: false
  id: 65ae504b5033724f453cdeec
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/64132452d8a418df415a6ded/H9C5KINWX4hq0iOoyj7Sy.jpeg?w=200&h=200&f=face
      fullname: Duarte Alves
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: DuarteMRAlves
      type: user
    createdAt: '2024-01-23T16:01:16.000Z'
    data:
      edited: false
      editors:
      - DuarteMRAlves
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9041137099266052
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/64132452d8a418df415a6ded/H9C5KINWX4hq0iOoyj7Sy.jpeg?w=200&h=200&f=face
          fullname: Duarte Alves
          isHf: false
          isPro: false
          name: DuarteMRAlves
          type: user
        html: '<p>Hi JaimeLugo,</p>

          <p>Adding to the previous answer, we noticed generation_config.json for
          the model had the incorrect eos_token_id (only the tokenizer had the correct
          one), causing it to not stop the generation. It should have been fixed,
          you just need to redownload the model.</p>

          <p>Look here for more info: <a href="https://huggingface.co/Unbabel/TowerInstruct-7B-v0.1/discussions/4">https://huggingface.co/Unbabel/TowerInstruct-7B-v0.1/discussions/4</a>.</p>

          '
        raw: 'Hi JaimeLugo,


          Adding to the previous answer, we noticed generation_config.json for the
          model had the incorrect eos_token_id (only the tokenizer had the correct
          one), causing it to not stop the generation. It should have been fixed,
          you just need to redownload the model.


          Look here for more info: https://huggingface.co/Unbabel/TowerInstruct-7B-v0.1/discussions/4.'
        updatedAt: '2024-01-23T16:01:16.989Z'
      numEdits: 0
      reactions: []
    id: 65afe2cc04655dc934dc622c
    type: comment
  author: DuarteMRAlves
  content: 'Hi JaimeLugo,


    Adding to the previous answer, we noticed generation_config.json for the model
    had the incorrect eos_token_id (only the tokenizer had the correct one), causing
    it to not stop the generation. It should have been fixed, you just need to redownload
    the model.


    Look here for more info: https://huggingface.co/Unbabel/TowerInstruct-7B-v0.1/discussions/4.'
  created_at: 2024-01-23 16:01:16+00:00
  edited: false
  hidden: false
  id: 65afe2cc04655dc934dc622c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/8613a2b60856b6d5a7b49c2fdf82f9e8.svg
      fullname: Jaime Lugo
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: JaimeLugo
      type: user
    createdAt: '2024-01-24T11:04:43.000Z'
    data:
      edited: false
      editors:
      - JaimeLugo
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9554506540298462
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/8613a2b60856b6d5a7b49c2fdf82f9e8.svg
          fullname: Jaime Lugo
          isHf: false
          isPro: false
          name: JaimeLugo
          type: user
        html: "<p>Hey DuarteMRAlves</p>\n<p>I confirm the consistency has improved\
          \ significantly... but still errors happen. For example, it once gave me\
          \ this response \"20: What? What the actual fuck?!'&lt;|im_end|&gt;\" so\
          \ it didn't translate at all, and I gave 1500 tokens as input...</p>\n<p>Here\
          \ is my prompt and chinfo as a reference:</p>\n<pre><code>  conversation\
          \ = [  {'role': 'user', 'content': f'Translate the input text into Spanish:\
          \ \\n Input Text: {chstory}'}] \n  prompt = tokenizer.apply_chat_template(conversation,\
          \ tokenize=False, add_generation_prompt=True)\n\n  inputs = tokenizer(prompt,\
          \ return_tensors=\"pt\").to(model.device) \n  outputs = model.generate(**inputs,\
          \ use_cache=True, pad_token_id=tokenizer.eos_token_id, max_length=4000 \
          \ , top_k=25, prompt_lookup_num_tokens=10,  do_sample=True)\n  output_text\
          \ = tokenizer.decode(outputs[0]) \n\n  \"ChInfo\": \"0 | Chapter 2: Slave\
          \ Caravan\\n1 | Sunny dreamt of a mountain.\\n2 | Jagged and lonesome, it\
          \ dwarfed other peaks of the mountain chain, cutting the night sky with\
          \ its sharp edges. A radiant moon bathed its slopes in the ghostly, pale\
          \ light.\\n3 | On one of the slopes, the remnants of an old road stubbornly\
          \ clung to the rocks. Here and there, weathered paved stones could be seen\
          \ through the snow. To the right side of the road, a sheer cliff face rose\
          \ as an impregnable wall. To the left, a silent black sea of nothingness\
          \ indicated an endless fall. Strong winds crashed into the mountain over\
          \ and over again, screaming in powerless rage.\\n4 | Suddenly, the moon\
          \ fell over the horizon. The sun rose from the west, streaked across the\
          \ sky and disappeared in the east. Snowflakes jumped from the ground and\
          \ returned into the embrace of clouds. Sunny realized that he was seeing\
          \ the flow of time in reverse.\\n5 | In an instant, hundreds of years flew\
          \ by. The snow retreated, baring the old road. Cold shivers ran down Sunny's\
          \ back as he noticed human bones littering the ground. A moment later, the\
          \ bones were gone, and in their place, a slave caravan appeared, moving\
          \ backwards down the mountain in the clamor of chains.\\n6 | Time slowed,\
          \ stopped, and then resumed its usual pace.\\n7 | [Aspirant! Welcome to\
          \ the Nightmare Spell. Prepare for your First Trial\u2026]\\n8 | What\u2026\
          \ what the hell is this?'\\n9 | Step. Step. Another step.\\n10 | A dull\
          \ ache was radiating through Sunny's bleeding feet as he was shivering from\
          \ cold. His threadbare tunic was nearly useless against the biting wind.\
          \ His wrists were the main source of agony: badly hurt by the iron shackles,\
          \ they sent a sharp pang of pain every time the freezing metal touched his\
          \ broken skin.\\n11 | What kind of a situation is this?!'\\n12 | Sunny looked\
          \ up and down, noticing a long chain winding up the road, with dozens and\
          \ dozens of hollow-eyed people \u2014 slaves just like him \u2014 shackled\
          \ to it at small intervals. Ahead of him, a man with broad shoulders and\
          \ a bloodied back was walking with a measured gait. Behind him, a shifty-looking\
          \ guy with quick, desperate eyes was quietly cursing under his breath in\
          \ a language that Sunny did not know, but somehow still understood. From\
          \ time to time, armed horsemen in ancient-style armor would pass by, giving\
          \ the slaves menacing looks.\\n13 | However you judged it, things were really\
          \ bad.\\n14 | Sunny was more bewildered than panicked. True, these circumstances\
          \ were not like what the First Nightmares were supposed to be. Usually,\
          \ freshly chosen aspirants would find themselves in a scenario that presented\
          \ them with a fair amount of agency: they would become members of privileged\
          \ or warrior casts, with plenty of access to necessary weapons to at least\
          \ try to tackle any conflict.\\n15 | Starting out as a powerless slave,\
          \ shackled and already half-dead, was as far from being ideal as one could\
          \ imagine.\\n16 | However, the Spell was as much about challenge as it was\
          \ about balance. As the old policeman said, it created trials, not executions.\
          \ So Sunny was pretty sure that, to counter this abysmal start, it would\
          \ reward him with something good. A powerful Aspect, at least.\\n17 | Let's\
          \ see\u2026 how do I do this?'\"\n</code></pre>\n"
        raw: "Hey DuarteMRAlves\n\nI confirm the consistency has improved significantly...\
          \ but still errors happen. For example, it once gave me this response \"\
          20: What? What the actual fuck?!'<|im_end|>\" so it didn't translate at\
          \ all, and I gave 1500 tokens as input...\n\nHere is my prompt and chinfo\
          \ as a reference:\n\n      conversation = [  {'role': 'user', 'content':\
          \ f'Translate the input text into Spanish: \\n Input Text: {chstory}'}]\
          \ \n      prompt = tokenizer.apply_chat_template(conversation, tokenize=False,\
          \ add_generation_prompt=True)\n\n      inputs = tokenizer(prompt, return_tensors=\"\
          pt\").to(model.device) \n      outputs = model.generate(**inputs, use_cache=True,\
          \ pad_token_id=tokenizer.eos_token_id, max_length=4000  , top_k=25, prompt_lookup_num_tokens=10,\
          \  do_sample=True)\n      output_text = tokenizer.decode(outputs[0]) \n\
          \  \n      \"ChInfo\": \"0 | Chapter 2: Slave Caravan\\n1 | Sunny dreamt\
          \ of a mountain.\\n2 | Jagged and lonesome, it dwarfed other peaks of the\
          \ mountain chain, cutting the night sky with its sharp edges. A radiant\
          \ moon bathed its slopes in the ghostly, pale light.\\n3 | On one of the\
          \ slopes, the remnants of an old road stubbornly clung to the rocks. Here\
          \ and there, weathered paved stones could be seen through the snow. To the\
          \ right side of the road, a sheer cliff face rose as an impregnable wall.\
          \ To the left, a silent black sea of nothingness indicated an endless fall.\
          \ Strong winds crashed into the mountain over and over again, screaming\
          \ in powerless rage.\\n4 | Suddenly, the moon fell over the horizon. The\
          \ sun rose from the west, streaked across the sky and disappeared in the\
          \ east. Snowflakes jumped from the ground and returned into the embrace\
          \ of clouds. Sunny realized that he was seeing the flow of time in reverse.\\\
          n5 | In an instant, hundreds of years flew by. The snow retreated, baring\
          \ the old road. Cold shivers ran down Sunny's back as he noticed human bones\
          \ littering the ground. A moment later, the bones were gone, and in their\
          \ place, a slave caravan appeared, moving backwards down the mountain in\
          \ the clamor of chains.\\n6 | Time slowed, stopped, and then resumed its\
          \ usual pace.\\n7 | [Aspirant! Welcome to the Nightmare Spell. Prepare for\
          \ your First Trial\u2026]\\n8 | What\u2026 what the hell is this?'\\n9 |\
          \ Step. Step. Another step.\\n10 | A dull ache was radiating through Sunny's\
          \ bleeding feet as he was shivering from cold. His threadbare tunic was\
          \ nearly useless against the biting wind. His wrists were the main source\
          \ of agony: badly hurt by the iron shackles, they sent a sharp pang of pain\
          \ every time the freezing metal touched his broken skin.\\n11 | What kind\
          \ of a situation is this?!'\\n12 | Sunny looked up and down, noticing a\
          \ long chain winding up the road, with dozens and dozens of hollow-eyed\
          \ people \u2014 slaves just like him \u2014 shackled to it at small intervals.\
          \ Ahead of him, a man with broad shoulders and a bloodied back was walking\
          \ with a measured gait. Behind him, a shifty-looking guy with quick, desperate\
          \ eyes was quietly cursing under his breath in a language that Sunny did\
          \ not know, but somehow still understood. From time to time, armed horsemen\
          \ in ancient-style armor would pass by, giving the slaves menacing looks.\\\
          n13 | However you judged it, things were really bad.\\n14 | Sunny was more\
          \ bewildered than panicked. True, these circumstances were not like what\
          \ the First Nightmares were supposed to be. Usually, freshly chosen aspirants\
          \ would find themselves in a scenario that presented them with a fair amount\
          \ of agency: they would become members of privileged or warrior casts, with\
          \ plenty of access to necessary weapons to at least try to tackle any conflict.\\\
          n15 | Starting out as a powerless slave, shackled and already half-dead,\
          \ was as far from being ideal as one could imagine.\\n16 | However, the\
          \ Spell was as much about challenge as it was about balance. As the old\
          \ policeman said, it created trials, not executions. So Sunny was pretty\
          \ sure that, to counter this abysmal start, it would reward him with something\
          \ good. A powerful Aspect, at least.\\n17 | Let's see\u2026 how do I do\
          \ this?'\"\n  "
        updatedAt: '2024-01-24T11:04:43.725Z'
      numEdits: 0
      reactions: []
    id: 65b0eecb7febbcc2affdd944
    type: comment
  author: JaimeLugo
  content: "Hey DuarteMRAlves\n\nI confirm the consistency has improved significantly...\
    \ but still errors happen. For example, it once gave me this response \"20: What?\
    \ What the actual fuck?!'<|im_end|>\" so it didn't translate at all, and I gave\
    \ 1500 tokens as input...\n\nHere is my prompt and chinfo as a reference:\n\n\
    \      conversation = [  {'role': 'user', 'content': f'Translate the input text\
    \ into Spanish: \\n Input Text: {chstory}'}] \n      prompt = tokenizer.apply_chat_template(conversation,\
    \ tokenize=False, add_generation_prompt=True)\n\n      inputs = tokenizer(prompt,\
    \ return_tensors=\"pt\").to(model.device) \n      outputs = model.generate(**inputs,\
    \ use_cache=True, pad_token_id=tokenizer.eos_token_id, max_length=4000  , top_k=25,\
    \ prompt_lookup_num_tokens=10,  do_sample=True)\n      output_text = tokenizer.decode(outputs[0])\
    \ \n  \n      \"ChInfo\": \"0 | Chapter 2: Slave Caravan\\n1 | Sunny dreamt of\
    \ a mountain.\\n2 | Jagged and lonesome, it dwarfed other peaks of the mountain\
    \ chain, cutting the night sky with its sharp edges. A radiant moon bathed its\
    \ slopes in the ghostly, pale light.\\n3 | On one of the slopes, the remnants\
    \ of an old road stubbornly clung to the rocks. Here and there, weathered paved\
    \ stones could be seen through the snow. To the right side of the road, a sheer\
    \ cliff face rose as an impregnable wall. To the left, a silent black sea of nothingness\
    \ indicated an endless fall. Strong winds crashed into the mountain over and over\
    \ again, screaming in powerless rage.\\n4 | Suddenly, the moon fell over the horizon.\
    \ The sun rose from the west, streaked across the sky and disappeared in the east.\
    \ Snowflakes jumped from the ground and returned into the embrace of clouds. Sunny\
    \ realized that he was seeing the flow of time in reverse.\\n5 | In an instant,\
    \ hundreds of years flew by. The snow retreated, baring the old road. Cold shivers\
    \ ran down Sunny's back as he noticed human bones littering the ground. A moment\
    \ later, the bones were gone, and in their place, a slave caravan appeared, moving\
    \ backwards down the mountain in the clamor of chains.\\n6 | Time slowed, stopped,\
    \ and then resumed its usual pace.\\n7 | [Aspirant! Welcome to the Nightmare Spell.\
    \ Prepare for your First Trial\u2026]\\n8 | What\u2026 what the hell is this?'\\\
    n9 | Step. Step. Another step.\\n10 | A dull ache was radiating through Sunny's\
    \ bleeding feet as he was shivering from cold. His threadbare tunic was nearly\
    \ useless against the biting wind. His wrists were the main source of agony: badly\
    \ hurt by the iron shackles, they sent a sharp pang of pain every time the freezing\
    \ metal touched his broken skin.\\n11 | What kind of a situation is this?!'\\\
    n12 | Sunny looked up and down, noticing a long chain winding up the road, with\
    \ dozens and dozens of hollow-eyed people \u2014 slaves just like him \u2014 shackled\
    \ to it at small intervals. Ahead of him, a man with broad shoulders and a bloodied\
    \ back was walking with a measured gait. Behind him, a shifty-looking guy with\
    \ quick, desperate eyes was quietly cursing under his breath in a language that\
    \ Sunny did not know, but somehow still understood. From time to time, armed horsemen\
    \ in ancient-style armor would pass by, giving the slaves menacing looks.\\n13\
    \ | However you judged it, things were really bad.\\n14 | Sunny was more bewildered\
    \ than panicked. True, these circumstances were not like what the First Nightmares\
    \ were supposed to be. Usually, freshly chosen aspirants would find themselves\
    \ in a scenario that presented them with a fair amount of agency: they would become\
    \ members of privileged or warrior casts, with plenty of access to necessary weapons\
    \ to at least try to tackle any conflict.\\n15 | Starting out as a powerless slave,\
    \ shackled and already half-dead, was as far from being ideal as one could imagine.\\\
    n16 | However, the Spell was as much about challenge as it was about balance.\
    \ As the old policeman said, it created trials, not executions. So Sunny was pretty\
    \ sure that, to counter this abysmal start, it would reward him with something\
    \ good. A powerful Aspect, at least.\\n17 | Let's see\u2026 how do I do this?'\"\
    \n  "
  created_at: 2024-01-24 11:04:43+00:00
  edited: false
  hidden: false
  id: 65b0eecb7febbcc2affdd944
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 2
repo_id: Unbabel/TowerInstruct-7B-v0.1
repo_type: model
status: open
target_branch: null
title: Struggling to have it consistant
