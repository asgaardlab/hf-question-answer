!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Mr1gh
conflicting_files: null
created_at: 2023-06-13 17:45:37+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e8edf9127dc830edd3a9b2c89dc0f8ae.svg
      fullname: Marwan gh
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Mr1gh
      type: user
    createdAt: '2023-06-13T18:45:37.000Z'
    data:
      edited: false
      editors:
      - Mr1gh
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6100664734840393
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e8edf9127dc830edd3a9b2c89dc0f8ae.svg
          fullname: Marwan gh
          isHf: false
          isPro: false
          name: Mr1gh
          type: user
        html: '<pre><code>size mismatch for _mel_filters: copying a param with shape
          torch.Size([80, 201]) from checkpoint, the shape in current model is torch.Size([201,
          80]).

          </code></pre>

          <p>I just use the same code provided and get this error , when i transpode
          the mel_filters it load the model but when transcribing give matrix multiplication
          error :</p>

          <p>File /opt/conda/lib/python3.10/site-packages/speechbrain/lobes/models/huggingface_whisper.py:247,
          in HuggingFaceWhisper._log_mel_spectrogram(self, audio)<br>    244 magnitudes
          = stft[..., :-1].abs() ** 2<br>    246 filters = self._mel_filters<br>--&gt;
          247 mel_spec = filters @ magnitudes<br>    249 log_spec = torch.clamp(mel_spec,
          min=1e-10).log10()<br>    250 log_spec = torch.maximum(<br>    251     log_spec,<br>    252     (log_spec.flatten(start_dim=1).max(dim=-1)[0]
          - 8.0)[:, None, None],<br>    253 )</p>

          <p>RuntimeError: mat1 and mat2 shapes cannot be multiplied (3000x201 and
          80x201)</p>

          '
        raw: "\r\n\tsize mismatch for _mel_filters: copying a param with shape torch.Size([80,\
          \ 201]) from checkpoint, the shape in current model is torch.Size([201,\
          \ 80]).\r\n\r\nI just use the same code provided and get this error , when\
          \ i transpode the mel_filters it load the model but when transcribing give\
          \ matrix multiplication error :\r\n\r\nFile /opt/conda/lib/python3.10/site-packages/speechbrain/lobes/models/huggingface_whisper.py:247,\
          \ in HuggingFaceWhisper._log_mel_spectrogram(self, audio)\r\n    244 magnitudes\
          \ = stft[..., :-1].abs() ** 2\r\n    246 filters = self._mel_filters\r\n\
          --> 247 mel_spec = filters @ magnitudes\r\n    249 log_spec = torch.clamp(mel_spec,\
          \ min=1e-10).log10()\r\n    250 log_spec = torch.maximum(\r\n    251   \
          \  log_spec,\r\n    252     (log_spec.flatten(start_dim=1).max(dim=-1)[0]\
          \ - 8.0)[:, None, None],\r\n    253 )\r\n\r\nRuntimeError: mat1 and mat2\
          \ shapes cannot be multiplied (3000x201 and 80x201)"
        updatedAt: '2023-06-13T18:45:37.887Z'
      numEdits: 0
      reactions: []
    id: 6488b9515cf73a16e775eb78
    type: comment
  author: Mr1gh
  content: "\r\n\tsize mismatch for _mel_filters: copying a param with shape torch.Size([80,\
    \ 201]) from checkpoint, the shape in current model is torch.Size([201, 80]).\r\
    \n\r\nI just use the same code provided and get this error , when i transpode\
    \ the mel_filters it load the model but when transcribing give matrix multiplication\
    \ error :\r\n\r\nFile /opt/conda/lib/python3.10/site-packages/speechbrain/lobes/models/huggingface_whisper.py:247,\
    \ in HuggingFaceWhisper._log_mel_spectrogram(self, audio)\r\n    244 magnitudes\
    \ = stft[..., :-1].abs() ** 2\r\n    246 filters = self._mel_filters\r\n--> 247\
    \ mel_spec = filters @ magnitudes\r\n    249 log_spec = torch.clamp(mel_spec,\
    \ min=1e-10).log10()\r\n    250 log_spec = torch.maximum(\r\n    251     log_spec,\r\
    \n    252     (log_spec.flatten(start_dim=1).max(dim=-1)[0] - 8.0)[:, None, None],\r\
    \n    253 )\r\n\r\nRuntimeError: mat1 and mat2 shapes cannot be multiplied (3000x201\
    \ and 80x201)"
  created_at: 2023-06-13 17:45:37+00:00
  edited: false
  hidden: false
  id: 6488b9515cf73a16e775eb78
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1674648410294-6316f98723ac76623d5b8d0e.png?w=200&h=200&f=face
      fullname: Adel Moumen
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: Adel-Moumen
      type: user
    createdAt: '2023-06-13T18:46:14.000Z'
    data:
      edited: false
      editors:
      - Adel-Moumen
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9820722937583923
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1674648410294-6316f98723ac76623d5b8d0e.png?w=200&h=200&f=face
          fullname: Adel Moumen
          isHf: false
          isPro: false
          name: Adel-Moumen
          type: user
        html: '<p>Hello, </p>

          <p>which version of PyTorch are you using? </p>

          '
        raw: "Hello, \n\nwhich version of PyTorch are you using? "
        updatedAt: '2023-06-13T18:46:14.877Z'
      numEdits: 0
      reactions: []
    id: 6488b976ff2d5d42e6de8632
    type: comment
  author: Adel-Moumen
  content: "Hello, \n\nwhich version of PyTorch are you using? "
  created_at: 2023-06-13 17:46:14+00:00
  edited: false
  hidden: false
  id: 6488b976ff2d5d42e6de8632
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e8edf9127dc830edd3a9b2c89dc0f8ae.svg
      fullname: Marwan gh
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Mr1gh
      type: user
    createdAt: '2023-06-14T12:20:48.000Z'
    data:
      edited: false
      editors:
      - Mr1gh
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8630943894386292
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e8edf9127dc830edd3a9b2c89dc0f8ae.svg
          fullname: Marwan gh
          isHf: false
          isPro: false
          name: Mr1gh
          type: user
        html: '<blockquote>

          <p>Hello, </p>

          <p>which version of PyTorch are you using?</p>

          </blockquote>

          <p>Hello   torch.<strong>version</strong>    ''2.0.0+cu117''</p>

          <p>It works when I reshape the feature_extractor.filter on speechbrain in
          /speechbrain/lobes/models/huggingface_whisper.py</p>

          <p>but I don''t know if this is a good way to fix it </p>

          '
        raw: "> Hello, \n> \n> which version of PyTorch are you using?\n\nHello  \
          \ torch.__version__    '2.0.0+cu117'\n\nIt works when I reshape the feature_extractor.filter\
          \ on speechbrain in /speechbrain/lobes/models/huggingface_whisper.py\n\n\
          but I don't know if this is a good way to fix it \n\n"
        updatedAt: '2023-06-14T12:20:48.553Z'
      numEdits: 0
      reactions: []
    id: 6489b0a0aff1493a0ff74f58
    type: comment
  author: Mr1gh
  content: "> Hello, \n> \n> which version of PyTorch are you using?\n\nHello   torch.__version__\
    \    '2.0.0+cu117'\n\nIt works when I reshape the feature_extractor.filter on\
    \ speechbrain in /speechbrain/lobes/models/huggingface_whisper.py\n\nbut I don't\
    \ know if this is a good way to fix it \n\n"
  created_at: 2023-06-14 11:20:48+00:00
  edited: false
  hidden: false
  id: 6489b0a0aff1493a0ff74f58
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: speechbrain/asr-whisper-large-v2-commonvoice-ar
repo_type: model
status: open
target_branch: null
title: 'RuntimeError: Error(s) in loading state_dict for HuggingFaceWhisper:'
