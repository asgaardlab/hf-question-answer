!!python/object:huggingface_hub.community.DiscussionWithDetails
author: vivasvan100
conflicting_files: null
created_at: 2023-10-06 10:44:09+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1678193795699-noauth.png?w=200&h=200&f=face
      fullname: Vivasvan Patel
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: vivasvan100
      type: user
    createdAt: '2023-10-06T11:44:09.000Z'
    data:
      edited: false
      editors:
      - vivasvan100
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8075213432312012
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1678193795699-noauth.png?w=200&h=200&f=face
          fullname: Vivasvan Patel
          isHf: false
          isPro: false
          name: vivasvan100
          type: user
        html: '<p>Hi there, </p>

          <p>how can i pass "v2/en_speaker_6" history prompt to the model?</p>

          '
        raw: "Hi there, \r\n\r\nhow can i pass \"v2/en_speaker_6\" history prompt\
          \ to the model?"
        updatedAt: '2023-10-06T11:44:09.352Z'
      numEdits: 0
      reactions: []
    id: 651ff309eab153738f04cfba
    type: comment
  author: vivasvan100
  content: "Hi there, \r\n\r\nhow can i pass \"v2/en_speaker_6\" history prompt to\
    \ the model?"
  created_at: 2023-10-06 10:44:09+00:00
  edited: false
  hidden: false
  id: 651ff309eab153738f04cfba
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62611fcabbcbd1c34f1615f6/ehvQLkjaEaz0pYJwbB51L.jpeg?w=200&h=200&f=face
      fullname: Yoach Lacombe
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: ylacombe
      type: user
    createdAt: '2023-10-06T12:04:10.000Z'
    data:
      edited: false
      editors:
      - ylacombe
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.4222639799118042
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62611fcabbcbd1c34f1615f6/ehvQLkjaEaz0pYJwbB51L.jpeg?w=200&h=200&f=face
          fullname: Yoach Lacombe
          isHf: true
          isPro: false
          name: ylacombe
          type: user
        html: "<p>Hey <span data-props=\"{&quot;user&quot;:&quot;vivasvan100&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/vivasvan100\"\
          >@<span class=\"underline\">vivasvan100</span></a></span>\n\n\t</span></span>,\
          \ you can do it like this:</p>\n<pre><code class=\"language-python\"><span\
          \ class=\"hljs-keyword\">from</span> transformers <span class=\"hljs-keyword\"\
          >import</span> AutoProcessor, BarkModel\n\nprocessor = AutoProcessor.from_pretrained(<span\
          \ class=\"hljs-string\">\"suno/bark\"</span>)\nmodel = BarkModel.from_pretrained(<span\
          \ class=\"hljs-string\">\"suno/bark\"</span>)\n\nvoice_preset = <span class=\"\
          hljs-string\">\"v2/en_speaker_6\"</span>\n\ninputs = processor(<span class=\"\
          hljs-string\">\"Hello, my dog is cute\"</span>, voice_preset=voice_preset)\n\
          \naudio_array = model.generate(**inputs)\naudio_array = audio_array.cpu().numpy().squeeze()\n\
          </code></pre>\n"
        raw: 'Hey @vivasvan100, you can do it like this:


          ```python

          from transformers import AutoProcessor, BarkModel


          processor = AutoProcessor.from_pretrained("suno/bark")

          model = BarkModel.from_pretrained("suno/bark")


          voice_preset = "v2/en_speaker_6"


          inputs = processor("Hello, my dog is cute", voice_preset=voice_preset)


          audio_array = model.generate(**inputs)

          audio_array = audio_array.cpu().numpy().squeeze()

          ```

          '
        updatedAt: '2023-10-06T12:04:10.047Z'
      numEdits: 0
      reactions: []
    id: 651ff7baad960391874cf22d
    type: comment
  author: ylacombe
  content: 'Hey @vivasvan100, you can do it like this:


    ```python

    from transformers import AutoProcessor, BarkModel


    processor = AutoProcessor.from_pretrained("suno/bark")

    model = BarkModel.from_pretrained("suno/bark")


    voice_preset = "v2/en_speaker_6"


    inputs = processor("Hello, my dog is cute", voice_preset=voice_preset)


    audio_array = model.generate(**inputs)

    audio_array = audio_array.cpu().numpy().squeeze()

    ```

    '
  created_at: 2023-10-06 11:04:10+00:00
  edited: false
  hidden: false
  id: 651ff7baad960391874cf22d
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1678193795699-noauth.png?w=200&h=200&f=face
      fullname: Vivasvan Patel
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: vivasvan100
      type: user
    createdAt: '2023-10-06T12:13:57.000Z'
    data:
      edited: true
      editors:
      - vivasvan100
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.573325514793396
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1678193795699-noauth.png?w=200&h=200&f=face
          fullname: Vivasvan Patel
          isHf: false
          isPro: false
          name: vivasvan100
          type: user
        html: "<p>Thank you for your response, however i would like to do it in the\
          \  \U0001F917 inference API or \U0001F917 Inference Endpoint.</p>\n<p>The\
          \ code above will do it on my local system i believe. Is this correct?</p>\n\
          <p>My question is:</p>\n<pre><code class=\"language-python\"><span class=\"\
          hljs-keyword\">import</span> requests\n\nAPI_URL = <span class=\"hljs-string\"\
          >\"https://api-inference.huggingface.co/models/suno/bark-small\"</span>\n\
          headers = {<span class=\"hljs-string\">\"Authorization\"</span>: <span class=\"\
          hljs-string\">\"Bearer xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"</span>}\n\
          \n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\"\
          >query</span>(<span class=\"hljs-params\">payload</span>):\n    response\
          \ = requests.post(API_URL, headers=headers, json=payload)\n    <span class=\"\
          hljs-keyword\">return</span> response.json()\n    \noutput = query({\n \
          \   <span class=\"hljs-string\">\"inputs\"</span>: <span class=\"hljs-string\"\
          >\"The answer to the universe is 42\"</span>,\n    <span class=\"hljs-comment\"\
          ># If possible .... can I add a parameter here for history prompt</span>\n\
          })\n</code></pre>\n<p>Sorry if this is noob question. I am new to HuggingFace</p>\n"
        raw: "Thank you for your response, however i would like to do it in the  \U0001F917\
          \ inference API or \U0001F917 Inference Endpoint.\n\nThe code above will\
          \ do it on my local system i believe. Is this correct?\n\nMy question is:\n\
          \n```python\nimport requests\n\nAPI_URL = \"https://api-inference.huggingface.co/models/suno/bark-small\"\
          \nheaders = {\"Authorization\": \"Bearer xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"\
          }\n\ndef query(payload):\n\tresponse = requests.post(API_URL, headers=headers,\
          \ json=payload)\n\treturn response.json()\n\t\noutput = query({\n\t\"inputs\"\
          : \"The answer to the universe is 42\",\n    # If possible .... can I add\
          \ a parameter here for history prompt\n})\n```\n\nSorry if this is noob\
          \ question. I am new to HuggingFace"
        updatedAt: '2023-10-06T12:23:05.975Z'
      numEdits: 2
      reactions: []
    id: 651ffa05d5cf7a1a94d6babc
    type: comment
  author: vivasvan100
  content: "Thank you for your response, however i would like to do it in the  \U0001F917\
    \ inference API or \U0001F917 Inference Endpoint.\n\nThe code above will do it\
    \ on my local system i believe. Is this correct?\n\nMy question is:\n\n```python\n\
    import requests\n\nAPI_URL = \"https://api-inference.huggingface.co/models/suno/bark-small\"\
    \nheaders = {\"Authorization\": \"Bearer xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"\
    }\n\ndef query(payload):\n\tresponse = requests.post(API_URL, headers=headers,\
    \ json=payload)\n\treturn response.json()\n\t\noutput = query({\n\t\"inputs\"\
    : \"The answer to the universe is 42\",\n    # If possible .... can I add a parameter\
    \ here for history prompt\n})\n```\n\nSorry if this is noob question. I am new\
    \ to HuggingFace"
  created_at: 2023-10-06 11:13:57+00:00
  edited: true
  hidden: false
  id: 651ffa05d5cf7a1a94d6babc
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62611fcabbcbd1c34f1615f6/ehvQLkjaEaz0pYJwbB51L.jpeg?w=200&h=200&f=face
      fullname: Yoach Lacombe
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: ylacombe
      type: user
    createdAt: '2023-10-06T12:30:31.000Z'
    data:
      edited: false
      editors:
      - ylacombe
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6701191067695618
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62611fcabbcbd1c34f1615f6/ehvQLkjaEaz0pYJwbB51L.jpeg?w=200&h=200&f=face
          fullname: Yoach Lacombe
          isHf: true
          isPro: false
          name: ylacombe
          type: user
        html: "<p>I believe you can first define some forward parameters:</p>\n<pre><code\
          \ class=\"language-python\"><span class=\"hljs-keyword\">from</span> transformers\
          \ <span class=\"hljs-keyword\">import</span> AutoProcessor\n\nprocessor\
          \ = AutoProcessor.from_pretrained(<span class=\"hljs-string\">\"suno/bark\"\
          </span>)\n\n<span class=\"hljs-comment\"># get voice preset from processor</span>\n\
          blank_inp = processor(<span class=\"hljs-string\">\"blank\"</span>, voice_preset\
          \ = <span class=\"hljs-string\">\"v2/en_speaker_1\"</span>)\n<span class=\"\
          hljs-comment\"># get voice_preset</span>\nhistory_prompt = blank_inp[<span\
          \ class=\"hljs-string\">\"history_prompt\"</span>]\nforward_params = {\n\
          \    <span class=\"hljs-string\">\"history_prompt\"</span>: history_prompt,\n\
          }\n</code></pre>\n<p>And then pass this to your request:</p>\n<pre><code\
          \ class=\"language-python\"><span class=\"hljs-keyword\">import</span> requests\n\
          \nAPI_URL = <span class=\"hljs-string\">\"https://api-inference.huggingface.co/models/suno/bark-small\"\
          </span>\nheaders = {<span class=\"hljs-string\">\"Authorization\"</span>:\
          \ <span class=\"hljs-string\">\"Bearer xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"\
          </span>}\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\
          \ function_\">query</span>(<span class=\"hljs-params\">payload</span>):\n\
          \    response = requests.post(API_URL, headers=headers, json=payload)\n\
          \    <span class=\"hljs-keyword\">return</span> response.json()\n    \n\
          output = query({\n    <span class=\"hljs-string\">\"inputs\"</span>: <span\
          \ class=\"hljs-string\">\"The answer to the universe is 42\"</span>,\n \
          \   <span class=\"hljs-string\">\"forward_params\"</span>: forward_params,\n\
          })\n</code></pre>\n<p>I'm actually not sure it works, could you tell me\
          \ what you've got ?</p>\n"
        raw: "I believe you can first define some forward parameters:\n\n```python\n\
          from transformers import AutoProcessor\n\nprocessor = AutoProcessor.from_pretrained(\"\
          suno/bark\")\n\n# get voice preset from processor\nblank_inp = processor(\"\
          blank\", voice_preset = \"v2/en_speaker_1\")\n# get voice_preset\nhistory_prompt\
          \ = blank_inp[\"history_prompt\"]\nforward_params = {\n    \"history_prompt\"\
          : history_prompt,\n}\n```\n\nAnd then pass this to your request:\n\n```python\n\
          import requests\n\nAPI_URL = \"https://api-inference.huggingface.co/models/suno/bark-small\"\
          \nheaders = {\"Authorization\": \"Bearer xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"\
          }\n\ndef query(payload):\n    response = requests.post(API_URL, headers=headers,\
          \ json=payload)\n    return response.json()\n    \noutput = query({\n  \
          \  \"inputs\": \"The answer to the universe is 42\",\n    \"forward_params\"\
          : forward_params,\n})\n```\n\nI'm actually not sure it works, could you\
          \ tell me what you've got ?"
        updatedAt: '2023-10-06T12:30:31.361Z'
      numEdits: 0
      reactions: []
    id: 651ffde7d936576d25175e31
    type: comment
  author: ylacombe
  content: "I believe you can first define some forward parameters:\n\n```python\n\
    from transformers import AutoProcessor\n\nprocessor = AutoProcessor.from_pretrained(\"\
    suno/bark\")\n\n# get voice preset from processor\nblank_inp = processor(\"blank\"\
    , voice_preset = \"v2/en_speaker_1\")\n# get voice_preset\nhistory_prompt = blank_inp[\"\
    history_prompt\"]\nforward_params = {\n    \"history_prompt\": history_prompt,\n\
    }\n```\n\nAnd then pass this to your request:\n\n```python\nimport requests\n\n\
    API_URL = \"https://api-inference.huggingface.co/models/suno/bark-small\"\nheaders\
    \ = {\"Authorization\": \"Bearer xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"}\n\n\
    def query(payload):\n    response = requests.post(API_URL, headers=headers, json=payload)\n\
    \    return response.json()\n    \noutput = query({\n    \"inputs\": \"The answer\
    \ to the universe is 42\",\n    \"forward_params\": forward_params,\n})\n```\n\
    \nI'm actually not sure it works, could you tell me what you've got ?"
  created_at: 2023-10-06 11:30:31+00:00
  edited: false
  hidden: false
  id: 651ffde7d936576d25175e31
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/1212bec00cfacfdf579413042debf15a.svg
      fullname: "Sebastian Kr\xF6del"
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: skroed
      type: user
    createdAt: '2023-10-26T14:45:01.000Z'
    data:
      edited: true
      editors:
      - skroed
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6944761276245117
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/1212bec00cfacfdf579413042debf15a.svg
          fullname: "Sebastian Kr\xF6del"
          isHf: false
          isPro: false
          name: skroed
          type: user
        html: "<p>It does not work because the output of the processor contains tensors\
          \ that are not JSON serialisable.<br>I tried this fix:</p>\n<pre><code class=\"\
          language-python\">blank_inp = AutoProcessor.from_pretrained(<span class=\"\
          hljs-string\">\"suno/bark\"</span>)(\n    <span class=\"hljs-string\">\"\
          blank\"</span>, voice_preset=<span class=\"hljs-string\">\"v2/en_speaker_1\"\
          </span>\n)\n<span class=\"hljs-comment\"># get voice_preset</span>\nhistory_prompt\
          \ = blank_inp[<span class=\"hljs-string\">\"history_prompt\"</span>]\nnew_history_prompt\
          \ = {}\n<span class=\"hljs-keyword\">for</span> key, value <span class=\"\
          hljs-keyword\">in</span> history_prompt.items():\n    value = value.cpu().numpy().tolist()\n\
          \    new_history_prompt[key] = value\nforward_params = {\n    <span class=\"\
          hljs-string\">\"history_prompt\"</span>: new_history_prompt,\n}\n</code></pre>\n\
          <p>This runs through but the speaker is actually not consistent... Any ideas\
          \ ?</p>\n"
        raw: "It does not work because the output of the processor contains tensors\
          \ that are not JSON serialisable. \nI tried this fix:\n``` python\nblank_inp\
          \ = AutoProcessor.from_pretrained(\"suno/bark\")(\n    \"blank\", voice_preset=\"\
          v2/en_speaker_1\"\n)\n# get voice_preset\nhistory_prompt = blank_inp[\"\
          history_prompt\"]\nnew_history_prompt = {}\nfor key, value in history_prompt.items():\n\
          \    value = value.cpu().numpy().tolist()\n    new_history_prompt[key] =\
          \ value\nforward_params = {\n    \"history_prompt\": new_history_prompt,\n\
          }\n```\nThis runs through but the speaker is actually not consistent...\
          \ Any ideas ?\n"
        updatedAt: '2023-10-26T14:46:30.170Z'
      numEdits: 1
      reactions: []
    id: 653a7b6ddfce99b57b36e674
    type: comment
  author: skroed
  content: "It does not work because the output of the processor contains tensors\
    \ that are not JSON serialisable. \nI tried this fix:\n``` python\nblank_inp =\
    \ AutoProcessor.from_pretrained(\"suno/bark\")(\n    \"blank\", voice_preset=\"\
    v2/en_speaker_1\"\n)\n# get voice_preset\nhistory_prompt = blank_inp[\"history_prompt\"\
    ]\nnew_history_prompt = {}\nfor key, value in history_prompt.items():\n    value\
    \ = value.cpu().numpy().tolist()\n    new_history_prompt[key] = value\nforward_params\
    \ = {\n    \"history_prompt\": new_history_prompt,\n}\n```\nThis runs through\
    \ but the speaker is actually not consistent... Any ideas ?\n"
  created_at: 2023-10-26 13:45:01+00:00
  edited: true
  hidden: false
  id: 653a7b6ddfce99b57b36e674
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/1212bec00cfacfdf579413042debf15a.svg
      fullname: "Sebastian Kr\xF6del"
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: skroed
      type: user
    createdAt: '2023-11-01T21:22:25.000Z'
    data:
      edited: false
      editors:
      - skroed
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7411723732948303
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/1212bec00cfacfdf579413042debf15a.svg
          fullname: "Sebastian Kr\xF6del"
          isHf: false
          isPro: false
          name: skroed
          type: user
        html: '<p>FYI I managed to make it work using a custom handler. Feel free
          to use <a href="https://huggingface.co/skroed/bark-small">https://huggingface.co/skroed/bark-small</a></p>

          '
        raw: FYI I managed to make it work using a custom handler. Feel free to use
          https://huggingface.co/skroed/bark-small
        updatedAt: '2023-11-01T21:22:25.342Z'
      numEdits: 0
      reactions:
      - count: 3
        reaction: "\U0001F44D"
        users:
        - vivasvan100
        - ylacombe
        - mikolodz
      - count: 2
        reaction: "\u2764\uFE0F"
        users:
        - vivasvan100
        - ylacombe
    id: 6542c191d0f52498c6a0db52
    type: comment
  author: skroed
  content: FYI I managed to make it work using a custom handler. Feel free to use
    https://huggingface.co/skroed/bark-small
  created_at: 2023-11-01 20:22:25+00:00
  edited: false
  hidden: false
  id: 6542c191d0f52498c6a0db52
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62611fcabbcbd1c34f1615f6/ehvQLkjaEaz0pYJwbB51L.jpeg?w=200&h=200&f=face
      fullname: Yoach Lacombe
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: ylacombe
      type: user
    createdAt: '2023-11-02T17:09:05.000Z'
    data:
      edited: false
      editors:
      - ylacombe
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8720265030860901
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62611fcabbcbd1c34f1615f6/ehvQLkjaEaz0pYJwbB51L.jpeg?w=200&h=200&f=face
          fullname: Yoach Lacombe
          isHf: true
          isPro: false
          name: ylacombe
          type: user
        html: '<p>Wow, thanks for figuring that out ! Leaving the discussion open
          for future reference!</p>

          '
        raw: Wow, thanks for figuring that out ! Leaving the discussion open for future
          reference!
        updatedAt: '2023-11-02T17:09:05.814Z'
      numEdits: 0
      reactions: []
    id: 6543d7b19b639f21e1c0a9cf
    type: comment
  author: ylacombe
  content: Wow, thanks for figuring that out ! Leaving the discussion open for future
    reference!
  created_at: 2023-11-02 16:09:05+00:00
  edited: false
  hidden: false
  id: 6543d7b19b639f21e1c0a9cf
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 10
repo_id: suno/bark-small
repo_type: model
status: open
target_branch: null
title: How to pass "history_prompt" in the API inference?
