!!python/object:huggingface_hub.community.DiscussionWithDetails
author: AayushShah
conflicting_files: null
created_at: 2023-04-03 12:12:24+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63ff5fc4fe6383d50b29052e/Vk9R5rKqG-Z_ou-55J9x-.jpeg?w=200&h=200&f=face
      fullname: AayushShah
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: AayushShah
      type: user
    createdAt: '2023-04-03T13:12:24.000Z'
    data:
      edited: false
      editors:
      - AayushShah
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63ff5fc4fe6383d50b29052e/Vk9R5rKqG-Z_ou-55J9x-.jpeg?w=200&h=200&f=face
          fullname: AayushShah
          isHf: false
          isPro: false
          name: AayushShah
          type: user
        html: "<p>I was trying to run this code:</p>\n<pre><code class=\"language-python\"\
          ><span class=\"hljs-keyword\">for</span> param <span class=\"hljs-keyword\"\
          >in</span> model.parameters():\n    param.requires_grad = <span class=\"\
          hljs-literal\">False</span>  <span class=\"hljs-comment\"># freeze the model\
          \ - train adapters later</span>\n    <span class=\"hljs-keyword\">if</span>\
          \ param.ndim == <span class=\"hljs-number\">1</span>:\n        <span class=\"\
          hljs-comment\"># cast the small parameters (e.g. layernorm) to fp32 for\
          \ stability</span>\n        param.data = param.data.to(torch.float32)\n\n\
          model.gradient_checkpointing_enable()  <span class=\"hljs-comment\"># reduce\
          \ number of stored activations</span>\nmodel.enable_input_require_grads()\n\
          \n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\"\
          >CastOutputToFloat</span>(nn.Sequential):\n    <span class=\"hljs-keyword\"\
          >def</span> <span class=\"hljs-title function_\">forward</span>(<span class=\"\
          hljs-params\">self, x</span>): <span class=\"hljs-keyword\">return</span>\
          \ <span class=\"hljs-built_in\">super</span>().forward(x).to(torch.float32)\n\
          \nmodel.lm_head = CastOutputToFloat(model.lm_head)\n</code></pre>\n<p>And\
          \ got this error:</p>\n<pre><code>AttributeError: 'GPTNeoXForCausalLM' object\
          \ has no attribute 'lm_head'\n</code></pre>\n<p>Please help.</p>\n"
        raw: "I was trying to run this code:\r\n```python\r\nfor param in model.parameters():\r\
          \n    param.requires_grad = False  # freeze the model - train adapters later\r\
          \n    if param.ndim == 1:\r\n        # cast the small parameters (e.g. layernorm)\
          \ to fp32 for stability\r\n        param.data = param.data.to(torch.float32)\r\
          \n\r\nmodel.gradient_checkpointing_enable()  # reduce number of stored activations\r\
          \nmodel.enable_input_require_grads()\r\n\r\nclass CastOutputToFloat(nn.Sequential):\r\
          \n    def forward(self, x): return super().forward(x).to(torch.float32)\r\
          \n\r\nmodel.lm_head = CastOutputToFloat(model.lm_head)\r\n```\r\n\r\nAnd\
          \ got this error:\r\n```\r\nAttributeError: 'GPTNeoXForCausalLM' object\
          \ has no attribute 'lm_head'\r\n```\r\n\r\nPlease help."
        updatedAt: '2023-04-03T13:12:24.671Z'
      numEdits: 0
      reactions: []
    id: 642ad0b825442667e9bca91b
    type: comment
  author: AayushShah
  content: "I was trying to run this code:\r\n```python\r\nfor param in model.parameters():\r\
    \n    param.requires_grad = False  # freeze the model - train adapters later\r\
    \n    if param.ndim == 1:\r\n        # cast the small parameters (e.g. layernorm)\
    \ to fp32 for stability\r\n        param.data = param.data.to(torch.float32)\r\
    \n\r\nmodel.gradient_checkpointing_enable()  # reduce number of stored activations\r\
    \nmodel.enable_input_require_grads()\r\n\r\nclass CastOutputToFloat(nn.Sequential):\r\
    \n    def forward(self, x): return super().forward(x).to(torch.float32)\r\n\r\n\
    model.lm_head = CastOutputToFloat(model.lm_head)\r\n```\r\n\r\nAnd got this error:\r\
    \n```\r\nAttributeError: 'GPTNeoXForCausalLM' object has no attribute 'lm_head'\r\
    \n```\r\n\r\nPlease help."
  created_at: 2023-04-03 12:12:24+00:00
  edited: false
  hidden: false
  id: 642ad0b825442667e9bca91b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/c824379e62a403eab4c7d1d8cce93f76.svg
      fullname: Samir R.
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: sr5434
      type: user
    createdAt: '2023-05-06T21:38:44.000Z'
    data:
      edited: false
      editors:
      - sr5434
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/c824379e62a403eab4c7d1d8cce93f76.svg
          fullname: Samir R.
          isHf: false
          isPro: false
          name: sr5434
          type: user
        html: '<p>Same problem</p>

          '
        raw: Same problem
        updatedAt: '2023-05-06T21:38:44.015Z'
      numEdits: 0
      reactions: []
    id: 6456c8e4d10badc95561ba34
    type: comment
  author: sr5434
  content: Same problem
  created_at: 2023-05-06 20:38:44+00:00
  edited: false
  hidden: false
  id: 6456c8e4d10badc95561ba34
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63ff5fc4fe6383d50b29052e/Vk9R5rKqG-Z_ou-55J9x-.jpeg?w=200&h=200&f=face
      fullname: AayushShah
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: AayushShah
      type: user
    createdAt: '2023-05-09T04:52:29.000Z'
    data:
      edited: false
      editors:
      - AayushShah
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63ff5fc4fe6383d50b29052e/Vk9R5rKqG-Z_ou-55J9x-.jpeg?w=200&h=200&f=face
          fullname: AayushShah
          isHf: false
          isPro: false
          name: AayushShah
          type: user
        html: "<p>Hello <span data-props=\"{&quot;user&quot;:&quot;sr5434&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/sr5434\"\
          >@<span class=\"underline\">sr5434</span></a></span>\n\n\t</span></span>,<br>I\
          \ think this would help:</p>\n<blockquote>\n<p>It appears that GPTNeoXForCausalLM's\
          \ output layer is model.embed_out instead of model.lm_head. Could you modify\
          \ the name and try again?</p>\n</blockquote>\n<p>Please follow this thread:\
          \ <a href=\"https://huggingface.co/togethercomputer/GPT-NeoXT-Chat-Base-20B/discussions/12#6438f683bda65f2f5c8aae78\"\
          >https://huggingface.co/togethercomputer/GPT-NeoXT-Chat-Base-20B/discussions/12#6434f46ba5aed21dd11b3534</a></p>\n"
        raw: 'Hello @sr5434,

          I think this would help:

          > It appears that GPTNeoXForCausalLM''s output layer is model.embed_out
          instead of model.lm_head. Could you modify the name and try again?


          Please follow this thread: [https://huggingface.co/togethercomputer/GPT-NeoXT-Chat-Base-20B/discussions/12#6434f46ba5aed21dd11b3534](https://huggingface.co/togethercomputer/GPT-NeoXT-Chat-Base-20B/discussions/12#6438f683bda65f2f5c8aae78)'
        updatedAt: '2023-05-09T04:52:29.362Z'
      numEdits: 0
      reactions:
      - count: 2
        reaction: "\U0001F44D"
        users:
        - layoric
        - adi789
    id: 6459d18dc5d0d57ba42dff8b
    type: comment
  author: AayushShah
  content: 'Hello @sr5434,

    I think this would help:

    > It appears that GPTNeoXForCausalLM''s output layer is model.embed_out instead
    of model.lm_head. Could you modify the name and try again?


    Please follow this thread: [https://huggingface.co/togethercomputer/GPT-NeoXT-Chat-Base-20B/discussions/12#6434f46ba5aed21dd11b3534](https://huggingface.co/togethercomputer/GPT-NeoXT-Chat-Base-20B/discussions/12#6438f683bda65f2f5c8aae78)'
  created_at: 2023-05-09 03:52:29+00:00
  edited: false
  hidden: false
  id: 6459d18dc5d0d57ba42dff8b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/c824379e62a403eab4c7d1d8cce93f76.svg
      fullname: Samir R.
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: sr5434
      type: user
    createdAt: '2023-05-09T22:20:47.000Z'
    data:
      edited: false
      editors:
      - sr5434
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/c824379e62a403eab4c7d1d8cce93f76.svg
          fullname: Samir R.
          isHf: false
          isPro: false
          name: sr5434
          type: user
        html: '<p>Ok, thanks</p>

          '
        raw: Ok, thanks
        updatedAt: '2023-05-09T22:20:47.791Z'
      numEdits: 0
      reactions: []
    id: 645ac73f214503ad17ae013b
    type: comment
  author: sr5434
  content: Ok, thanks
  created_at: 2023-05-09 21:20:47+00:00
  edited: false
  hidden: false
  id: 645ac73f214503ad17ae013b
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: lambdalabs/pythia-1.4b-deduped-synthetic-instruct
repo_type: model
status: open
target_branch: null
title: 'AttributeError: ''GPTNeoXForCausalLM'' object has no attribute ''lm_head'''
