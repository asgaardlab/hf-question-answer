!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Yehor
conflicting_files: null
created_at: 2022-06-19 11:11:57+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1643148576788-6196cf5c7bf349604352ecda.png?w=200&h=200&f=face
      fullname: Smoliakov
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Yehor
      type: user
    createdAt: '2022-06-19T12:11:57.000Z'
    data:
      edited: false
      editors:
      - Yehor
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1643148576788-6196cf5c7bf349604352ecda.png?w=200&h=200&f=face
          fullname: Smoliakov
          isHf: false
          isPro: false
          name: Yehor
          type: user
        html: "<p>My test script:</p>\n<pre><code class=\"language-python\"><span\
          \ class=\"hljs-keyword\">import</span> torchaudio\n<span class=\"hljs-keyword\"\
          >from</span> speechbrain.pretrained <span class=\"hljs-keyword\">import</span>\
          \ VAD\n\n\ntest_file = <span class=\"hljs-string\">'a.wav'</span>\nvad_final\
          \ = <span class=\"hljs-string\">'bond_vad.wav'</span>\n\n<span class=\"\
          hljs-comment\">######</span>\n\nVAD = VAD.from_hparams(run_opts={<span class=\"\
          hljs-string\">\"device\"</span>:<span class=\"hljs-string\">\"cuda\"</span>},\
          \ source=<span class=\"hljs-string\">\"speechbrain/vad-crdnn-libriparty\"\
          </span>, savedir=<span class=\"hljs-string\">\"pretrained_models/vad-crdnn-libriparty\"\
          </span>)\n\nboundaries = VAD.get_speech_segments(test_file)\n\n\nVAD.save_boundaries(boundaries,\
          \ save_path=<span class=\"hljs-string\">'VAD_file.txt'</span>)\n\nupsampled_boundaries\
          \ = VAD.upsample_boundaries(boundaries, test_file)\ntorchaudio.save(vad_final,\
          \ upsampled_boundaries.cpu(), <span class=\"hljs-number\">16000</span>)\n\
          </code></pre>\n<p>When I run it, the following error goes:</p>\n<pre><code>Traceback\
          \ (most recent call last):\n  File \"test.py\", line 12, in &lt;module&gt;\n\
          \    boundaries = VAD.get_speech_segments(test_file)\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/pretrained/interfaces.py\"\
          , line 1861, in get_speech_segments\n    prob_chunks = self.get_speech_prob_file(\n\
          \  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/pretrained/interfaces.py\"\
          , line 1092, in get_speech_prob_file\n    small_chunks_prob = self.get_speech_prob_chunk(small_chunks)\n\
          \  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/pretrained/interfaces.py\"\
          , line 1203, in get_speech_prob_chunk\n    outputs = self.mods.cnn(feats)\n\
          \  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1110, in _call_impl\n    return forward_call(*input, **kwargs)\n\
          \  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/nnet/containers.py\"\
          , line 144, in forward\n    x = layer(x)\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1110, in _call_impl\n    return forward_call(*input, **kwargs)\n\
          \  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/nnet/normalization.py\"\
          , line 222, in forward\n    return self.norm(x)\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1110, in _call_impl\n    return forward_call(*input, **kwargs)\n\
          \  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/normalization.py\"\
          , line 189, in forward\n    return F.layer_norm(\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/functional.py\"\
          , line 2486, in layer_norm\n    return torch.layer_norm(input, normalized_shape,\
          \ weight, bias, eps, torch.backends.cudnn.enabled)\nRuntimeError: Expected\
          \ all tensors to be on the same device, but found at least two devices,\
          \ cpu and cuda:0! (when checking argument for argument weight in method\
          \ wrapper__native_layer_norm)\n</code></pre>\n"
        raw: "My test script:\r\n\r\n```python\r\nimport torchaudio\r\nfrom speechbrain.pretrained\
          \ import VAD\r\n\r\n\r\ntest_file = 'a.wav'\r\nvad_final = 'bond_vad.wav'\r\
          \n\r\n######\r\n\r\nVAD = VAD.from_hparams(run_opts={\"device\":\"cuda\"\
          }, source=\"speechbrain/vad-crdnn-libriparty\", savedir=\"pretrained_models/vad-crdnn-libriparty\"\
          )\r\n\r\nboundaries = VAD.get_speech_segments(test_file)\r\n\r\n\r\nVAD.save_boundaries(boundaries,\
          \ save_path='VAD_file.txt')\r\n\r\nupsampled_boundaries = VAD.upsample_boundaries(boundaries,\
          \ test_file)\r\ntorchaudio.save(vad_final, upsampled_boundaries.cpu(), 16000)\r\
          \n```\r\n\r\nWhen I run it, the following error goes:\r\n\r\n```\r\nTraceback\
          \ (most recent call last):\r\n  File \"test.py\", line 12, in <module>\r\
          \n    boundaries = VAD.get_speech_segments(test_file)\r\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/pretrained/interfaces.py\"\
          , line 1861, in get_speech_segments\r\n    prob_chunks = self.get_speech_prob_file(\r\
          \n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/pretrained/interfaces.py\"\
          , line 1092, in get_speech_prob_file\r\n    small_chunks_prob = self.get_speech_prob_chunk(small_chunks)\r\
          \n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/pretrained/interfaces.py\"\
          , line 1203, in get_speech_prob_chunk\r\n    outputs = self.mods.cnn(feats)\r\
          \n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1110, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\
          \n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/nnet/containers.py\"\
          , line 144, in forward\r\n    x = layer(x)\r\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1110, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\
          \n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/nnet/normalization.py\"\
          , line 222, in forward\r\n    return self.norm(x)\r\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1110, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\
          \n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/normalization.py\"\
          , line 189, in forward\r\n    return F.layer_norm(\r\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/functional.py\"\
          , line 2486, in layer_norm\r\n    return torch.layer_norm(input, normalized_shape,\
          \ weight, bias, eps, torch.backends.cudnn.enabled)\r\nRuntimeError: Expected\
          \ all tensors to be on the same device, but found at least two devices,\
          \ cpu and cuda:0! (when checking argument for argument weight in method\
          \ wrapper__native_layer_norm)\r\n```"
        updatedAt: '2022-06-19T12:11:57.410Z'
      numEdits: 0
      reactions: []
    id: 62af128d24488e6adf9b4170
    type: comment
  author: Yehor
  content: "My test script:\r\n\r\n```python\r\nimport torchaudio\r\nfrom speechbrain.pretrained\
    \ import VAD\r\n\r\n\r\ntest_file = 'a.wav'\r\nvad_final = 'bond_vad.wav'\r\n\r\
    \n######\r\n\r\nVAD = VAD.from_hparams(run_opts={\"device\":\"cuda\"}, source=\"\
    speechbrain/vad-crdnn-libriparty\", savedir=\"pretrained_models/vad-crdnn-libriparty\"\
    )\r\n\r\nboundaries = VAD.get_speech_segments(test_file)\r\n\r\n\r\nVAD.save_boundaries(boundaries,\
    \ save_path='VAD_file.txt')\r\n\r\nupsampled_boundaries = VAD.upsample_boundaries(boundaries,\
    \ test_file)\r\ntorchaudio.save(vad_final, upsampled_boundaries.cpu(), 16000)\r\
    \n```\r\n\r\nWhen I run it, the following error goes:\r\n\r\n```\r\nTraceback\
    \ (most recent call last):\r\n  File \"test.py\", line 12, in <module>\r\n   \
    \ boundaries = VAD.get_speech_segments(test_file)\r\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/pretrained/interfaces.py\"\
    , line 1861, in get_speech_segments\r\n    prob_chunks = self.get_speech_prob_file(\r\
    \n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/pretrained/interfaces.py\"\
    , line 1092, in get_speech_prob_file\r\n    small_chunks_prob = self.get_speech_prob_chunk(small_chunks)\r\
    \n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/pretrained/interfaces.py\"\
    , line 1203, in get_speech_prob_chunk\r\n    outputs = self.mods.cnn(feats)\r\n\
    \  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
    , line 1110, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n  File\
    \ \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/nnet/containers.py\"\
    , line 144, in forward\r\n    x = layer(x)\r\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
    , line 1110, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n  File\
    \ \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/speechbrain/nnet/normalization.py\"\
    , line 222, in forward\r\n    return self.norm(x)\r\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
    , line 1110, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n  File\
    \ \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/modules/normalization.py\"\
    , line 189, in forward\r\n    return F.layer_norm(\r\n  File \"/home/yehor/Tools/anaconda3/envs/my/lib/python3.8/site-packages/torch/nn/functional.py\"\
    , line 2486, in layer_norm\r\n    return torch.layer_norm(input, normalized_shape,\
    \ weight, bias, eps, torch.backends.cudnn.enabled)\r\nRuntimeError: Expected all\
    \ tensors to be on the same device, but found at least two devices, cpu and cuda:0!\
    \ (when checking argument for argument weight in method wrapper__native_layer_norm)\r\
    \n```"
  created_at: 2022-06-19 11:11:57+00:00
  edited: false
  hidden: false
  id: 62af128d24488e6adf9b4170
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/91edd5abd822a09795fa2aa039e7231d.svg
      fullname: Rahul kadam
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: RahulKadam0909
      type: user
    createdAt: '2022-12-06T05:29:10.000Z'
    data:
      edited: false
      editors:
      - RahulKadam0909
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/91edd5abd822a09795fa2aa039e7231d.svg
          fullname: Rahul kadam
          isHf: false
          isPro: false
          name: RahulKadam0909
          type: user
        html: '<p>you mentioned device as a cuda i.e. gpu and then you set upsampled_boundaries
          to cpu. because of that you are getting an error.</p>

          '
        raw: you mentioned device as a cuda i.e. gpu and then you set upsampled_boundaries
          to cpu. because of that you are getting an error.
        updatedAt: '2022-12-06T05:29:10.155Z'
      numEdits: 0
      reactions: []
    id: 638ed326848625f9fad09fb7
    type: comment
  author: RahulKadam0909
  content: you mentioned device as a cuda i.e. gpu and then you set upsampled_boundaries
    to cpu. because of that you are getting an error.
  created_at: 2022-12-06 05:29:10+00:00
  edited: false
  hidden: false
  id: 638ed326848625f9fad09fb7
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: speechbrain/vad-crdnn-libriparty
repo_type: model
status: open
target_branch: null
title: RuntimeError when I use cuda
