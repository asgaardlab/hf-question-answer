!!python/object:huggingface_hub.community.DiscussionWithDetails
author: ccdv
conflicting_files: null
created_at: 2022-11-15 13:45:34+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659877476012-616f3a4cf92cbd8e03c1d541.jpeg?w=200&h=200&f=face
      fullname: ccdv
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ccdv
      type: user
    createdAt: '2022-11-15T13:45:34.000Z'
    data:
      edited: false
      editors:
      - ccdv
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659877476012-616f3a4cf92cbd8e03c1d541.jpeg?w=200&h=200&f=face
          fullname: ccdv
          isHf: false
          isPro: false
          name: ccdv
          type: user
        html: "<p>Hey <span data-props=\"{&quot;user&quot;:&quot;pszemraj&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/pszemraj\"\
          >@<span class=\"underline\">pszemraj</span></a></span>\n\n\t</span></span><br>Do\
          \ you still have the training script of this model?</p>\n<p>Thank you</p>\n"
        raw: "Hey @pszemraj \r\nDo you still have the training script of this model?\r\
          \n\r\nThank you"
        updatedAt: '2022-11-15T13:45:34.786Z'
      numEdits: 0
      reactions: []
    id: 637397fee75ef9e9652efb77
    type: comment
  author: ccdv
  content: "Hey @pszemraj \r\nDo you still have the training script of this model?\r\
    \n\r\nThank you"
  created_at: 2022-11-15 13:45:34+00:00
  edited: false
  hidden: false
  id: 637397fee75ef9e9652efb77
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1641390233716-60bccec062080d33f875cd0c.png?w=200&h=200&f=face
      fullname: Peter Szemraj
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: pszemraj
      type: user
    createdAt: '2022-11-18T09:30:57.000Z'
    data:
      edited: false
      editors:
      - pszemraj
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1641390233716-60bccec062080d33f875cd0c.png?w=200&h=200&f=face
          fullname: Peter Szemraj
          isHf: false
          isPro: false
          name: pszemraj
          type: user
        html: "<p>hey thanks for reaching out! I don't have anything on hand at the\
          \ moment. I'll let you know if I dig through and find it, but essentially\
          \ I used a variant of the <a rel=\"nofollow\" href=\"https://github.com/patrickvonplaten/notebooks/blob/master/Fine_tune_Longformer_Encoder_Decoder_(LED)_for_Summarization_on_pubmed.ipynb\"\
          >longformer training notebook</a>, key enabler being deepspeed. </p>\n<h2\
          \ id=\"deepspeed-json\">deepspeed JSON</h2>\n<p>typically I use ZeRO-2 and\
          \ roll with something like:</p>\n<pre><code class=\"language-json\"><span\
          \ class=\"hljs-punctuation\">{</span>\n   <span class=\"hljs-attr\">\"optimizer\"\
          </span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\"\
          >{</span>\n      <span class=\"hljs-attr\">\"type\"</span><span class=\"\
          hljs-punctuation\">:</span><span class=\"hljs-string\">\"AdamW\"</span><span\
          \ class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"\
          params\"</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\"\
          >{</span>\n         <span class=\"hljs-attr\">\"lr\"</span><span class=\"\
          hljs-punctuation\">:</span><span class=\"hljs-string\">\"auto\"</span><span\
          \ class=\"hljs-punctuation\">,</span>\n         <span class=\"hljs-attr\"\
          >\"betas\"</span><span class=\"hljs-punctuation\">:</span><span class=\"\
          hljs-string\">\"auto\"</span><span class=\"hljs-punctuation\">,</span>\n\
          \         <span class=\"hljs-attr\">\"eps\"</span><span class=\"hljs-punctuation\"\
          >:</span><span class=\"hljs-string\">\"auto\"</span><span class=\"hljs-punctuation\"\
          >,</span>\n         <span class=\"hljs-attr\">\"weight_decay\"</span><span\
          \ class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">\"auto\"\
          </span>\n      <span class=\"hljs-punctuation\">}</span>\n   <span class=\"\
          hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n \
          \  <span class=\"hljs-attr\">\"zero_optimization\"</span><span class=\"\
          hljs-punctuation\">:</span><span class=\"hljs-punctuation\">{</span>\n \
          \     <span class=\"hljs-attr\">\"stage\"</span><span class=\"hljs-punctuation\"\
          >:</span><span class=\"hljs-number\">2</span><span class=\"hljs-punctuation\"\
          >,</span>\n      <span class=\"hljs-attr\">\"offload_optimizer\"</span><span\
          \ class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">{</span>\n\
          \         <span class=\"hljs-attr\">\"device\"</span><span class=\"hljs-punctuation\"\
          >:</span><span class=\"hljs-string\">\"cpu\"</span><span class=\"hljs-punctuation\"\
          >,</span>\n         <span class=\"hljs-attr\">\"pin_memory\"</span><span\
          \ class=\"hljs-punctuation\">:</span><span class=\"hljs-literal\"><span\
          \ class=\"hljs-keyword\">true</span></span>\n      <span class=\"hljs-punctuation\"\
          >}</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"\
          hljs-attr\">\"allgather_partitions\"</span><span class=\"hljs-punctuation\"\
          >:</span><span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span><span\
          \ class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"\
          allgather_bucket_size\"</span><span class=\"hljs-punctuation\">:</span><span\
          \ class=\"hljs-number\">2e8</span><span class=\"hljs-punctuation\">,</span>\n\
          \      <span class=\"hljs-attr\">\"overlap_comm\"</span><span class=\"hljs-punctuation\"\
          >:</span><span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span><span\
          \ class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"\
          reduce_scatter\"</span><span class=\"hljs-punctuation\">:</span><span class=\"\
          hljs-literal\"><span class=\"hljs-keyword\">true</span></span><span class=\"\
          hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"reduce_bucket_size\"\
          </span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\"\
          >2e8</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"\
          hljs-attr\">\"round_robin_gradients\"</span><span class=\"hljs-punctuation\"\
          >:</span><span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span><span\
          \ class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"\
          contiguous_gradients\"</span><span class=\"hljs-punctuation\">:</span><span\
          \ class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span>\n\
          \   <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\"\
          >,</span>\n   <span class=\"hljs-attr\">\"bfloat16\"</span><span class=\"\
          hljs-punctuation\">:</span><span class=\"hljs-punctuation\">{</span>\n \
          \     <span class=\"hljs-attr\">\"enabled\"</span><span class=\"hljs-punctuation\"\
          >:</span><span class=\"hljs-string\">\"auto\"</span>\n   <span class=\"\
          hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n \
          \  <span class=\"hljs-attr\">\"gradient_accumulation_steps\"</span><span\
          \ class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">\"auto\"\
          </span><span class=\"hljs-punctuation\">,</span>\n   <span class=\"hljs-attr\"\
          >\"gradient_clipping\"</span><span class=\"hljs-punctuation\">:</span><span\
          \ class=\"hljs-string\">\"auto\"</span><span class=\"hljs-punctuation\"\
          >,</span>\n   <span class=\"hljs-attr\">\"steps_per_print\"</span><span\
          \ class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">4000</span><span\
          \ class=\"hljs-punctuation\">,</span>\n   <span class=\"hljs-attr\">\"train_batch_size\"\
          </span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\"\
          >\"auto\"</span><span class=\"hljs-punctuation\">,</span>\n   <span class=\"\
          hljs-attr\">\"train_micro_batch_size_per_gpu\"</span><span class=\"hljs-punctuation\"\
          >:</span><span class=\"hljs-string\">\"auto\"</span><span class=\"hljs-punctuation\"\
          >,</span>\n   <span class=\"hljs-attr\">\"wall_clock_breakdown\"</span><span\
          \ class=\"hljs-punctuation\">:</span><span class=\"hljs-literal\"><span\
          \ class=\"hljs-keyword\">false</span></span>\n<span class=\"hljs-punctuation\"\
          >}</span>\n</code></pre>\n"
        raw: "hey thanks for reaching out! I don't have anything on hand at the moment.\
          \ I'll let you know if I dig through and find it, but essentially I used\
          \ a variant of the [longformer training notebook](https://github.com/patrickvonplaten/notebooks/blob/master/Fine_tune_Longformer_Encoder_Decoder_(LED)_for_Summarization_on_pubmed.ipynb),\
          \ key enabler being deepspeed. \n\n## deepspeed JSON\n\ntypically I use\
          \ ZeRO-2 and roll with something like:\n\n```json\n{\n   \"optimizer\":{\n\
          \      \"type\":\"AdamW\",\n      \"params\":{\n         \"lr\":\"auto\"\
          ,\n         \"betas\":\"auto\",\n         \"eps\":\"auto\",\n         \"\
          weight_decay\":\"auto\"\n      }\n   },\n   \"zero_optimization\":{\n  \
          \    \"stage\":2,\n      \"offload_optimizer\":{\n         \"device\":\"\
          cpu\",\n         \"pin_memory\":true\n      },\n      \"allgather_partitions\"\
          :true,\n      \"allgather_bucket_size\":2e8,\n      \"overlap_comm\":true,\n\
          \      \"reduce_scatter\":true,\n      \"reduce_bucket_size\":2e8,\n   \
          \   \"round_robin_gradients\":true,\n      \"contiguous_gradients\":true\n\
          \   },\n   \"bfloat16\":{\n      \"enabled\":\"auto\"\n   },\n   \"gradient_accumulation_steps\"\
          :\"auto\",\n   \"gradient_clipping\":\"auto\",\n   \"steps_per_print\":4000,\n\
          \   \"train_batch_size\":\"auto\",\n   \"train_micro_batch_size_per_gpu\"\
          :\"auto\",\n   \"wall_clock_breakdown\":false\n}\n```"
        updatedAt: '2022-11-18T09:30:57.546Z'
      numEdits: 0
      reactions: []
    id: 637750d1fc2207aa11e1ec6b
    type: comment
  author: pszemraj
  content: "hey thanks for reaching out! I don't have anything on hand at the moment.\
    \ I'll let you know if I dig through and find it, but essentially I used a variant\
    \ of the [longformer training notebook](https://github.com/patrickvonplaten/notebooks/blob/master/Fine_tune_Longformer_Encoder_Decoder_(LED)_for_Summarization_on_pubmed.ipynb),\
    \ key enabler being deepspeed. \n\n## deepspeed JSON\n\ntypically I use ZeRO-2\
    \ and roll with something like:\n\n```json\n{\n   \"optimizer\":{\n      \"type\"\
    :\"AdamW\",\n      \"params\":{\n         \"lr\":\"auto\",\n         \"betas\"\
    :\"auto\",\n         \"eps\":\"auto\",\n         \"weight_decay\":\"auto\"\n \
    \     }\n   },\n   \"zero_optimization\":{\n      \"stage\":2,\n      \"offload_optimizer\"\
    :{\n         \"device\":\"cpu\",\n         \"pin_memory\":true\n      },\n   \
    \   \"allgather_partitions\":true,\n      \"allgather_bucket_size\":2e8,\n   \
    \   \"overlap_comm\":true,\n      \"reduce_scatter\":true,\n      \"reduce_bucket_size\"\
    :2e8,\n      \"round_robin_gradients\":true,\n      \"contiguous_gradients\":true\n\
    \   },\n   \"bfloat16\":{\n      \"enabled\":\"auto\"\n   },\n   \"gradient_accumulation_steps\"\
    :\"auto\",\n   \"gradient_clipping\":\"auto\",\n   \"steps_per_print\":4000,\n\
    \   \"train_batch_size\":\"auto\",\n   \"train_micro_batch_size_per_gpu\":\"auto\"\
    ,\n   \"wall_clock_breakdown\":false\n}\n```"
  created_at: 2022-11-18 09:30:57+00:00
  edited: false
  hidden: false
  id: 637750d1fc2207aa11e1ec6b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659877476012-616f3a4cf92cbd8e03c1d541.jpeg?w=200&h=200&f=face
      fullname: ccdv
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ccdv
      type: user
    createdAt: '2022-11-20T15:07:18.000Z'
    data:
      edited: false
      editors:
      - ccdv
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1659877476012-616f3a4cf92cbd8e03c1d541.jpeg?w=200&h=200&f=face
          fullname: ccdv
          isHf: false
          isPro: false
          name: ccdv
          type: user
        html: '<p>ok thanks<br>Got the training done on 4096 length, will try up to
          16384 tokens now.</p>

          '
        raw: 'ok thanks

          Got the training done on 4096 length, will try up to 16384 tokens now.'
        updatedAt: '2022-11-20T15:07:18.491Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - pszemraj
    id: 637a42a68a37df6c50de332f
    type: comment
  author: ccdv
  content: 'ok thanks

    Got the training done on 4096 length, will try up to 16384 tokens now.'
  created_at: 2022-11-20 15:07:18+00:00
  edited: false
  hidden: false
  id: 637a42a68a37df6c50de332f
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1641390233716-60bccec062080d33f875cd0c.png?w=200&h=200&f=face
      fullname: Peter Szemraj
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: pszemraj
      type: user
    createdAt: '2022-12-20T03:56:01.000Z'
    data:
      edited: false
      editors:
      - pszemraj
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1641390233716-60bccec062080d33f875cd0c.png?w=200&h=200&f=face
          fullname: Peter Szemraj
          isHf: false
          isPro: false
          name: pszemraj
          type: user
        html: '<p>Hey, let me know if you have any other questions/issues with training.
          Either feel free to comment here/reopen, or message me on discord mrshadow773#0840
          :)</p>

          '
        raw: Hey, let me know if you have any other questions/issues with training.
          Either feel free to comment here/reopen, or message me on discord mrshadow773#0840
          :)
        updatedAt: '2022-12-20T03:56:01.325Z'
      numEdits: 0
      reactions: []
      relatedEventId: 63a1325145edac9f750a73c1
    id: 63a1325145edac9f750a73c0
    type: comment
  author: pszemraj
  content: Hey, let me know if you have any other questions/issues with training.
    Either feel free to comment here/reopen, or message me on discord mrshadow773#0840
    :)
  created_at: 2022-12-20 03:56:01+00:00
  edited: false
  hidden: false
  id: 63a1325145edac9f750a73c0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1641390233716-60bccec062080d33f875cd0c.png?w=200&h=200&f=face
      fullname: Peter Szemraj
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: pszemraj
      type: user
    createdAt: '2022-12-20T03:56:01.000Z'
    data:
      status: closed
    id: 63a1325145edac9f750a73c1
    type: status-change
  author: pszemraj
  created_at: 2022-12-20 03:56:01+00:00
  id: 63a1325145edac9f750a73c1
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 13
repo_id: pszemraj/long-t5-tglobal-base-16384-book-summary
repo_type: model
status: closed
target_branch: null
title: Training script
