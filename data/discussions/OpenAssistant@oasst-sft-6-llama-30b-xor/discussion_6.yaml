!!python/object:huggingface_hub.community.DiscussionWithDetails
author: vidlb
conflicting_files: null
created_at: 2023-04-23 19:51:13+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/fad75c008d0e56113b563339e5347b0d.svg
      fullname: Vincent Delbar
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: vidlb
      type: user
    createdAt: '2023-04-23T20:51:13.000Z'
    data:
      edited: true
      editors:
      - vidlb
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/fad75c008d0e56113b563339e5347b0d.svg
          fullname: Vincent Delbar
          isHf: false
          isPro: false
          name: vidlb
          type: user
        html: "<p>I have the required dependencies installed in the virtual env, and\
          \ checked out the right commit in the transformers repo.<br>I also checked\
          \ the llama weights sum.  </p>\n<p>But torch 1.13 cannot be imported, it\
          \ fails with the following error :</p>\n<pre><code>Traceback (most recent\
          \ call last):\n  File \"/media/data/models/openassistant/transformers/src/transformers/models/llama/convert_llama_weights_to_hf.py\"\
          , line 22, in &lt;module&gt;\n    import torch\n  File \"/media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/__init__.py\"\
          , line 217, in &lt;module&gt;\n    _load_global_deps()\n  File \"/media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/__init__.py\"\
          , line 177, in _load_global_deps\n    raise err\n  File \"/media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/__init__.py\"\
          , line 172, in _load_global_deps\n    ctypes.CDLL(lib_path, mode=ctypes.RTLD_GLOBAL)\n\
          \  File \"/usr/lib/python3.10/ctypes/__init__.py\", line 374, in __init__\n\
          \    self._handle = _dlopen(self._name, mode)\nOSError: /media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/lib/libtorch_global_deps.so:\
          \ failed to map segment from shared object\n</code></pre>\n<p>It seems to\
          \ work with my other torch install in 2.0, but will it produce incompatible\
          \ files ?</p>\n"
        raw: "I have the required dependencies installed in the virtual env, and checked\
          \ out the right commit in the transformers repo.\nI also checked the llama\
          \ weights sum.  \n\nBut torch 1.13 cannot be imported, it fails with the\
          \ following error :\n```\nTraceback (most recent call last):\n  File \"\
          /media/data/models/openassistant/transformers/src/transformers/models/llama/convert_llama_weights_to_hf.py\"\
          , line 22, in <module>\n    import torch\n  File \"/media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/__init__.py\"\
          , line 217, in <module>\n    _load_global_deps()\n  File \"/media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/__init__.py\"\
          , line 177, in _load_global_deps\n    raise err\n  File \"/media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/__init__.py\"\
          , line 172, in _load_global_deps\n    ctypes.CDLL(lib_path, mode=ctypes.RTLD_GLOBAL)\n\
          \  File \"/usr/lib/python3.10/ctypes/__init__.py\", line 374, in __init__\n\
          \    self._handle = _dlopen(self._name, mode)\nOSError: /media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/lib/libtorch_global_deps.so:\
          \ failed to map segment from shared object\n```\n\nIt seems to work with\
          \ my other torch install in 2.0, but will it produce incompatible files\
          \ ?"
        updatedAt: '2023-04-23T21:14:48.734Z'
      numEdits: 4
      reactions: []
    id: 64459a417a7b94ddc2d57ef6
    type: comment
  author: vidlb
  content: "I have the required dependencies installed in the virtual env, and checked\
    \ out the right commit in the transformers repo.\nI also checked the llama weights\
    \ sum.  \n\nBut torch 1.13 cannot be imported, it fails with the following error\
    \ :\n```\nTraceback (most recent call last):\n  File \"/media/data/models/openassistant/transformers/src/transformers/models/llama/convert_llama_weights_to_hf.py\"\
    , line 22, in <module>\n    import torch\n  File \"/media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/__init__.py\"\
    , line 217, in <module>\n    _load_global_deps()\n  File \"/media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/__init__.py\"\
    , line 177, in _load_global_deps\n    raise err\n  File \"/media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/__init__.py\"\
    , line 172, in _load_global_deps\n    ctypes.CDLL(lib_path, mode=ctypes.RTLD_GLOBAL)\n\
    \  File \"/usr/lib/python3.10/ctypes/__init__.py\", line 374, in __init__\n  \
    \  self._handle = _dlopen(self._name, mode)\nOSError: /media/data/models/openassistant/xor_venv/lib/python3.10/site-packages/torch/lib/libtorch_global_deps.so:\
    \ failed to map segment from shared object\n```\n\nIt seems to work with my other\
    \ torch install in 2.0, but will it produce incompatible files ?"
  created_at: 2023-04-23 19:51:13+00:00
  edited: true
  hidden: false
  id: 64459a417a7b94ddc2d57ef6
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/fad75c008d0e56113b563339e5347b0d.svg
      fullname: Vincent Delbar
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: vidlb
      type: user
    createdAt: '2023-04-23T22:58:12.000Z'
    data:
      edited: false
      editors:
      - vidlb
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/fad75c008d0e56113b563339e5347b0d.svg
          fullname: Vincent Delbar
          isHf: false
          isPro: false
          name: vidlb
          type: user
        html: '<p>Yes, it worked with torch 2.0</p>

          '
        raw: Yes, it worked with torch 2.0
        updatedAt: '2023-04-23T22:58:12.066Z'
      numEdits: 0
      reactions: []
      relatedEventId: 6445b804d1460e859d23b527
    id: 6445b804d1460e859d23b526
    type: comment
  author: vidlb
  content: Yes, it worked with torch 2.0
  created_at: 2023-04-23 21:58:12+00:00
  edited: false
  hidden: false
  id: 6445b804d1460e859d23b526
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/fad75c008d0e56113b563339e5347b0d.svg
      fullname: Vincent Delbar
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: vidlb
      type: user
    createdAt: '2023-04-23T22:58:12.000Z'
    data:
      status: closed
    id: 6445b804d1460e859d23b527
    type: status-change
  author: vidlb
  created_at: 2023-04-23 21:58:12+00:00
  id: 6445b804d1460e859d23b527
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 6
repo_id: OpenAssistant/oasst-sft-6-llama-30b-xor
repo_type: model
status: closed
target_branch: null
title: OSError when trying to convert weights to hf
