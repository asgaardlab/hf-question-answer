!!python/object:huggingface_hub.community.DiscussionWithDetails
author: aviadm
conflicting_files: null
created_at: 2023-07-25 07:08:30+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/d8e178cf4273a358e18545f910f3fcc7.svg
      fullname: Aviad Moreshet
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: aviadm
      type: user
    createdAt: '2023-07-25T08:08:30.000Z'
    data:
      edited: false
      editors:
      - aviadm
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.695848822593689
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/d8e178cf4273a358e18545f910f3fcc7.svg
          fullname: Aviad Moreshet
          isHf: false
          isPro: false
          name: aviadm
          type: user
        html: "<p>Try to delete the .bin files and all the other .safetensors of the\
          \ VAE, then load the .fp16.safetensors file.<br>It throws inside 'load_sub_module':</p>\n\
          <pre><code>ValueError: Cannot load &lt;class 'diffusers.models.autoencoder_kl.AutoencoderKL'&gt;\
          \ from /fsx/cld-models/stable-diffusion/1/vae because the following keys\
          \ are missing: \n decoder.mid_block.attentions.0.proj_attn.weight, encoder.mid_block.attentions.0.key.weight,\
          \ encoder.mid_block.attentions.0.proj_attn.bias, decoder.mid_block.attentions.0.value.weight,\
          \ decoder.mid_block.attentions.0.key.bias, decoder.mid_block.attentions.0.query.weight,\
          \ encoder.mid_block.attentions.0.query.bias, encoder.mid_block.attentions.0.proj_attn.weight,\
          \ decoder.mid_block.attentions.0.proj_attn.bias, encoder.mid_block.attentions.0.key.bias,\
          \ decoder.mid_block.attentions.0.key.weight, encoder.mid_block.attentions.0.query.weight,\
          \ decoder.mid_block.attentions.0.value.bias, decoder.mid_block.attentions.0.query.bias,\
          \ encoder.mid_block.attentions.0.value.weight, encoder.mid_block.attentions.0.value.bias.\
          \ \n Please make sure to pass `low_cpu_mem_usage=False` and `device_map=None`\
          \ if you want to randomly initialize those weights or else make sure your\
          \ checkpoint file is correct.\n</code></pre>\n<p>And then attempts to load\
          \ the .bin</p>\n"
        raw: "Try to delete the .bin files and all the other .safetensors of the VAE,\
          \ then load the .fp16.safetensors file.\r\nIt throws inside 'load_sub_module':\r\
          \n```\r\nValueError: Cannot load <class 'diffusers.models.autoencoder_kl.AutoencoderKL'>\
          \ from /fsx/cld-models/stable-diffusion/1/vae because the following keys\
          \ are missing: \r\n decoder.mid_block.attentions.0.proj_attn.weight, encoder.mid_block.attentions.0.key.weight,\
          \ encoder.mid_block.attentions.0.proj_attn.bias, decoder.mid_block.attentions.0.value.weight,\
          \ decoder.mid_block.attentions.0.key.bias, decoder.mid_block.attentions.0.query.weight,\
          \ encoder.mid_block.attentions.0.query.bias, encoder.mid_block.attentions.0.proj_attn.weight,\
          \ decoder.mid_block.attentions.0.proj_attn.bias, encoder.mid_block.attentions.0.key.bias,\
          \ decoder.mid_block.attentions.0.key.weight, encoder.mid_block.attentions.0.query.weight,\
          \ decoder.mid_block.attentions.0.value.bias, decoder.mid_block.attentions.0.query.bias,\
          \ encoder.mid_block.attentions.0.value.weight, encoder.mid_block.attentions.0.value.bias.\
          \ \r\n Please make sure to pass `low_cpu_mem_usage=False` and `device_map=None`\
          \ if you want to randomly initialize those weights or else make sure your\
          \ checkpoint file is correct.\r\n```\r\nAnd then attempts to load the .bin"
        updatedAt: '2023-07-25T08:08:30.986Z'
      numEdits: 0
      reactions: []
    id: 64bf82fef671da974e74eb9e
    type: comment
  author: aviadm
  content: "Try to delete the .bin files and all the other .safetensors of the VAE,\
    \ then load the .fp16.safetensors file.\r\nIt throws inside 'load_sub_module':\r\
    \n```\r\nValueError: Cannot load <class 'diffusers.models.autoencoder_kl.AutoencoderKL'>\
    \ from /fsx/cld-models/stable-diffusion/1/vae because the following keys are missing:\
    \ \r\n decoder.mid_block.attentions.0.proj_attn.weight, encoder.mid_block.attentions.0.key.weight,\
    \ encoder.mid_block.attentions.0.proj_attn.bias, decoder.mid_block.attentions.0.value.weight,\
    \ decoder.mid_block.attentions.0.key.bias, decoder.mid_block.attentions.0.query.weight,\
    \ encoder.mid_block.attentions.0.query.bias, encoder.mid_block.attentions.0.proj_attn.weight,\
    \ decoder.mid_block.attentions.0.proj_attn.bias, encoder.mid_block.attentions.0.key.bias,\
    \ decoder.mid_block.attentions.0.key.weight, encoder.mid_block.attentions.0.query.weight,\
    \ decoder.mid_block.attentions.0.value.bias, decoder.mid_block.attentions.0.query.bias,\
    \ encoder.mid_block.attentions.0.value.weight, encoder.mid_block.attentions.0.value.bias.\
    \ \r\n Please make sure to pass `low_cpu_mem_usage=False` and `device_map=None`\
    \ if you want to randomly initialize those weights or else make sure your checkpoint\
    \ file is correct.\r\n```\r\nAnd then attempts to load the .bin"
  created_at: 2023-07-25 07:08:30+00:00
  edited: false
  hidden: false
  id: 64bf82fef671da974e74eb9e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/d8e178cf4273a358e18545f910f3fcc7.svg
      fullname: Aviad Moreshet
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: aviadm
      type: user
    createdAt: '2023-07-25T08:30:43.000Z'
    data:
      edited: false
      editors:
      - aviadm
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8940238356590271
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/d8e178cf4273a358e18545f910f3fcc7.svg
          fullname: Aviad Moreshet
          isHf: false
          isPro: false
          name: aviadm
          type: user
        html: '<p>I confirm this comes from the .fp16.bin model and not related to
          the safetensors</p>

          '
        raw: I confirm this comes from the .fp16.bin model and not related to the
          safetensors
        updatedAt: '2023-07-25T08:30:43.637Z'
      numEdits: 0
      reactions: []
    id: 64bf8833af05eb17c7248123
    type: comment
  author: aviadm
  content: I confirm this comes from the .fp16.bin model and not related to the safetensors
  created_at: 2023-07-25 07:30:43+00:00
  edited: false
  hidden: false
  id: 64bf8833af05eb17c7248123
  type: comment
- !!python/object:huggingface_hub.community.DiscussionTitleChange
  _event:
    author:
      avatarUrl: /avatars/d8e178cf4273a358e18545f910f3fcc7.svg
      fullname: Aviad Moreshet
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: aviadm
      type: user
    createdAt: '2023-07-25T08:31:05.000Z'
    data:
      from: fp16.safetensors of VAE is not saved correctly
      to: fp16 weights of VAE is not saved correctly
    id: 64bf884986e7fb5b8aaaba39
    type: title-change
  author: aviadm
  created_at: 2023-07-25 07:31:05+00:00
  id: 64bf884986e7fb5b8aaaba39
  new_title: fp16 weights of VAE is not saved correctly
  old_title: fp16.safetensors of VAE is not saved correctly
  type: title-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/2e9df4be8870d8cb7e8709debabd9b44.svg
      fullname: pl-2
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: eplo
      type: user
    createdAt: '2023-07-26T14:57:55.000Z'
    data:
      edited: true
      editors:
      - eplo
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6839498281478882
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/2e9df4be8870d8cb7e8709debabd9b44.svg
          fullname: pl-2
          isHf: false
          isPro: false
          name: eplo
          type: user
        html: "<p>Indeed, fp16 was the matter with the 5700. Deleting <code> torch_dtype=torch.float16</code>\
          \ solves this, but introduces other challenges to VRAM conservation which\
          \ I'm giving the simplest, dumbest, possible solution for here:</p>\n<pre><code\
          \ class=\"language-python\"><span class=\"hljs-keyword\">from</span> diffusers\
          \ <span class=\"hljs-keyword\">import</span> StableDiffusionPipeline\n<span\
          \ class=\"hljs-keyword\">import</span> torch\n\nmodel_id = <span class=\"\
          hljs-string\">\"runwayml/stable-diffusion-v1-5\"</span>\npipe = StableDiffusionPipeline.from_pretrained(model_id)\n\
          pipe = pipe.to(<span class=\"hljs-string\">\"cuda\"</span>)\n\nprompt =\
          \ <span class=\"hljs-string\">\"a photo of an astronaut riding a horse on\
          \ mars\"</span>\nimage = pipe(prompt, width=<span class=\"hljs-number\"\
          >400</span>, height=<span class=\"hljs-number\">400</span>).images[<span\
          \ class=\"hljs-number\">0</span>]  \n    \nimage.save(<span class=\"hljs-string\"\
          >\"astronaut_rides_horse.png\"</span>)\n</code></pre>\n<p>Sorry, I was replying\
          \ to myself, in the wrong thread, and now can't delete this.</p>\n"
        raw: "Indeed, fp16 was the matter with the 5700. Deleting ` torch_dtype=torch.float16`\
          \ solves this, but introduces other challenges to VRAM conservation which\
          \ I'm giving the simplest, dumbest, possible solution for here:\n\n```python\n\
          from diffusers import StableDiffusionPipeline\nimport torch\n\nmodel_id\
          \ = \"runwayml/stable-diffusion-v1-5\"\npipe = StableDiffusionPipeline.from_pretrained(model_id)\n\
          pipe = pipe.to(\"cuda\")\n\nprompt = \"a photo of an astronaut riding a\
          \ horse on mars\"\nimage = pipe(prompt, width=400, height=400).images[0]\
          \  \n    \nimage.save(\"astronaut_rides_horse.png\")\n```\n\nSorry, I was\
          \ replying to myself, in the wrong thread, and now can't delete this."
        updatedAt: '2023-07-26T15:01:26.561Z'
      numEdits: 2
      reactions: []
    id: 64c13473647baafd41b75baf
    type: comment
  author: eplo
  content: "Indeed, fp16 was the matter with the 5700. Deleting ` torch_dtype=torch.float16`\
    \ solves this, but introduces other challenges to VRAM conservation which I'm\
    \ giving the simplest, dumbest, possible solution for here:\n\n```python\nfrom\
    \ diffusers import StableDiffusionPipeline\nimport torch\n\nmodel_id = \"runwayml/stable-diffusion-v1-5\"\
    \npipe = StableDiffusionPipeline.from_pretrained(model_id)\npipe = pipe.to(\"\
    cuda\")\n\nprompt = \"a photo of an astronaut riding a horse on mars\"\nimage\
    \ = pipe(prompt, width=400, height=400).images[0]  \n    \nimage.save(\"astronaut_rides_horse.png\"\
    )\n```\n\nSorry, I was replying to myself, in the wrong thread, and now can't\
    \ delete this."
  created_at: 2023-07-26 13:57:55+00:00
  edited: true
  hidden: false
  id: 64c13473647baafd41b75baf
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 160
repo_id: runwayml/stable-diffusion-v1-5
repo_type: model
status: open
target_branch: null
title: fp16 weights of VAE is not saved correctly
