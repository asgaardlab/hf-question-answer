!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Bauyrjan
conflicting_files: null
created_at: 2022-11-23 11:32:40+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/641454c1d5480e1f66f9b1fb60072045.svg
      fullname: Bauyrjan Qairatuly
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Bauyrjan
      type: user
    createdAt: '2022-11-23T11:32:40.000Z'
    data:
      edited: false
      editors:
      - Bauyrjan
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/641454c1d5480e1f66f9b1fb60072045.svg
          fullname: Bauyrjan Qairatuly
          isHf: false
          isPro: false
          name: Bauyrjan
          type: user
        html: "<p> I wonder if you faced an error \"realloc of size ... failed\" while\
          \ working with it and if you did could you please share how you dealed with\
          \ it? I got it while preparing dataset. I tried to change batch_size but\
          \ when I run command batched=True it got me an error saying that \"string\
          \ indices must be integers\"</p>\n<p>Here is how whole section looks like:</p>\n\
          <p>def prepare_dataset(batch):<br>    audio = batch[\"audio\"]</p>\n<pre><code>#\
          \ batched output is \"un-batched\"\nbatch[\"input_values\"] = processor(audio[\"\
          array\"], sampling_rate=audio[\"sampling_rate\"]).input_values[0]\nbatch[\"\
          input_length\"] = len(batch[\"input_values\"])\n\nwith processor.as_target_processor():\n\
          \    batch[\"labels\"] = processor(batch[\"sentence\"]).input_ids\nreturn\
          \ batch\n</code></pre>\n<p>train =train.map(prepare_dataset, remove_columns=train.column_names)<br>test\
          \ = test.map(prepare_dataset, remove_columns=test.column_names)</p>\n"
        raw: " I wonder if you faced an error \"realloc of size ... failed\" while\
          \ working with it and if you did could you please share how you dealed with\
          \ it? I got it while preparing dataset. I tried to change batch_size but\
          \ when I run command batched=True it got me an error saying that \"string\
          \ indices must be integers\"\r\n\r\nHere is how whole section looks like:\r\
          \n\r\ndef prepare_dataset(batch):\r\n    audio = batch[\"audio\"]\r\n\r\n\
          \    # batched output is \"un-batched\"\r\n    batch[\"input_values\"] =\
          \ processor(audio[\"array\"], sampling_rate=audio[\"sampling_rate\"]).input_values[0]\r\
          \n    batch[\"input_length\"] = len(batch[\"input_values\"])\r\n    \r\n\
          \    with processor.as_target_processor():\r\n        batch[\"labels\"]\
          \ = processor(batch[\"sentence\"]).input_ids\r\n    return batch\r\n\r\n\
          train =train.map(prepare_dataset, remove_columns=train.column_names)\r\n\
          test = test.map(prepare_dataset, remove_columns=test.column_names)"
        updatedAt: '2022-11-23T11:32:40.166Z'
      numEdits: 0
      reactions: []
    id: 637e04d82c3a3e9f4aabfc5d
    type: comment
  author: Bauyrjan
  content: " I wonder if you faced an error \"realloc of size ... failed\" while working\
    \ with it and if you did could you please share how you dealed with it? I got\
    \ it while preparing dataset. I tried to change batch_size but when I run command\
    \ batched=True it got me an error saying that \"string indices must be integers\"\
    \r\n\r\nHere is how whole section looks like:\r\n\r\ndef prepare_dataset(batch):\r\
    \n    audio = batch[\"audio\"]\r\n\r\n    # batched output is \"un-batched\"\r\
    \n    batch[\"input_values\"] = processor(audio[\"array\"], sampling_rate=audio[\"\
    sampling_rate\"]).input_values[0]\r\n    batch[\"input_length\"] = len(batch[\"\
    input_values\"])\r\n    \r\n    with processor.as_target_processor():\r\n    \
    \    batch[\"labels\"] = processor(batch[\"sentence\"]).input_ids\r\n    return\
    \ batch\r\n\r\ntrain =train.map(prepare_dataset, remove_columns=train.column_names)\r\
    \ntest = test.map(prepare_dataset, remove_columns=test.column_names)"
  created_at: 2022-11-23 11:32:40+00:00
  edited: false
  hidden: false
  id: 637e04d82c3a3e9f4aabfc5d
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1625490539159-5ecd2f89968f6028e0559f98.jpeg?w=200&h=200&f=face
      fullname: Bayartsogt Yadamsuren
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: bayartsogt
      type: user
    createdAt: '2022-11-29T21:29:10.000Z'
    data:
      edited: false
      editors:
      - bayartsogt
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1625490539159-5ecd2f89968f6028e0559f98.jpeg?w=200&h=200&f=face
          fullname: Bayartsogt Yadamsuren
          isHf: false
          isPro: false
          name: bayartsogt
          type: user
        html: "<p>Hey <span data-props=\"{&quot;user&quot;:&quot;Bauyrjan&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/Bauyrjan\"\
          >@<span class=\"underline\">Bauyrjan</span></a></span>\n\n\t</span></span>\
          \ ,</p>\n<p>I am not sure if <code>batched=True</code> was the reason of\
          \ the error, but it is probably some dimension error that you facing there.\
          \ Please try to debug the code inside <code>prepare_dataset</code> function.</p>\n\
          <p>I also have to note that this code is pretty much following the standard\
          \ code written from <span data-props=\"{&quot;user&quot;:&quot;huggingface-co&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/huggingface-co\"\
          >@<span class=\"underline\">huggingface-co</span></a></span>\n\n\t</span></span>\
          \ team. here is a <a rel=\"nofollow\" href=\"https://github.com/huggingface/notebooks/blob/main/examples/multi_lingual_speech_recognition.ipynb\"\
          >link</a> to the code I followed.</p>\n<p>Please let me know this helped!</p>\n"
        raw: 'Hey @Bauyrjan ,


          I am not sure if `batched=True` was the reason of the error, but it is probably
          some dimension error that you facing there. Please try to debug the code
          inside `prepare_dataset` function.


          I also have to note that this code is pretty much following the standard
          code written from @huggingface-co team. here is a [link](https://github.com/huggingface/notebooks/blob/main/examples/multi_lingual_speech_recognition.ipynb)
          to the code I followed.


          Please let me know this helped!'
        updatedAt: '2022-11-29T21:29:10.428Z'
      numEdits: 0
      reactions: []
    id: 638679a65ea0bcbedb149034
    type: comment
  author: bayartsogt
  content: 'Hey @Bauyrjan ,


    I am not sure if `batched=True` was the reason of the error, but it is probably
    some dimension error that you facing there. Please try to debug the code inside
    `prepare_dataset` function.


    I also have to note that this code is pretty much following the standard code
    written from @huggingface-co team. here is a [link](https://github.com/huggingface/notebooks/blob/main/examples/multi_lingual_speech_recognition.ipynb)
    to the code I followed.


    Please let me know this helped!'
  created_at: 2022-11-29 21:29:10+00:00
  edited: false
  hidden: false
  id: 638679a65ea0bcbedb149034
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: bayartsogt/wav2vec2-large-xlsr-mongolian
repo_type: model
status: open
target_branch: null
title: Realloc error
