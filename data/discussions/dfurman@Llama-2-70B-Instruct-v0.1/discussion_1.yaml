!!python/object:huggingface_hub.community.DiscussionWithDetails
author: juanpablo4l
conflicting_files: null
created_at: 2023-07-26 13:00:56+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671005391532-noauth.jpeg?w=200&h=200&f=face
      fullname: "Jan Paw\u0142owski"
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: juanpablo4l
      type: user
    createdAt: '2023-07-26T14:00:56.000Z'
    data:
      edited: false
      editors:
      - juanpablo4l
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9498413801193237
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671005391532-noauth.jpeg?w=200&h=200&f=face
          fullname: "Jan Paw\u0142owski"
          isHf: false
          isPro: false
          name: juanpablo4l
          type: user
        html: '<p>Hi!<br>Could you perhaps share or add to your script your way of
          saving and uploading trained model to the hub? I encounter some exceptions
          when attempting to push_to_hub() the model, even after following other tutorials.<br>Thanks
          in advance!</p>

          '
        raw: "Hi!\r\nCould you perhaps share or add to your script your way of saving\
          \ and uploading trained model to the hub? I encounter some exceptions when\
          \ attempting to push_to_hub() the model, even after following other tutorials.\r\
          \nThanks in advance!"
        updatedAt: '2023-07-26T14:00:56.794Z'
      numEdits: 0
      reactions: []
    id: 64c1271844f6d769b617b798
    type: comment
  author: juanpablo4l
  content: "Hi!\r\nCould you perhaps share or add to your script your way of saving\
    \ and uploading trained model to the hub? I encounter some exceptions when attempting\
    \ to push_to_hub() the model, even after following other tutorials.\r\nThanks\
    \ in advance!"
  created_at: 2023-07-26 13:00:56+00:00
  edited: false
  hidden: false
  id: 64c1271844f6d769b617b798
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62afc20ca5bd7cef3e1ab3f4/h1cNaEshcUDc-XrycEp6o.jpeg?w=200&h=200&f=face
      fullname: Daniel Furman
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: dfurman
      type: user
    createdAt: '2023-07-26T14:34:56.000Z'
    data:
      edited: true
      editors:
      - dfurman
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.35949763655662537
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62afc20ca5bd7cef3e1ab3f4/h1cNaEshcUDc-XrycEp6o.jpeg?w=200&h=200&f=face
          fullname: Daniel Furman
          isHf: false
          isPro: false
          name: dfurman
          type: user
        html: '<pre><code class="language-python"><span class="hljs-comment"># push
          to hub</span>

          model_id_load = <span class="hljs-string">""</span>


          <span class="hljs-comment"># tokenizer</span>

          tokenizer.push_to_hub(model_id_load, use_auth_token=<span class="hljs-literal">True</span>)

          <span class="hljs-comment"># safetensors</span>

          model.push_to_hub(model_id_load, use_auth_token=<span class="hljs-literal">True</span>,
          safe_serialization=<span class="hljs-literal">True</span>)

          <span class="hljs-comment"># torch tensors</span>

          model.push_to_hub(model_id_load, use_auth_token=<span class="hljs-literal">True</span>)

          </code></pre>

          '
        raw: '```python

          # push to hub

          model_id_load = ""


          # tokenizer

          tokenizer.push_to_hub(model_id_load, use_auth_token=True)

          # safetensors

          model.push_to_hub(model_id_load, use_auth_token=True, safe_serialization=True)

          # torch tensors

          model.push_to_hub(model_id_load, use_auth_token=True)

          ```'
        updatedAt: '2023-07-26T14:35:14.320Z'
      numEdits: 1
      reactions:
      - count: 1
        reaction: "\u2764\uFE0F"
        users:
        - juanpablo4l
    id: 64c12f10937d427528c2b8ce
    type: comment
  author: dfurman
  content: '```python

    # push to hub

    model_id_load = ""


    # tokenizer

    tokenizer.push_to_hub(model_id_load, use_auth_token=True)

    # safetensors

    model.push_to_hub(model_id_load, use_auth_token=True, safe_serialization=True)

    # torch tensors

    model.push_to_hub(model_id_load, use_auth_token=True)

    ```'
  created_at: 2023-07-26 13:34:56+00:00
  edited: true
  hidden: false
  id: 64c12f10937d427528c2b8ce
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62afc20ca5bd7cef3e1ab3f4/h1cNaEshcUDc-XrycEp6o.jpeg?w=200&h=200&f=face
      fullname: Daniel Furman
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: dfurman
      type: user
    createdAt: '2023-07-26T14:35:39.000Z'
    data:
      status: closed
    id: 64c12f3bd9bdb0d64d50af52
    type: status-change
  author: dfurman
  created_at: 2023-07-26 13:35:39+00:00
  id: 64c12f3bd9bdb0d64d50af52
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671005391532-noauth.jpeg?w=200&h=200&f=face
      fullname: "Jan Paw\u0142owski"
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: juanpablo4l
      type: user
    createdAt: '2023-07-28T08:18:12.000Z'
    data:
      edited: false
      editors:
      - juanpablo4l
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8013386726379395
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671005391532-noauth.jpeg?w=200&h=200&f=face
          fullname: "Jan Paw\u0142owski"
          isHf: false
          isPro: false
          name: juanpablo4l
          type: user
        html: "<p>I am still missing something, because I get when trying to upload\
          \ a model. This goes both for safetensors and pytorch.</p>\n<pre><code>Traceback\
          \ (most recent call last):\n  File \"/builds/devops/gitlab-train-example/run.py\"\
          , line 289, in &lt;module&gt;\n    model.push_to_hub(model_id_load, use_auth_token=True,\
          \ safe_serialization=True)\n  File \"/root/miniconda3/envs/par3/lib/python3.10/site-packages/transformers/utils/hub.py\"\
          , line 814, in push_to_hub\n    self.save_pretrained(work_dir, max_shard_size=max_shard_size,\
          \ safe_serialization=safe_serialization)\n  File \"/root/miniconda3/envs/par3/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
          , line 1715, in save_pretrained\n    raise NotImplementedError(\nNotImplementedError:\
          \ You are calling `save_pretrained` on a 4-bit converted model. This is\
          \ currently not supported\n</code></pre>\n<p>I tried using the peft installed\
          \ from github (as in your code) and 0.4.0 (as suggested by someone else\
          \ on the internet).<br>I guess that it's either something with the versions\
          \ of the libraries that I'm using or I'm simply missing something in code\
          \ and try to push the entire model instead of just the adapter.<br>Could\
          \ you please share the output of your <code>pip list</code>/<code>pip freeze</code>?<br>Thanks\
          \ for your effort!</p>\n"
        raw: "I am still missing something, because I get when trying to upload a\
          \ model. This goes both for safetensors and pytorch.\n\n```\nTraceback (most\
          \ recent call last):\n  File \"/builds/devops/gitlab-train-example/run.py\"\
          , line 289, in <module>\n    model.push_to_hub(model_id_load, use_auth_token=True,\
          \ safe_serialization=True)\n  File \"/root/miniconda3/envs/par3/lib/python3.10/site-packages/transformers/utils/hub.py\"\
          , line 814, in push_to_hub\n    self.save_pretrained(work_dir, max_shard_size=max_shard_size,\
          \ safe_serialization=safe_serialization)\n  File \"/root/miniconda3/envs/par3/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
          , line 1715, in save_pretrained\n    raise NotImplementedError(\nNotImplementedError:\
          \ You are calling `save_pretrained` on a 4-bit converted model. This is\
          \ currently not supported\n```\n\nI tried using the peft installed from\
          \ github (as in your code) and 0.4.0 (as suggested by someone else on the\
          \ internet).\nI guess that it's either something with the versions of the\
          \ libraries that I'm using or I'm simply missing something in code and try\
          \ to push the entire model instead of just the adapter. \nCould you please\
          \ share the output of your `pip list`/`pip freeze`? \nThanks for your effort!"
        updatedAt: '2023-07-28T08:18:12.757Z'
      numEdits: 0
      reactions: []
      relatedEventId: 64c379c42a5eaefd000dd4a6
    id: 64c379c42a5eaefd000dd4a4
    type: comment
  author: juanpablo4l
  content: "I am still missing something, because I get when trying to upload a model.\
    \ This goes both for safetensors and pytorch.\n\n```\nTraceback (most recent call\
    \ last):\n  File \"/builds/devops/gitlab-train-example/run.py\", line 289, in\
    \ <module>\n    model.push_to_hub(model_id_load, use_auth_token=True, safe_serialization=True)\n\
    \  File \"/root/miniconda3/envs/par3/lib/python3.10/site-packages/transformers/utils/hub.py\"\
    , line 814, in push_to_hub\n    self.save_pretrained(work_dir, max_shard_size=max_shard_size,\
    \ safe_serialization=safe_serialization)\n  File \"/root/miniconda3/envs/par3/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
    , line 1715, in save_pretrained\n    raise NotImplementedError(\nNotImplementedError:\
    \ You are calling `save_pretrained` on a 4-bit converted model. This is currently\
    \ not supported\n```\n\nI tried using the peft installed from github (as in your\
    \ code) and 0.4.0 (as suggested by someone else on the internet).\nI guess that\
    \ it's either something with the versions of the libraries that I'm using or I'm\
    \ simply missing something in code and try to push the entire model instead of\
    \ just the adapter. \nCould you please share the output of your `pip list`/`pip\
    \ freeze`? \nThanks for your effort!"
  created_at: 2023-07-28 07:18:12+00:00
  edited: false
  hidden: false
  id: 64c379c42a5eaefd000dd4a4
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671005391532-noauth.jpeg?w=200&h=200&f=face
      fullname: "Jan Paw\u0142owski"
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: juanpablo4l
      type: user
    createdAt: '2023-07-28T08:18:12.000Z'
    data:
      status: open
    id: 64c379c42a5eaefd000dd4a6
    type: status-change
  author: juanpablo4l
  created_at: 2023-07-28 07:18:12+00:00
  id: 64c379c42a5eaefd000dd4a6
  new_status: open
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62afc20ca5bd7cef3e1ab3f4/h1cNaEshcUDc-XrycEp6o.jpeg?w=200&h=200&f=face
      fullname: Daniel Furman
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: dfurman
      type: user
    createdAt: '2023-07-28T14:00:24.000Z'
    data:
      edited: false
      editors:
      - dfurman
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8370057344436646
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62afc20ca5bd7cef3e1ab3f4/h1cNaEshcUDc-XrycEp6o.jpeg?w=200&h=200&f=face
          fullname: Daniel Furman
          isHf: false
          isPro: false
          name: dfurman
          type: user
        html: "<p>The error message says it all, you can\u2019t upload a model in\
          \ 4bit. You need to load it in at a different precision/dtype. I loaded\
          \ it in bfloat16 for example.</p>\n"
        raw: "The error message says it all, you can\u2019t upload a model in 4bit.\
          \ You need to load it in at a different precision/dtype. I loaded it in\
          \ bfloat16 for example."
        updatedAt: '2023-07-28T14:00:24.103Z'
      numEdits: 0
      reactions: []
      relatedEventId: 64c3c9f819565937fb059bb1
    id: 64c3c9f819565937fb059bb0
    type: comment
  author: dfurman
  content: "The error message says it all, you can\u2019t upload a model in 4bit.\
    \ You need to load it in at a different precision/dtype. I loaded it in bfloat16\
    \ for example."
  created_at: 2023-07-28 13:00:24+00:00
  edited: false
  hidden: false
  id: 64c3c9f819565937fb059bb0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/62afc20ca5bd7cef3e1ab3f4/h1cNaEshcUDc-XrycEp6o.jpeg?w=200&h=200&f=face
      fullname: Daniel Furman
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: dfurman
      type: user
    createdAt: '2023-07-28T14:00:24.000Z'
    data:
      status: closed
    id: 64c3c9f819565937fb059bb1
    type: status-change
  author: dfurman
  created_at: 2023-07-28 13:00:24+00:00
  id: 64c3c9f819565937fb059bb1
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: dfurman/Llama-2-70B-Instruct-v0.1
repo_type: model
status: closed
target_branch: null
title: Code to upload finetuned model.
