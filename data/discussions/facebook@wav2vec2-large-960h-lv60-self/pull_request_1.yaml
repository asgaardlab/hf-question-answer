!!python/object:huggingface_hub.community.DiscussionWithDetails
author: andreagasparini
conflicting_files: []
created_at: 2022-07-06 16:49:09+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/1bb1f9cea617fbdee67e1f559c2a632f.svg
      fullname: Andrea Gasparini
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: andreagasparini
      type: user
    createdAt: '2022-07-06T17:49:09.000Z'
    data:
      edited: true
      editors:
      - andreagasparini
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/1bb1f9cea617fbdee67e1f559c2a632f.svg
          fullname: Andrea Gasparini
          isHf: false
          isPro: false
          name: andreagasparini
          type: user
        html: '<p>Hi, I was trying to evaluate the model on LibriSpeech''s "clean"
          and "other" test data following the code snippet in the Model card and I
          got an annoying warning about the missing sampling_rate argument in the
          processor call, printed at every call of the map_to_pred function.</p>

          <p>"It is strongly recommended to pass the <code>sampling_rate</code> argument
          to this function. Failing to do so can result in silent errors that might
          be hard to debug."</p>

          <p>I have changed the snippet by simply inferring the sr from the dataset
          itself. I think the same argument is missing in similar Model cards as well
          (e.g. facebook/wav2vec2-large-960h-lv60).</p>

          '
        raw: 'Hi, I was trying to evaluate the model on LibriSpeech''s "clean" and
          "other" test data following the code snippet in the Model card and I got
          an annoying warning about the missing sampling_rate argument in the processor
          call, printed at every call of the map_to_pred function.


          "It is strongly recommended to pass the ``sampling_rate`` argument to this
          function. Failing to do so can result in silent errors that might be hard
          to debug."


          I have changed the snippet by simply inferring the sr from the dataset itself.
          I think the same argument is missing in similar Model cards as well (e.g.
          facebook/wav2vec2-large-960h-lv60).'
        updatedAt: '2022-07-07T17:46:16.361Z'
      numEdits: 5
      reactions: []
    id: 62c5cb15a3d7ba70fd3ca12b
    type: comment
  author: andreagasparini
  content: 'Hi, I was trying to evaluate the model on LibriSpeech''s "clean" and "other"
    test data following the code snippet in the Model card and I got an annoying warning
    about the missing sampling_rate argument in the processor call, printed at every
    call of the map_to_pred function.


    "It is strongly recommended to pass the ``sampling_rate`` argument to this function.
    Failing to do so can result in silent errors that might be hard to debug."


    I have changed the snippet by simply inferring the sr from the dataset itself.
    I think the same argument is missing in similar Model cards as well (e.g. facebook/wav2vec2-large-960h-lv60).'
  created_at: 2022-07-06 16:49:09+00:00
  edited: true
  hidden: false
  id: 62c5cb15a3d7ba70fd3ca12b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionCommit
  _event:
    author:
      avatarUrl: /avatars/1bb1f9cea617fbdee67e1f559c2a632f.svg
      fullname: Andrea Gasparini
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: andreagasparini
      type: user
    createdAt: '2022-07-06T17:49:09.000Z'
    data:
      oid: 750319d4d12769f2c7da9109f784e4ece1c85bd9
      parents:
      - 54074b1c16f4de6a5ad59affb4caa8f2ea03a119
      subject: 'Removes annoying  warning: missing "sampling_rate" argument'
    id: 62c5cb150000000000000000
    type: commit
  author: andreagasparini
  created_at: 2022-07-06 16:49:09+00:00
  id: 62c5cb150000000000000000
  oid: 750319d4d12769f2c7da9109f784e4ece1c85bd9
  summary: 'Removes annoying  warning: missing "sampling_rate" argument'
  type: commit
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1653243468328-61f91cf54a8e5a275b2b3e7c.jpeg?w=200&h=200&f=face
      fullname: Sanchit Gandhi
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: sanchit-gandhi
      type: user
    createdAt: '2022-07-28T16:36:20.000Z'
    data:
      edited: true
      editors:
      - sanchit-gandhi
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1653243468328-61f91cf54a8e5a275b2b3e7c.jpeg?w=200&h=200&f=face
          fullname: Sanchit Gandhi
          isHf: true
          isPro: false
          name: sanchit-gandhi
          type: user
        html: "<p>Hey <span data-props=\"{&quot;user&quot;:&quot;andreagasparini&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/andreagasparini\"\
          >@<span class=\"underline\">andreagasparini</span></a></span>\n\n\t</span></span>,\
          \ for LS the <code>sampling_rate</code> is 16kHz which is equal to the sampling\
          \ rate of the W2V2 feature extractor. In this case, passing the sampling\
          \ rate of the raw dataset (16kHz) to the <code>processor</code> is completely\
          \ valid. In the case that the <code>sampling_rate</code> of the dataset\
          \ != 16kHz, we would have to resample:</p>\n<pre><code class=\"language-python\"\
          ><span class=\"hljs-comment\"># compute sample rate of dataset</span>\n\
          dataset_sampling_rate = <span class=\"hljs-built_in\">next</span>(<span\
          \ class=\"hljs-built_in\">iter</span>(raw_datasets.values())).features[<span\
          \ class=\"hljs-string\">\"audio\"</span>].sampling_rate\n\n<span class=\"\
          hljs-comment\"># check if sample rates match</span>\n<span class=\"hljs-keyword\"\
          >if</span> dataset_sampling_rate != processor.feature_extractor.sampling_rate:\n\
          \    <span class=\"hljs-comment\"># resample if necessary</span>\n    raw_datasets\
          \ = raw_datasets.cast_column(\n           <span class=\"hljs-string\">\"\
          audio\"</span>, datasets.features.Audio(sampling_rate=processor.feature_extractor.sampling_rate)\n\
          \        )\n    )\n</code></pre>\n<p>I'd be happy to merge this PR provided\
          \ we prepend your proposed change with a one line comment explaining why\
          \ passing the sampling rate is valid:</p>\n<pre><code class=\"language-python\"\
          >...\n<span class=\"hljs-comment\"># LibriSpeech sampling rate (16kHz) is\
          \ equal to Wav2Vec2 processor sampling rate -&gt; pass audio directly to\
          \ processor</span>\ninputs = processor(batch[<span class=\"hljs-string\"\
          >\"audio\"</span>][<span class=\"hljs-string\">\"array\"</span>], return_tensors=<span\
          \ class=\"hljs-string\">\"pt\"</span>, padding=<span class=\"hljs-string\"\
          >\"longest\"</span>, sampling_rate=batch[<span class=\"hljs-string\">\"\
          audio\"</span>][<span class=\"hljs-string\">\"sampling_rate\"</span>])\n\
          ...\n</code></pre>\n<p>Let me know what you think!</p>\n"
        raw: "Hey @andreagasparini, for LS the `sampling_rate` is 16kHz which is equal\
          \ to the sampling rate of the W2V2 feature extractor. In this case, passing\
          \ the sampling rate of the raw dataset (16kHz) to the `processor` is completely\
          \ valid. In the case that the `sampling_rate` of the dataset != 16kHz, we\
          \ would have to resample:\n```python\n# compute sample rate of dataset\n\
          dataset_sampling_rate = next(iter(raw_datasets.values())).features[\"audio\"\
          ].sampling_rate\n\n# check if sample rates match\nif dataset_sampling_rate\
          \ != processor.feature_extractor.sampling_rate:\n    # resample if necessary\n\
          \    raw_datasets = raw_datasets.cast_column(\n           \"audio\", datasets.features.Audio(sampling_rate=processor.feature_extractor.sampling_rate)\n\
          \        )\n    )\n```\nI'd be happy to merge this PR provided we prepend\
          \ your proposed change with a one line comment explaining why passing the\
          \ sampling rate is valid:\n```python\n...\n# LibriSpeech sampling rate (16kHz)\
          \ is equal to Wav2Vec2 processor sampling rate -> pass audio directly to\
          \ processor\ninputs = processor(batch[\"audio\"][\"array\"], return_tensors=\"\
          pt\", padding=\"longest\", sampling_rate=batch[\"audio\"][\"sampling_rate\"\
          ])\n...\n```\nLet me know what you think!"
        updatedAt: '2022-07-28T16:36:37.552Z'
      numEdits: 1
      reactions: []
    id: 62e2bb043a616d16e2f75f63
    type: comment
  author: sanchit-gandhi
  content: "Hey @andreagasparini, for LS the `sampling_rate` is 16kHz which is equal\
    \ to the sampling rate of the W2V2 feature extractor. In this case, passing the\
    \ sampling rate of the raw dataset (16kHz) to the `processor` is completely valid.\
    \ In the case that the `sampling_rate` of the dataset != 16kHz, we would have\
    \ to resample:\n```python\n# compute sample rate of dataset\ndataset_sampling_rate\
    \ = next(iter(raw_datasets.values())).features[\"audio\"].sampling_rate\n\n# check\
    \ if sample rates match\nif dataset_sampling_rate != processor.feature_extractor.sampling_rate:\n\
    \    # resample if necessary\n    raw_datasets = raw_datasets.cast_column(\n \
    \          \"audio\", datasets.features.Audio(sampling_rate=processor.feature_extractor.sampling_rate)\n\
    \        )\n    )\n```\nI'd be happy to merge this PR provided we prepend your\
    \ proposed change with a one line comment explaining why passing the sampling\
    \ rate is valid:\n```python\n...\n# LibriSpeech sampling rate (16kHz) is equal\
    \ to Wav2Vec2 processor sampling rate -> pass audio directly to processor\ninputs\
    \ = processor(batch[\"audio\"][\"array\"], return_tensors=\"pt\", padding=\"longest\"\
    , sampling_rate=batch[\"audio\"][\"sampling_rate\"])\n...\n```\nLet me know what\
    \ you think!"
  created_at: 2022-07-28 15:36:20+00:00
  edited: true
  hidden: false
  id: 62e2bb043a616d16e2f75f63
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/1bb1f9cea617fbdee67e1f559c2a632f.svg
      fullname: Andrea Gasparini
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: andreagasparini
      type: user
    createdAt: '2022-08-09T15:21:50.000Z'
    data:
      edited: true
      editors:
      - andreagasparini
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/1bb1f9cea617fbdee67e1f559c2a632f.svg
          fullname: Andrea Gasparini
          isHf: false
          isPro: false
          name: andreagasparini
          type: user
        html: "<p>Hi <span data-props=\"{&quot;user&quot;:&quot;sanchit-gandhi&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/sanchit-gandhi\"\
          >@<span class=\"underline\">sanchit-gandhi</span></a></span>\n\n\t</span></span>,\
          \ indeed you are right!<br>I directly put it like that since the code snippet\
          \ referst to \"<em>how to evaluate facebook/wav2vec2-large-960h-lv60-self\
          \ on LibriSpeech's \"clean\" and \"other\" test data</em>\". Anyway I totally\
          \ agree with adding your comment, explicitly saying why we do so can not\
          \ hurt.<br>Maybe I would also add there that if the sampling rates do not\
          \ match we have to resample before using the model.</p>\n"
        raw: 'Hi @sanchit-gandhi, indeed you are right!

          I directly put it like that since the code snippet referst to "_how to evaluate
          facebook/wav2vec2-large-960h-lv60-self on LibriSpeech''s "clean" and "other"
          test data_". Anyway I totally agree with adding your comment, explicitly
          saying why we do so can not hurt.

          Maybe I would also add there that if the sampling rates do not match we
          have to resample before using the model.'
        updatedAt: '2022-08-09T15:30:16.812Z'
      numEdits: 2
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - sanchit-gandhi
      - count: 1
        reaction: "\U0001F917"
        users:
        - sanchit-gandhi
    id: 62f27b8eab2853085b7e7a77
    type: comment
  author: andreagasparini
  content: 'Hi @sanchit-gandhi, indeed you are right!

    I directly put it like that since the code snippet referst to "_how to evaluate
    facebook/wav2vec2-large-960h-lv60-self on LibriSpeech''s "clean" and "other" test
    data_". Anyway I totally agree with adding your comment, explicitly saying why
    we do so can not hurt.

    Maybe I would also add there that if the sampling rates do not match we have to
    resample before using the model.'
  created_at: 2022-08-09 14:21:50+00:00
  edited: true
  hidden: false
  id: 62f27b8eab2853085b7e7a77
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1653243468328-61f91cf54a8e5a275b2b3e7c.jpeg?w=200&h=200&f=face
      fullname: Sanchit Gandhi
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: sanchit-gandhi
      type: user
    createdAt: '2022-08-09T15:29:04.000Z'
    data:
      edited: true
      editors:
      - sanchit-gandhi
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1653243468328-61f91cf54a8e5a275b2b3e7c.jpeg?w=200&h=200&f=face
          fullname: Sanchit Gandhi
          isHf: true
          isPro: false
          name: sanchit-gandhi
          type: user
        html: "<p>Hey <span data-props=\"{&quot;user&quot;:&quot;andreagasparini&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/andreagasparini\"\
          >@<span class=\"underline\">andreagasparini</span></a></span>\n\n\t</span></span>,\
          \ </p>\n<p>That'd be great, and would certainly help in avoiding preventable\
          \ errors when the feature extractor sampling rate != audio sampling rate!\
          \ </p>\n<p>Thank you!</p>\n"
        raw: "Hey @andreagasparini, \n\nThat'd be great, and would certainly help\
          \ in avoiding preventable errors when the feature extractor sampling rate\
          \ != audio sampling rate! \n\nThank you!"
        updatedAt: '2022-08-09T15:29:42.248Z'
      numEdits: 2
      reactions:
      - count: 1
        reaction: "\U0001F917"
        users:
        - andreagasparini
    id: 62f27d40e538a8081154ca84
    type: comment
  author: sanchit-gandhi
  content: "Hey @andreagasparini, \n\nThat'd be great, and would certainly help in\
    \ avoiding preventable errors when the feature extractor sampling rate != audio\
    \ sampling rate! \n\nThank you!"
  created_at: 2022-08-09 14:29:04+00:00
  edited: true
  hidden: false
  id: 62f27d40e538a8081154ca84
  type: comment
- !!python/object:huggingface_hub.community.DiscussionCommit
  _event:
    author:
      avatarUrl: /avatars/1bb1f9cea617fbdee67e1f559c2a632f.svg
      fullname: Andrea Gasparini
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: andreagasparini
      type: user
    createdAt: '2022-10-03T10:37:31.000Z'
    data:
      oid: d779cee80d1851f5b533fcf70bb9cb4dd0e1b052
      parents:
      - 750319d4d12769f2c7da9109f784e4ece1c85bd9
      subject: Adds comment explaination of when to resample
    id: 633abb6b0000000000000000
    type: commit
  author: andreagasparini
  created_at: 2022-10-03 09:37:31+00:00
  id: 633abb6b0000000000000000
  oid: d779cee80d1851f5b533fcf70bb9cb4dd0e1b052
  summary: Adds comment explaination of when to resample
  type: commit
is_pull_request: true
merge_commit_oid: null
num: 1
repo_id: facebook/wav2vec2-large-960h-lv60-self
repo_type: model
status: open
target_branch: refs/heads/main
title: 'Removes annoying  warning: missing "sampling_rate" argument'
