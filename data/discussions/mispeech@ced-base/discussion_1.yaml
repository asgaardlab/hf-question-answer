!!python/object:huggingface_hub.community.DiscussionWithDetails
author: daisukelab
conflicting_files: null
created_at: 2023-12-28 02:09:58+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/24ffdd65229aac1e9e6d65fe208a33a9.svg
      fullname: Daisuke Niizumi
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: daisukelab
      type: user
    createdAt: '2023-12-28T02:09:58.000Z'
    data:
      edited: false
      editors:
      - daisukelab
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9387432336807251
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/24ffdd65229aac1e9e6d65fe208a33a9.svg
          fullname: Daisuke Niizumi
          isHf: false
          isPro: false
          name: daisukelab
          type: user
        html: "<p>Hi, thanks for sharing the implementation on Hugging Face.</p>\n\
          <p>I noticed issues with 30-s audios and made a fix locally, which are around:<br><a\
          \ href=\"https://huggingface.co/mispeech/ced-base/blob/main/ced_model/modeling_ced.py#L456-L459\"\
          >https://huggingface.co/mispeech/ced-base/blob/main/ced_model/modeling_ced.py#L456-L459</a><br>These\
          \ codes have problems that the <code>self.forward_head</code> and <code>self.ced</code>\
          \ are not found in the class.<br>I guess, instead, we should simply call\
          \ <code>forward_features</code> as same as when the audio is short.</p>\n\
          <p>In addition, it seems to have an issue with reshaping right after that.</p>\n\
          <p>Then, the following is my local fix.</p>\n<pre><code class=\"language-Python\"\
          >        x = self.forward_features(x)\n        SPLB, T, D = x.shape\n  \
          \      x = torch.reshape(\n            x, (n_splits, SPLB//n_splits, T,\
          \ D)\n        )\n</code></pre>\n<p>I hope it helps.</p>\n"
        raw: "Hi, thanks for sharing the implementation on Hugging Face.\r\n\r\nI\
          \ noticed issues with 30-s audios and made a fix locally, which are around:\r\
          \nhttps://huggingface.co/mispeech/ced-base/blob/main/ced_model/modeling_ced.py#L456-L459\r\
          \nThese codes have problems that the `self.forward_head` and `self.ced`\
          \ are not found in the class.\r\nI guess, instead, we should simply call\
          \ `forward_features` as same as when the audio is short.\r\n\r\nIn addition,\
          \ it seems to have an issue with reshaping right after that.\r\n\r\nThen,\
          \ the following is my local fix.\r\n\r\n```Python\r\n        x = self.forward_features(x)\r\
          \n        SPLB, T, D = x.shape\r\n        x = torch.reshape(\r\n       \
          \     x, (n_splits, SPLB//n_splits, T, D)\r\n        )\r\n```\r\n\r\nI hope\
          \ it helps."
        updatedAt: '2023-12-28T02:09:58.985Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\u2764\uFE0F"
        users:
        - jimbozhang
    id: 658cd8f69b22f4d7963b405e
    type: comment
  author: daisukelab
  content: "Hi, thanks for sharing the implementation on Hugging Face.\r\n\r\nI noticed\
    \ issues with 30-s audios and made a fix locally, which are around:\r\nhttps://huggingface.co/mispeech/ced-base/blob/main/ced_model/modeling_ced.py#L456-L459\r\
    \nThese codes have problems that the `self.forward_head` and `self.ced` are not\
    \ found in the class.\r\nI guess, instead, we should simply call `forward_features`\
    \ as same as when the audio is short.\r\n\r\nIn addition, it seems to have an\
    \ issue with reshaping right after that.\r\n\r\nThen, the following is my local\
    \ fix.\r\n\r\n```Python\r\n        x = self.forward_features(x)\r\n        SPLB,\
    \ T, D = x.shape\r\n        x = torch.reshape(\r\n            x, (n_splits, SPLB//n_splits,\
    \ T, D)\r\n        )\r\n```\r\n\r\nI hope it helps."
  created_at: 2023-12-28 02:09:58+00:00
  edited: false
  hidden: false
  id: 658cd8f69b22f4d7963b405e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1656385205895-62ba6e4b0e2fb1dcddca938a.jpeg?w=200&h=200&f=face
      fullname: Junbo Zhang
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: jimbozhang
      type: user
    createdAt: '2024-01-03T22:54:30.000Z'
    data:
      edited: false
      editors:
      - jimbozhang
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9271222949028015
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1656385205895-62ba6e4b0e2fb1dcddca938a.jpeg?w=200&h=200&f=face
          fullname: Junbo Zhang
          isHf: false
          isPro: false
          name: jimbozhang
          type: user
        html: '<p>Fixed. Thanks a lot!</p>

          '
        raw: Fixed. Thanks a lot!
        updatedAt: '2024-01-03T22:54:30.149Z'
      numEdits: 0
      reactions: []
    id: 6595e5a6e4fbf46026176cbb
    type: comment
  author: jimbozhang
  content: Fixed. Thanks a lot!
  created_at: 2024-01-03 22:54:30+00:00
  edited: false
  hidden: false
  id: 6595e5a6e4fbf46026176cbb
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1656385205895-62ba6e4b0e2fb1dcddca938a.jpeg?w=200&h=200&f=face
      fullname: Junbo Zhang
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: jimbozhang
      type: user
    createdAt: '2024-01-03T22:55:25.000Z'
    data:
      status: closed
    id: 6595e5ddc57a761c567b2060
    type: status-change
  author: jimbozhang
  created_at: 2024-01-03 22:55:25+00:00
  id: 6595e5ddc57a761c567b2060
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: mispeech/ced-base
repo_type: model
status: closed
target_branch: null
title: Possible fix for the CedModel's forward method for a long audio
