!!python/object:huggingface_hub.community.DiscussionWithDetails
author: TheBloke
conflicting_files: null
created_at: 2023-11-19 23:21:46+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
      fullname: Tom Jobbins
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: true
      name: TheBloke
      type: user
    createdAt: '2023-11-19T23:21:46.000Z'
    data:
      edited: true
      editors:
      - TheBloke
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9570128917694092
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
          fullname: Tom Jobbins
          isHf: false
          isPro: true
          name: TheBloke
          type: user
        html: "<p>Hi, thanks for the model!</p>\n<p>I'm trying to load it, and am\
          \ getting this:</p>\n<pre><code>ValueError: Trying to set a tensor of shape\
          \ torch.Size([32000, 4096]) in \"weight\" (which has shape torch.Size([32002,\
          \ 4096])), this look incorrect.\n</code></pre>\n<p>It seems to be a mismatch\
          \ between the base vocab size of 32000, and the size with the extra two\
          \ tokens of 32002.</p>\n<p>I tried some simple JSON file edits, but haven't\
          \ managed to resolve it that way.</p>\n<p>Did you manage to load it yourself,\
          \ and if so what is required to do so?</p>\n<p>Thanks</p>\n<p>Demonstration\
          \ of issue:</p>\n<pre><code>&gt;&gt;&gt; from transformers import AutoModelForCausalLM\n\
          &gt;&gt;&gt; model = AutoModelForCausalLM.from_pretrained(\"ByteWave/Cheus-11B\"\
          , low_cpu_mem_usage=True)\nLoading checkpoint shards:   0%|            \
          \                                                                      \
          \                   | 0/3 [00:00&lt;?, ?it/s]\nTraceback (most recent call\
          \ last):\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\n  File \"\
          /workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/models/auto/auto_factory.py\"\
          , line 566, in from_pretrained\n    return model_class.from_pretrained(\n\
          \  File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
          , line 3480, in from_pretrained\n    ) = cls._load_pretrained_model(\n \
          \ File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
          , line 3870, in _load_pretrained_model\n    new_error_msgs, offload_index,\
          \ state_dict_index = _load_state_dict_into_meta_model(\n  File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
          , line 743, in _load_state_dict_into_meta_model\n    set_module_tensor_to_device(model,\
          \ param_name, param_device, **set_module_kwargs)\n  File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/accelerate/utils/modeling.py\"\
          , line 285, in set_module_tensor_to_device\n    raise ValueError(\nValueError:\
          \ Trying to set a tensor of shape torch.Size([32000, 4096]) in \"weight\"\
          \ (which has shape torch.Size([32002, 4096])), this look incorrect.\n&gt;&gt;&gt;\n\
          </code></pre>\n"
        raw: "Hi, thanks for the model!\n\nI'm trying to load it, and am getting this:\n\
          ```\nValueError: Trying to set a tensor of shape torch.Size([32000, 4096])\
          \ in \"weight\" (which has shape torch.Size([32002, 4096])), this look incorrect.\n\
          ```\n\nIt seems to be a mismatch between the base vocab size of 32000, and\
          \ the size with the extra two tokens of 32002.\n\nI tried some simple JSON\
          \ file edits, but haven't managed to resolve it that way.\n\nDid you manage\
          \ to load it yourself, and if so what is required to do so?\n\nThanks\n\n\
          Demonstration of issue:\n```\n>>> from transformers import AutoModelForCausalLM\n\
          >>> model = AutoModelForCausalLM.from_pretrained(\"ByteWave/Cheus-11B\"\
          , low_cpu_mem_usage=True)\nLoading checkpoint shards:   0%|            \
          \                                                                      \
          \                   | 0/3 [00:00<?, ?it/s]\nTraceback (most recent call\
          \ last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/models/auto/auto_factory.py\"\
          , line 566, in from_pretrained\n    return model_class.from_pretrained(\n\
          \  File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
          , line 3480, in from_pretrained\n    ) = cls._load_pretrained_model(\n \
          \ File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
          , line 3870, in _load_pretrained_model\n    new_error_msgs, offload_index,\
          \ state_dict_index = _load_state_dict_into_meta_model(\n  File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
          , line 743, in _load_state_dict_into_meta_model\n    set_module_tensor_to_device(model,\
          \ param_name, param_device, **set_module_kwargs)\n  File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/accelerate/utils/modeling.py\"\
          , line 285, in set_module_tensor_to_device\n    raise ValueError(\nValueError:\
          \ Trying to set a tensor of shape torch.Size([32000, 4096]) in \"weight\"\
          \ (which has shape torch.Size([32002, 4096])), this look incorrect.\n>>>\n\
          ```"
        updatedAt: '2023-11-19T23:36:14.894Z'
      numEdits: 1
      reactions: []
    id: 655a988a57f3e9ac07cc46d4
    type: comment
  author: TheBloke
  content: "Hi, thanks for the model!\n\nI'm trying to load it, and am getting this:\n\
    ```\nValueError: Trying to set a tensor of shape torch.Size([32000, 4096]) in\
    \ \"weight\" (which has shape torch.Size([32002, 4096])), this look incorrect.\n\
    ```\n\nIt seems to be a mismatch between the base vocab size of 32000, and the\
    \ size with the extra two tokens of 32002.\n\nI tried some simple JSON file edits,\
    \ but haven't managed to resolve it that way.\n\nDid you manage to load it yourself,\
    \ and if so what is required to do so?\n\nThanks\n\nDemonstration of issue:\n\
    ```\n>>> from transformers import AutoModelForCausalLM\n>>> model = AutoModelForCausalLM.from_pretrained(\"\
    ByteWave/Cheus-11B\", low_cpu_mem_usage=True)\nLoading checkpoint shards:   0%|\
    \                                                                            \
    \                         | 0/3 [00:00<?, ?it/s]\nTraceback (most recent call\
    \ last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/models/auto/auto_factory.py\"\
    , line 566, in from_pretrained\n    return model_class.from_pretrained(\n  File\
    \ \"/workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
    , line 3480, in from_pretrained\n    ) = cls._load_pretrained_model(\n  File \"\
    /workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
    , line 3870, in _load_pretrained_model\n    new_error_msgs, offload_index, state_dict_index\
    \ = _load_state_dict_into_meta_model(\n  File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/transformers/modeling_utils.py\"\
    , line 743, in _load_state_dict_into_meta_model\n    set_module_tensor_to_device(model,\
    \ param_name, param_device, **set_module_kwargs)\n  File \"/workspace/venv/pytorch2/lib/python3.10/site-packages/accelerate/utils/modeling.py\"\
    , line 285, in set_module_tensor_to_device\n    raise ValueError(\nValueError:\
    \ Trying to set a tensor of shape torch.Size([32000, 4096]) in \"weight\" (which\
    \ has shape torch.Size([32002, 4096])), this look incorrect.\n>>>\n```"
  created_at: 2023-11-19 23:21:46+00:00
  edited: true
  hidden: false
  id: 655a988a57f3e9ac07cc46d4
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: ByteWave/Cheus-11B
repo_type: model
status: open
target_branch: null
title: Can't load model due to tensor shape mismatch
