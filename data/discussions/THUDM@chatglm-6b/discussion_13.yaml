!!python/object:huggingface_hub.community.DiscussionWithDetails
author: byzp
conflicting_files: null
created_at: 2023-03-21 10:33:06+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/a38f199fbaeb85debde9047ce327ad4d.svg
      fullname: zp
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: byzp
      type: user
    createdAt: '2023-03-21T11:33:06.000Z'
    data:
      edited: false
      editors:
      - byzp
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/a38f199fbaeb85debde9047ce327ad4d.svg
          fullname: zp
          isHf: false
          isPro: false
          name: byzp
          type: user
        html: '<p>CPU reasoning seems to use half the number of kernel threads by
          default. Can I improve it to get faster speed? </p>

          '
        raw: 'CPU reasoning seems to use half the number of kernel threads by default.
          Can I improve it to get faster speed? '
        updatedAt: '2023-03-21T11:33:06.865Z'
      numEdits: 0
      reactions: []
    id: 641995f2e8a6183a8cab5304
    type: comment
  author: byzp
  content: 'CPU reasoning seems to use half the number of kernel threads by default.
    Can I improve it to get faster speed? '
  created_at: 2023-03-21 10:33:06+00:00
  edited: false
  hidden: false
  id: 641995f2e8a6183a8cab5304
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1679311624745-63f36b504745321de3510823.jpeg?w=200&h=200&f=face
      fullname: Song XiXuan
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: DrSong
      type: user
    createdAt: '2023-03-22T03:07:44.000Z'
    data:
      edited: false
      editors:
      - DrSong
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1679311624745-63f36b504745321de3510823.jpeg?w=200&h=200&f=face
          fullname: Song XiXuan
          isHf: false
          isPro: false
          name: DrSong
          type: user
        html: '<p>Of course you can.<br>Pass <code>parallel_num=your_threads_num</code>
          to <code>quantize()</code> when quantizing.<br>Or if your model has already
          been loaded, call <code>quantize()</code> again, and reset the cpu core
          number used in quantization:</p>

          <pre><code>model = AutoModel.from_pretrained("THUDM/chatglm-6b-int4", trust_remote_code=True).cpu().float()

          model = model.quantize(bits=4, parallel_num=your_threads_num)

          </code></pre>

          <p>However, inappropriate parallel_num can harm efficiency, it is not recommended
          to exceed the number of cores.</p>

          '
        raw: 'Of course you can.

          Pass `parallel_num=your_threads_num` to `quantize()` when quantizing.

          Or if your model has already been loaded, call `quantize()` again, and reset
          the cpu core number used in quantization:

          ```

          model = AutoModel.from_pretrained("THUDM/chatglm-6b-int4", trust_remote_code=True).cpu().float()

          model = model.quantize(bits=4, parallel_num=your_threads_num)

          ```

          However, inappropriate parallel_num can harm efficiency, it is not recommended
          to exceed the number of cores.'
        updatedAt: '2023-03-22T03:07:44.509Z'
      numEdits: 0
      reactions:
      - count: 3
        reaction: "\U0001F917"
        users:
        - DrSong
        - tjmm
        - SinanZhou
    id: 641a71000d3389131fabca95
    type: comment
  author: DrSong
  content: 'Of course you can.

    Pass `parallel_num=your_threads_num` to `quantize()` when quantizing.

    Or if your model has already been loaded, call `quantize()` again, and reset the
    cpu core number used in quantization:

    ```

    model = AutoModel.from_pretrained("THUDM/chatglm-6b-int4", trust_remote_code=True).cpu().float()

    model = model.quantize(bits=4, parallel_num=your_threads_num)

    ```

    However, inappropriate parallel_num can harm efficiency, it is not recommended
    to exceed the number of cores.'
  created_at: 2023-03-22 02:07:44+00:00
  edited: false
  hidden: false
  id: 641a71000d3389131fabca95
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 13
repo_id: THUDM/chatglm-6b
repo_type: model
status: open
target_branch: null
title: 'Can I specify the number of threads used in CPU reasoning? '
