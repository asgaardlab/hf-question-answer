!!python/object:huggingface_hub.community.DiscussionWithDetails
author: adolf669
conflicting_files: null
created_at: 2023-03-14 07:00:14+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/5173b9d9327008dfbdf093aa7d190b72.svg
      fullname: he
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: adolf669
      type: user
    createdAt: '2023-03-14T08:00:14.000Z'
    data:
      edited: false
      editors:
      - adolf669
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/5173b9d9327008dfbdf093aa7d190b72.svg
          fullname: he
          isHf: false
          isPro: false
          name: adolf669
          type: user
        html: '<p>I use accelerate,like this:<br>"""<br>tokenizer = AutoTokenizer.from_pretrained("model/GPT-NeoXT-Chat-Base-20B")<br>with
          init_empty_weights():<br>    model = AutoConfig.from_pretrained("model/GPT-NeoXT-Chat-Base-20B")<br>model
          = load_checkpoint_and_dispatch(model, "model/GPT-NeoXT-Chat-Base-20B", device_map="auto")<br>"""<br>but
          it have a error:AttributeError: ''GPTNeoXConfig'' object has no attribute
          ''named_parameters'',what can I do</p>

          '
        raw: "I use accelerate,like this:\r\n\"\"\"\r\ntokenizer = AutoTokenizer.from_pretrained(\"\
          model/GPT-NeoXT-Chat-Base-20B\")\r\nwith init_empty_weights():  \r\n   \
          \ model = AutoConfig.from_pretrained(\"model/GPT-NeoXT-Chat-Base-20B\")\r\
          \nmodel = load_checkpoint_and_dispatch(model, \"model/GPT-NeoXT-Chat-Base-20B\"\
          , device_map=\"auto\")\r\n\"\"\"\r\nbut it have a error:AttributeError:\
          \ 'GPTNeoXConfig' object has no attribute 'named_parameters',what can I\
          \ do"
        updatedAt: '2023-03-14T08:00:14.835Z'
      numEdits: 0
      reactions: []
    id: 6410298ef52d7eb22e040fd6
    type: comment
  author: adolf669
  content: "I use accelerate,like this:\r\n\"\"\"\r\ntokenizer = AutoTokenizer.from_pretrained(\"\
    model/GPT-NeoXT-Chat-Base-20B\")\r\nwith init_empty_weights():  \r\n    model\
    \ = AutoConfig.from_pretrained(\"model/GPT-NeoXT-Chat-Base-20B\")\r\nmodel = load_checkpoint_and_dispatch(model,\
    \ \"model/GPT-NeoXT-Chat-Base-20B\", device_map=\"auto\")\r\n\"\"\"\r\nbut it\
    \ have a error:AttributeError: 'GPTNeoXConfig' object has no attribute 'named_parameters',what\
    \ can I do"
  created_at: 2023-03-14 07:00:14+00:00
  edited: false
  hidden: false
  id: 6410298ef52d7eb22e040fd6
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1669380535028-61dce5c2af6d5e733e0fb08b.jpeg?w=200&h=200&f=face
      fullname: Jue Wang
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: juewang
      type: user
    createdAt: '2023-03-17T16:30:58.000Z'
    data:
      edited: false
      editors:
      - juewang
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1669380535028-61dce5c2af6d5e733e0fb08b.jpeg?w=200&h=200&f=face
          fullname: Jue Wang
          isHf: false
          isPro: false
          name: juewang
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;adolf669&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/adolf669\">@<span class=\"\
          underline\">adolf669</span></a></span>\n\n\t</span></span> Hi, you seem\
          \ to take a config as model. Can you try this?</p>\n<pre><code class=\"\
          language-python\">tokenizer = AutoTokenizer.from_pretrained(<span class=\"\
          hljs-string\">\"model/GPT-NeoXT-Chat-Base-20B\"</span>)\nconfig = AutoConfig.from_pretrained(<span\
          \ class=\"hljs-string\">\"model/GPT-NeoXT-Chat-Base-20B\"</span>)\n<span\
          \ class=\"hljs-keyword\">with</span> init_empty_weights():\n    model =\
          \ AutoModelForCausalLM.from_config(config)\nmodel = load_checkpoint_and_dispatch(model,\
          \ <span class=\"hljs-string\">\"model/GPT-NeoXT-Chat-Base-20B\"</span>,\
          \ device_map=<span class=\"hljs-string\">\"auto\"</span>)\n</code></pre>\n"
        raw: "@adolf669 Hi, you seem to take a config as model. Can you try this?\n\
          ```python\ntokenizer = AutoTokenizer.from_pretrained(\"model/GPT-NeoXT-Chat-Base-20B\"\
          )\nconfig = AutoConfig.from_pretrained(\"model/GPT-NeoXT-Chat-Base-20B\"\
          )\nwith init_empty_weights():\n    model = AutoModelForCausalLM.from_config(config)\n\
          model = load_checkpoint_and_dispatch(model, \"model/GPT-NeoXT-Chat-Base-20B\"\
          , device_map=\"auto\")\n```"
        updatedAt: '2023-03-17T16:30:58.169Z'
      numEdits: 0
      reactions: []
    id: 641495c21bba590a7e9be226
    type: comment
  author: juewang
  content: "@adolf669 Hi, you seem to take a config as model. Can you try this?\n\
    ```python\ntokenizer = AutoTokenizer.from_pretrained(\"model/GPT-NeoXT-Chat-Base-20B\"\
    )\nconfig = AutoConfig.from_pretrained(\"model/GPT-NeoXT-Chat-Base-20B\")\nwith\
    \ init_empty_weights():\n    model = AutoModelForCausalLM.from_config(config)\n\
    model = load_checkpoint_and_dispatch(model, \"model/GPT-NeoXT-Chat-Base-20B\"\
    , device_map=\"auto\")\n```"
  created_at: 2023-03-17 15:30:58+00:00
  edited: false
  hidden: false
  id: 641495c21bba590a7e9be226
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 4
repo_id: togethercomputer/GPT-NeoXT-Chat-Base-20B
repo_type: model
status: open
target_branch: null
title: use accelerate to load model
