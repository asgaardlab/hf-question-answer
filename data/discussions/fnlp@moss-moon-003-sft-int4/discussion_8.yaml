!!python/object:huggingface_hub.community.DiscussionWithDetails
author: rabbit18snow
conflicting_files: null
created_at: 2023-06-25 21:43:48+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/bd1f70ed5fe59eaa126480d8ecf8b6d6.svg
      fullname: rabbitsnow
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: rabbit18snow
      type: user
    createdAt: '2023-06-25T22:43:48.000Z'
    data:
      edited: true
      editors:
      - rabbit18snow
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.35015934705734253
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/bd1f70ed5fe59eaa126480d8ecf8b6d6.svg
          fullname: rabbitsnow
          isHf: false
          isPro: false
          name: rabbit18snow
          type: user
        html: '<p>You can now view your Streamlit app in your browser.</p>

          <p>  Local URL: <a rel="nofollow" href="http://localhost:8888">http://localhost:8888</a><br>  Network
          URL: <a rel="nofollow" href="http://10.68.50.15:8888">http://10.68.50.15:8888</a></p>

          <p>The attention mask and the pad token id were not set. As a consequence,
          you may observe unexpected behavior. Please pass your input''s <code>attention_mask</code>
          to obtain reliable results.<br>Setting <code>pad_token_id</code> to <code>eos_token_id</code>:106068
          for open-end generation.<br>2023-06-26 06:40:17.334 Uncaught app exception<br>Traceback
          (most recent call last):<br>  File "F:\mossint\lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py",
          line 548, in _run_script<br>    self._session_state.on_script_will_rerun(rerun_data.widget_states)<br>  File
          "F:\mossint\lib\site-packages\streamlit\runtime\state\safe_session_state.py",
          line 68, in on_script_will_rerun<br>    self._state.on_script_will_rerun(latest_widget_states)<br>  File
          "F:\mossint\lib\site-packages\streamlit\runtime\state\session_state.py",
          line 482, in on_script_will_rerun<br>    self._call_callbacks()<br>  File
          "F:\mossint\lib\site-packages\streamlit\runtime\state\session_state.py",
          line 495, in _call_callbacks<br>    self._new_widget_state.call_callback(wid)<br>  File
          "F:\mossint\lib\site-packages\streamlit\runtime\state\session_state.py",
          line 247, in call_callback<br>    callback(*args, **kwargs)<br>  File "F:\mossint\MOSS\moss_web_demo_streamlit.py",
          line 100, in generate_answer<br>    generated_ids = model.generate(<br>  File
          "F:\mossint\lib\site-packages\torch\utils_contextlib.py", line 115, in decorate_context<br>    return
          func(*args, **kwargs)<br>  File "F:\mossint\lib\site-packages\transformers\generation\utils.py",
          line 1518, in generate<br>    return self.greedy_search(<br>  File "F:\mossint\lib\site-packages\transformers\generation\utils.py",
          line 2285, in greedy_search<br>    outputs = self(<br>  File "F:\mossint\lib\site-packages\torch\nn\modules\module.py",
          line 1501, in _call_impl<br>    return forward_call(*args, **kwargs)<br>  File
          "F:\mossint\MOSS\models\modeling_moss.py", line 678, in forward<br>    transformer_outputs
          = self.transformer(<br>  File "F:\mossint\lib\site-packages\torch\nn\modules\module.py",
          line 1501, in _call_impl<br>    return forward_call(*args, **kwargs)<br>  File
          "F:\mossint\MOSS\models\modeling_moss.py", line 545, in forward<br>    outputs
          = block(<br>  File "F:\mossint\lib\site-packages\torch\nn\modules\module.py",
          line 1501, in _call_impl<br>    return forward_call(*args, **kwargs)<br>  File
          "F:\mossint\MOSS\models\modeling_moss.py", line 270, in forward<br>    attn_outputs
          = self.attn(<br>  File "F:\mossint\lib\site-packages\torch\nn\modules\module.py",
          line 1501, in _call_impl<br>    return forward_call(*args, **kwargs)<br>  File
          "F:\mossint\MOSS\models\modeling_moss.py", line 164, in forward<br>    qkv
          = self.qkv_proj(hidden_states)<br>  File "F:\mossint\lib\site-packages\torch\nn\modules\module.py",
          line 1501, in _call_impl<br>    return forward_call(*args, **kwargs)<br>  File
          "F:\mossint\MOSS\models\quantization.py", line 367, in forward<br>    out
          = QuantLinearFunction.apply(x.reshape(-1, x.shape[-1]), self.qweight, self.scales,<br>  File
          "F:\mossint\lib\site-packages\torch\autograd\function.py", line 506, in
          apply<br>    return super().apply(*args, **kwargs)  # type: ignore[misc]<br>  File
          "F:\mossint\lib\site-packages\torch\cuda\amp\autocast_mode.py", line 106,
          in decorate_fwd<br>    return fwd(*args, **kwargs)<br>  File "F:\mossint\MOSS\models\quantization.py",
          line 279, in forward<br>    output = matmul248(input, qweight, scales, qzeros,
          g_idx, bits, maxq)<br>  File "F:\mossint\MOSS\models\quantization.py", line
          250, in matmul248<br>    matmul_248_kernel[grid](input, qweight, output,<br>  File
          "F:\mossint\lib\site-packages\triton\runtime\jit.py", line 106, in launcher<br>    return
          self.run(*args, grid=grid, **kwargs)<br>  File "F:\mossint\MOSS\models\custom_autotune.py",
          line 89, in run<br>    timings = {config: self._bench(*args, config=config,
          **kwargs)<br>  File "F:\mossint\MOSS\models\custom_autotune.py", line 89,
          in <br>    timings = {config: self._bench(*args, config=config, **kwargs)<br>  File
          "F:\mossint\MOSS\models\custom_autotune.py", line 71, in _bench<br>    return
          triton.testing.do_bench(kernel_call, rep=40)<br>  File "F:\mossint\lib\site-packages\triton\testing.py",
          line 136, in do_bench<br>    fn()<br>  File "F:\mossint\MOSS\models\custom_autotune.py",
          line 67, in kernel_call<br>    self.fn.run(*args, num_warps=config.num_warps,
          num_stages=config.num_stages, **current)<br>  File "", line 41, in matmul_248_kernel<br>  File
          "F:\mossint\lib\site-packages\triton\compiler.py", line 1230, in compile<br>    so_cache_manager
          = CacheManager(so_cache_key)<br>  File "F:\mossint\lib\site-packages\triton\compiler.py",
          line 1102, in <strong>init</strong><br>    self.cache_dir = os.environ.get(''TRITON_CACHE_DIR'',
          default_cache_dir())<br>  File "F:\mossint\lib\site-packages\triton\compiler.py",
          line 1093, in default_cache_dir<br>    return os.path.join(os.environ["HOME"],
          ".triton", "cache")<br>  File "F:\mossint\lib\os.py", line 679, in <strong>getitem</strong><br>    raise
          KeyError(key) from None<br>KeyError: ''HOME''</p>

          '
        raw: "You can now view your Streamlit app in your browser.\n\n  Local URL:\
          \ http://localhost:8888\n  Network URL: http://10.68.50.15:8888\n\nThe attention\
          \ mask and the pad token id were not set. As a consequence, you may observe\
          \ unexpected behavior. Please pass your input's `attention_mask` to obtain\
          \ reliable results.\nSetting `pad_token_id` to `eos_token_id`:106068 for\
          \ open-end generation.\n2023-06-26 06:40:17.334 Uncaught app exception\n\
          Traceback (most recent call last):\n  File \"F:\\mossint\\lib\\site-packages\\\
          streamlit\\runtime\\scriptrunner\\script_runner.py\", line 548, in _run_script\n\
          \    self._session_state.on_script_will_rerun(rerun_data.widget_states)\n\
          \  File \"F:\\mossint\\lib\\site-packages\\streamlit\\runtime\\state\\safe_session_state.py\"\
          , line 68, in on_script_will_rerun\n    self._state.on_script_will_rerun(latest_widget_states)\n\
          \  File \"F:\\mossint\\lib\\site-packages\\streamlit\\runtime\\state\\session_state.py\"\
          , line 482, in on_script_will_rerun\n    self._call_callbacks()\n  File\
          \ \"F:\\mossint\\lib\\site-packages\\streamlit\\runtime\\state\\session_state.py\"\
          , line 495, in _call_callbacks\n    self._new_widget_state.call_callback(wid)\n\
          \  File \"F:\\mossint\\lib\\site-packages\\streamlit\\runtime\\state\\session_state.py\"\
          , line 247, in call_callback\n    callback(*args, **kwargs)\n  File \"F:\\\
          mossint\\MOSS\\moss_web_demo_streamlit.py\", line 100, in generate_answer\n\
          \    generated_ids = model.generate(\n  File \"F:\\mossint\\lib\\site-packages\\\
          torch\\utils\\_contextlib.py\", line 115, in decorate_context\n    return\
          \ func(*args, **kwargs)\n  File \"F:\\mossint\\lib\\site-packages\\transformers\\\
          generation\\utils.py\", line 1518, in generate\n    return self.greedy_search(\n\
          \  File \"F:\\mossint\\lib\\site-packages\\transformers\\generation\\utils.py\"\
          , line 2285, in greedy_search\n    outputs = self(\n  File \"F:\\mossint\\\
          lib\\site-packages\\torch\\nn\\modules\\module.py\", line 1501, in _call_impl\n\
          \    return forward_call(*args, **kwargs)\n  File \"F:\\mossint\\MOSS\\\
          models\\modeling_moss.py\", line 678, in forward\n    transformer_outputs\
          \ = self.transformer(\n  File \"F:\\mossint\\lib\\site-packages\\torch\\\
          nn\\modules\\module.py\", line 1501, in _call_impl\n    return forward_call(*args,\
          \ **kwargs)\n  File \"F:\\mossint\\MOSS\\models\\modeling_moss.py\", line\
          \ 545, in forward\n    outputs = block(\n  File \"F:\\mossint\\lib\\site-packages\\\
          torch\\nn\\modules\\module.py\", line 1501, in _call_impl\n    return forward_call(*args,\
          \ **kwargs)\n  File \"F:\\mossint\\MOSS\\models\\modeling_moss.py\", line\
          \ 270, in forward\n    attn_outputs = self.attn(\n  File \"F:\\mossint\\\
          lib\\site-packages\\torch\\nn\\modules\\module.py\", line 1501, in _call_impl\n\
          \    return forward_call(*args, **kwargs)\n  File \"F:\\mossint\\MOSS\\\
          models\\modeling_moss.py\", line 164, in forward\n    qkv = self.qkv_proj(hidden_states)\n\
          \  File \"F:\\mossint\\lib\\site-packages\\torch\\nn\\modules\\module.py\"\
          , line 1501, in _call_impl\n    return forward_call(*args, **kwargs)\n \
          \ File \"F:\\mossint\\MOSS\\models\\quantization.py\", line 367, in forward\n\
          \    out = QuantLinearFunction.apply(x.reshape(-1, x.shape[-1]), self.qweight,\
          \ self.scales,\n  File \"F:\\mossint\\lib\\site-packages\\torch\\autograd\\\
          function.py\", line 506, in apply\n    return super().apply(*args, **kwargs)\
          \  # type: ignore[misc]\n  File \"F:\\mossint\\lib\\site-packages\\torch\\\
          cuda\\amp\\autocast_mode.py\", line 106, in decorate_fwd\n    return fwd(*args,\
          \ **kwargs)\n  File \"F:\\mossint\\MOSS\\models\\quantization.py\", line\
          \ 279, in forward\n    output = matmul248(input, qweight, scales, qzeros,\
          \ g_idx, bits, maxq)\n  File \"F:\\mossint\\MOSS\\models\\quantization.py\"\
          , line 250, in matmul248\n    matmul_248_kernel[grid](input, qweight, output,\n\
          \  File \"F:\\mossint\\lib\\site-packages\\triton\\runtime\\jit.py\", line\
          \ 106, in launcher\n    return self.run(*args, grid=grid, **kwargs)\n  File\
          \ \"F:\\mossint\\MOSS\\models\\custom_autotune.py\", line 89, in run\n \
          \   timings = {config: self._bench(*args, config=config, **kwargs)\n  File\
          \ \"F:\\mossint\\MOSS\\models\\custom_autotune.py\", line 89, in <dictcomp>\n\
          \    timings = {config: self._bench(*args, config=config, **kwargs)\n  File\
          \ \"F:\\mossint\\MOSS\\models\\custom_autotune.py\", line 71, in _bench\n\
          \    return triton.testing.do_bench(kernel_call, rep=40)\n  File \"F:\\\
          mossint\\lib\\site-packages\\triton\\testing.py\", line 136, in do_bench\n\
          \    fn()\n  File \"F:\\mossint\\MOSS\\models\\custom_autotune.py\", line\
          \ 67, in kernel_call\n    self.fn.run(*args, num_warps=config.num_warps,\
          \ num_stages=config.num_stages, **current)\n  File \"<string>\", line 41,\
          \ in matmul_248_kernel\n  File \"F:\\mossint\\lib\\site-packages\\triton\\\
          compiler.py\", line 1230, in compile\n    so_cache_manager = CacheManager(so_cache_key)\n\
          \  File \"F:\\mossint\\lib\\site-packages\\triton\\compiler.py\", line 1102,\
          \ in __init__\n    self.cache_dir = os.environ.get('TRITON_CACHE_DIR', default_cache_dir())\n\
          \  File \"F:\\mossint\\lib\\site-packages\\triton\\compiler.py\", line 1093,\
          \ in default_cache_dir\n    return os.path.join(os.environ[\"HOME\"], \"\
          .triton\", \"cache\")\n  File \"F:\\mossint\\lib\\os.py\", line 679, in\
          \ __getitem__\n    raise KeyError(key) from None\nKeyError: 'HOME'"
        updatedAt: '2023-06-25T22:44:24.729Z'
      numEdits: 1
      reactions: []
    id: 6498c3244ecdc6fbd69a0420
    type: comment
  author: rabbit18snow
  content: "You can now view your Streamlit app in your browser.\n\n  Local URL: http://localhost:8888\n\
    \  Network URL: http://10.68.50.15:8888\n\nThe attention mask and the pad token\
    \ id were not set. As a consequence, you may observe unexpected behavior. Please\
    \ pass your input's `attention_mask` to obtain reliable results.\nSetting `pad_token_id`\
    \ to `eos_token_id`:106068 for open-end generation.\n2023-06-26 06:40:17.334 Uncaught\
    \ app exception\nTraceback (most recent call last):\n  File \"F:\\mossint\\lib\\\
    site-packages\\streamlit\\runtime\\scriptrunner\\script_runner.py\", line 548,\
    \ in _run_script\n    self._session_state.on_script_will_rerun(rerun_data.widget_states)\n\
    \  File \"F:\\mossint\\lib\\site-packages\\streamlit\\runtime\\state\\safe_session_state.py\"\
    , line 68, in on_script_will_rerun\n    self._state.on_script_will_rerun(latest_widget_states)\n\
    \  File \"F:\\mossint\\lib\\site-packages\\streamlit\\runtime\\state\\session_state.py\"\
    , line 482, in on_script_will_rerun\n    self._call_callbacks()\n  File \"F:\\\
    mossint\\lib\\site-packages\\streamlit\\runtime\\state\\session_state.py\", line\
    \ 495, in _call_callbacks\n    self._new_widget_state.call_callback(wid)\n  File\
    \ \"F:\\mossint\\lib\\site-packages\\streamlit\\runtime\\state\\session_state.py\"\
    , line 247, in call_callback\n    callback(*args, **kwargs)\n  File \"F:\\mossint\\\
    MOSS\\moss_web_demo_streamlit.py\", line 100, in generate_answer\n    generated_ids\
    \ = model.generate(\n  File \"F:\\mossint\\lib\\site-packages\\torch\\utils\\\
    _contextlib.py\", line 115, in decorate_context\n    return func(*args, **kwargs)\n\
    \  File \"F:\\mossint\\lib\\site-packages\\transformers\\generation\\utils.py\"\
    , line 1518, in generate\n    return self.greedy_search(\n  File \"F:\\mossint\\\
    lib\\site-packages\\transformers\\generation\\utils.py\", line 2285, in greedy_search\n\
    \    outputs = self(\n  File \"F:\\mossint\\lib\\site-packages\\torch\\nn\\modules\\\
    module.py\", line 1501, in _call_impl\n    return forward_call(*args, **kwargs)\n\
    \  File \"F:\\mossint\\MOSS\\models\\modeling_moss.py\", line 678, in forward\n\
    \    transformer_outputs = self.transformer(\n  File \"F:\\mossint\\lib\\site-packages\\\
    torch\\nn\\modules\\module.py\", line 1501, in _call_impl\n    return forward_call(*args,\
    \ **kwargs)\n  File \"F:\\mossint\\MOSS\\models\\modeling_moss.py\", line 545,\
    \ in forward\n    outputs = block(\n  File \"F:\\mossint\\lib\\site-packages\\\
    torch\\nn\\modules\\module.py\", line 1501, in _call_impl\n    return forward_call(*args,\
    \ **kwargs)\n  File \"F:\\mossint\\MOSS\\models\\modeling_moss.py\", line 270,\
    \ in forward\n    attn_outputs = self.attn(\n  File \"F:\\mossint\\lib\\site-packages\\\
    torch\\nn\\modules\\module.py\", line 1501, in _call_impl\n    return forward_call(*args,\
    \ **kwargs)\n  File \"F:\\mossint\\MOSS\\models\\modeling_moss.py\", line 164,\
    \ in forward\n    qkv = self.qkv_proj(hidden_states)\n  File \"F:\\mossint\\lib\\\
    site-packages\\torch\\nn\\modules\\module.py\", line 1501, in _call_impl\n   \
    \ return forward_call(*args, **kwargs)\n  File \"F:\\mossint\\MOSS\\models\\quantization.py\"\
    , line 367, in forward\n    out = QuantLinearFunction.apply(x.reshape(-1, x.shape[-1]),\
    \ self.qweight, self.scales,\n  File \"F:\\mossint\\lib\\site-packages\\torch\\\
    autograd\\function.py\", line 506, in apply\n    return super().apply(*args, **kwargs)\
    \  # type: ignore[misc]\n  File \"F:\\mossint\\lib\\site-packages\\torch\\cuda\\\
    amp\\autocast_mode.py\", line 106, in decorate_fwd\n    return fwd(*args, **kwargs)\n\
    \  File \"F:\\mossint\\MOSS\\models\\quantization.py\", line 279, in forward\n\
    \    output = matmul248(input, qweight, scales, qzeros, g_idx, bits, maxq)\n \
    \ File \"F:\\mossint\\MOSS\\models\\quantization.py\", line 250, in matmul248\n\
    \    matmul_248_kernel[grid](input, qweight, output,\n  File \"F:\\mossint\\lib\\\
    site-packages\\triton\\runtime\\jit.py\", line 106, in launcher\n    return self.run(*args,\
    \ grid=grid, **kwargs)\n  File \"F:\\mossint\\MOSS\\models\\custom_autotune.py\"\
    , line 89, in run\n    timings = {config: self._bench(*args, config=config, **kwargs)\n\
    \  File \"F:\\mossint\\MOSS\\models\\custom_autotune.py\", line 89, in <dictcomp>\n\
    \    timings = {config: self._bench(*args, config=config, **kwargs)\n  File \"\
    F:\\mossint\\MOSS\\models\\custom_autotune.py\", line 71, in _bench\n    return\
    \ triton.testing.do_bench(kernel_call, rep=40)\n  File \"F:\\mossint\\lib\\site-packages\\\
    triton\\testing.py\", line 136, in do_bench\n    fn()\n  File \"F:\\mossint\\\
    MOSS\\models\\custom_autotune.py\", line 67, in kernel_call\n    self.fn.run(*args,\
    \ num_warps=config.num_warps, num_stages=config.num_stages, **current)\n  File\
    \ \"<string>\", line 41, in matmul_248_kernel\n  File \"F:\\mossint\\lib\\site-packages\\\
    triton\\compiler.py\", line 1230, in compile\n    so_cache_manager = CacheManager(so_cache_key)\n\
    \  File \"F:\\mossint\\lib\\site-packages\\triton\\compiler.py\", line 1102, in\
    \ __init__\n    self.cache_dir = os.environ.get('TRITON_CACHE_DIR', default_cache_dir())\n\
    \  File \"F:\\mossint\\lib\\site-packages\\triton\\compiler.py\", line 1093, in\
    \ default_cache_dir\n    return os.path.join(os.environ[\"HOME\"], \".triton\"\
    , \"cache\")\n  File \"F:\\mossint\\lib\\os.py\", line 679, in __getitem__\n \
    \   raise KeyError(key) from None\nKeyError: 'HOME'"
  created_at: 2023-06-25 21:43:48+00:00
  edited: true
  hidden: false
  id: 6498c3244ecdc6fbd69a0420
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 8
repo_id: fnlp/moss-moon-003-sft-int4
repo_type: model
status: open
target_branch: null
title: 'raise KeyError(key)  from None KeyError: ''HOME'''
