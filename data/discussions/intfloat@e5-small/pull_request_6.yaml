!!python/object:huggingface_hub.community.DiscussionWithDetails
author: michaelfeil
conflicting_files: []
created_at: 2023-06-17 14:56:52+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/644fac0ce1d7a97f3b653ab1/fottSAPFrJdKeMW2UJv_l.jpeg?w=200&h=200&f=face
      fullname: Michael
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: michaelfeil
      type: user
    createdAt: '2023-06-17T15:56:52.000Z'
    data:
      edited: false
      editors:
      - michaelfeil
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.11044929921627045
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/644fac0ce1d7a97f3b653ab1/fottSAPFrJdKeMW2UJv_l.jpeg?w=200&h=200&f=face
          fullname: Michael
          isHf: false
          isPro: false
          name: michaelfeil
          type: user
        html: ''
        raw: ''
        updatedAt: '2023-06-17T15:56:52.705Z'
      numEdits: 0
      reactions: []
    id: 648dd7c4b7dab2d0ac4b3c21
    type: comment
  author: michaelfeil
  content: ''
  created_at: 2023-06-17 14:56:52+00:00
  edited: false
  hidden: false
  id: 648dd7c4b7dab2d0ac4b3c21
  type: comment
- !!python/object:huggingface_hub.community.DiscussionCommit
  _event:
    createdAt: '2023-06-17T16:02:18.000Z'
    data:
      oid: 31c4c82d6bf234d289db231795da28d9b1790e66
      parents:
      - 25bf0683362172a290dbb1de2e86eb1a1c39b795
      subject: add configs
    id: 648dd90a0000000000000000
    type: commit
  author: deleted
  created_at: 2023-06-17 15:02:18+00:00
  id: 648dd90a0000000000000000
  oid: 31c4c82d6bf234d289db231795da28d9b1790e66
  summary: add configs
  type: commit
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/644fac0ce1d7a97f3b653ab1/fottSAPFrJdKeMW2UJv_l.jpeg?w=200&h=200&f=face
      fullname: Michael
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: michaelfeil
      type: user
    createdAt: '2023-06-17T16:04:34.000Z'
    data:
      edited: true
      editors:
      - michaelfeil
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7562546730041504
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/644fac0ce1d7a97f3b653ab1/fottSAPFrJdKeMW2UJv_l.jpeg?w=200&h=200&f=face
          fullname: Michael
          isHf: false
          isPro: false
          name: michaelfeil
          type: user
        html: '<p>This makes the model compatible with sentence_transformers by telling
          the package to perform "pooling_mode_mean_tokens" after the model, and optional
          normalize<br>Example:<br><a href="https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2/tree/main">https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2/tree/main</a></p>

          '
        raw: "This makes the model compatible with sentence_transformers by telling\
          \ the package to perform \"pooling_mode_mean_tokens\" after the model, and\
          \ optional normalize \nExample:\nhttps://huggingface.co/sentence-transformers/all-MiniLM-L6-v2/tree/main\n\
          \n"
        updatedAt: '2023-06-17T16:05:20.313Z'
      numEdits: 1
      reactions: []
      relatedEventId: 648dd9939237602e0d4db93b
    id: 648dd9929237602e0d4db938
    type: comment
  author: michaelfeil
  content: "This makes the model compatible with sentence_transformers by telling\
    \ the package to perform \"pooling_mode_mean_tokens\" after the model, and optional\
    \ normalize \nExample:\nhttps://huggingface.co/sentence-transformers/all-MiniLM-L6-v2/tree/main\n\
    \n"
  created_at: 2023-06-17 15:04:34+00:00
  edited: true
  hidden: false
  id: 648dd9929237602e0d4db938
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/644fac0ce1d7a97f3b653ab1/fottSAPFrJdKeMW2UJv_l.jpeg?w=200&h=200&f=face
      fullname: Michael
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: michaelfeil
      type: user
    createdAt: '2023-06-17T16:04:35.000Z'
    data:
      status: open
    id: 648dd9939237602e0d4db93b
    type: status-change
  author: michaelfeil
  created_at: 2023-06-17 15:04:35+00:00
  id: 648dd9939237602e0d4db93b
  new_status: open
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionCommit
  _event:
    createdAt: '2023-06-17T16:12:39.000Z'
    data:
      oid: 23fef9b590d3cf49ed732683a1d950cfbfbfd201
      parents:
      - 31c4c82d6bf234d289db231795da28d9b1790e66
      subject: sentence_bert_config.json
    id: 648ddb770000000000000000
    type: commit
  author: deleted
  created_at: 2023-06-17 15:12:39+00:00
  id: 648ddb770000000000000000
  oid: 23fef9b590d3cf49ed732683a1d950cfbfbfd201
  summary: sentence_bert_config.json
  type: commit
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/644fac0ce1d7a97f3b653ab1/fottSAPFrJdKeMW2UJv_l.jpeg?w=200&h=200&f=face
      fullname: Michael
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: michaelfeil
      type: user
    createdAt: '2023-06-17T16:28:29.000Z'
    data:
      edited: true
      editors:
      - michaelfeil
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7188131809234619
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/644fac0ce1d7a97f3b653ab1/fottSAPFrJdKeMW2UJv_l.jpeg?w=200&h=200&f=face
          fullname: Michael
          isHf: false
          isPro: false
          name: michaelfeil
          type: user
        html: "<p>tested via</p>\n<pre><code class=\"language-python\"><span class=\"\
          hljs-keyword\">import</span> torch.nn.functional <span class=\"hljs-keyword\"\
          >as</span> F\n\n<span class=\"hljs-keyword\">from</span> torch <span class=\"\
          hljs-keyword\">import</span> Tensor\n<span class=\"hljs-keyword\">from</span>\
          \ transformers <span class=\"hljs-keyword\">import</span> AutoTokenizer,\
          \ AutoModel\n<span class=\"hljs-keyword\">import</span> numpy <span class=\"\
          hljs-keyword\">as</span> np\n\n<span class=\"hljs-keyword\">def</span> <span\
          \ class=\"hljs-title function_\">average_pool</span>(<span class=\"hljs-params\"\
          >last_hidden_states: Tensor,</span>\n<span class=\"hljs-params\">      \
          \           attention_mask: Tensor</span>) -&gt; Tensor:\n    last_hidden\
          \ = last_hidden_states.masked_fill(~attention_mask[..., <span class=\"hljs-literal\"\
          >None</span>].<span class=\"hljs-built_in\">bool</span>(), <span class=\"\
          hljs-number\">0.0</span>)\n    <span class=\"hljs-keyword\">return</span>\
          \ last_hidden.<span class=\"hljs-built_in\">sum</span>(dim=<span class=\"\
          hljs-number\">1</span>) / attention_mask.<span class=\"hljs-built_in\">sum</span>(dim=<span\
          \ class=\"hljs-number\">1</span>)[..., <span class=\"hljs-literal\">None</span>]\n\
          \n\n<span class=\"hljs-comment\"># Each input text should start with \"\
          query: \" or \"passage: \".</span>\n<span class=\"hljs-comment\"># For tasks\
          \ other than retrieval, you can simply use the \"query: \" prefix.</span>\n\
          input_texts = [<span class=\"hljs-string\">'query: how much protein should\
          \ a female eat'</span>,\n               <span class=\"hljs-string\">'query:\
          \ summit define'</span>,\n               <span class=\"hljs-string\">\"\
          passage: As a general guideline, the CDC's average requirement of protein\
          \ for women ages 19 to 70 is 46 grams per day. But, as you can see from\
          \ this chart, you'll need to increase that if you're expecting or training\
          \ for a marathon. Check out the chart below to see how much protein you\
          \ should be eating each day.\"</span>,\n               <span class=\"hljs-string\"\
          >\"passage: Definition of summit for English Language Learners. : 1  the\
          \ highest point of a mountain : the top of a mountain. : 2  the highest\
          \ level. : 3  a meeting or series of meetings between the leaders of two\
          \ or more governments.\"</span>]\n\ntokenizer = AutoTokenizer.from_pretrained(<span\
          \ class=\"hljs-string\">'intfloat/e5-small'</span>)\nmodel = AutoModel.from_pretrained(<span\
          \ class=\"hljs-string\">'intfloat/e5-small'</span>)\n\n<span class=\"hljs-comment\"\
          ># Tokenize the input texts</span>\nbatch_dict = tokenizer(input_texts,\
          \ max_length=<span class=\"hljs-number\">512</span>, padding=<span class=\"\
          hljs-literal\">True</span>, truncation=<span class=\"hljs-literal\">True</span>,\
          \ return_tensors=<span class=\"hljs-string\">'pt'</span>)\n\noutputs = model(**batch_dict)\n\
          embeddings = average_pool(outputs.last_hidden_state, batch_dict[<span class=\"\
          hljs-string\">'attention_mask'</span>])\n\n<span class=\"hljs-comment\"\
          ># (Optionally) normalize embeddings</span>\nembeddings_norm = F.normalize(embeddings,\
          \ p=<span class=\"hljs-number\">2</span>, dim=<span class=\"hljs-number\"\
          >1</span>)\nscores = (embeddings_norm[:<span class=\"hljs-number\">2</span>]\
          \ @ embeddings_norm[<span class=\"hljs-number\">2</span>:].T) * <span class=\"\
          hljs-number\">100</span>\n\nembeddings_norm = embeddings_norm.detach().numpy()\n\
          \n<span class=\"hljs-keyword\">from</span> sentence_transformers <span class=\"\
          hljs-keyword\">import</span> SentenceTransformer\nmodel = SentenceTransformer(<span\
          \ class=\"hljs-string\">'./e5-small'</span>)\nembeddings_norm2 = model.encode(input_texts,\
          \ normalize_embeddings=<span class=\"hljs-literal\">True</span>)\n\nnp.testing.assert_allclose(embeddings_norm,\
          \ embeddings_norm2, atol=<span class=\"hljs-number\">1e-6</span>)\n</code></pre>\n"
        raw: "tested via\n```python\nimport torch.nn.functional as F\n\nfrom torch\
          \ import Tensor\nfrom transformers import AutoTokenizer, AutoModel\nimport\
          \ numpy as np\n\ndef average_pool(last_hidden_states: Tensor,\n        \
          \         attention_mask: Tensor) -> Tensor:\n    last_hidden = last_hidden_states.masked_fill(~attention_mask[...,\
          \ None].bool(), 0.0)\n    return last_hidden.sum(dim=1) / attention_mask.sum(dim=1)[...,\
          \ None]\n\n\n# Each input text should start with \"query: \" or \"passage:\
          \ \".\n# For tasks other than retrieval, you can simply use the \"query:\
          \ \" prefix.\ninput_texts = ['query: how much protein should a female eat',\n\
          \               'query: summit define',\n               \"passage: As a\
          \ general guideline, the CDC's average requirement of protein for women\
          \ ages 19 to 70 is 46 grams per day. But, as you can see from this chart,\
          \ you'll need to increase that if you're expecting or training for a marathon.\
          \ Check out the chart below to see how much protein you should be eating\
          \ each day.\",\n               \"passage: Definition of summit for English\
          \ Language Learners. : 1  the highest point of a mountain : the top of a\
          \ mountain. : 2  the highest level. : 3  a meeting or series of meetings\
          \ between the leaders of two or more governments.\"]\n\ntokenizer = AutoTokenizer.from_pretrained('intfloat/e5-small')\n\
          model = AutoModel.from_pretrained('intfloat/e5-small')\n\n# Tokenize the\
          \ input texts\nbatch_dict = tokenizer(input_texts, max_length=512, padding=True,\
          \ truncation=True, return_tensors='pt')\n\noutputs = model(**batch_dict)\n\
          embeddings = average_pool(outputs.last_hidden_state, batch_dict['attention_mask'])\n\
          \n# (Optionally) normalize embeddings\nembeddings_norm = F.normalize(embeddings,\
          \ p=2, dim=1)\nscores = (embeddings_norm[:2] @ embeddings_norm[2:].T) *\
          \ 100\n\nembeddings_norm = embeddings_norm.detach().numpy()\n\nfrom sentence_transformers\
          \ import SentenceTransformer\nmodel = SentenceTransformer('./e5-small')\n\
          embeddings_norm2 = model.encode(input_texts, normalize_embeddings=True)\n\
          \nnp.testing.assert_allclose(embeddings_norm, embeddings_norm2, atol=1e-6)\n\
          \n```"
        updatedAt: '2023-06-18T10:40:35.509Z'
      numEdits: 2
      reactions: []
    id: 648ddf2d98124663427c0d69
    type: comment
  author: michaelfeil
  content: "tested via\n```python\nimport torch.nn.functional as F\n\nfrom torch import\
    \ Tensor\nfrom transformers import AutoTokenizer, AutoModel\nimport numpy as np\n\
    \ndef average_pool(last_hidden_states: Tensor,\n                 attention_mask:\
    \ Tensor) -> Tensor:\n    last_hidden = last_hidden_states.masked_fill(~attention_mask[...,\
    \ None].bool(), 0.0)\n    return last_hidden.sum(dim=1) / attention_mask.sum(dim=1)[...,\
    \ None]\n\n\n# Each input text should start with \"query: \" or \"passage: \"\
    .\n# For tasks other than retrieval, you can simply use the \"query: \" prefix.\n\
    input_texts = ['query: how much protein should a female eat',\n              \
    \ 'query: summit define',\n               \"passage: As a general guideline, the\
    \ CDC's average requirement of protein for women ages 19 to 70 is 46 grams per\
    \ day. But, as you can see from this chart, you'll need to increase that if you're\
    \ expecting or training for a marathon. Check out the chart below to see how much\
    \ protein you should be eating each day.\",\n               \"passage: Definition\
    \ of summit for English Language Learners. : 1  the highest point of a mountain\
    \ : the top of a mountain. : 2  the highest level. : 3  a meeting or series of\
    \ meetings between the leaders of two or more governments.\"]\n\ntokenizer = AutoTokenizer.from_pretrained('intfloat/e5-small')\n\
    model = AutoModel.from_pretrained('intfloat/e5-small')\n\n# Tokenize the input\
    \ texts\nbatch_dict = tokenizer(input_texts, max_length=512, padding=True, truncation=True,\
    \ return_tensors='pt')\n\noutputs = model(**batch_dict)\nembeddings = average_pool(outputs.last_hidden_state,\
    \ batch_dict['attention_mask'])\n\n# (Optionally) normalize embeddings\nembeddings_norm\
    \ = F.normalize(embeddings, p=2, dim=1)\nscores = (embeddings_norm[:2] @ embeddings_norm[2:].T)\
    \ * 100\n\nembeddings_norm = embeddings_norm.detach().numpy()\n\nfrom sentence_transformers\
    \ import SentenceTransformer\nmodel = SentenceTransformer('./e5-small')\nembeddings_norm2\
    \ = model.encode(input_texts, normalize_embeddings=True)\n\nnp.testing.assert_allclose(embeddings_norm,\
    \ embeddings_norm2, atol=1e-6)\n\n```"
  created_at: 2023-06-17 15:28:29+00:00
  edited: true
  hidden: false
  id: 648ddf2d98124663427c0d69
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/5a1ee74c2dbe349a6ec9843a1599d281.svg
      fullname: Liang Wang
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: intfloat
      type: user
    createdAt: '2023-06-18T02:02:47.000Z'
    data:
      edited: false
      editors:
      - intfloat
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9397111535072327
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/5a1ee74c2dbe349a6ec9843a1599d281.svg
          fullname: Liang Wang
          isHf: false
          isPro: false
          name: intfloat
          type: user
        html: '<p>Thanks for your contribution! Really appreciate it.</p>

          '
        raw: Thanks for your contribution! Really appreciate it.
        updatedAt: '2023-06-18T02:02:47.981Z'
      numEdits: 0
      reactions: []
      relatedEventId: 648e65c8cd7fb3983ed1ef68
    id: 648e65c7cd7fb3983ed1ef66
    type: comment
  author: intfloat
  content: Thanks for your contribution! Really appreciate it.
  created_at: 2023-06-18 01:02:47+00:00
  edited: false
  hidden: false
  id: 648e65c7cd7fb3983ed1ef66
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/5a1ee74c2dbe349a6ec9843a1599d281.svg
      fullname: Liang Wang
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: intfloat
      type: user
    createdAt: '2023-06-18T02:02:48.000Z'
    data:
      status: merged
    id: 648e65c8cd7fb3983ed1ef68
    type: status-change
  author: intfloat
  created_at: 2023-06-18 01:02:48+00:00
  id: 648e65c8cd7fb3983ed1ef68
  new_status: merged
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/644fac0ce1d7a97f3b653ab1/fottSAPFrJdKeMW2UJv_l.jpeg?w=200&h=200&f=face
      fullname: Michael
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: michaelfeil
      type: user
    createdAt: '2023-06-18T10:40:43.000Z'
    data:
      edited: false
      editors:
      - michaelfeil
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8539390563964844
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/644fac0ce1d7a97f3b653ab1/fottSAPFrJdKeMW2UJv_l.jpeg?w=200&h=200&f=face
          fullname: Michael
          isHf: false
          isPro: false
          name: michaelfeil
          type: user
        html: '<p>Cool, thanks for making e5 available. </p>

          '
        raw: "Cool, thanks for making e5 available. \n"
        updatedAt: '2023-06-18T10:40:43.014Z'
      numEdits: 0
      reactions: []
    id: 648edf2b7799fc04940b881c
    type: comment
  author: michaelfeil
  content: "Cool, thanks for making e5 available. \n"
  created_at: 2023-06-18 09:40:43+00:00
  edited: false
  hidden: false
  id: 648edf2b7799fc04940b881c
  type: comment
is_pull_request: true
merge_commit_oid: c8dae5e43593121d58e9ddf22b40331cc563bddf
num: 6
repo_id: intfloat/e5-small
repo_type: model
status: merged
target_branch: refs/heads/main
title: compatibility_sentence_transformers
