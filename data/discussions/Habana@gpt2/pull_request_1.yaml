!!python/object:huggingface_hub.community.DiscussionWithDetails
author: zhaifly
conflicting_files: []
created_at: 2023-03-27 13:50:16+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/93ae2ae9d34c5b23f4653c82eb8b307f.svg
      fullname: Zhai
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: zhaifly
      type: user
    createdAt: '2023-03-27T14:50:16.000Z'
    data:
      edited: false
      editors:
      - zhaifly
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/93ae2ae9d34c5b23f4653c82eb8b307f.svg
          fullname: Zhai
          isHf: false
          isPro: false
          name: zhaifly
          type: user
        html: ''
        raw: ''
        updatedAt: '2023-03-27T14:50:16.113Z'
      numEdits: 0
      reactions: []
    id: 6421ad2804dcf8f198d86f0b
    type: comment
  author: zhaifly
  content: ''
  created_at: 2023-03-27 13:50:16+00:00
  edited: false
  hidden: false
  id: 6421ad2804dcf8f198d86f0b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
      fullname: "R\xE9gis Pierrard"
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: regisss
      type: user
    createdAt: '2023-03-27T15:09:42.000Z'
    data:
      edited: false
      editors:
      - regisss
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
          fullname: "R\xE9gis Pierrard"
          isHf: true
          isPro: false
          name: regisss
          type: user
        html: "<p>Hi <span data-props=\"{&quot;user&quot;:&quot;zhaifly&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/zhaifly\">@<span class=\"\
          underline\">zhaifly</span></a></span>\n\n\t</span></span>! Could you describe\
          \ a bit what you mean?<br>The title of your PR makes me think of a change\
          \ in modeling, which should take place in <a rel=\"nofollow\" href=\"https://github.com/huggingface/optimum-habana\"\
          >Optimum Habana</a>.</p>\n"
        raw: 'Hi @zhaifly! Could you describe a bit what you mean?

          The title of your PR makes me think of a change in modeling, which should
          take place in [Optimum Habana](https://github.com/huggingface/optimum-habana).'
        updatedAt: '2023-03-27T15:09:42.010Z'
      numEdits: 0
      reactions: []
    id: 6421b1b63f204ac24e17c0f5
    type: comment
  author: regisss
  content: 'Hi @zhaifly! Could you describe a bit what you mean?

    The title of your PR makes me think of a change in modeling, which should take
    place in [Optimum Habana](https://github.com/huggingface/optimum-habana).'
  created_at: 2023-03-27 14:09:42+00:00
  edited: false
  hidden: false
  id: 6421b1b63f204ac24e17c0f5
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/93ae2ae9d34c5b23f4653c82eb8b307f.svg
      fullname: Zhai
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: zhaifly
      type: user
    createdAt: '2023-03-27T15:21:45.000Z'
    data:
      status: closed
    id: 6421b489332961f4dfaa5ae9
    type: status-change
  author: zhaifly
  created_at: 2023-03-27 14:21:45+00:00
  id: 6421b489332961f4dfaa5ae9
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/93ae2ae9d34c5b23f4653c82eb8b307f.svg
      fullname: Zhai
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: zhaifly
      type: user
    createdAt: '2023-03-27T15:39:36.000Z'
    data:
      edited: false
      editors:
      - zhaifly
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/93ae2ae9d34c5b23f4653c82eb8b307f.svg
          fullname: Zhai
          isHf: false
          isPro: false
          name: zhaifly
          type: user
        html: "<blockquote>\n<p>Hi <span data-props=\"{&quot;user&quot;:&quot;zhaifly&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/zhaifly\"\
          >@<span class=\"underline\">zhaifly</span></a></span>\n\n\t</span></span>!\
          \ Could you describe a bit what you mean?<br>The title of your PR makes\
          \ me think of a change in modeling, which should take place in <a rel=\"\
          nofollow\" href=\"https://github.com/huggingface/optimum-habana\">Optimum\
          \ Habana</a>.</p>\n</blockquote>\n<p>hi <span data-props=\"{&quot;user&quot;:&quot;regisss&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/regisss\"\
          >@<span class=\"underline\">regisss</span></a></span>\n\n\t</span></span>,\
          \ I'm now optimizing the habana models ViT, Swin, GPT2, GPT-J and Neox,\
          \  I want to add more HABANA specific command line args, and which also\
          \ should be added into gaudi_config in each of model.<br>This PR is means:\
          \ add a <code>mark_step</code> between the  model.forward and loss.backward\
          \ for better performance when doing training(pipelining host BWD and device\
          \ FWD). There are lots of code changes  in my local side for the 5 models.\
          \ so  I will  temporary close this PR and reopen after the code ready.</p>\n"
        raw: '> Hi @zhaifly! Could you describe a bit what you mean?

          > The title of your PR makes me think of a change in modeling, which should
          take place in [Optimum Habana](https://github.com/huggingface/optimum-habana).


          hi @regisss, I''m now optimizing the habana models ViT, Swin, GPT2, GPT-J
          and Neox,  I want to add more HABANA specific command line args, and which
          also should be added into gaudi_config in each of model.

          This PR is means: add a `mark_step` between the  model.forward and loss.backward
          for better performance when doing training(pipelining host BWD and device
          FWD). There are lots of code changes  in my local side for the 5 models.
          so  I will  temporary close this PR and reopen after the code ready.'
        updatedAt: '2023-03-27T15:39:36.672Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\u2764\uFE0F"
        users:
        - regisss
    id: 6421b8b85acad90e6b6eec3c
    type: comment
  author: zhaifly
  content: '> Hi @zhaifly! Could you describe a bit what you mean?

    > The title of your PR makes me think of a change in modeling, which should take
    place in [Optimum Habana](https://github.com/huggingface/optimum-habana).


    hi @regisss, I''m now optimizing the habana models ViT, Swin, GPT2, GPT-J and
    Neox,  I want to add more HABANA specific command line args, and which also should
    be added into gaudi_config in each of model.

    This PR is means: add a `mark_step` between the  model.forward and loss.backward
    for better performance when doing training(pipelining host BWD and device FWD).
    There are lots of code changes  in my local side for the 5 models. so  I will  temporary
    close this PR and reopen after the code ready.'
  created_at: 2023-03-27 14:39:36+00:00
  edited: false
  hidden: false
  id: 6421b8b85acad90e6b6eec3c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
      fullname: "R\xE9gis Pierrard"
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: regisss
      type: user
    createdAt: '2023-03-27T16:12:14.000Z'
    data:
      edited: false
      editors:
      - regisss
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
          fullname: "R\xE9gis Pierrard"
          isHf: true
          isPro: false
          name: regisss
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;zhaifly&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/zhaifly\">@<span class=\"\
          underline\">zhaifly</span></a></span>\n\n\t</span></span> Sounds good!</p>\n\
          <p>A few recommendations:</p>\n<ul>\n<li>To add a <code>mark_step</code>\
          \ between the forward and backward methods, the best is to override the\
          \ <a rel=\"nofollow\" href=\"https://github.com/huggingface/transformers/blob/53155b520d6faab07ff185384ac04ee840106fc2/src/transformers/trainer.py#L2631\"\
          ><code>training_step</code></a> method in the <a rel=\"nofollow\" href=\"\
          https://github.com/huggingface/optimum-habana/blob/2762c17ff8353e917f7f99922970c1c7601d4f69/optimum/habana/transformers/trainer.py#L107\"\
          ><code>GaudiTrainer</code></a> class (unless it is specific to the models\
          \ you mentioned).</li>\n<li>To add more Habana-specific args, we should\
          \ first modify the <a rel=\"nofollow\" href=\"https://github.com/huggingface/optimum-habana/blob/2762c17ff8353e917f7f99922970c1c7601d4f69/optimum/habana/transformers/gaudi_configuration.py#L50\"\
          ><code>GaudiConfig</code></a> class. And then we can update the <code>gaudi_config.json</code>\
          \ here.</li>\n</ul>\n<p>Do not hesitate to ping me and open PRs on Github\
          \ when you start working on it :)</p>\n"
        raw: '@zhaifly Sounds good!


          A few recommendations:

          - To add a `mark_step` between the forward and backward methods, the best
          is to override the [`training_step`](https://github.com/huggingface/transformers/blob/53155b520d6faab07ff185384ac04ee840106fc2/src/transformers/trainer.py#L2631)
          method in the [`GaudiTrainer`](https://github.com/huggingface/optimum-habana/blob/2762c17ff8353e917f7f99922970c1c7601d4f69/optimum/habana/transformers/trainer.py#L107)
          class (unless it is specific to the models you mentioned).

          - To add more Habana-specific args, we should first modify the [`GaudiConfig`](https://github.com/huggingface/optimum-habana/blob/2762c17ff8353e917f7f99922970c1c7601d4f69/optimum/habana/transformers/gaudi_configuration.py#L50)
          class. And then we can update the `gaudi_config.json` here.


          Do not hesitate to ping me and open PRs on Github when you start working
          on it :)'
        updatedAt: '2023-03-27T16:12:14.323Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - zhaifly
    id: 6421c05eec91bf6c97939130
    type: comment
  author: regisss
  content: '@zhaifly Sounds good!


    A few recommendations:

    - To add a `mark_step` between the forward and backward methods, the best is to
    override the [`training_step`](https://github.com/huggingface/transformers/blob/53155b520d6faab07ff185384ac04ee840106fc2/src/transformers/trainer.py#L2631)
    method in the [`GaudiTrainer`](https://github.com/huggingface/optimum-habana/blob/2762c17ff8353e917f7f99922970c1c7601d4f69/optimum/habana/transformers/trainer.py#L107)
    class (unless it is specific to the models you mentioned).

    - To add more Habana-specific args, we should first modify the [`GaudiConfig`](https://github.com/huggingface/optimum-habana/blob/2762c17ff8353e917f7f99922970c1c7601d4f69/optimum/habana/transformers/gaudi_configuration.py#L50)
    class. And then we can update the `gaudi_config.json` here.


    Do not hesitate to ping me and open PRs on Github when you start working on it
    :)'
  created_at: 2023-03-27 15:12:14+00:00
  edited: false
  hidden: false
  id: 6421c05eec91bf6c97939130
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/93ae2ae9d34c5b23f4653c82eb8b307f.svg
      fullname: Zhai
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: zhaifly
      type: user
    createdAt: '2023-03-28T02:00:44.000Z'
    data:
      edited: true
      editors:
      - zhaifly
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/93ae2ae9d34c5b23f4653c82eb8b307f.svg
          fullname: Zhai
          isHf: false
          isPro: false
          name: zhaifly
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;regisss&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/regisss\">@<span class=\"\
          underline\">regisss</span></a></span>\n\n\t</span></span> appreciate your\
          \ suggestions and will follow your comments to clean my code.</p>\n"
        raw: '@regisss appreciate your suggestions and will follow your comments to
          clean my code.'
        updatedAt: '2023-03-28T02:00:52.624Z'
      numEdits: 1
      reactions: []
    id: 64224a4c3f204ac24e1be169
    type: comment
  author: zhaifly
  content: '@regisss appreciate your suggestions and will follow your comments to
    clean my code.'
  created_at: 2023-03-28 01:00:44+00:00
  edited: true
  hidden: false
  id: 64224a4c3f204ac24e1be169
  type: comment
is_pull_request: true
merge_commit_oid: null
num: 1
repo_id: Habana/gpt2
repo_type: model
status: closed
target_branch: refs/heads/main
title: optimize pipeline between device fwd and host bwd
