!!python/object:huggingface_hub.community.DiscussionWithDetails
author: olszd
conflicting_files: []
created_at: 2023-07-21 08:47:22+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/c6157f33cde44ccc27a911408622f38d.svg
      fullname: Dominika Olszewska
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: olszd
      type: user
    createdAt: '2023-07-21T09:47:22.000Z'
    data:
      edited: false
      editors:
      - olszd
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9871069192886353
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/c6157f33cde44ccc27a911408622f38d.svg
          fullname: Dominika Olszewska
          isHf: false
          isPro: false
          name: olszd
          type: user
        html: '<p>Mixed precision was turned off in this model due to the usage of
          Deepspeed</p>

          '
        raw: Mixed precision was turned off in this model due to the usage of Deepspeed
        updatedAt: '2023-07-21T09:47:22.140Z'
      numEdits: 0
      reactions: []
    id: 64ba542a367f9a0596337970
    type: comment
  author: olszd
  content: Mixed precision was turned off in this model due to the usage of Deepspeed
  created_at: 2023-07-21 08:47:22+00:00
  edited: false
  hidden: false
  id: 64ba542a367f9a0596337970
  type: comment
- !!python/object:huggingface_hub.community.DiscussionCommit
  _event:
    author:
      avatarUrl: /avatars/c6157f33cde44ccc27a911408622f38d.svg
      fullname: Dominika Olszewska
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: olszd
      type: user
    createdAt: '2023-07-21T09:47:22.000Z'
    data:
      oid: 06d0a0c721e5d88f3c76e112499a12d482bc8447
      parents:
      - 954e75b838981b4fb2eda2376312d012f756b0ef
      subject: Remove deprecated Habana mixed precision from gaudi config
    id: 64ba542a0000000000000000
    type: commit
  author: olszd
  created_at: 2023-07-21 08:47:22+00:00
  id: 64ba542a0000000000000000
  oid: 06d0a0c721e5d88f3c76e112499a12d482bc8447
  summary: Remove deprecated Habana mixed precision from gaudi config
  type: commit
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
      fullname: "R\xE9gis Pierrard"
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: regisss
      type: user
    createdAt: '2023-07-26T10:51:38.000Z'
    data:
      edited: false
      editors:
      - regisss
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8975641131401062
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
          fullname: "R\xE9gis Pierrard"
          isHf: true
          isPro: false
          name: regisss
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;olszd&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/olszd\">@<span class=\"\
          underline\">olszd</span></a></span>\n\n\t</span></span> Could you add <code>\"\
          use_torch_autocast\": true</code> in the Gaudi config please? Actually HMP\
          \ was enabled since we have <code>\"use_habana_mixed_precision\": true</code>.</p>\n\
          <p>Besides, regression tests didn't pass because there is an issue with\
          \ autocast when doing gradient checkpointing. So let's wait for this to\
          \ be solved before merging this PR.</p>\n"
        raw: '@olszd Could you add `"use_torch_autocast": true` in the Gaudi config
          please? Actually HMP was enabled since we have `"use_habana_mixed_precision":
          true`.


          Besides, regression tests didn''t pass because there is an issue with autocast
          when doing gradient checkpointing. So let''s wait for this to be solved
          before merging this PR.'
        updatedAt: '2023-07-26T10:51:38.884Z'
      numEdits: 0
      reactions: []
    id: 64c0faba9832a455bc31433c
    type: comment
  author: regisss
  content: '@olszd Could you add `"use_torch_autocast": true` in the Gaudi config
    please? Actually HMP was enabled since we have `"use_habana_mixed_precision":
    true`.


    Besides, regression tests didn''t pass because there is an issue with autocast
    when doing gradient checkpointing. So let''s wait for this to be solved before
    merging this PR.'
  created_at: 2023-07-26 09:51:38+00:00
  edited: false
  hidden: false
  id: 64c0faba9832a455bc31433c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
      fullname: "R\xE9gis Pierrard"
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: regisss
      type: user
    createdAt: '2023-07-26T17:08:29.000Z'
    data:
      edited: false
      editors:
      - regisss
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9550206661224365
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
          fullname: "R\xE9gis Pierrard"
          isHf: true
          isPro: false
          name: regisss
          type: user
        html: '<p>The issue with gradient checkpointing was solved, but default autocast
          is ~20% slower than HMP with custom ops. I tried autocast with custom ops,
          got similar speeds to HMP, but the loss is NaN. Let''s wait for <a rel="nofollow"
          href="https://github.com/huggingface/optimum-habana/pull/308">this PR</a>
          to be merged before doing anything here.</p>

          '
        raw: The issue with gradient checkpointing was solved, but default autocast
          is ~20% slower than HMP with custom ops. I tried autocast with custom ops,
          got similar speeds to HMP, but the loss is NaN. Let's wait for [this PR](https://github.com/huggingface/optimum-habana/pull/308)
          to be merged before doing anything here.
        updatedAt: '2023-07-26T17:08:29.883Z'
      numEdits: 0
      reactions: []
    id: 64c1530d406a9272ce797c79
    type: comment
  author: regisss
  content: The issue with gradient checkpointing was solved, but default autocast
    is ~20% slower than HMP with custom ops. I tried autocast with custom ops, got
    similar speeds to HMP, but the loss is NaN. Let's wait for [this PR](https://github.com/huggingface/optimum-habana/pull/308)
    to be merged before doing anything here.
  created_at: 2023-07-26 16:08:29+00:00
  edited: false
  hidden: false
  id: 64c1530d406a9272ce797c79
  type: comment
- !!python/object:huggingface_hub.community.DiscussionCommit
  _event:
    author:
      avatarUrl: /avatars/c6157f33cde44ccc27a911408622f38d.svg
      fullname: Dominika Olszewska
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: olszd
      type: user
    createdAt: '2023-09-26T13:04:36.000Z'
    data:
      oid: d2a3258238b10260ff2f112de13ecbd1f713c8c5
      parents:
      - 06d0a0c721e5d88f3c76e112499a12d482bc8447
      subject: Update gaudi_config.json
    id: 6512d6e40000000000000000
    type: commit
  author: olszd
  created_at: 2023-09-26 12:04:36+00:00
  id: 6512d6e40000000000000000
  oid: d2a3258238b10260ff2f112de13ecbd1f713c8c5
  summary: Update gaudi_config.json
  type: commit
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/c6157f33cde44ccc27a911408622f38d.svg
      fullname: Dominika Olszewska
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: olszd
      type: user
    createdAt: '2023-09-26T13:09:06.000Z'
    data:
      edited: false
      editors:
      - olszd
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7380381226539612
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/c6157f33cde44ccc27a911408622f38d.svg
          fullname: Dominika Olszewska
          isHf: false
          isPro: false
          name: olszd
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;regisss&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/regisss\">@<span class=\"\
          underline\">regisss</span></a></span>\n\n\t</span></span> I've updated the\
          \ config, can we retest now and merge if the tests pass? </p>\n"
        raw: '@regisss I''ve updated the config, can we retest now and merge if the
          tests pass? '
        updatedAt: '2023-09-26T13:09:06.093Z'
      numEdits: 0
      reactions: []
    id: 6512d7f213aa0728130d9312
    type: comment
  author: olszd
  content: '@regisss I''ve updated the config, can we retest now and merge if the
    tests pass? '
  created_at: 2023-09-26 12:09:06+00:00
  edited: false
  hidden: false
  id: 6512d7f213aa0728130d9312
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
      fullname: "R\xE9gis Pierrard"
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: regisss
      type: user
    createdAt: '2023-10-20T09:13:27.000Z'
    data:
      edited: false
      editors:
      - regisss
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7226772308349609
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
          fullname: "R\xE9gis Pierrard"
          isHf: true
          isPro: false
          name: regisss
          type: user
        html: '<p>I updated the Gaudi config with custom bf16/fp32 op lists that give
          better throughput and similar accuracy, closing this one: <a href="https://huggingface.co/Habana/gpt2/blob/main/gaudi_config.json">https://huggingface.co/Habana/gpt2/blob/main/gaudi_config.json</a></p>

          '
        raw: 'I updated the Gaudi config with custom bf16/fp32 op lists that give
          better throughput and similar accuracy, closing this one: https://huggingface.co/Habana/gpt2/blob/main/gaudi_config.json'
        updatedAt: '2023-10-20T09:13:27.171Z'
      numEdits: 0
      reactions: []
      relatedEventId: 653244b7548eae0c990c346f
    id: 653244b7548eae0c990c346e
    type: comment
  author: regisss
  content: 'I updated the Gaudi config with custom bf16/fp32 op lists that give better
    throughput and similar accuracy, closing this one: https://huggingface.co/Habana/gpt2/blob/main/gaudi_config.json'
  created_at: 2023-10-20 08:13:27+00:00
  edited: false
  hidden: false
  id: 653244b7548eae0c990c346e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
      fullname: "R\xE9gis Pierrard"
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: regisss
      type: user
    createdAt: '2023-10-20T09:13:27.000Z'
    data:
      status: closed
    id: 653244b7548eae0c990c346f
    type: status-change
  author: regisss
  created_at: 2023-10-20 08:13:27+00:00
  id: 653244b7548eae0c990c346f
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
      fullname: "R\xE9gis Pierrard"
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: regisss
      type: user
    createdAt: '2023-11-24T13:45:49.000Z'
    data:
      edited: false
      editors:
      - regisss
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9331535696983337
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1644920200150-620b7c408f5871b8a1a168a7.jpeg?w=200&h=200&f=face
          fullname: "R\xE9gis Pierrard"
          isHf: true
          isPro: false
          name: regisss
          type: user
        html: '<p>I''m getting better results keeping the same custom ops (the current
          ones with HMP) for autocast than default autocast, so I''m going to update
          that directly.</p>

          '
        raw: I'm getting better results keeping the same custom ops (the current ones
          with HMP) for autocast than default autocast, so I'm going to update that
          directly.
        updatedAt: '2023-11-24T13:45:49.816Z'
      numEdits: 0
      reactions: []
    id: 6560a90d2324e4d25c86c340
    type: comment
  author: regisss
  content: I'm getting better results keeping the same custom ops (the current ones
    with HMP) for autocast than default autocast, so I'm going to update that directly.
  created_at: 2023-11-24 13:45:49+00:00
  edited: false
  hidden: false
  id: 6560a90d2324e4d25c86c340
  type: comment
is_pull_request: true
merge_commit_oid: null
num: 4
repo_id: Habana/gpt2
repo_type: model
status: closed
target_branch: refs/heads/main
title: Remove deprecated Habana mixed precision from gaudi config
