!!python/object:huggingface_hub.community.DiscussionWithDetails
author: yuryya
conflicting_files: null
created_at: 2023-10-12 00:28:48+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0e9e141c9ad9f15046d676888ca5909a.svg
      fullname: Yury
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: yuryya
      type: user
    createdAt: '2023-10-12T01:28:48.000Z'
    data:
      edited: false
      editors:
      - yuryya
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7103665471076965
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0e9e141c9ad9f15046d676888ca5909a.svg
          fullname: Yury
          isHf: false
          isPro: false
          name: yuryya
          type: user
        html: '<p>This model has special tokens, which <a href="https://huggingface.co/bigcode/santacoder/blob/cd86b9757a24d90ce2d1b2e26edc4bcacb1e624d/special_tokens_map.json">start
          with "fim-"</a>, while StarCoder model uses tokens <a href="https://huggingface.co/bigcode/starcoder/blob/354f883c9e9f777cd3eef6820f6c6f6dd892c102/special_tokens_map.json">starting
          with "fim_"</a>. VSCode client is working with StarCoder by default, so
          <a rel="nofollow" href="https://github.com/huggingface/llm-vscode/blob/5ff71e47e9e8ef6cbebd3ad346188c505e0c3c94/package.json#L102">it
          uses "fim_" tokens</a>. This leads to improper work of SantaCoder when VSCode
          endpoint is changed to it: "fim_..." tokens are parsed as text, and the
          model adds them to the output from time to time.</p>

          <p>Workaround: change token names "fim_" to "fim-" in the VSCode extension
          settings when SantaCoder is used.</p>

          <p>Proposal: change "fim-" to "fim_" for this model.</p>

          '
        raw: "This model has special tokens, which [start with \"fim-\"](https://huggingface.co/bigcode/santacoder/blob/cd86b9757a24d90ce2d1b2e26edc4bcacb1e624d/special_tokens_map.json),\
          \ while StarCoder model uses tokens [starting with \"fim_\"](https://huggingface.co/bigcode/starcoder/blob/354f883c9e9f777cd3eef6820f6c6f6dd892c102/special_tokens_map.json).\
          \ VSCode client is working with StarCoder by default, so [it uses \"fim_\"\
          \ tokens](https://github.com/huggingface/llm-vscode/blob/5ff71e47e9e8ef6cbebd3ad346188c505e0c3c94/package.json#L102).\
          \ This leads to improper work of SantaCoder when VSCode endpoint is changed\
          \ to it: \"fim_...\" tokens are parsed as text, and the model adds them\
          \ to the output from time to time.\r\n\r\nWorkaround: change token names\
          \ \"fim_\" to \"fim-\" in the VSCode extension settings when SantaCoder\
          \ is used.\r\n\r\nProposal: change \"fim-\" to \"fim_\" for this model."
        updatedAt: '2023-10-12T01:28:48.898Z'
      numEdits: 0
      reactions: []
    id: 65274bd0d4670b0875259db4
    type: comment
  author: yuryya
  content: "This model has special tokens, which [start with \"fim-\"](https://huggingface.co/bigcode/santacoder/blob/cd86b9757a24d90ce2d1b2e26edc4bcacb1e624d/special_tokens_map.json),\
    \ while StarCoder model uses tokens [starting with \"fim_\"](https://huggingface.co/bigcode/starcoder/blob/354f883c9e9f777cd3eef6820f6c6f6dd892c102/special_tokens_map.json).\
    \ VSCode client is working with StarCoder by default, so [it uses \"fim_\" tokens](https://github.com/huggingface/llm-vscode/blob/5ff71e47e9e8ef6cbebd3ad346188c505e0c3c94/package.json#L102).\
    \ This leads to improper work of SantaCoder when VSCode endpoint is changed to\
    \ it: \"fim_...\" tokens are parsed as text, and the model adds them to the output\
    \ from time to time.\r\n\r\nWorkaround: change token names \"fim_\" to \"fim-\"\
    \ in the VSCode extension settings when SantaCoder is used.\r\n\r\nProposal: change\
    \ \"fim-\" to \"fim_\" for this model."
  created_at: 2023-10-12 00:28:48+00:00
  edited: false
  hidden: false
  id: 65274bd0d4670b0875259db4
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1666977434736-617bc8d1000dbbbf7c225eed.png?w=200&h=200&f=face
      fullname: Luc Georges
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: mcpotato
      type: user
    createdAt: '2023-10-12T09:17:06.000Z'
    data:
      edited: false
      editors:
      - mcpotato
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8192269206047058
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1666977434736-617bc8d1000dbbbf7c225eed.png?w=200&h=200&f=face
          fullname: Luc Georges
          isHf: true
          isPro: false
          name: mcpotato
          type: user
        html: "<p>Hello <span data-props=\"{&quot;user&quot;:&quot;yuryya&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/yuryya\"\
          >@<span class=\"underline\">yuryya</span></a></span>\n\n\t</span></span>,\
          \ are you certain to have configured the following settings to the right\
          \ values?<br><a rel=\"nofollow\" href=\"https://cdn-uploads.huggingface.co/production/uploads/617bc8d1000dbbbf7c225eed/X1TmgWi2ow4HFHsbiW6TT.png\"\
          ><img alt=\"Screenshot 2023-10-12 at 11.15.42.png\" src=\"https://cdn-uploads.huggingface.co/production/uploads/617bc8d1000dbbbf7c225eed/X1TmgWi2ow4HFHsbiW6TT.png\"\
          ></a><br>If so, please open an issue in <a rel=\"nofollow\" href=\"https://github.com/huggingface/llm-vscode\"\
          >https://github.com/huggingface/llm-vscode</a> with the detail of your problems.</p>\n"
        raw: 'Hello @yuryya, are you certain to have configured the following settings
          to the right values?

          ![Screenshot 2023-10-12 at 11.15.42.png](https://cdn-uploads.huggingface.co/production/uploads/617bc8d1000dbbbf7c225eed/X1TmgWi2ow4HFHsbiW6TT.png)

          If so, please open an issue in https://github.com/huggingface/llm-vscode
          with the detail of your problems.'
        updatedAt: '2023-10-12T09:17:06.747Z'
      numEdits: 0
      reactions: []
    id: 6527b99291b85c8e22b48dc9
    type: comment
  author: mcpotato
  content: 'Hello @yuryya, are you certain to have configured the following settings
    to the right values?

    ![Screenshot 2023-10-12 at 11.15.42.png](https://cdn-uploads.huggingface.co/production/uploads/617bc8d1000dbbbf7c225eed/X1TmgWi2ow4HFHsbiW6TT.png)

    If so, please open an issue in https://github.com/huggingface/llm-vscode with
    the detail of your problems.'
  created_at: 2023-10-12 08:17:06+00:00
  edited: false
  hidden: false
  id: 6527b99291b85c8e22b48dc9
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0e9e141c9ad9f15046d676888ca5909a.svg
      fullname: Yury
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: yuryya
      type: user
    createdAt: '2023-10-12T10:12:36.000Z'
    data:
      edited: false
      editors:
      - yuryya
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8587437272071838
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0e9e141c9ad9f15046d676888ca5909a.svg
          fullname: Yury
          isHf: false
          isPro: false
          name: yuryya
          type: user
        html: '<p>Hello! Sure, I mentioned this way as "workaround" in my proposal.</p>

          <p>The problem is that it is not evident way. Since StarCoder and SantaCoder
          are from the save vendor and for the same task, there is no good reason
          to look in the config again. Moreover,  difference like <code>&lt;fim_prefix&gt;</code>
          and <code>&lt;fim-prefix&gt;</code> is too hard to notice for human, and
          the error manifests not every time.</p>

          <p>Yes, problem can be solved by adding <a rel="nofollow" href="https://github.com/huggingface/llm-vscode/blob/5ff71e47e9e8ef6cbebd3ad346188c505e0c3c94/src/configTemplates.ts#L29">a
          separate template</a> for SantaCoder in <a rel="nofollow" href="https://github.com/huggingface/llm-vscode">https://github.com/huggingface/llm-vscode</a>.
          It will work for default configurations, while model interfaces will remain
          different. But it is better than nothing, I will create PR when I have time.</p>

          <p>Maybe, we can also add a note in <a href="https://huggingface.co/bigcode/santacoder/blob/132eb6b6cedaf579c2f333f1ecd78a16d7e45978/README.md">README</a>
          like "this model uses different tokens, comparing to StarCoder (<code>fim-</code>
          instead of <code>fim_</code>), so be careful in the case of migration between
          them".</p>

          '
        raw: 'Hello! Sure, I mentioned this way as "workaround" in my proposal.


          The problem is that it is not evident way. Since StarCoder and SantaCoder
          are from the save vendor and for the same task, there is no good reason
          to look in the config again. Moreover,  difference like `<fim_prefix>` and
          `<fim-prefix>` is too hard to notice for human, and the error manifests
          not every time.


          Yes, problem can be solved by adding [a separate template](https://github.com/huggingface/llm-vscode/blob/5ff71e47e9e8ef6cbebd3ad346188c505e0c3c94/src/configTemplates.ts#L29)
          for SantaCoder in https://github.com/huggingface/llm-vscode. It will work
          for default configurations, while model interfaces will remain different.
          But it is better than nothing, I will create PR when I have time.


          Maybe, we can also add a note in [README](https://huggingface.co/bigcode/santacoder/blob/132eb6b6cedaf579c2f333f1ecd78a16d7e45978/README.md)
          like "this model uses different tokens, comparing to StarCoder (`fim-` instead
          of `fim_`), so be careful in the case of migration between them".'
        updatedAt: '2023-10-12T10:12:36.750Z'
      numEdits: 0
      reactions: []
    id: 6527c694f39fb90337174fda
    type: comment
  author: yuryya
  content: 'Hello! Sure, I mentioned this way as "workaround" in my proposal.


    The problem is that it is not evident way. Since StarCoder and SantaCoder are
    from the save vendor and for the same task, there is no good reason to look in
    the config again. Moreover,  difference like `<fim_prefix>` and `<fim-prefix>`
    is too hard to notice for human, and the error manifests not every time.


    Yes, problem can be solved by adding [a separate template](https://github.com/huggingface/llm-vscode/blob/5ff71e47e9e8ef6cbebd3ad346188c505e0c3c94/src/configTemplates.ts#L29)
    for SantaCoder in https://github.com/huggingface/llm-vscode. It will work for
    default configurations, while model interfaces will remain different. But it is
    better than nothing, I will create PR when I have time.


    Maybe, we can also add a note in [README](https://huggingface.co/bigcode/santacoder/blob/132eb6b6cedaf579c2f333f1ecd78a16d7e45978/README.md)
    like "this model uses different tokens, comparing to StarCoder (`fim-` instead
    of `fim_`), so be careful in the case of migration between them".'
  created_at: 2023-10-12 09:12:36+00:00
  edited: false
  hidden: false
  id: 6527c694f39fb90337174fda
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/61c141342aac764ce1654e43/81AwoT5IQ_Xdw0OVw7TKu.jpeg?w=200&h=200&f=face
      fullname: Loubna Ben Allal
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: loubnabnl
      type: user
    createdAt: '2023-10-12T16:44:37.000Z'
    data:
      edited: false
      editors:
      - loubnabnl
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9097811579704285
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/61c141342aac764ce1654e43/81AwoT5IQ_Xdw0OVw7TKu.jpeg?w=200&h=200&f=face
          fullname: Loubna Ben Allal
          isHf: true
          isPro: false
          name: loubnabnl
          type: user
        html: '<p>Hello, both models are by BigCode but it''s not the same family
          of models e.g all StarCoder variants (15B, 7B, 3B.. ) have the same FIM
          tokens. But I added the note you suggested to the "How to use FIM section"
          in the readme <a href="https://huggingface.co/bigcode/santacoder/discussions/42">https://huggingface.co/bigcode/santacoder/discussions/42</a>.</p>

          '
        raw: Hello, both models are by BigCode but it's not the same family of models
          e.g all StarCoder variants (15B, 7B, 3B.. ) have the same FIM tokens. But
          I added the note you suggested to the "How to use FIM section" in the readme
          https://huggingface.co/bigcode/santacoder/discussions/42.
        updatedAt: '2023-10-12T16:44:37.453Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - yuryya
    id: 65282275598467feb323dca7
    type: comment
  author: loubnabnl
  content: Hello, both models are by BigCode but it's not the same family of models
    e.g all StarCoder variants (15B, 7B, 3B.. ) have the same FIM tokens. But I added
    the note you suggested to the "How to use FIM section" in the readme https://huggingface.co/bigcode/santacoder/discussions/42.
  created_at: 2023-10-12 15:44:37+00:00
  edited: false
  hidden: false
  id: 65282275598467feb323dca7
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/49328849866095f481ee72eb5dd066e2.svg
      fullname: Adam klein
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Thinkcru
      type: user
    createdAt: '2023-10-13T13:01:08.000Z'
    data:
      edited: false
      editors:
      - Thinkcru
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8704605102539062
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/49328849866095f481ee72eb5dd066e2.svg
          fullname: Adam klein
          isHf: false
          isPro: false
          name: Thinkcru
          type: user
        html: '<p>Oh man... I am one human that totally missed the <code>_</code>
          vs <code>-</code> I wish they used the same token type.</p>

          '
        raw: Oh man... I am one human that totally missed the `_` vs `-` I wish they
          used the same token type.
        updatedAt: '2023-10-13T13:01:08.177Z'
      numEdits: 0
      reactions: []
    id: 65293f943efa1da5dde4a0d1
    type: comment
  author: Thinkcru
  content: Oh man... I am one human that totally missed the `_` vs `-` I wish they
    used the same token type.
  created_at: 2023-10-13 12:01:08+00:00
  edited: false
  hidden: false
  id: 65293f943efa1da5dde4a0d1
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 41
repo_id: bigcode/santacoder
repo_type: model
status: open
target_branch: null
title: 'Token inconsistency with Starcoder: fim_ or fim-'
