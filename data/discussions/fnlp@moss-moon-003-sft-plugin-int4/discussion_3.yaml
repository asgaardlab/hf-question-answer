!!python/object:huggingface_hub.community.DiscussionWithDetails
author: hua0424
conflicting_files: null
created_at: 2023-04-26 07:49:26+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/7b7302a61f2adfa6be047a65912e59b2.svg
      fullname: hua xue
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: hua0424
      type: user
    createdAt: '2023-04-26T08:49:26.000Z'
    data:
      edited: false
      editors:
      - hua0424
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/7b7302a61f2adfa6be047a65912e59b2.svg
          fullname: hua xue
          isHf: false
          isPro: false
          name: hua0424
          type: user
        html: '<p>I run this project by Streamlit. I can see the page, but got error
          when I press "send" button.</p>

          <p>ps: I follow the guide in readme.<br>That''s the error stack print on
          console and web page:</p>

          <p>TypeError: ''&lt;'' not supported between instances of ''tuple'' and
          ''float''<br>Traceback:<br>File "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/scriptrunner/script_runner.py",
          line 561, in _run_script<br>    self._session_state.on_script_will_rerun(rerun_data.widget_states)<br>File
          "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/safe_session_state.py",
          line 68, in on_script_will_rerun<br>    self._state.on_script_will_rerun(latest_widget_states)<br>File
          "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/session_state.py",
          line 476, in on_script_will_rerun<br>    self._call_callbacks()<br>File
          "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/session_state.py",
          line 489, in _call_callbacks<br>    self._new_widget_state.call_callback(wid)<br>File
          "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/session_state.py",
          line 244, in call_callback<br>    callback(*args, **kwargs)<br>File "moss_web_demo_streamlit.py",
          line 69, in generate_answer<br>    generated_ids = model.generate(<br>File
          "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/autograd/grad_mode.py",
          line 28, in decorate_context<br>    return func(*args, **kwargs)<br>File
          "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/transformers/generation/utils.py",
          line 1518, in generate<br>    return self.greedy_search(<br>File "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/transformers/generation/utils.py",
          line 2285, in greedy_search<br>    outputs = self(<br>File "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py",
          line 1102, in _call_impl<br>    return forward_call(*input, **kwargs)<br>File
          "/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py",
          line 678, in forward<br>    transformer_outputs = self.transformer(<br>File
          "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py",
          line 1102, in _call_impl<br>    return forward_call(*input, **kwargs)<br>File
          "/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py",
          line 545, in forward<br>    outputs = block(<br>File "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py",
          line 1102, in _call_impl<br>    return forward_call(*input, **kwargs)<br>File
          "/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py",
          line 270, in forward<br>    attn_outputs = self.attn(<br>File "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py",
          line 1102, in _call_impl<br>    return forward_call(*input, **kwargs)<br>File
          "/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py",
          line 164, in forward<br>    qkv = self.qkv_proj(hidden_states)<br>File "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py",
          line 1102, in _call_impl<br>    return forward_call(*input, **kwargs)<br>File
          "/root/.cache/huggingface/modules/transformers_modules/local/quantization.py",
          line 367, in forward<br>    out = QuantLinearFunction.apply(x.reshape(-1,
          x.shape[-1]), self.qweight, self.scales,<br>File "/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/cuda/amp/autocast_mode.py",
          line 94, in decorate_fwd<br>    return fwd(*args, **kwargs)<br>File "/root/.cache/huggingface/modules/transformers_modules/local/quantization.py",
          line 279, in forward<br>    output = matmul248(input, qweight, scales, qzeros,
          g_idx, bits, maxq)<br>File "/root/.cache/huggingface/modules/transformers_modules/local/quantization.py",
          line 250, in matmul248<br>    matmul_248_kernel[grid](input, qweight, output,<br>File
          "/usr/local/app/jupyterlab/moss/MOSS/models/custom_autotune.py", line 93,
          in run<br>    self.cache[key] = builtins.min(timings, key=timings.get)</p>

          '
        raw: "I run this project by Streamlit. I can see the page, but got error when\
          \ I press \"send\" button.\r\n\r\nps: I follow the guide in readme.\r\n\
          That's the error stack print on console and web page:\r\n\r\nTypeError:\
          \ '<' not supported between instances of 'tuple' and 'float'\r\nTraceback:\r\
          \nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/scriptrunner/script_runner.py\"\
          , line 561, in _run_script\r\n    self._session_state.on_script_will_rerun(rerun_data.widget_states)\r\
          \nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/safe_session_state.py\"\
          , line 68, in on_script_will_rerun\r\n    self._state.on_script_will_rerun(latest_widget_states)\r\
          \nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/session_state.py\"\
          , line 476, in on_script_will_rerun\r\n    self._call_callbacks()\r\nFile\
          \ \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/session_state.py\"\
          , line 489, in _call_callbacks\r\n    self._new_widget_state.call_callback(wid)\r\
          \nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/session_state.py\"\
          , line 244, in call_callback\r\n    callback(*args, **kwargs)\r\nFile \"\
          moss_web_demo_streamlit.py\", line 69, in generate_answer\r\n    generated_ids\
          \ = model.generate(\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/autograd/grad_mode.py\"\
          , line 28, in decorate_context\r\n    return func(*args, **kwargs)\r\nFile\
          \ \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/transformers/generation/utils.py\"\
          , line 1518, in generate\r\n    return self.greedy_search(\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/transformers/generation/utils.py\"\
          , line 2285, in greedy_search\r\n    outputs = self(\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\
          \nFile \"/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py\"\
          , line 678, in forward\r\n    transformer_outputs = self.transformer(\r\n\
          File \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\
          \nFile \"/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py\"\
          , line 545, in forward\r\n    outputs = block(\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\
          \nFile \"/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py\"\
          , line 270, in forward\r\n    attn_outputs = self.attn(\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\
          \nFile \"/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py\"\
          , line 164, in forward\r\n    qkv = self.qkv_proj(hidden_states)\r\nFile\
          \ \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\
          \nFile \"/root/.cache/huggingface/modules/transformers_modules/local/quantization.py\"\
          , line 367, in forward\r\n    out = QuantLinearFunction.apply(x.reshape(-1,\
          \ x.shape[-1]), self.qweight, self.scales,\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/cuda/amp/autocast_mode.py\"\
          , line 94, in decorate_fwd\r\n    return fwd(*args, **kwargs)\r\nFile \"\
          /root/.cache/huggingface/modules/transformers_modules/local/quantization.py\"\
          , line 279, in forward\r\n    output = matmul248(input, qweight, scales,\
          \ qzeros, g_idx, bits, maxq)\r\nFile \"/root/.cache/huggingface/modules/transformers_modules/local/quantization.py\"\
          , line 250, in matmul248\r\n    matmul_248_kernel[grid](input, qweight,\
          \ output,\r\nFile \"/usr/local/app/jupyterlab/moss/MOSS/models/custom_autotune.py\"\
          , line 93, in run\r\n    self.cache[key] = builtins.min(timings, key=timings.get)"
        updatedAt: '2023-04-26T08:49:26.934Z'
      numEdits: 0
      reactions: []
    id: 6448e596638bfa3ce1381a56
    type: comment
  author: hua0424
  content: "I run this project by Streamlit. I can see the page, but got error when\
    \ I press \"send\" button.\r\n\r\nps: I follow the guide in readme.\r\nThat's\
    \ the error stack print on console and web page:\r\n\r\nTypeError: '<' not supported\
    \ between instances of 'tuple' and 'float'\r\nTraceback:\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/scriptrunner/script_runner.py\"\
    , line 561, in _run_script\r\n    self._session_state.on_script_will_rerun(rerun_data.widget_states)\r\
    \nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/safe_session_state.py\"\
    , line 68, in on_script_will_rerun\r\n    self._state.on_script_will_rerun(latest_widget_states)\r\
    \nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/session_state.py\"\
    , line 476, in on_script_will_rerun\r\n    self._call_callbacks()\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/session_state.py\"\
    , line 489, in _call_callbacks\r\n    self._new_widget_state.call_callback(wid)\r\
    \nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/streamlit/runtime/state/session_state.py\"\
    , line 244, in call_callback\r\n    callback(*args, **kwargs)\r\nFile \"moss_web_demo_streamlit.py\"\
    , line 69, in generate_answer\r\n    generated_ids = model.generate(\r\nFile \"\
    /usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/autograd/grad_mode.py\"\
    , line 28, in decorate_context\r\n    return func(*args, **kwargs)\r\nFile \"\
    /usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/transformers/generation/utils.py\"\
    , line 1518, in generate\r\n    return self.greedy_search(\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/transformers/generation/utils.py\"\
    , line 2285, in greedy_search\r\n    outputs = self(\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
    , line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\nFile\
    \ \"/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py\"\
    , line 678, in forward\r\n    transformer_outputs = self.transformer(\r\nFile\
    \ \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
    , line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\nFile\
    \ \"/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py\"\
    , line 545, in forward\r\n    outputs = block(\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
    , line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\nFile\
    \ \"/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py\"\
    , line 270, in forward\r\n    attn_outputs = self.attn(\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
    , line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\nFile\
    \ \"/root/.cache/huggingface/modules/transformers_modules/local/modeling_moss.py\"\
    , line 164, in forward\r\n    qkv = self.qkv_proj(hidden_states)\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
    , line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\nFile\
    \ \"/root/.cache/huggingface/modules/transformers_modules/local/quantization.py\"\
    , line 367, in forward\r\n    out = QuantLinearFunction.apply(x.reshape(-1, x.shape[-1]),\
    \ self.qweight, self.scales,\r\nFile \"/usr/local/lib/miniconda3/envs/moss/lib/python3.8/site-packages/torch/cuda/amp/autocast_mode.py\"\
    , line 94, in decorate_fwd\r\n    return fwd(*args, **kwargs)\r\nFile \"/root/.cache/huggingface/modules/transformers_modules/local/quantization.py\"\
    , line 279, in forward\r\n    output = matmul248(input, qweight, scales, qzeros,\
    \ g_idx, bits, maxq)\r\nFile \"/root/.cache/huggingface/modules/transformers_modules/local/quantization.py\"\
    , line 250, in matmul248\r\n    matmul_248_kernel[grid](input, qweight, output,\r\
    \nFile \"/usr/local/app/jupyterlab/moss/MOSS/models/custom_autotune.py\", line\
    \ 93, in run\r\n    self.cache[key] = builtins.min(timings, key=timings.get)"
  created_at: 2023-04-26 07:49:26+00:00
  edited: false
  hidden: false
  id: 6448e596638bfa3ce1381a56
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 3
repo_id: fnlp/moss-moon-003-sft-plugin-int4
repo_type: model
status: open
target_branch: null
title: show error:'<' not supported between instances of 'tuple' and 'float'
