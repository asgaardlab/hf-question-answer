!!python/object:huggingface_hub.community.DiscussionWithDetails
author: mauricio-repetto
conflicting_files: null
created_at: 2023-07-16 01:11:28+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1653673654684-noauth.jpeg?w=200&h=200&f=face
      fullname: "Andr\xE9s Mauricio Repetto Ferrero"
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: mauricio-repetto
      type: user
    createdAt: '2023-07-16T02:11:28.000Z'
    data:
      edited: true
      editors:
      - mauricio-repetto
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6389687061309814
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1653673654684-noauth.jpeg?w=200&h=200&f=face
          fullname: "Andr\xE9s Mauricio Repetto Ferrero"
          isHf: false
          isPro: false
          name: mauricio-repetto
          type: user
        html: "<p>Hi, </p>\n<p>Is this model available for dreambooth? I tried to\
          \ run the regular script for this model to see how good it is in comparison\
          \ with the other sd versions but I'm getting an error :'(</p>\n<p>This is\
          \ the configuration I'm using:</p>\n<pre><code>!accelerate launch train_dreambooth.py\
          \ \\\n  --pretrained_model_name_or_path=\"stabilityai/stable-diffusion-xl-base-0.9\"\
          \  \\\n  --instance_data_dir=\"./pneumoconiosis\" \\\n  --class_data_dir=\"\
          ./data/xray\" \\\n  --output_dir=\"./diffusion/pneumoconiosis/models/stable-diffusion-xl-pneumoconiosis-finetuned\"\
          \ \\\n  --train_text_encoder \\\n  --mixed_precision=\"fp16\" \\\n  --with_prior_preservation\
          \ --prior_loss_weight=1.0 \\\n  --instance_prompt=\"image of a pneumoconiosis\
          \ xray\" \\\n  --class_prompt=\"image of a xray\" \\\n  --resolution=512\
          \ \\\n  --train_batch_size=1 \\\n  --gradient_accumulation_steps=2 --gradient_checkpointing\
          \ \\\n  --use_8bit_adam \\\n  --learning_rate=5e-6 \\\n  --lr_scheduler=\"\
          constant\" \\\n  --lr_warmup_steps=0 \\\n  --num_class_images=200 \\\n \
          \ --max_train_steps=11400 \\\n  --checkpointing_steps=4000 \\\n  --num_validation_images=4\
          \ \\\n  --report_to=\"wandb\" \\\n  --seed=1337\n</code></pre>\n<p>this\
          \ is the error:</p>\n<pre><code>2023-07-16 01:08:42.735258: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38]\
          \ TF-TRT Warning: Could not find TensorRT\n2023-07-16 01:08:48.477573: W\
          \ tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning:\
          \ Could not find TensorRT\n07/16/2023 01:08:51 - INFO - __main__ - Distributed\
          \ environment: NO\nNum processes: 1\nProcess index: 0\nLocal process index:\
          \ 0\nDevice: cuda\n\nMixed precision type: fp16\n\nKeyword arguments {'safety_checker':\
          \ None} are not expected by StableDiffusionXLPipeline and will be ignored.\n\
          Loading pipeline components...:   0% 0/7 [00:00&lt;?, ?it/s]Loaded text_encoder_2\
          \ as CLIPTextModelWithProjection from `text_encoder_2` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...:  14% 1/7 [00:01&lt;00:09,  1.61s/it]{'force_upcast'}\
          \ was not found in config. Values will be initialized to default values.\n\
          Loaded vae as AutoencoderKL from `vae` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...:  29% 2/7 [00:01&lt;00:04,  1.24it/s]Loaded\
          \ text_encoder as CLIPTextModel from `text_encoder` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...:  43% 3/7 [00:02&lt;00:02,  1.47it/s]Loaded\
          \ tokenizer_2 as CLIPTokenizer from `tokenizer_2` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loaded tokenizer as CLIPTokenizer from `tokenizer` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...:  71% 5/7 [00:02&lt;00:00,  3.02it/s]Loaded\
          \ unet as UNet2DConditionModel from `unet` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...:  86% 6/7 [00:07&lt;00:01,  1.72s/it]Loaded\
          \ scheduler as EulerDiscreteScheduler from `scheduler` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...: 100% 7/7 [00:07&lt;00:00,  1.10s/it]\n07/16/2023\
          \ 01:08:59 - INFO - __main__ - Number of class images to sample: 200.\n\
          Generating class images: 100% 50/50 [19:51&lt;00:00, 23.83s/it]\nYou are\
          \ using a model of type clip_text_model to instantiate a model of type .\
          \ This is not supported for all configurations of models and can yield errors.\n\
          {'variance_type'} was not found in config. Values will be initialized to\
          \ default values.\n{'force_upcast'} was not found in config. Values will\
          \ be initialized to default values.\nwandb: Currently logged in as: amd-repetto\
          \ (only-my-team). Use `wandb login --relogin` to force relogin\nwandb: Tracking\
          \ run with wandb version 0.15.5\nwandb: Run data is saved locally in /content/wandb/run-20230716_012903-r6j5zx8r\n\
          wandb: Run `wandb offline` to turn off syncing.\nwandb: Syncing run azure-shadow-26\n\
          wandb: \u2B50\uFE0F View project at https://wandb.ai/only-my-team/dreambooth\n\
          wandb: \U0001F680 View run at https://wandb.ai/only-my-team/dreambooth/runs/r6j5zx8r\n\
          07/16/2023 01:29:03 - INFO - __main__ - ***** Running training *****\n07/16/2023\
          \ 01:29:03 - INFO - __main__ -   Num examples = 200\n07/16/2023 01:29:03\
          \ - INFO - __main__ -   Num batches each epoch = 200\n07/16/2023 01:29:03\
          \ - INFO - __main__ -   Num Epochs = 114\n07/16/2023 01:29:03 - INFO - __main__\
          \ -   Instantaneous batch size per device = 1\n07/16/2023 01:29:03 - INFO\
          \ - __main__ -   Total train batch size (w. parallel, distributed &amp;\
          \ accumulation) = 2\n07/16/2023 01:29:03 - INFO - __main__ -   Gradient\
          \ Accumulation steps = 2\n07/16/2023 01:29:03 - INFO - __main__ -   Total\
          \ optimization steps = 11400\nSteps:   0% 0/11400 [00:00&lt;?, ?it/s]Traceback\
          \ (most recent call last):\n  File \"/content/train_dreambooth.py\", line\
          \ 1375, in &lt;module&gt;\n    main(args)\n  File \"/content/train_dreambooth.py\"\
          , line 1223, in main\n    model_pred = unet(\n  File \"/usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py\"\
          , line 1501, in _call_impl\n    return forward_call(*args, **kwargs)\n \
          \ File \"/usr/local/lib/python3.10/dist-packages/accelerate/utils/operations.py\"\
          , line 581, in forward\n    return model_forward(*args, **kwargs)\n  File\
          \ \"/usr/local/lib/python3.10/dist-packages/accelerate/utils/operations.py\"\
          , line 569, in __call__\n    return convert_to_fp32(self.model_forward(*args,\
          \ **kwargs))\n  File \"/usr/local/lib/python3.10/dist-packages/torch/amp/autocast_mode.py\"\
          , line 14, in decorate_autocast\n    return func(*args, **kwargs)\n  File\
          \ \"/usr/local/lib/python3.10/dist-packages/diffusers/models/unet_2d_condition.py\"\
          , line 839, in forward\n    if \"text_embeds\" not in added_cond_kwargs:\n\
          TypeError: argument of type 'NoneType' is not iterable\nwandb: Waiting for\
          \ W&amp;B process to finish... (failed 1). Press Control-C to abort syncing.\n\
          wandb: \U0001F680 View run azure-shadow-26 at: https://wandb.ai/only-my-team/dreambooth/runs/r6j5zx8r\n\
          wandb: Synced 5 W&amp;B file(s), 0 media file(s), 0 artifact file(s) and\
          \ 0 other file(s)\nwandb: Find logs at: ./wandb/run-20230716_012903-r6j5zx8r/logs\n\
          Traceback (most recent call last):\n  File \"/usr/local/bin/accelerate\"\
          , line 8, in &lt;module&gt;\n    sys.exit(main())\n  File \"/usr/local/lib/python3.10/dist-packages/accelerate/commands/accelerate_cli.py\"\
          , line 45, in main\n    args.func(args)\n  File \"/usr/local/lib/python3.10/dist-packages/accelerate/commands/launch.py\"\
          , line 979, in launch_command\n    simple_launcher(args)\n  File \"/usr/local/lib/python3.10/dist-packages/accelerate/commands/launch.py\"\
          , line 628, in simple_launcher\n    raise subprocess.CalledProcessError(returncode=process.returncode,\
          \ cmd=cmd)\nsubprocess.CalledProcessError: Command '['/usr/bin/python3',\
          \ 'train_dreambooth.py', '--pretrained_model_name_or_path=stabilityai/stable-diffusion-xl-base-0.9',\
          \ '--instance_data_dir=/content/pneumoconiosis_resized/train/1', '--class_data_dir=/content/data/xray',\
          \ '--output_dir=/content/drive/MyDrive/ORT/Master/Codes/diffusion/pneumoconiosis/models/stable-diffusion-xl-pneumoconiosis-finetuned',\
          \ '--train_text_encoder', '--mixed_precision=fp16', '--with_prior_preservation',\
          \ '--prior_loss_weight=1.0', '--instance_prompt=image of a pneumoconiosis\
          \ xray', '--class_prompt=image of a xray', '--resolution=768', '--train_batch_size=1',\
          \ '--gradient_accumulation_steps=2', '--gradient_checkpointing', '--use_8bit_adam',\
          \ '--learning_rate=5e-6', '--lr_scheduler=constant', '--lr_warmup_steps=0',\
          \ '--num_class_images=200', '--max_train_steps=11400', '--checkpointing_steps=4000',\
          \ '--num_validation_images=4', '--report_to=wandb', '--seed=1337']' returned\
          \ non-zero exit status 1.\n</code></pre>\n<p>Now that I think this is probably\
          \ something that I should put as an issue or a feature request in the diffusers'\
          \ scripts repo. </p>\n<p>[UPDATED] I've created an issue <a rel=\"nofollow\"\
          \ href=\"https://github.com/huggingface/diffusers/issues/4117\">here</a></p>\n"
        raw: "Hi, \n\nIs this model available for dreambooth? I tried to run the regular\
          \ script for this model to see how good it is in comparison with the other\
          \ sd versions but I'm getting an error :'(\n\nThis is the configuration\
          \ I'm using:\n\n```\n!accelerate launch train_dreambooth.py \\\n  --pretrained_model_name_or_path=\"\
          stabilityai/stable-diffusion-xl-base-0.9\"  \\\n  --instance_data_dir=\"\
          ./pneumoconiosis\" \\\n  --class_data_dir=\"./data/xray\" \\\n  --output_dir=\"\
          ./diffusion/pneumoconiosis/models/stable-diffusion-xl-pneumoconiosis-finetuned\"\
          \ \\\n  --train_text_encoder \\\n  --mixed_precision=\"fp16\" \\\n  --with_prior_preservation\
          \ --prior_loss_weight=1.0 \\\n  --instance_prompt=\"image of a pneumoconiosis\
          \ xray\" \\\n  --class_prompt=\"image of a xray\" \\\n  --resolution=512\
          \ \\\n  --train_batch_size=1 \\\n  --gradient_accumulation_steps=2 --gradient_checkpointing\
          \ \\\n  --use_8bit_adam \\\n  --learning_rate=5e-6 \\\n  --lr_scheduler=\"\
          constant\" \\\n  --lr_warmup_steps=0 \\\n  --num_class_images=200 \\\n \
          \ --max_train_steps=11400 \\\n  --checkpointing_steps=4000 \\\n  --num_validation_images=4\
          \ \\\n  --report_to=\"wandb\" \\\n  --seed=1337\n```\n\nthis is the error:\n\
          \n```\n2023-07-16 01:08:42.735258: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38]\
          \ TF-TRT Warning: Could not find TensorRT\n2023-07-16 01:08:48.477573: W\
          \ tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning:\
          \ Could not find TensorRT\n07/16/2023 01:08:51 - INFO - __main__ - Distributed\
          \ environment: NO\nNum processes: 1\nProcess index: 0\nLocal process index:\
          \ 0\nDevice: cuda\n\nMixed precision type: fp16\n\nKeyword arguments {'safety_checker':\
          \ None} are not expected by StableDiffusionXLPipeline and will be ignored.\n\
          Loading pipeline components...:   0% 0/7 [00:00<?, ?it/s]Loaded text_encoder_2\
          \ as CLIPTextModelWithProjection from `text_encoder_2` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...:  14% 1/7 [00:01<00:09,  1.61s/it]{'force_upcast'}\
          \ was not found in config. Values will be initialized to default values.\n\
          Loaded vae as AutoencoderKL from `vae` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...:  29% 2/7 [00:01<00:04,  1.24it/s]Loaded\
          \ text_encoder as CLIPTextModel from `text_encoder` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...:  43% 3/7 [00:02<00:02,  1.47it/s]Loaded\
          \ tokenizer_2 as CLIPTokenizer from `tokenizer_2` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loaded tokenizer as CLIPTokenizer from `tokenizer` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...:  71% 5/7 [00:02<00:00,  3.02it/s]Loaded\
          \ unet as UNet2DConditionModel from `unet` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...:  86% 6/7 [00:07<00:01,  1.72s/it]Loaded\
          \ scheduler as EulerDiscreteScheduler from `scheduler` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
          Loading pipeline components...: 100% 7/7 [00:07<00:00,  1.10s/it]\n07/16/2023\
          \ 01:08:59 - INFO - __main__ - Number of class images to sample: 200.\n\
          Generating class images: 100% 50/50 [19:51<00:00, 23.83s/it]\nYou are using\
          \ a model of type clip_text_model to instantiate a model of type . This\
          \ is not supported for all configurations of models and can yield errors.\n\
          {'variance_type'} was not found in config. Values will be initialized to\
          \ default values.\n{'force_upcast'} was not found in config. Values will\
          \ be initialized to default values.\nwandb: Currently logged in as: amd-repetto\
          \ (only-my-team). Use `wandb login --relogin` to force relogin\nwandb: Tracking\
          \ run with wandb version 0.15.5\nwandb: Run data is saved locally in /content/wandb/run-20230716_012903-r6j5zx8r\n\
          wandb: Run `wandb offline` to turn off syncing.\nwandb: Syncing run azure-shadow-26\n\
          wandb: \u2B50\uFE0F View project at https://wandb.ai/only-my-team/dreambooth\n\
          wandb: \U0001F680 View run at https://wandb.ai/only-my-team/dreambooth/runs/r6j5zx8r\n\
          07/16/2023 01:29:03 - INFO - __main__ - ***** Running training *****\n07/16/2023\
          \ 01:29:03 - INFO - __main__ -   Num examples = 200\n07/16/2023 01:29:03\
          \ - INFO - __main__ -   Num batches each epoch = 200\n07/16/2023 01:29:03\
          \ - INFO - __main__ -   Num Epochs = 114\n07/16/2023 01:29:03 - INFO - __main__\
          \ -   Instantaneous batch size per device = 1\n07/16/2023 01:29:03 - INFO\
          \ - __main__ -   Total train batch size (w. parallel, distributed & accumulation)\
          \ = 2\n07/16/2023 01:29:03 - INFO - __main__ -   Gradient Accumulation steps\
          \ = 2\n07/16/2023 01:29:03 - INFO - __main__ -   Total optimization steps\
          \ = 11400\nSteps:   0% 0/11400 [00:00<?, ?it/s]Traceback (most recent call\
          \ last):\n  File \"/content/train_dreambooth.py\", line 1375, in <module>\n\
          \    main(args)\n  File \"/content/train_dreambooth.py\", line 1223, in\
          \ main\n    model_pred = unet(\n  File \"/usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py\"\
          , line 1501, in _call_impl\n    return forward_call(*args, **kwargs)\n \
          \ File \"/usr/local/lib/python3.10/dist-packages/accelerate/utils/operations.py\"\
          , line 581, in forward\n    return model_forward(*args, **kwargs)\n  File\
          \ \"/usr/local/lib/python3.10/dist-packages/accelerate/utils/operations.py\"\
          , line 569, in __call__\n    return convert_to_fp32(self.model_forward(*args,\
          \ **kwargs))\n  File \"/usr/local/lib/python3.10/dist-packages/torch/amp/autocast_mode.py\"\
          , line 14, in decorate_autocast\n    return func(*args, **kwargs)\n  File\
          \ \"/usr/local/lib/python3.10/dist-packages/diffusers/models/unet_2d_condition.py\"\
          , line 839, in forward\n    if \"text_embeds\" not in added_cond_kwargs:\n\
          TypeError: argument of type 'NoneType' is not iterable\nwandb: Waiting for\
          \ W&B process to finish... (failed 1). Press Control-C to abort syncing.\n\
          wandb: \U0001F680 View run azure-shadow-26 at: https://wandb.ai/only-my-team/dreambooth/runs/r6j5zx8r\n\
          wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other\
          \ file(s)\nwandb: Find logs at: ./wandb/run-20230716_012903-r6j5zx8r/logs\n\
          Traceback (most recent call last):\n  File \"/usr/local/bin/accelerate\"\
          , line 8, in <module>\n    sys.exit(main())\n  File \"/usr/local/lib/python3.10/dist-packages/accelerate/commands/accelerate_cli.py\"\
          , line 45, in main\n    args.func(args)\n  File \"/usr/local/lib/python3.10/dist-packages/accelerate/commands/launch.py\"\
          , line 979, in launch_command\n    simple_launcher(args)\n  File \"/usr/local/lib/python3.10/dist-packages/accelerate/commands/launch.py\"\
          , line 628, in simple_launcher\n    raise subprocess.CalledProcessError(returncode=process.returncode,\
          \ cmd=cmd)\nsubprocess.CalledProcessError: Command '['/usr/bin/python3',\
          \ 'train_dreambooth.py', '--pretrained_model_name_or_path=stabilityai/stable-diffusion-xl-base-0.9',\
          \ '--instance_data_dir=/content/pneumoconiosis_resized/train/1', '--class_data_dir=/content/data/xray',\
          \ '--output_dir=/content/drive/MyDrive/ORT/Master/Codes/diffusion/pneumoconiosis/models/stable-diffusion-xl-pneumoconiosis-finetuned',\
          \ '--train_text_encoder', '--mixed_precision=fp16', '--with_prior_preservation',\
          \ '--prior_loss_weight=1.0', '--instance_prompt=image of a pneumoconiosis\
          \ xray', '--class_prompt=image of a xray', '--resolution=768', '--train_batch_size=1',\
          \ '--gradient_accumulation_steps=2', '--gradient_checkpointing', '--use_8bit_adam',\
          \ '--learning_rate=5e-6', '--lr_scheduler=constant', '--lr_warmup_steps=0',\
          \ '--num_class_images=200', '--max_train_steps=11400', '--checkpointing_steps=4000',\
          \ '--num_validation_images=4', '--report_to=wandb', '--seed=1337']' returned\
          \ non-zero exit status 1.\n```\n\nNow that I think this is probably something\
          \ that I should put as an issue or a feature request in the diffusers' scripts\
          \ repo. \n\n[UPDATED] I've created an issue [here](https://github.com/huggingface/diffusers/issues/4117)"
        updatedAt: '2023-07-16T02:51:12.787Z'
      numEdits: 4
      reactions: []
    id: 64b351d04e5902e2fdce9c46
    type: comment
  author: mauricio-repetto
  content: "Hi, \n\nIs this model available for dreambooth? I tried to run the regular\
    \ script for this model to see how good it is in comparison with the other sd\
    \ versions but I'm getting an error :'(\n\nThis is the configuration I'm using:\n\
    \n```\n!accelerate launch train_dreambooth.py \\\n  --pretrained_model_name_or_path=\"\
    stabilityai/stable-diffusion-xl-base-0.9\"  \\\n  --instance_data_dir=\"./pneumoconiosis\"\
    \ \\\n  --class_data_dir=\"./data/xray\" \\\n  --output_dir=\"./diffusion/pneumoconiosis/models/stable-diffusion-xl-pneumoconiosis-finetuned\"\
    \ \\\n  --train_text_encoder \\\n  --mixed_precision=\"fp16\" \\\n  --with_prior_preservation\
    \ --prior_loss_weight=1.0 \\\n  --instance_prompt=\"image of a pneumoconiosis\
    \ xray\" \\\n  --class_prompt=\"image of a xray\" \\\n  --resolution=512 \\\n\
    \  --train_batch_size=1 \\\n  --gradient_accumulation_steps=2 --gradient_checkpointing\
    \ \\\n  --use_8bit_adam \\\n  --learning_rate=5e-6 \\\n  --lr_scheduler=\"constant\"\
    \ \\\n  --lr_warmup_steps=0 \\\n  --num_class_images=200 \\\n  --max_train_steps=11400\
    \ \\\n  --checkpointing_steps=4000 \\\n  --num_validation_images=4 \\\n  --report_to=\"\
    wandb\" \\\n  --seed=1337\n```\n\nthis is the error:\n\n```\n2023-07-16 01:08:42.735258:\
    \ W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could\
    \ not find TensorRT\n2023-07-16 01:08:48.477573: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38]\
    \ TF-TRT Warning: Could not find TensorRT\n07/16/2023 01:08:51 - INFO - __main__\
    \ - Distributed environment: NO\nNum processes: 1\nProcess index: 0\nLocal process\
    \ index: 0\nDevice: cuda\n\nMixed precision type: fp16\n\nKeyword arguments {'safety_checker':\
    \ None} are not expected by StableDiffusionXLPipeline and will be ignored.\nLoading\
    \ pipeline components...:   0% 0/7 [00:00<?, ?it/s]Loaded text_encoder_2 as CLIPTextModelWithProjection\
    \ from `text_encoder_2` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
    Loading pipeline components...:  14% 1/7 [00:01<00:09,  1.61s/it]{'force_upcast'}\
    \ was not found in config. Values will be initialized to default values.\nLoaded\
    \ vae as AutoencoderKL from `vae` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
    Loading pipeline components...:  29% 2/7 [00:01<00:04,  1.24it/s]Loaded text_encoder\
    \ as CLIPTextModel from `text_encoder` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
    Loading pipeline components...:  43% 3/7 [00:02<00:02,  1.47it/s]Loaded tokenizer_2\
    \ as CLIPTokenizer from `tokenizer_2` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
    Loaded tokenizer as CLIPTokenizer from `tokenizer` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
    Loading pipeline components...:  71% 5/7 [00:02<00:00,  3.02it/s]Loaded unet as\
    \ UNet2DConditionModel from `unet` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
    Loading pipeline components...:  86% 6/7 [00:07<00:01,  1.72s/it]Loaded scheduler\
    \ as EulerDiscreteScheduler from `scheduler` subfolder of stabilityai/stable-diffusion-xl-base-0.9.\n\
    Loading pipeline components...: 100% 7/7 [00:07<00:00,  1.10s/it]\n07/16/2023\
    \ 01:08:59 - INFO - __main__ - Number of class images to sample: 200.\nGenerating\
    \ class images: 100% 50/50 [19:51<00:00, 23.83s/it]\nYou are using a model of\
    \ type clip_text_model to instantiate a model of type . This is not supported\
    \ for all configurations of models and can yield errors.\n{'variance_type'} was\
    \ not found in config. Values will be initialized to default values.\n{'force_upcast'}\
    \ was not found in config. Values will be initialized to default values.\nwandb:\
    \ Currently logged in as: amd-repetto (only-my-team). Use `wandb login --relogin`\
    \ to force relogin\nwandb: Tracking run with wandb version 0.15.5\nwandb: Run\
    \ data is saved locally in /content/wandb/run-20230716_012903-r6j5zx8r\nwandb:\
    \ Run `wandb offline` to turn off syncing.\nwandb: Syncing run azure-shadow-26\n\
    wandb: \u2B50\uFE0F View project at https://wandb.ai/only-my-team/dreambooth\n\
    wandb: \U0001F680 View run at https://wandb.ai/only-my-team/dreambooth/runs/r6j5zx8r\n\
    07/16/2023 01:29:03 - INFO - __main__ - ***** Running training *****\n07/16/2023\
    \ 01:29:03 - INFO - __main__ -   Num examples = 200\n07/16/2023 01:29:03 - INFO\
    \ - __main__ -   Num batches each epoch = 200\n07/16/2023 01:29:03 - INFO - __main__\
    \ -   Num Epochs = 114\n07/16/2023 01:29:03 - INFO - __main__ -   Instantaneous\
    \ batch size per device = 1\n07/16/2023 01:29:03 - INFO - __main__ -   Total train\
    \ batch size (w. parallel, distributed & accumulation) = 2\n07/16/2023 01:29:03\
    \ - INFO - __main__ -   Gradient Accumulation steps = 2\n07/16/2023 01:29:03 -\
    \ INFO - __main__ -   Total optimization steps = 11400\nSteps:   0% 0/11400 [00:00<?,\
    \ ?it/s]Traceback (most recent call last):\n  File \"/content/train_dreambooth.py\"\
    , line 1375, in <module>\n    main(args)\n  File \"/content/train_dreambooth.py\"\
    , line 1223, in main\n    model_pred = unet(\n  File \"/usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py\"\
    , line 1501, in _call_impl\n    return forward_call(*args, **kwargs)\n  File \"\
    /usr/local/lib/python3.10/dist-packages/accelerate/utils/operations.py\", line\
    \ 581, in forward\n    return model_forward(*args, **kwargs)\n  File \"/usr/local/lib/python3.10/dist-packages/accelerate/utils/operations.py\"\
    , line 569, in __call__\n    return convert_to_fp32(self.model_forward(*args,\
    \ **kwargs))\n  File \"/usr/local/lib/python3.10/dist-packages/torch/amp/autocast_mode.py\"\
    , line 14, in decorate_autocast\n    return func(*args, **kwargs)\n  File \"/usr/local/lib/python3.10/dist-packages/diffusers/models/unet_2d_condition.py\"\
    , line 839, in forward\n    if \"text_embeds\" not in added_cond_kwargs:\nTypeError:\
    \ argument of type 'NoneType' is not iterable\nwandb: Waiting for W&B process\
    \ to finish... (failed 1). Press Control-C to abort syncing.\nwandb: \U0001F680\
    \ View run azure-shadow-26 at: https://wandb.ai/only-my-team/dreambooth/runs/r6j5zx8r\n\
    wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n\
    wandb: Find logs at: ./wandb/run-20230716_012903-r6j5zx8r/logs\nTraceback (most\
    \ recent call last):\n  File \"/usr/local/bin/accelerate\", line 8, in <module>\n\
    \    sys.exit(main())\n  File \"/usr/local/lib/python3.10/dist-packages/accelerate/commands/accelerate_cli.py\"\
    , line 45, in main\n    args.func(args)\n  File \"/usr/local/lib/python3.10/dist-packages/accelerate/commands/launch.py\"\
    , line 979, in launch_command\n    simple_launcher(args)\n  File \"/usr/local/lib/python3.10/dist-packages/accelerate/commands/launch.py\"\
    , line 628, in simple_launcher\n    raise subprocess.CalledProcessError(returncode=process.returncode,\
    \ cmd=cmd)\nsubprocess.CalledProcessError: Command '['/usr/bin/python3', 'train_dreambooth.py',\
    \ '--pretrained_model_name_or_path=stabilityai/stable-diffusion-xl-base-0.9',\
    \ '--instance_data_dir=/content/pneumoconiosis_resized/train/1', '--class_data_dir=/content/data/xray',\
    \ '--output_dir=/content/drive/MyDrive/ORT/Master/Codes/diffusion/pneumoconiosis/models/stable-diffusion-xl-pneumoconiosis-finetuned',\
    \ '--train_text_encoder', '--mixed_precision=fp16', '--with_prior_preservation',\
    \ '--prior_loss_weight=1.0', '--instance_prompt=image of a pneumoconiosis xray',\
    \ '--class_prompt=image of a xray', '--resolution=768', '--train_batch_size=1',\
    \ '--gradient_accumulation_steps=2', '--gradient_checkpointing', '--use_8bit_adam',\
    \ '--learning_rate=5e-6', '--lr_scheduler=constant', '--lr_warmup_steps=0', '--num_class_images=200',\
    \ '--max_train_steps=11400', '--checkpointing_steps=4000', '--num_validation_images=4',\
    \ '--report_to=wandb', '--seed=1337']' returned non-zero exit status 1.\n```\n\
    \nNow that I think this is probably something that I should put as an issue or\
    \ a feature request in the diffusers' scripts repo. \n\n[UPDATED] I've created\
    \ an issue [here](https://github.com/huggingface/diffusers/issues/4117)"
  created_at: 2023-07-16 01:11:28+00:00
  edited: true
  hidden: false
  id: 64b351d04e5902e2fdce9c46
  type: comment
- !!python/object:huggingface_hub.community.DiscussionTitleChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1653673654684-noauth.jpeg?w=200&h=200&f=face
      fullname: "Andr\xE9s Mauricio Repetto Ferrero"
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: mauricio-repetto
      type: user
    createdAt: '2023-07-16T02:49:01.000Z'
    data:
      from: Dreambooth using XL / Use of watermark
      to: Dreambooth using XL
    id: 64b35a9d9df48bad8174c0a6
    type: title-change
  author: mauricio-repetto
  created_at: 2023-07-16 01:49:01+00:00
  id: 64b35a9d9df48bad8174c0a6
  new_title: Dreambooth using XL
  old_title: Dreambooth using XL / Use of watermark
  type: title-change
is_pull_request: false
merge_commit_oid: null
num: 41
repo_id: stabilityai/stable-diffusion-xl-base-0.9
repo_type: model
status: open
target_branch: null
title: Dreambooth using XL
