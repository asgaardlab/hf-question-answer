!!python/object:huggingface_hub.community.DiscussionWithDetails
author: melonrindrind
conflicting_files: null
created_at: 2023-10-23 02:18:51+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/88eb1db5b4ef93d717635c368f755035.svg
      fullname: mleon
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: melonrindrind
      type: user
    createdAt: '2023-10-23T03:18:51.000Z'
    data:
      edited: false
      editors:
      - melonrindrind
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.46313270926475525
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/88eb1db5b4ef93d717635c368f755035.svg
          fullname: mleon
          isHf: false
          isPro: false
          name: melonrindrind
          type: user
        html: "<p>\u4F60\u597D\uFF0C\u611F\u8C22\u5F00\u53D1\u8005\u4EEC\u5F00\u6E90\
          \u9879\u76EE\uFF0C\u5728\u672C\u5730\u4F7F\u7528TGI\u8FD0\u884C\u8FC7\u7A0B\
          \u4E2D\u6211\u9047\u5230\u4E86\u4E00\u4E9B\u95EE\u9898\uFF0C\u7531\u4E8E\
          3090\u663E\u5B58\u4E0D\u8DB3\u65E0\u6CD5\u8FD0\u884C7B\u672A\u91CF\u5316\
          \u6A21\u578B\uFF0C\u6211\u6253\u7B97\u8FD0\u884Cint4\u7684\u91CF\u5316\u6A21\
          \u578B\uFF0C\u4F46 CodeShell-7B-Chat-int4  \u5728TGI\u4E0B\u8FD0\u884C\u5931\
          \u8D25,\u8BF7\u95EE\u662F\u4EC0\u4E48\u95EE\u9898</p>\n<pre><code>docker\
          \ run --gpus 'all' --shm-size 20g -p 9090:80 -v /root/codeshell/model:/data\
          \         --env LOG_LEVEL=\"info,text_generation_router=debug\"        \
          \ ghcr.nju.edu.cn/huggingface/text-generation-inference:1.0.3         --model-id\
          \ /data/C\nodeShell-7B-Chat-int4 --num-shard 1         --max-total-tokens\
          \ 5000 --max-input-length 4096         --max-stop-sequences 12 --trust-remote-code\n\
          2023-10-23T02:59:41.362133Z  INFO text_generation_launcher: Args { model_id:\
          \ \"/data/CodeShell-7B-Chat-int4\", revision: None, validation_workers:\
          \ 2, sharded: None, num_shard: Some(1), quantize: None, dtype: None, trust_remote_code:\
          \ true, max_concurrent_requests: 128, max_best_of: 2, max_stop_sequences:\
          \ 12, max_top_n_tokens: 5, max_input_length: 4096, max_total_tokens: 5000,\
          \ waiting_served_ratio: 1.2, max_batch_prefill_tokens: 4096, max_batch_total_tokens:\
          \ None, max_waiting_tokens: 20, hostname: \"f1b26d576e27\", port: 80, shard_uds_path:\
          \ \"/tmp/text-generation-server\", master_addr: \"localhost\", master_port:\
          \ 29500, huggingface_hub_cache: Some(\"/data\"), weights_cache_override:\
          \ None, disable_custom_kernels: false, cuda_memory_fraction: 1.0, rope_scaling:\
          \ None, rope_factor: None, json_output: false, otlp_endpoint: None, cors_allow_origin:\
          \ [], watermark_gamma: None, watermark_delta: None, ngrok: false, ngrok_authtoken:\
          \ None, ngrok_edge: None, env: false }\n2023-10-23T02:59:41.362173Z  WARN\
          \ text_generation_launcher: `trust_remote_code` is set. Trusting that model\
          \ `/data/CodeShell-7B-Chat-int4` do not contain malicious code.\n2023-10-23T02:59:41.362290Z\
          \  INFO download: text_generation_launcher: Starting download process.\n\
          2023-10-23T02:59:44.612287Z  WARN text_generation_launcher: No safetensors\
          \ weights found for model /data/CodeShell-7B-Chat-int4 at revision None.\
          \ Converting PyTorch weights to safetensors.\n\nError: DownloadError\n2023-10-23T02:59:47.269640Z\
          \ ERROR download: text_generation_launcher: Download encountered an error:\
          \ Traceback (most recent call last):\n\n  File \"/opt/conda/bin/text-generation-server\"\
          , line 8, in &lt;module&gt;\n    sys.exit(app())\n\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/cli.py\"\
          , line 195, in download_weights\n    utils.convert_files(local_pt_files,\
          \ local_st_files, discard_names)\n\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/convert.py\"\
          , line 106, in convert_files\n    convert_file(pt_file, sf_file, discard_names)\n\
          \n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/convert.py\"\
          , line 68, in convert_file\n    to_removes = _remove_duplicate_names(loaded,\
          \ discard_names=discard_names)\n\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/convert.py\"\
          , line 25, in _remove_duplicate_names\n    shareds = _find_shared_tensors(state_dict)\n\
          \n  File \"/opt/conda/lib/python3.9/site-packages/safetensors/torch.py\"\
          , line 72, in _find_shared_tensors\n    if v.device != torch.device(\"meta\"\
          ) and storage_ptr(v) != 0 and storage_size(v) != 0:\n\nAttributeError: 'list'\
          \ object has no attribute 'device'\n</code></pre>\n"
        raw: "\u4F60\u597D\uFF0C\u611F\u8C22\u5F00\u53D1\u8005\u4EEC\u5F00\u6E90\u9879\
          \u76EE\uFF0C\u5728\u672C\u5730\u4F7F\u7528TGI\u8FD0\u884C\u8FC7\u7A0B\u4E2D\
          \u6211\u9047\u5230\u4E86\u4E00\u4E9B\u95EE\u9898\uFF0C\u7531\u4E8E3090\u663E\
          \u5B58\u4E0D\u8DB3\u65E0\u6CD5\u8FD0\u884C7B\u672A\u91CF\u5316\u6A21\u578B\
          \uFF0C\u6211\u6253\u7B97\u8FD0\u884Cint4\u7684\u91CF\u5316\u6A21\u578B\uFF0C\
          \u4F46 CodeShell-7B-Chat-int4  \u5728TGI\u4E0B\u8FD0\u884C\u5931\u8D25,\u8BF7\
          \u95EE\u662F\u4EC0\u4E48\u95EE\u9898\r\n\r\n```\r\ndocker run --gpus 'all'\
          \ --shm-size 20g -p 9090:80 -v /root/codeshell/model:/data         --env\
          \ LOG_LEVEL=\"info,text_generation_router=debug\"         ghcr.nju.edu.cn/huggingface/text-generation-inference:1.0.3\
          \         --model-id /data/C\r\nodeShell-7B-Chat-int4 --num-shard 1    \
          \     --max-total-tokens 5000 --max-input-length 4096         --max-stop-sequences\
          \ 12 --trust-remote-code\r\n2023-10-23T02:59:41.362133Z  INFO text_generation_launcher:\
          \ Args { model_id: \"/data/CodeShell-7B-Chat-int4\", revision: None, validation_workers:\
          \ 2, sharded: None, num_shard: Some(1), quantize: None, dtype: None, trust_remote_code:\
          \ true, max_concurrent_requests: 128, max_best_of: 2, max_stop_sequences:\
          \ 12, max_top_n_tokens: 5, max_input_length: 4096, max_total_tokens: 5000,\
          \ waiting_served_ratio: 1.2, max_batch_prefill_tokens: 4096, max_batch_total_tokens:\
          \ None, max_waiting_tokens: 20, hostname: \"f1b26d576e27\", port: 80, shard_uds_path:\
          \ \"/tmp/text-generation-server\", master_addr: \"localhost\", master_port:\
          \ 29500, huggingface_hub_cache: Some(\"/data\"), weights_cache_override:\
          \ None, disable_custom_kernels: false, cuda_memory_fraction: 1.0, rope_scaling:\
          \ None, rope_factor: None, json_output: false, otlp_endpoint: None, cors_allow_origin:\
          \ [], watermark_gamma: None, watermark_delta: None, ngrok: false, ngrok_authtoken:\
          \ None, ngrok_edge: None, env: false }\r\n2023-10-23T02:59:41.362173Z  WARN\
          \ text_generation_launcher: `trust_remote_code` is set. Trusting that model\
          \ `/data/CodeShell-7B-Chat-int4` do not contain malicious code.\r\n2023-10-23T02:59:41.362290Z\
          \  INFO download: text_generation_launcher: Starting download process.\r\
          \n2023-10-23T02:59:44.612287Z  WARN text_generation_launcher: No safetensors\
          \ weights found for model /data/CodeShell-7B-Chat-int4 at revision None.\
          \ Converting PyTorch weights to safetensors.\r\n\r\nError: DownloadError\r\
          \n2023-10-23T02:59:47.269640Z ERROR download: text_generation_launcher:\
          \ Download encountered an error: Traceback (most recent call last):\r\n\r\
          \n  File \"/opt/conda/bin/text-generation-server\", line 8, in <module>\r\
          \n    sys.exit(app())\r\n\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/cli.py\"\
          , line 195, in download_weights\r\n    utils.convert_files(local_pt_files,\
          \ local_st_files, discard_names)\r\n\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/convert.py\"\
          , line 106, in convert_files\r\n    convert_file(pt_file, sf_file, discard_names)\r\
          \n\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/convert.py\"\
          , line 68, in convert_file\r\n    to_removes = _remove_duplicate_names(loaded,\
          \ discard_names=discard_names)\r\n\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/convert.py\"\
          , line 25, in _remove_duplicate_names\r\n    shareds = _find_shared_tensors(state_dict)\r\
          \n\r\n  File \"/opt/conda/lib/python3.9/site-packages/safetensors/torch.py\"\
          , line 72, in _find_shared_tensors\r\n    if v.device != torch.device(\"\
          meta\") and storage_ptr(v) != 0 and storage_size(v) != 0:\r\n\r\nAttributeError:\
          \ 'list' object has no attribute 'device'\r\n```"
        updatedAt: '2023-10-23T03:18:51.593Z'
      numEdits: 0
      reactions: []
    id: 6535e61b5f5e918bdc195534
    type: comment
  author: melonrindrind
  content: "\u4F60\u597D\uFF0C\u611F\u8C22\u5F00\u53D1\u8005\u4EEC\u5F00\u6E90\u9879\
    \u76EE\uFF0C\u5728\u672C\u5730\u4F7F\u7528TGI\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u6211\
    \u9047\u5230\u4E86\u4E00\u4E9B\u95EE\u9898\uFF0C\u7531\u4E8E3090\u663E\u5B58\u4E0D\
    \u8DB3\u65E0\u6CD5\u8FD0\u884C7B\u672A\u91CF\u5316\u6A21\u578B\uFF0C\u6211\u6253\
    \u7B97\u8FD0\u884Cint4\u7684\u91CF\u5316\u6A21\u578B\uFF0C\u4F46 CodeShell-7B-Chat-int4\
    \  \u5728TGI\u4E0B\u8FD0\u884C\u5931\u8D25,\u8BF7\u95EE\u662F\u4EC0\u4E48\u95EE\
    \u9898\r\n\r\n```\r\ndocker run --gpus 'all' --shm-size 20g -p 9090:80 -v /root/codeshell/model:/data\
    \         --env LOG_LEVEL=\"info,text_generation_router=debug\"         ghcr.nju.edu.cn/huggingface/text-generation-inference:1.0.3\
    \         --model-id /data/C\r\nodeShell-7B-Chat-int4 --num-shard 1         --max-total-tokens\
    \ 5000 --max-input-length 4096         --max-stop-sequences 12 --trust-remote-code\r\
    \n2023-10-23T02:59:41.362133Z  INFO text_generation_launcher: Args { model_id:\
    \ \"/data/CodeShell-7B-Chat-int4\", revision: None, validation_workers: 2, sharded:\
    \ None, num_shard: Some(1), quantize: None, dtype: None, trust_remote_code: true,\
    \ max_concurrent_requests: 128, max_best_of: 2, max_stop_sequences: 12, max_top_n_tokens:\
    \ 5, max_input_length: 4096, max_total_tokens: 5000, waiting_served_ratio: 1.2,\
    \ max_batch_prefill_tokens: 4096, max_batch_total_tokens: None, max_waiting_tokens:\
    \ 20, hostname: \"f1b26d576e27\", port: 80, shard_uds_path: \"/tmp/text-generation-server\"\
    , master_addr: \"localhost\", master_port: 29500, huggingface_hub_cache: Some(\"\
    /data\"), weights_cache_override: None, disable_custom_kernels: false, cuda_memory_fraction:\
    \ 1.0, rope_scaling: None, rope_factor: None, json_output: false, otlp_endpoint:\
    \ None, cors_allow_origin: [], watermark_gamma: None, watermark_delta: None, ngrok:\
    \ false, ngrok_authtoken: None, ngrok_edge: None, env: false }\r\n2023-10-23T02:59:41.362173Z\
    \  WARN text_generation_launcher: `trust_remote_code` is set. Trusting that model\
    \ `/data/CodeShell-7B-Chat-int4` do not contain malicious code.\r\n2023-10-23T02:59:41.362290Z\
    \  INFO download: text_generation_launcher: Starting download process.\r\n2023-10-23T02:59:44.612287Z\
    \  WARN text_generation_launcher: No safetensors weights found for model /data/CodeShell-7B-Chat-int4\
    \ at revision None. Converting PyTorch weights to safetensors.\r\n\r\nError: DownloadError\r\
    \n2023-10-23T02:59:47.269640Z ERROR download: text_generation_launcher: Download\
    \ encountered an error: Traceback (most recent call last):\r\n\r\n  File \"/opt/conda/bin/text-generation-server\"\
    , line 8, in <module>\r\n    sys.exit(app())\r\n\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/cli.py\"\
    , line 195, in download_weights\r\n    utils.convert_files(local_pt_files, local_st_files,\
    \ discard_names)\r\n\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/convert.py\"\
    , line 106, in convert_files\r\n    convert_file(pt_file, sf_file, discard_names)\r\
    \n\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/convert.py\"\
    , line 68, in convert_file\r\n    to_removes = _remove_duplicate_names(loaded,\
    \ discard_names=discard_names)\r\n\r\n  File \"/opt/conda/lib/python3.9/site-packages/text_generation_server/utils/convert.py\"\
    , line 25, in _remove_duplicate_names\r\n    shareds = _find_shared_tensors(state_dict)\r\
    \n\r\n  File \"/opt/conda/lib/python3.9/site-packages/safetensors/torch.py\",\
    \ line 72, in _find_shared_tensors\r\n    if v.device != torch.device(\"meta\"\
    ) and storage_ptr(v) != 0 and storage_size(v) != 0:\r\n\r\nAttributeError: 'list'\
    \ object has no attribute 'device'\r\n```"
  created_at: 2023-10-23 02:18:51+00:00
  edited: false
  hidden: false
  id: 6535e61b5f5e918bdc195534
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/1aa730b5df7e9e8051d718ba4c25ad2c.svg
      fullname: Kai
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: apkai
      type: user
    createdAt: '2023-10-24T06:30:56.000Z'
    data:
      edited: false
      editors:
      - apkai
      hidden: false
      identifiedLanguage:
        language: zh
        probability: 1.0000375509262085
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/1aa730b5df7e9e8051d718ba4c25ad2c.svg
          fullname: Kai
          isHf: false
          isPro: false
          name: apkai
          type: user
        html: "<p>\u8E72\uFF0C \u540C\u6837\u7684\u95EE\u9898</p>\n"
        raw: "\u8E72\uFF0C \u540C\u6837\u7684\u95EE\u9898"
        updatedAt: '2023-10-24T06:30:56.541Z'
      numEdits: 0
      reactions: []
    id: 653764a05b08fc7fd598cb70
    type: comment
  author: apkai
  content: "\u8E72\uFF0C \u540C\u6837\u7684\u95EE\u9898"
  created_at: 2023-10-24 05:30:56+00:00
  edited: false
  hidden: false
  id: 653764a05b08fc7fd598cb70
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: WisdomShell/CodeShell-7B-Chat-int4
repo_type: model
status: open
target_branch: null
title: "CodeShell-7B-Chat-int4  \u5728TGI\u4E0B\u8FD0\u884C\u5931\u8D25"
