!!python/object:huggingface_hub.community.DiscussionWithDetails
author: calvinball
conflicting_files: null
created_at: 2023-12-24 03:49:34+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/31f744c9e2b4460e3c908d57824d0cde.svg
      fullname: Tech
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: calvinball
      type: user
    createdAt: '2023-12-24T03:49:34.000Z'
    data:
      edited: false
      editors:
      - calvinball
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5367486476898193
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/31f744c9e2b4460e3c908d57824d0cde.svg
          fullname: Tech
          isHf: false
          isPro: false
          name: calvinball
          type: user
        html: "<p>Hi, I tried to deploy this model in Inference Endpoints using the\
          \ Text Generation Inference , however it fails to start. When I see the\
          \ logs, I found that it detects this model as PEFT model and try to load\
          \ model with the AutoPEFT class. As we know this model doesn\u2019t have\
          \ any adapter weights.</p>\n<p>Error logs</p>\n<pre><code>2023/12/23 17:15:48\
          \ ~ {\"timestamp\":\"2023-12-23T10:15:48.081726Z\",\"level\":\"INFO\",\"\
          fields\":{\"message\":\"Peft model detected.\\n\"},\"target\":\"text_generation_launcher\"\
          }\n2023/12/23 17:15:48 ~ {\"timestamp\":\"2023-12-23T10:15:48.081759Z\"\
          ,\"level\":\"INFO\",\"fields\":{\"message\":\"Loading the model it might\
          \ take a while without feedback\\n\"},\"target\":\"text_generation_launcher\"\
          }\n2023/12/23 17:15:48 ~ {\"timestamp\":\"2023-12-23T10:15:48.612560Z\"\
          ,\"level\":\"ERROR\",\"fields\":{\"message\":\"Download encountered an error:\
          \ Traceback (most recent call last):\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
          \", line 117, in from_pretrained\\n config_file = hf_hub_download(\\n\\\
          n File \\\"/opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
          \", line 110, in _inner_fn\\n validate_repo_id(arg_value)\\n\\n File \\\"\
          /opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
          \", line 164, in validate_repo_id\\n raise HFValidationError(\\n\\nhuggingface_hub.utils._validators.HFValidationError:\
          \ Repo id must use alphanumeric chars or '-', '_', '.', '--' and '..' are\
          \ forbidden, '-' and '.' cannot start or end the name, max length is 96:\
          \ '/repository'.\\n\\n\\nDuring handling of the above exception, another\
          \ exception occurred:\\n\\n\\nTraceback (most recent call last):\\n\\n File\
          \ \\\"/opt/conda/lib/python3.10/site-packages/text_generation_server/utils/peft.py\\\
          \", line 16, in download_and_unload_peft\\n model = AutoPeftModelForCausalLM.from_pretrained(\\\
          n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/auto.py\\\",\
          \ line 69, in from_pretrained\\n peft_config = PeftConfig.from_pretrained(pretrained_model_name_or_path,\
          \ **kwargs)\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
          \", line 121, in from_pretrained\\n raise ValueError(f\\\"Can't find '{CONFIG_NAME}'\
          \ at '{pretrained_model_name_or_path}'\\\")\\n\\nValueError: Can't find\
          \ 'adapter_config.json' at '/repository'\\n\\n\\nDuring handling of the\
          \ above exception, another exception occurred:\\n\\n\\nTraceback (most recent\
          \ call last):\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
          \", line 117, in from_pretrained\\n config_file = hf_hub_download(\\n\\\
          n File \\\"/opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
          \", line 110, in _inner_fn\\n validate_repo_id(arg_value)\\n\\n File \\\"\
          /opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
          \", line 164, in validate_repo_id\\n raise HFValidationError(\\n\\nhuggingface_hub.utils._validators.HFValidationError:\
          \ Repo id must use alphanumeric chars or '-', '_', '.', '--' and '..' are\
          \ forbidden, '-' and '.' cannot start or end the name, max length is 96:\
          \ '/repository'.\\n\\n\\nDuring handling of the above exception, another\
          \ exception occurred:\\n\\n\\nTraceback (most recent call last):\\n\\n File\
          \ \\\"/opt/conda/bin/text-generation-server\\\", line 8, in &lt;module&gt;\\\
          n sys.exit(app())\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/text_generation_server/cli.py\\\
          \", line 204, in download_weights\\n utils.download_and_unload_peft(\\n\\\
          n File \\\"/opt/conda/lib/python3.10/site-packages/text_generation_server/utils/peft.py\\\
          \", line 24, in download_and_unload_peft\\n model = AutoPeftModelForSeq2SeqLM.from_pretrained(\\\
          n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/auto.py\\\",\
          \ line 69, in from_pretrained\\n peft_config = PeftConfig.from_pretrained(pretrained_model_name_or_path,\
          \ **kwargs)\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
          \", line 121, in from_pretrained\\n raise ValueError(f\\\"Can't find '{CONFIG_NAME}'\
          \ at '{pretrained_model_name_or_path}'\\\")\\n\\nValueError: Can't find\
          \ 'adapter_config.json' at '/repository'\\n\\n\"},\"target\":\"text_generation_launcher\"\
          ,\"span\":{\"name\":\"download\"},\"spans\":[{\"name\":\"download\"}]}\n\
          2023/12/23 17:15:48 ~ Error: DownloadError\n</code></pre>\n<p>Note: I already\
          \ changed the container config for Quantization as None<br><a rel=\"nofollow\"\
          \ href=\"https://cdn-uploads.huggingface.co/production/uploads/6578129f0e0d4703ffae4ab1/ndxXK-XLM-Cw1Dr8Qcsbe.png\"\
          ><img alt=\"image.png\" src=\"https://cdn-uploads.huggingface.co/production/uploads/6578129f0e0d4703ffae4ab1/ndxXK-XLM-Cw1Dr8Qcsbe.png\"\
          ></a></p>\n"
        raw: "Hi, I tried to deploy this model in Inference Endpoints using the Text\
          \ Generation Inference , however it fails to start. When I see the logs,\
          \ I found that it detects this model as PEFT model and try to load model\
          \ with the AutoPEFT class. As we know this model doesn\u2019t have any adapter\
          \ weights.\r\n\r\nError logs\r\n```\r\n2023/12/23 17:15:48 ~ {\"timestamp\"\
          :\"2023-12-23T10:15:48.081726Z\",\"level\":\"INFO\",\"fields\":{\"message\"\
          :\"Peft model detected.\\n\"},\"target\":\"text_generation_launcher\"}\r\
          \n2023/12/23 17:15:48 ~ {\"timestamp\":\"2023-12-23T10:15:48.081759Z\",\"\
          level\":\"INFO\",\"fields\":{\"message\":\"Loading the model it might take\
          \ a while without feedback\\n\"},\"target\":\"text_generation_launcher\"\
          }\r\n2023/12/23 17:15:48 ~ {\"timestamp\":\"2023-12-23T10:15:48.612560Z\"\
          ,\"level\":\"ERROR\",\"fields\":{\"message\":\"Download encountered an error:\
          \ Traceback (most recent call last):\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
          \", line 117, in from_pretrained\\n config_file = hf_hub_download(\\n\\\
          n File \\\"/opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
          \", line 110, in _inner_fn\\n validate_repo_id(arg_value)\\n\\n File \\\"\
          /opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
          \", line 164, in validate_repo_id\\n raise HFValidationError(\\n\\nhuggingface_hub.utils._validators.HFValidationError:\
          \ Repo id must use alphanumeric chars or '-', '_', '.', '--' and '..' are\
          \ forbidden, '-' and '.' cannot start or end the name, max length is 96:\
          \ '/repository'.\\n\\n\\nDuring handling of the above exception, another\
          \ exception occurred:\\n\\n\\nTraceback (most recent call last):\\n\\n File\
          \ \\\"/opt/conda/lib/python3.10/site-packages/text_generation_server/utils/peft.py\\\
          \", line 16, in download_and_unload_peft\\n model = AutoPeftModelForCausalLM.from_pretrained(\\\
          n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/auto.py\\\",\
          \ line 69, in from_pretrained\\n peft_config = PeftConfig.from_pretrained(pretrained_model_name_or_path,\
          \ **kwargs)\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
          \", line 121, in from_pretrained\\n raise ValueError(f\\\"Can't find '{CONFIG_NAME}'\
          \ at '{pretrained_model_name_or_path}'\\\")\\n\\nValueError: Can't find\
          \ 'adapter_config.json' at '/repository'\\n\\n\\nDuring handling of the\
          \ above exception, another exception occurred:\\n\\n\\nTraceback (most recent\
          \ call last):\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
          \", line 117, in from_pretrained\\n config_file = hf_hub_download(\\n\\\
          n File \\\"/opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
          \", line 110, in _inner_fn\\n validate_repo_id(arg_value)\\n\\n File \\\"\
          /opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
          \", line 164, in validate_repo_id\\n raise HFValidationError(\\n\\nhuggingface_hub.utils._validators.HFValidationError:\
          \ Repo id must use alphanumeric chars or '-', '_', '.', '--' and '..' are\
          \ forbidden, '-' and '.' cannot start or end the name, max length is 96:\
          \ '/repository'.\\n\\n\\nDuring handling of the above exception, another\
          \ exception occurred:\\n\\n\\nTraceback (most recent call last):\\n\\n File\
          \ \\\"/opt/conda/bin/text-generation-server\\\", line 8, in <module>\\n\
          \ sys.exit(app())\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/text_generation_server/cli.py\\\
          \", line 204, in download_weights\\n utils.download_and_unload_peft(\\n\\\
          n File \\\"/opt/conda/lib/python3.10/site-packages/text_generation_server/utils/peft.py\\\
          \", line 24, in download_and_unload_peft\\n model = AutoPeftModelForSeq2SeqLM.from_pretrained(\\\
          n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/auto.py\\\",\
          \ line 69, in from_pretrained\\n peft_config = PeftConfig.from_pretrained(pretrained_model_name_or_path,\
          \ **kwargs)\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
          \", line 121, in from_pretrained\\n raise ValueError(f\\\"Can't find '{CONFIG_NAME}'\
          \ at '{pretrained_model_name_or_path}'\\\")\\n\\nValueError: Can't find\
          \ 'adapter_config.json' at '/repository'\\n\\n\"},\"target\":\"text_generation_launcher\"\
          ,\"span\":{\"name\":\"download\"},\"spans\":[{\"name\":\"download\"}]}\r\
          \n2023/12/23 17:15:48 ~ Error: DownloadError\r\n```\r\n\r\nNote: I already\
          \ changed the container config for Quantization as None\r\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/6578129f0e0d4703ffae4ab1/ndxXK-XLM-Cw1Dr8Qcsbe.png)\r\
          \n"
        updatedAt: '2023-12-24T03:49:34.326Z'
      numEdits: 0
      reactions: []
    id: 6587aa4ed861072dc5ec5733
    type: comment
  author: calvinball
  content: "Hi, I tried to deploy this model in Inference Endpoints using the Text\
    \ Generation Inference , however it fails to start. When I see the logs, I found\
    \ that it detects this model as PEFT model and try to load model with the AutoPEFT\
    \ class. As we know this model doesn\u2019t have any adapter weights.\r\n\r\n\
    Error logs\r\n```\r\n2023/12/23 17:15:48 ~ {\"timestamp\":\"2023-12-23T10:15:48.081726Z\"\
    ,\"level\":\"INFO\",\"fields\":{\"message\":\"Peft model detected.\\n\"},\"target\"\
    :\"text_generation_launcher\"}\r\n2023/12/23 17:15:48 ~ {\"timestamp\":\"2023-12-23T10:15:48.081759Z\"\
    ,\"level\":\"INFO\",\"fields\":{\"message\":\"Loading the model it might take\
    \ a while without feedback\\n\"},\"target\":\"text_generation_launcher\"}\r\n\
    2023/12/23 17:15:48 ~ {\"timestamp\":\"2023-12-23T10:15:48.612560Z\",\"level\"\
    :\"ERROR\",\"fields\":{\"message\":\"Download encountered an error: Traceback\
    \ (most recent call last):\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
    \", line 117, in from_pretrained\\n config_file = hf_hub_download(\\n\\n File\
    \ \\\"/opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
    \", line 110, in _inner_fn\\n validate_repo_id(arg_value)\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
    \", line 164, in validate_repo_id\\n raise HFValidationError(\\n\\nhuggingface_hub.utils._validators.HFValidationError:\
    \ Repo id must use alphanumeric chars or '-', '_', '.', '--' and '..' are forbidden,\
    \ '-' and '.' cannot start or end the name, max length is 96: '/repository'.\\\
    n\\n\\nDuring handling of the above exception, another exception occurred:\\n\\\
    n\\nTraceback (most recent call last):\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/text_generation_server/utils/peft.py\\\
    \", line 16, in download_and_unload_peft\\n model = AutoPeftModelForCausalLM.from_pretrained(\\\
    n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/auto.py\\\", line 69,\
    \ in from_pretrained\\n peft_config = PeftConfig.from_pretrained(pretrained_model_name_or_path,\
    \ **kwargs)\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
    \", line 121, in from_pretrained\\n raise ValueError(f\\\"Can't find '{CONFIG_NAME}'\
    \ at '{pretrained_model_name_or_path}'\\\")\\n\\nValueError: Can't find 'adapter_config.json'\
    \ at '/repository'\\n\\n\\nDuring handling of the above exception, another exception\
    \ occurred:\\n\\n\\nTraceback (most recent call last):\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
    \", line 117, in from_pretrained\\n config_file = hf_hub_download(\\n\\n File\
    \ \\\"/opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
    \", line 110, in _inner_fn\\n validate_repo_id(arg_value)\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py\\\
    \", line 164, in validate_repo_id\\n raise HFValidationError(\\n\\nhuggingface_hub.utils._validators.HFValidationError:\
    \ Repo id must use alphanumeric chars or '-', '_', '.', '--' and '..' are forbidden,\
    \ '-' and '.' cannot start or end the name, max length is 96: '/repository'.\\\
    n\\n\\nDuring handling of the above exception, another exception occurred:\\n\\\
    n\\nTraceback (most recent call last):\\n\\n File \\\"/opt/conda/bin/text-generation-server\\\
    \", line 8, in <module>\\n sys.exit(app())\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/text_generation_server/cli.py\\\
    \", line 204, in download_weights\\n utils.download_and_unload_peft(\\n\\n File\
    \ \\\"/opt/conda/lib/python3.10/site-packages/text_generation_server/utils/peft.py\\\
    \", line 24, in download_and_unload_peft\\n model = AutoPeftModelForSeq2SeqLM.from_pretrained(\\\
    n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/auto.py\\\", line 69,\
    \ in from_pretrained\\n peft_config = PeftConfig.from_pretrained(pretrained_model_name_or_path,\
    \ **kwargs)\\n\\n File \\\"/opt/conda/lib/python3.10/site-packages/peft/utils/config.py\\\
    \", line 121, in from_pretrained\\n raise ValueError(f\\\"Can't find '{CONFIG_NAME}'\
    \ at '{pretrained_model_name_or_path}'\\\")\\n\\nValueError: Can't find 'adapter_config.json'\
    \ at '/repository'\\n\\n\"},\"target\":\"text_generation_launcher\",\"span\":{\"\
    name\":\"download\"},\"spans\":[{\"name\":\"download\"}]}\r\n2023/12/23 17:15:48\
    \ ~ Error: DownloadError\r\n```\r\n\r\nNote: I already changed the container config\
    \ for Quantization as None\r\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/6578129f0e0d4703ffae4ab1/ndxXK-XLM-Cw1Dr8Qcsbe.png)\r\
    \n"
  created_at: 2023-12-24 03:49:34+00:00
  edited: false
  hidden: false
  id: 6587aa4ed861072dc5ec5733
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/da3622e7d35eb3e5b64d5ca09e7bdcbe.svg
      fullname: mustafa
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: mustafak99
      type: user
    createdAt: '2023-12-27T15:33:41.000Z'
    data:
      edited: false
      editors:
      - mustafak99
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6197459101676941
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/da3622e7d35eb3e5b64d5ca09e7bdcbe.svg
          fullname: mustafa
          isHf: false
          isPro: false
          name: mustafak99
          type: user
        html: '<p>encountered the same issue any update ?</p>

          '
        raw: encountered the same issue any update ?
        updatedAt: '2023-12-27T15:33:41.714Z'
      numEdits: 0
      reactions: []
    id: 658c43d5bc3644bd2399c178
    type: comment
  author: mustafak99
  content: encountered the same issue any update ?
  created_at: 2023-12-27 15:33:41+00:00
  edited: false
  hidden: false
  id: 658c43d5bc3644bd2399c178
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 19
repo_id: deepseek-ai/deepseek-coder-33b-instruct
repo_type: model
status: open
target_branch: null
title: Failed to Deploy this model in Inference Endpoints
