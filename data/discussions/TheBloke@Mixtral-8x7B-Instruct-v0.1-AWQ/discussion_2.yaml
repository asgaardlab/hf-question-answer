!!python/object:huggingface_hub.community.DiscussionWithDetails
author: mike-ravkine
conflicting_files: null
created_at: 2023-12-27 15:41:29+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/7865ac39276762682d8e20a33ff9f257.svg
      fullname: Mike Ravkine
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: mike-ravkine
      type: user
    createdAt: '2023-12-27T15:41:29.000Z'
    data:
      edited: false
      editors:
      - mike-ravkine
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9235454201698303
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/7865ac39276762682d8e20a33ff9f257.svg
          fullname: Mike Ravkine
          isHf: false
          isPro: false
          name: mike-ravkine
          type: user
        html: "<p>Attempting to load this model with vLLM on an A100-80GB gives me:</p>\n\
          <pre><code>torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate\
          \ 462.00 MiB. GPU 0 has a total capacty of 79.18 GiB of which 302.31 MiB\
          \ is free. Process \n18600 has 78.88 GiB memory in use. Of the allocated\
          \ memory 69.30 GiB is allocated by PyTorch, and 522.41 MiB is reserved by\
          \ PyTorch but unallocated. If \nreserved but unallocated memory is large\
          \ try setting max_split_size_mb to avoid fragmentation.  See documentation\
          \ for Memory Management and \nPYTORCH_CUDA_ALLOC_CONF\n</code></pre>\n<p>Has\
          \ anyone had any luck with this thing?</p>\n"
        raw: "Attempting to load this model with vLLM on an A100-80GB gives me:\r\n\
          \r\n```\r\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate\
          \ 462.00 MiB. GPU 0 has a total capacty of 79.18 GiB of which 302.31 MiB\
          \ is free. Process \r\n18600 has 78.88 GiB memory in use. Of the allocated\
          \ memory 69.30 GiB is allocated by PyTorch, and 522.41 MiB is reserved by\
          \ PyTorch but unallocated. If \r\nreserved but unallocated memory is large\
          \ try setting max_split_size_mb to avoid fragmentation.  See documentation\
          \ for Memory Management and \r\nPYTORCH_CUDA_ALLOC_CONF\r\n```\r\n\r\nHas\
          \ anyone had any luck with this thing?"
        updatedAt: '2023-12-27T15:41:29.889Z'
      numEdits: 0
      reactions: []
    id: 658c45a979c9c9b95f2f74cc
    type: comment
  author: mike-ravkine
  content: "Attempting to load this model with vLLM on an A100-80GB gives me:\r\n\r\
    \n```\r\ntorch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 462.00\
    \ MiB. GPU 0 has a total capacty of 79.18 GiB of which 302.31 MiB is free. Process\
    \ \r\n18600 has 78.88 GiB memory in use. Of the allocated memory 69.30 GiB is\
    \ allocated by PyTorch, and 522.41 MiB is reserved by PyTorch but unallocated.\
    \ If \r\nreserved but unallocated memory is large try setting max_split_size_mb\
    \ to avoid fragmentation.  See documentation for Memory Management and \r\nPYTORCH_CUDA_ALLOC_CONF\r\
    \n```\r\n\r\nHas anyone had any luck with this thing?"
  created_at: 2023-12-27 15:41:29+00:00
  edited: false
  hidden: false
  id: 658c45a979c9c9b95f2f74cc
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/5efd814f16bd4091e05d820df02f6d7f.svg
      fullname: m0wer
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: m0wer
      type: user
    createdAt: '2023-12-31T19:27:59.000Z'
    data:
      edited: false
      editors:
      - m0wer
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6856000423431396
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/5efd814f16bd4091e05d820df02f6d7f.svg
          fullname: m0wer
          isHf: false
          isPro: false
          name: m0wer
          type: user
        html: '<p>same here, opened <a rel="nofollow" href="https://github.com/vllm-project/vllm/issues/2312">https://github.com/vllm-project/vllm/issues/2312</a></p>

          '
        raw: same here, opened https://github.com/vllm-project/vllm/issues/2312
        updatedAt: '2023-12-31T19:27:59.112Z'
      numEdits: 0
      reactions: []
    id: 6591c0bfdbdeb5bf074b4489
    type: comment
  author: m0wer
  content: same here, opened https://github.com/vllm-project/vllm/issues/2312
  created_at: 2023-12-31 19:27:59+00:00
  edited: false
  hidden: false
  id: 6591c0bfdbdeb5bf074b4489
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/19f9eeb9281b47b34f68c312092ca468.svg
      fullname: Yu
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Yhyu13
      type: user
    createdAt: '2024-01-01T01:39:36.000Z'
    data:
      edited: false
      editors:
      - Yhyu13
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7751736640930176
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/19f9eeb9281b47b34f68c312092ca468.svg
          fullname: Yu
          isHf: false
          isPro: false
          name: Yhyu13
          type: user
        html: '<p>Set gpu-utilitization-ratio to 0.5?</p>

          '
        raw: Set gpu-utilitization-ratio to 0.5?
        updatedAt: '2024-01-01T01:39:36.826Z'
      numEdits: 0
      reactions: []
    id: 659217d8bec7ad26479b2720
    type: comment
  author: Yhyu13
  content: Set gpu-utilitization-ratio to 0.5?
  created_at: 2024-01-01 01:39:36+00:00
  edited: false
  hidden: false
  id: 659217d8bec7ad26479b2720
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/5efd814f16bd4091e05d820df02f6d7f.svg
      fullname: m0wer
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: m0wer
      type: user
    createdAt: '2024-01-01T06:55:08.000Z'
    data:
      edited: false
      editors:
      - m0wer
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9779611229896545
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/5efd814f16bd4091e05d820df02f6d7f.svg
          fullname: m0wer
          isHf: false
          isPro: false
          name: m0wer
          type: user
        html: '<blockquote>

          <p>Set gpu-utilitization-ratio to 0.5?</p>

          </blockquote>

          <p>Does not work.  Doesn''t seem to change anything.</p>

          '
        raw: '> Set gpu-utilitization-ratio to 0.5?


          Does not work.  Doesn''t seem to change anything.'
        updatedAt: '2024-01-01T06:55:08.311Z'
      numEdits: 0
      reactions: []
    id: 659261cc68d0b7633109ec40
    type: comment
  author: m0wer
  content: '> Set gpu-utilitization-ratio to 0.5?


    Does not work.  Doesn''t seem to change anything.'
  created_at: 2024-01-01 06:55:08+00:00
  edited: false
  hidden: false
  id: 659261cc68d0b7633109ec40
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/qWH4Z2kKG5jOhzy7LJzIo.jpeg?w=200&h=200&f=face
      fullname: Igor Sorochan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: IgBHolder
      type: user
    createdAt: '2024-01-04T18:13:02.000Z'
    data:
      edited: false
      editors:
      - IgBHolder
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8328410387039185
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/noauth/qWH4Z2kKG5jOhzy7LJzIo.jpeg?w=200&h=200&f=face
          fullname: Igor Sorochan
          isHf: false
          isPro: false
          name: IgBHolder
          type: user
        html: '<p>The model is loaded correctly w/o OOM errors.<br>But standard prompt
          (which works fine with vllm - openchat) fails due to wrong prompt_template.</p>

          '
        raw: 'The model is loaded correctly w/o OOM errors.

          But standard prompt (which works fine with vllm - openchat) fails due to
          wrong prompt_template.'
        updatedAt: '2024-01-04T18:13:02.951Z'
      numEdits: 0
      reactions: []
    id: 6596f52ed92a44a76c6bbbde
    type: comment
  author: IgBHolder
  content: 'The model is loaded correctly w/o OOM errors.

    But standard prompt (which works fine with vllm - openchat) fails due to wrong
    prompt_template.'
  created_at: 2024-01-04 18:13:02+00:00
  edited: false
  hidden: false
  id: 6596f52ed92a44a76c6bbbde
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/43879c82b86659e5298bec3837d9d038.svg
      fullname: Hiranya Jayathilaka
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: hiranya911
      type: user
    createdAt: '2024-01-17T17:19:49.000Z'
    data:
      edited: false
      editors:
      - hiranya911
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7944838404655457
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/43879c82b86659e5298bec3837d9d038.svg
          fullname: Hiranya Jayathilaka
          isHf: false
          isPro: false
          name: hiranya911
          type: user
        html: "<p>On an A100 40GB device, I managed to get the model loaded with the\
          \ following vLLM setup:</p>\n<pre><code class=\"language-py\">sampling_params\
          \ = SamplingParams(temperature=<span class=\"hljs-number\">0.1</span>, top_p=<span\
          \ class=\"hljs-number\">0.95</span>)\nmodel = <span class=\"hljs-string\"\
          >'TheBloke/Mixtral-8x7B-Instruct-v0.1-AWQ'</span>\n\nllm = LLM(\n  model=model,\
          \ \n  gpu_memory_utilization=<span class=\"hljs-number\">0.7</span>, \n\
          \  max_model_len=<span class=\"hljs-number\">2048</span>,\n)\n</code></pre>\n\
          <p>Increasing gpu memory allocation caused CUDA OOM errors. Decreasing it\
          \ also resulted in an error:</p>\n<pre><code>ValueError: No available memory\
          \ for the cache blocks. Try increasing `gpu_memory_utilization` when initializing\
          \ the engine.\n</code></pre>\n<p>However, now that I have the model running,\
          \ I'm encoutering the bug discussed in <a href=\"/TheBloke/Mixtral-8x7B-Instruct-v0.1-AWQ/discussions/3\"\
          >#3</a>. </p>\n"
        raw: "On an A100 40GB device, I managed to get the model loaded with the following\
          \ vLLM setup:\n\n```py\nsampling_params = SamplingParams(temperature=0.1,\
          \ top_p=0.95)\nmodel = 'TheBloke/Mixtral-8x7B-Instruct-v0.1-AWQ'\n\nllm\
          \ = LLM(\n  model=model, \n  gpu_memory_utilization=0.7, \n  max_model_len=2048,\n\
          )\n```\n\nIncreasing gpu memory allocation caused CUDA OOM errors. Decreasing\
          \ it also resulted in an error:\n```\nValueError: No available memory for\
          \ the cache blocks. Try increasing `gpu_memory_utilization` when initializing\
          \ the engine.\n```\n\nHowever, now that I have the model running, I'm encoutering\
          \ the bug discussed in #3. "
        updatedAt: '2024-01-17T17:19:49.485Z'
      numEdits: 0
      reactions: []
    id: 65a80c355d36223f732abba7
    type: comment
  author: hiranya911
  content: "On an A100 40GB device, I managed to get the model loaded with the following\
    \ vLLM setup:\n\n```py\nsampling_params = SamplingParams(temperature=0.1, top_p=0.95)\n\
    model = 'TheBloke/Mixtral-8x7B-Instruct-v0.1-AWQ'\n\nllm = LLM(\n  model=model,\
    \ \n  gpu_memory_utilization=0.7, \n  max_model_len=2048,\n)\n```\n\nIncreasing\
    \ gpu memory allocation caused CUDA OOM errors. Decreasing it also resulted in\
    \ an error:\n```\nValueError: No available memory for the cache blocks. Try increasing\
    \ `gpu_memory_utilization` when initializing the engine.\n```\n\nHowever, now\
    \ that I have the model running, I'm encoutering the bug discussed in #3. "
  created_at: 2024-01-17 17:19:49+00:00
  edited: false
  hidden: false
  id: 65a80c355d36223f732abba7
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 2
repo_id: TheBloke/Mixtral-8x7B-Instruct-v0.1-AWQ
repo_type: model
status: open
target_branch: null
title: OOM under vLLM even with 80GB GPU
