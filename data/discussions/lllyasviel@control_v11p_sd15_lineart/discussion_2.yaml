!!python/object:huggingface_hub.community.DiscussionWithDetails
author: sunhaozhepy
conflicting_files: null
created_at: 2023-12-13 06:38:14+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/11dc191321b9b68919d0901afc6869ba.svg
      fullname: Haozhe Sun
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: sunhaozhepy
      type: user
    createdAt: '2023-12-13T06:38:14.000Z'
    data:
      edited: false
      editors:
      - sunhaozhepy
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6142122745513916
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/11dc191321b9b68919d0901afc6869ba.svg
          fullname: Haozhe Sun
          isHf: false
          isPro: false
          name: sunhaozhepy
          type: user
        html: "<p>Hi,</p>\n<p>I'm recently applying this ControlNet model on an img2img\
          \ task. I got this error:</p>\n<pre><code>Traceback (most recent call last):\n\
          \  File \"/data/jupyter/aging/batch_mlsd_img2img.py\", line 32, in &lt;module&gt;\n\
          \    image = pipeline(prompt, image=img, control_image=condition_image,\
          \ strength=0.3, negative_prompt=negative_prompt, num_inference_steps=30,\
          \ guidance_scale=5).images[0]\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\
          \  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/torch/utils/_contextlib.py\"\
          , line 115, in decorate_context\n    return func(*args, **kwargs)\n    \
          \       ^^^^^^^^^^^^^^^^^^^^^\n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py\"\
          , line 1149, in __call__\n    down_block_res_samples, mid_block_res_sample\
          \ = self.controlnet(\n                                                 \
          \  ^^^^^^^^^^^^^^^^\n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/torch/nn/modules/module.py\"\
          , line 1518, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n\
          \           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/torch/nn/modules/module.py\"\
          , line 1527, in _call_impl\n    return forward_call(*args, **kwargs)\n \
          \          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/diffusers/models/controlnet.py\"\
          , line 794, in forward\n    sample = sample + controlnet_cond\n        \
          \     ~~~~~~~^~~~~~~~~~~~~~~~~\nRuntimeError: The size of tensor a (92)\
          \ must match the size of tensor b (96) at non-singleton dimension 2\n</code></pre>\n\
          <p>I suspect that this was because my input image was not a square. After\
          \ I resized the image to 512x512, the issue disappeared, but the image itself\
          \ was deformed. I checked whether the condition image, which was the output\
          \ of the LineartDetector, was of the same size of the input image; it wasn't.</p>\n\
          <p>I wonder whether we could have a processor that could output the same\
          \ size as the input image, so that we could avoid this issue and be able\
          \ to apply img2img+ControlNet on rectangle images?</p>\n"
        raw: "Hi,\r\n\r\nI'm recently applying this ControlNet model on an img2img\
          \ task. I got this error:\r\n```\r\nTraceback (most recent call last):\r\
          \n  File \"/data/jupyter/aging/batch_mlsd_img2img.py\", line 32, in <module>\r\
          \n    image = pipeline(prompt, image=img, control_image=condition_image,\
          \ strength=0.3, negative_prompt=negative_prompt, num_inference_steps=30,\
          \ guidance_scale=5).images[0]\r\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\
          \n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/torch/utils/_contextlib.py\"\
          , line 115, in decorate_context\r\n    return func(*args, **kwargs)\r\n\
          \           ^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py\"\
          , line 1149, in __call__\r\n    down_block_res_samples, mid_block_res_sample\
          \ = self.controlnet(\r\n                                               \
          \    ^^^^^^^^^^^^^^^^\r\n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/torch/nn/modules/module.py\"\
          , line 1518, in _wrapped_call_impl\r\n    return self._call_impl(*args,\
          \ **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"\
          /data/jupyter/anaconda3/lib/python3.11/site-packages/torch/nn/modules/module.py\"\
          , line 1527, in _call_impl\r\n    return forward_call(*args, **kwargs)\r\
          \n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/diffusers/models/controlnet.py\"\
          , line 794, in forward\r\n    sample = sample + controlnet_cond\r\n    \
          \         ~~~~~~~^~~~~~~~~~~~~~~~~\r\nRuntimeError: The size of tensor a\
          \ (92) must match the size of tensor b (96) at non-singleton dimension 2\r\
          \n```\r\nI suspect that this was because my input image was not a square.\
          \ After I resized the image to 512x512, the issue disappeared, but the image\
          \ itself was deformed. I checked whether the condition image, which was\
          \ the output of the LineartDetector, was of the same size of the input image;\
          \ it wasn't.\r\n\r\nI wonder whether we could have a processor that could\
          \ output the same size as the input image, so that we could avoid this issue\
          \ and be able to apply img2img+ControlNet on rectangle images?"
        updatedAt: '2023-12-13T06:38:14.240Z'
      numEdits: 0
      reactions: []
    id: 65795156d2ae45dee1371083
    type: comment
  author: sunhaozhepy
  content: "Hi,\r\n\r\nI'm recently applying this ControlNet model on an img2img task.\
    \ I got this error:\r\n```\r\nTraceback (most recent call last):\r\n  File \"\
    /data/jupyter/aging/batch_mlsd_img2img.py\", line 32, in <module>\r\n    image\
    \ = pipeline(prompt, image=img, control_image=condition_image, strength=0.3, negative_prompt=negative_prompt,\
    \ num_inference_steps=30, guidance_scale=5).images[0]\r\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\
    \n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/torch/utils/_contextlib.py\"\
    , line 115, in decorate_context\r\n    return func(*args, **kwargs)\r\n      \
    \     ^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py\"\
    , line 1149, in __call__\r\n    down_block_res_samples, mid_block_res_sample =\
    \ self.controlnet(\r\n                                                   ^^^^^^^^^^^^^^^^\r\
    \n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/torch/nn/modules/module.py\"\
    , line 1518, in _wrapped_call_impl\r\n    return self._call_impl(*args, **kwargs)\r\
    \n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/torch/nn/modules/module.py\"\
    , line 1527, in _call_impl\r\n    return forward_call(*args, **kwargs)\r\n   \
    \        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/data/jupyter/anaconda3/lib/python3.11/site-packages/diffusers/models/controlnet.py\"\
    , line 794, in forward\r\n    sample = sample + controlnet_cond\r\n          \
    \   ~~~~~~~^~~~~~~~~~~~~~~~~\r\nRuntimeError: The size of tensor a (92) must match\
    \ the size of tensor b (96) at non-singleton dimension 2\r\n```\r\nI suspect that\
    \ this was because my input image was not a square. After I resized the image\
    \ to 512x512, the issue disappeared, but the image itself was deformed. I checked\
    \ whether the condition image, which was the output of the LineartDetector, was\
    \ of the same size of the input image; it wasn't.\r\n\r\nI wonder whether we could\
    \ have a processor that could output the same size as the input image, so that\
    \ we could avoid this issue and be able to apply img2img+ControlNet on rectangle\
    \ images?"
  created_at: 2023-12-13 06:38:14+00:00
  edited: false
  hidden: false
  id: 65795156d2ae45dee1371083
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 2
repo_id: lllyasviel/control_v11p_sd15_lineart
repo_type: model
status: open
target_branch: null
title: Unable to use it on img2img and rectangle images
