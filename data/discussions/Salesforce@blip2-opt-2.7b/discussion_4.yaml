!!python/object:huggingface_hub.community.DiscussionWithDetails
author: robertwolf
conflicting_files: null
created_at: 2023-04-24 08:03:12+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/548e14c7d501750764a60f0f81384207.svg
      fullname: Roberto Anzaldua
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: robertwolf
      type: user
    createdAt: '2023-04-24T09:03:12.000Z'
    data:
      edited: true
      editors:
      - nielsr
      - robertwolf
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
          fullname: Niels Rogge
          isHf: true
          isPro: false
          name: nielsr
          type: user
        html: "<p>I am trying to use the inference API and I can't seem to add the\
          \ 'question' in the inputs for the API, would anyone know how to do it?\
          \ </p>\n<p>This is my current script. It does return a caption, but it does\
          \ not seem to take into account the text input.</p>\n<pre><code>import base64\n\
          import json\n\nimport requests\n\nAPI_URL = \"https://api-inference.huggingface.co/models/Salesforce/blip2-opt-2.7b\"\
          \n\nheaders = {\"Authorization\": f\"Bearer {'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'}\"\
          }\njson_request = {\n    \"inputs\": \"How could someone get out of the\
          \ house?\",\n    \"parameters\":\n        {\n\n            \"max_new_tokens\"\
          : 100\n        },\n    \"options\":\n        {\"wait_for_model\": True}\n\
          }\n\n\ndef query(filename):\n    with open(filename, \"rb\") as f:\n   \
          \     data = f.read()\n    json_request['image'] = base64.b64encode(data).decode('utf-8')\n\
          \    response = requests.request(\"POST\", API_URL, headers=headers, json=json_request)\n\
          \    return json.loads(response.content.decode(\"utf-8\"))\n\n\ndata = query(\"\
          house.jpg\")\nprint(data)\n</code></pre>\n"
        raw: "I am trying to use the inference API and I can't seem to add the 'question'\
          \ in the inputs for the API, would anyone know how to do it? \n\nThis is\
          \ my current script. It does return a caption, but it does not seem to take\
          \ into account the text input.\n\n```\nimport base64\nimport json\n\nimport\
          \ requests\n\nAPI_URL = \"https://api-inference.huggingface.co/models/Salesforce/blip2-opt-2.7b\"\
          \n\nheaders = {\"Authorization\": f\"Bearer {'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'}\"\
          }\njson_request = {\n    \"inputs\": \"How could someone get out of the\
          \ house?\",\n    \"parameters\":\n        {\n\n            \"max_new_tokens\"\
          : 100\n        },\n    \"options\":\n        {\"wait_for_model\": True}\n\
          }\n\n\ndef query(filename):\n    with open(filename, \"rb\") as f:\n   \
          \     data = f.read()\n    json_request['image'] = base64.b64encode(data).decode('utf-8')\n\
          \    response = requests.request(\"POST\", API_URL, headers=headers, json=json_request)\n\
          \    return json.loads(response.content.decode(\"utf-8\"))\n\n\ndata = query(\"\
          house.jpg\")\nprint(data)\n```"
        updatedAt: '2023-04-24T09:26:21.778Z'
      numEdits: 1
      reactions: []
    id: 644645d05442c42b4b94acf3
    type: comment
  author: robertwolf
  content: "I am trying to use the inference API and I can't seem to add the 'question'\
    \ in the inputs for the API, would anyone know how to do it? \n\nThis is my current\
    \ script. It does return a caption, but it does not seem to take into account\
    \ the text input.\n\n```\nimport base64\nimport json\n\nimport requests\n\nAPI_URL\
    \ = \"https://api-inference.huggingface.co/models/Salesforce/blip2-opt-2.7b\"\n\
    \nheaders = {\"Authorization\": f\"Bearer {'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'}\"\
    }\njson_request = {\n    \"inputs\": \"How could someone get out of the house?\"\
    ,\n    \"parameters\":\n        {\n\n            \"max_new_tokens\": 100\n   \
    \     },\n    \"options\":\n        {\"wait_for_model\": True}\n}\n\n\ndef query(filename):\n\
    \    with open(filename, \"rb\") as f:\n        data = f.read()\n    json_request['image']\
    \ = base64.b64encode(data).decode('utf-8')\n    response = requests.request(\"\
    POST\", API_URL, headers=headers, json=json_request)\n    return json.loads(response.content.decode(\"\
    utf-8\"))\n\n\ndata = query(\"house.jpg\")\nprint(data)\n```"
  created_at: 2023-04-24 08:03:12+00:00
  edited: true
  hidden: false
  id: 644645d05442c42b4b94acf3
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
      fullname: Niels Rogge
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: nielsr
      type: user
    createdAt: '2023-04-24T09:33:38.000Z'
    data:
      edited: false
      editors:
      - nielsr
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
          fullname: Niels Rogge
          isHf: true
          isPro: false
          name: nielsr
          type: user
        html: '<p>Hi,</p>

          <p>For the moment BLIP and BLIP-2 are only supported by the image-to-text
          pipeline, and this pipeline doesn''t support a text prompt for the moment.</p>

          <p>Will discuss this with the team, thanks for bringing it up!</p>

          '
        raw: 'Hi,


          For the moment BLIP and BLIP-2 are only supported by the image-to-text pipeline,
          and this pipeline doesn''t support a text prompt for the moment.


          Will discuss this with the team, thanks for bringing it up!'
        updatedAt: '2023-04-24T09:33:38.561Z'
      numEdits: 0
      reactions: []
    id: 64464cf2e11366005370c16b
    type: comment
  author: nielsr
  content: 'Hi,


    For the moment BLIP and BLIP-2 are only supported by the image-to-text pipeline,
    and this pipeline doesn''t support a text prompt for the moment.


    Will discuss this with the team, thanks for bringing it up!'
  created_at: 2023-04-24 08:33:38+00:00
  edited: false
  hidden: false
  id: 64464cf2e11366005370c16b
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 4
repo_id: Salesforce/blip2-opt-2.7b
repo_type: model
status: open
target_branch: null
title: Inference API usage
