!!python/object:huggingface_hub.community.DiscussionWithDetails
author: james-passio
conflicting_files: null
created_at: 2023-09-11 10:43:32+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/642194962cc2b3c39e8111e6/AE6sx5Ad9n-sxxpatjPIc.jpeg?w=200&h=200&f=face
      fullname: James Kelly
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: james-passio
      type: user
    createdAt: '2023-09-11T11:43:32.000Z'
    data:
      edited: false
      editors:
      - james-passio
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.697332501411438
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/642194962cc2b3c39e8111e6/AE6sx5Ad9n-sxxpatjPIc.jpeg?w=200&h=200&f=face
          fullname: James Kelly
          isHf: false
          isPro: false
          name: james-passio
          type: user
        html: "<p>I've literally copied and pasted the demo code:</p>\n<pre><code\
          \ class=\"language-python\">processor = Blip2Processor.from_pretrained(<span\
          \ class=\"hljs-string\">\"Salesforce/blip2-opt-2.7b\"</span>)\nmodel = Blip2ForConditionalGeneration.from_pretrained(<span\
          \ class=\"hljs-string\">\"Salesforce/blip2-opt-2.7b\"</span>)\n\nimg_url\
          \ = <span class=\"hljs-string\">'https://storage.googleapis.com/sfr-vision-language-research/BLIP/demo.jpg'</span>\
          \ \nraw_image = Image.<span class=\"hljs-built_in\">open</span>(requests.get(img_url,\
          \ stream=<span class=\"hljs-literal\">True</span>).raw).convert(<span class=\"\
          hljs-string\">'RGB'</span>)\n\nquestion = <span class=\"hljs-string\">\"\
          how many dogs are in the picture?\"</span>\ninputs = processor(raw_image,\
          \ question, return_tensors=<span class=\"hljs-string\">\"pt\"</span>)\n\n\
          out = model.generate(**inputs)\n<span class=\"hljs-built_in\">print</span>(processor.decode(out[<span\
          \ class=\"hljs-number\">0</span>], skip_special_tokens=<span class=\"hljs-literal\"\
          >True</span>))\n</code></pre>\n<p>All I get for an output is <code>\\n</code>.\
          \ I'm running:  torch==2.0.1+cu117 transformers==4.33.1. </p>\n<p>original\
          \ BLIP works well, as for other VQA model architectures, any ideas what\
          \ I'm doing wrong?</p>\n"
        raw: "I've literally copied and pasted the demo code:\r\n\r\n```python\r\n\
          processor = Blip2Processor.from_pretrained(\"Salesforce/blip2-opt-2.7b\"\
          )\r\nmodel = Blip2ForConditionalGeneration.from_pretrained(\"Salesforce/blip2-opt-2.7b\"\
          )\r\n\r\nimg_url = 'https://storage.googleapis.com/sfr-vision-language-research/BLIP/demo.jpg'\
          \ \r\nraw_image = Image.open(requests.get(img_url, stream=True).raw).convert('RGB')\r\
          \n\r\nquestion = \"how many dogs are in the picture?\"\r\ninputs = processor(raw_image,\
          \ question, return_tensors=\"pt\")\r\n\r\nout = model.generate(**inputs)\r\
          \nprint(processor.decode(out[0], skip_special_tokens=True))\r\n```\r\n\r\
          \nAll I get for an output is `\\n`. I'm running:  torch==2.0.1+cu117 transformers==4.33.1.\
          \ \r\n\r\noriginal BLIP works well, as for other VQA model architectures,\
          \ any ideas what I'm doing wrong?\r\n\r\n"
        updatedAt: '2023-09-11T11:43:32.687Z'
      numEdits: 0
      reactions: []
    id: 64fefd649e7815183357c022
    type: comment
  author: james-passio
  content: "I've literally copied and pasted the demo code:\r\n\r\n```python\r\nprocessor\
    \ = Blip2Processor.from_pretrained(\"Salesforce/blip2-opt-2.7b\")\r\nmodel = Blip2ForConditionalGeneration.from_pretrained(\"\
    Salesforce/blip2-opt-2.7b\")\r\n\r\nimg_url = 'https://storage.googleapis.com/sfr-vision-language-research/BLIP/demo.jpg'\
    \ \r\nraw_image = Image.open(requests.get(img_url, stream=True).raw).convert('RGB')\r\
    \n\r\nquestion = \"how many dogs are in the picture?\"\r\ninputs = processor(raw_image,\
    \ question, return_tensors=\"pt\")\r\n\r\nout = model.generate(**inputs)\r\nprint(processor.decode(out[0],\
    \ skip_special_tokens=True))\r\n```\r\n\r\nAll I get for an output is `\\n`. I'm\
    \ running:  torch==2.0.1+cu117 transformers==4.33.1. \r\n\r\noriginal BLIP works\
    \ well, as for other VQA model architectures, any ideas what I'm doing wrong?\r\
    \n\r\n"
  created_at: 2023-09-11 10:43:32+00:00
  edited: false
  hidden: false
  id: 64fefd649e7815183357c022
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/642194962cc2b3c39e8111e6/AE6sx5Ad9n-sxxpatjPIc.jpeg?w=200&h=200&f=face
      fullname: James Kelly
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: james-passio
      type: user
    createdAt: '2023-09-11T12:07:15.000Z'
    data:
      edited: false
      editors:
      - james-passio
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9238550066947937
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/642194962cc2b3c39e8111e6/AE6sx5Ad9n-sxxpatjPIc.jpeg?w=200&h=200&f=face
          fullname: James Kelly
          isHf: false
          isPro: false
          name: james-passio
          type: user
        html: '<p>I think there''s an issue with the example. Once I looked further
          in the documentation I saw there''s a specific prompt format:</p>

          <pre><code>qtext = f"Question: {question} Answer:"

          </code></pre>

          <p>If I send <code>qtext</code> I get good results. </p>

          '
        raw: 'I think there''s an issue with the example. Once I looked further in
          the documentation I saw there''s a specific prompt format:


          ```

          qtext = f"Question: {question} Answer:"

          ```


          If I send `qtext` I get good results. '
        updatedAt: '2023-09-11T12:07:15.082Z'
      numEdits: 0
      reactions: []
    id: 64ff02f3f8cf9e4f5b038262
    type: comment
  author: james-passio
  content: 'I think there''s an issue with the example. Once I looked further in the
    documentation I saw there''s a specific prompt format:


    ```

    qtext = f"Question: {question} Answer:"

    ```


    If I send `qtext` I get good results. '
  created_at: 2023-09-11 11:07:15+00:00
  edited: false
  hidden: false
  id: 64ff02f3f8cf9e4f5b038262
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
      fullname: Niels Rogge
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: nielsr
      type: user
    createdAt: '2023-09-11T12:58:55.000Z'
    data:
      edited: false
      editors:
      - nielsr
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7482855916023254
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
          fullname: Niels Rogge
          isHf: true
          isPro: false
          name: nielsr
          type: user
        html: '<p>Hi,</p>

          <p>Yes the authors are aware of this, they explicitly strip() the output
          as seen here: <a rel="nofollow" href="https://github.com/salesforce/LAVIS/blob/e4040b13d6120062829ee9625f016f3cd3dd16e6/lavis/models/blip2_models/blip2_opt.py#L278">https://github.com/salesforce/LAVIS/blob/e4040b13d6120062829ee9625f016f3cd3dd16e6/lavis/models/blip2_models/blip2_opt.py#L278</a>.</p>

          <p>Will update the model card, thanks for reporting.</p>

          '
        raw: 'Hi,


          Yes the authors are aware of this, they explicitly strip() the output as
          seen here: https://github.com/salesforce/LAVIS/blob/e4040b13d6120062829ee9625f016f3cd3dd16e6/lavis/models/blip2_models/blip2_opt.py#L278.


          Will update the model card, thanks for reporting.'
        updatedAt: '2023-09-11T12:58:55.257Z'
      numEdits: 0
      reactions: []
    id: 64ff0f0f56243ce8cb6e6c76
    type: comment
  author: nielsr
  content: 'Hi,


    Yes the authors are aware of this, they explicitly strip() the output as seen
    here: https://github.com/salesforce/LAVIS/blob/e4040b13d6120062829ee9625f016f3cd3dd16e6/lavis/models/blip2_models/blip2_opt.py#L278.


    Will update the model card, thanks for reporting.'
  created_at: 2023-09-11 11:58:55+00:00
  edited: false
  hidden: false
  id: 64ff0f0f56243ce8cb6e6c76
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1662984023051-62dbe9adfdb18b5f6cb05d20.jpeg?w=200&h=200&f=face
      fullname: simen eide
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: simeneide
      type: user
    createdAt: '2023-11-09T16:06:27.000Z'
    data:
      edited: false
      editors:
      - simeneide
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8260969519615173
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1662984023051-62dbe9adfdb18b5f6cb05d20.jpeg?w=200&h=200&f=face
          fullname: simen eide
          isHf: false
          isPro: false
          name: simeneide
          type: user
        html: '<p>Not updated yet ;) But I found this discussion fortunately :)</p>

          '
        raw: Not updated yet ;) But I found this discussion fortunately :)
        updatedAt: '2023-11-09T16:06:27.269Z'
      numEdits: 0
      reactions: []
    id: 654d03830154da835aff266e
    type: comment
  author: simeneide
  content: Not updated yet ;) But I found this discussion fortunately :)
  created_at: 2023-11-09 16:06:27+00:00
  edited: false
  hidden: false
  id: 654d03830154da835aff266e
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 15
repo_id: Salesforce/blip2-opt-2.7b
repo_type: model
status: open
target_branch: null
title: BLIP2 Always Gives `\n` as Output
