!!python/object:huggingface_hub.community.DiscussionWithDetails
author: NitishKumar1999
conflicting_files: null
created_at: 2024-01-08 15:26:15+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/be3f17407e7841ae40042dc574a107d4.svg
      fullname: Pilla
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: NitishKumar1999
      type: user
    createdAt: '2024-01-08T15:26:15.000Z'
    data:
      edited: false
      editors:
      - NitishKumar1999
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.52329421043396
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/be3f17407e7841ae40042dc574a107d4.svg
          fullname: Pilla
          isHf: false
          isPro: false
          name: NitishKumar1999
          type: user
        html: "<p>I tried the below code and am facing a <code>'NoneType' object is\
          \ not subscriptable</code> error:</p>\n<pre><code class=\"language-python\"\
          ><span class=\"hljs-keyword\">from</span> transformers <span class=\"hljs-keyword\"\
          >import</span> AutoTokenizer\n<span class=\"hljs-keyword\">from</span> auto_gptq\
          \ <span class=\"hljs-keyword\">import</span> AutoGPTQForCausalLM\n\nmodel_name\
          \ = <span class=\"hljs-string\">'support-pvelocity/Code-Llama-2-13B-instruct-text2sql-GPTQ'</span>\n\
          \nmodel = AutoGPTQForCausalLM.from_quantized(model_name, use_safetensors=<span\
          \ class=\"hljs-literal\">True</span>, device_map=<span class=\"hljs-string\"\
          >'auto'</span>)\ntokenizer = AutoTokenizer.from_pretrained(model_name)\n\
          \ntable = <span class=\"hljs-string\">\"CREATE TABLE sales (...); CREATE\
          \ TABLE product_suppliers (...);\"</span>\n\nquestion = <span class=\"hljs-string\"\
          >'Find the salesperson who made the most sales.'</span>\n\nprompt = <span\
          \ class=\"hljs-string\">f\"[INST] Write SQLite query to answer the following\
          \ question given the database schema. Please wrap your code answer using\
          \ ```: Schema: <span class=\"hljs-subst\">{table}</span> Question: <span\
          \ class=\"hljs-subst\">{question}</span> [/INST] Here is the SQLite query\
          \ to answer to the question: <span class=\"hljs-subst\">{question}</span>:\
          \ ``` \"</span>\n\ntokens = tokenizer(prompt, return_tensors=<span class=\"\
          hljs-string\">\"pt\"</span>).to(<span class=\"hljs-string\">'cuda:0'</span>)\n\
          input_ids = tokens.input_ids\n\ngenerated_ids = model.generate(input_ids=input_ids,\
          \ max_length=<span class=\"hljs-number\">4048</span>, pad_token_id=tokenizer.eos_token_id)\n\
          output = tokenizer.decode(generated_ids[<span class=\"hljs-number\">0</span>],\
          \ skip_special_tokens=<span class=\"hljs-literal\">True</span>)\noutput\
          \ = output.split(<span class=\"hljs-string\">'```'</span>)[<span class=\"\
          hljs-number\">2</span>]\n<span class=\"hljs-built_in\">print</span>(output)\n\
          </code></pre>\n<p>Below is the complete error:</p>\n<pre><code class=\"\
          language-python\">TypeError                                 Traceback (most\
          \ recent call last)\nCell In[<span class=\"hljs-number\">1</span>], line\
          \ <span class=\"hljs-number\">18</span>\n     <span class=\"hljs-number\"\
          >15</span> tokens = tokenizer(prompt, return_tensors=<span class=\"hljs-string\"\
          >\"pt\"</span>).to(<span class=\"hljs-string\">'cuda:0'</span>)\n     <span\
          \ class=\"hljs-number\">16</span> input_ids = tokens.input_ids\n---&gt;\
          \ <span class=\"hljs-number\">18</span> generated_ids = model.generate(input_ids=input_ids,\
          \ max_length=<span class=\"hljs-number\">4048</span>, pad_token_id=tokenizer.eos_token_id)\n\
          \     <span class=\"hljs-number\">19</span> output = tokenizer.decode(generated_ids[<span\
          \ class=\"hljs-number\">0</span>], skip_special_tokens=<span class=\"hljs-literal\"\
          >True</span>)\n     <span class=\"hljs-number\">20</span> output = output.split(<span\
          \ class=\"hljs-string\">'```'</span>)[<span class=\"hljs-number\">2</span>]\n\
          \nFile ~/.local/lib/python3<span class=\"hljs-number\">.10</span>/site-packages/auto_gptq/modeling/_base.py:<span\
          \ class=\"hljs-number\">447</span>, <span class=\"hljs-keyword\">in</span>\
          \ BaseGPTQForCausalLM.generate(self, **kwargs)\n    ...\nTypeError: <span\
          \ class=\"hljs-string\">'NoneType'</span> <span class=\"hljs-built_in\"\
          >object</span> <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\"\
          >not</span> subscriptable\n</code></pre>\n<p>Can anyone help me understand\
          \ why I am getting this error and how to fix it?</p>\n"
        raw: "I tried the below code and am facing a `'NoneType' object is not subscriptable`\
          \ error:\r\n\r\n```python\r\nfrom transformers import AutoTokenizer\r\n\
          from auto_gptq import AutoGPTQForCausalLM\r\n\r\nmodel_name = 'support-pvelocity/Code-Llama-2-13B-instruct-text2sql-GPTQ'\r\
          \n\r\nmodel = AutoGPTQForCausalLM.from_quantized(model_name, use_safetensors=True,\
          \ device_map='auto')\r\ntokenizer = AutoTokenizer.from_pretrained(model_name)\r\
          \n\r\ntable = \"CREATE TABLE sales (...); CREATE TABLE product_suppliers\
          \ (...);\"\r\n\r\nquestion = 'Find the salesperson who made the most sales.'\r\
          \n\r\nprompt = f\"[INST] Write SQLite query to answer the following question\
          \ given the database schema. Please wrap your code answer using ```: Schema:\
          \ {table} Question: {question} [/INST] Here is the SQLite query to answer\
          \ to the question: {question}: ``` \"\r\n\r\ntokens = tokenizer(prompt,\
          \ return_tensors=\"pt\").to('cuda:0')\r\ninput_ids = tokens.input_ids\r\n\
          \r\ngenerated_ids = model.generate(input_ids=input_ids, max_length=4048,\
          \ pad_token_id=tokenizer.eos_token_id)\r\noutput = tokenizer.decode(generated_ids[0],\
          \ skip_special_tokens=True)\r\noutput = output.split('```')[2]\r\nprint(output)\r\
          \n```\r\n\r\nBelow is the complete error:\r\n\r\n```python\r\nTypeError\
          \                                 Traceback (most recent call last)\r\n\
          Cell In[1], line 18\r\n     15 tokens = tokenizer(prompt, return_tensors=\"\
          pt\").to('cuda:0')\r\n     16 input_ids = tokens.input_ids\r\n---> 18 generated_ids\
          \ = model.generate(input_ids=input_ids, max_length=4048, pad_token_id=tokenizer.eos_token_id)\r\
          \n     19 output = tokenizer.decode(generated_ids[0], skip_special_tokens=True)\r\
          \n     20 output = output.split('```')[2]\r\n\r\nFile ~/.local/lib/python3.10/site-packages/auto_gptq/modeling/_base.py:447,\
          \ in BaseGPTQForCausalLM.generate(self, **kwargs)\r\n    ...\r\nTypeError:\
          \ 'NoneType' object is not subscriptable\r\n```\r\nCan anyone help me understand\
          \ why I am getting this error and how to fix it?\r\n"
        updatedAt: '2024-01-08T15:26:15.392Z'
      numEdits: 0
      reactions: []
    id: 659c1417bc5a462bbf95ecce
    type: comment
  author: NitishKumar1999
  content: "I tried the below code and am facing a `'NoneType' object is not subscriptable`\
    \ error:\r\n\r\n```python\r\nfrom transformers import AutoTokenizer\r\nfrom auto_gptq\
    \ import AutoGPTQForCausalLM\r\n\r\nmodel_name = 'support-pvelocity/Code-Llama-2-13B-instruct-text2sql-GPTQ'\r\
    \n\r\nmodel = AutoGPTQForCausalLM.from_quantized(model_name, use_safetensors=True,\
    \ device_map='auto')\r\ntokenizer = AutoTokenizer.from_pretrained(model_name)\r\
    \n\r\ntable = \"CREATE TABLE sales (...); CREATE TABLE product_suppliers (...);\"\
    \r\n\r\nquestion = 'Find the salesperson who made the most sales.'\r\n\r\nprompt\
    \ = f\"[INST] Write SQLite query to answer the following question given the database\
    \ schema. Please wrap your code answer using ```: Schema: {table} Question: {question}\
    \ [/INST] Here is the SQLite query to answer to the question: {question}: ```\
    \ \"\r\n\r\ntokens = tokenizer(prompt, return_tensors=\"pt\").to('cuda:0')\r\n\
    input_ids = tokens.input_ids\r\n\r\ngenerated_ids = model.generate(input_ids=input_ids,\
    \ max_length=4048, pad_token_id=tokenizer.eos_token_id)\r\noutput = tokenizer.decode(generated_ids[0],\
    \ skip_special_tokens=True)\r\noutput = output.split('```')[2]\r\nprint(output)\r\
    \n```\r\n\r\nBelow is the complete error:\r\n\r\n```python\r\nTypeError      \
    \                           Traceback (most recent call last)\r\nCell In[1], line\
    \ 18\r\n     15 tokens = tokenizer(prompt, return_tensors=\"pt\").to('cuda:0')\r\
    \n     16 input_ids = tokens.input_ids\r\n---> 18 generated_ids = model.generate(input_ids=input_ids,\
    \ max_length=4048, pad_token_id=tokenizer.eos_token_id)\r\n     19 output = tokenizer.decode(generated_ids[0],\
    \ skip_special_tokens=True)\r\n     20 output = output.split('```')[2]\r\n\r\n\
    File ~/.local/lib/python3.10/site-packages/auto_gptq/modeling/_base.py:447, in\
    \ BaseGPTQForCausalLM.generate(self, **kwargs)\r\n    ...\r\nTypeError: 'NoneType'\
    \ object is not subscriptable\r\n```\r\nCan anyone help me understand why I am\
    \ getting this error and how to fix it?\r\n"
  created_at: 2024-01-08 15:26:15+00:00
  edited: false
  hidden: false
  id: 659c1417bc5a462bbf95ecce
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: support-pvelocity/Code-Llama-2-13B-instruct-text2sql-GPTQ
repo_type: model
status: open
target_branch: null
title: '''NoneType'' object is not subscriptable` error'
