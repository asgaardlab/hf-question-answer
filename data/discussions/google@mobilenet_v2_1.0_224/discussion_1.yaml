!!python/object:huggingface_hub.community.DiscussionWithDetails
author: ayazdan
conflicting_files: null
created_at: 2022-12-07 03:34:51+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/76e5e7b51515b58e207c7d2a4b360d30.svg
      fullname: Amir Yazdanbakhsh
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ayazdan
      type: user
    createdAt: '2022-12-07T03:34:51.000Z'
    data:
      edited: false
      editors:
      - ayazdan
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/76e5e7b51515b58e207c7d2a4b360d30.svg
          fullname: Amir Yazdanbakhsh
          isHf: false
          isPro: false
          name: ayazdan
          type: user
        html: "<p>I am using the following script to measure model accuracy on imagenet-1k:</p>\n\
          <pre><code>python3 transformer-sparsity/examples/pytorch/image-classification/run_image_classification.py\
          \ \\\n        --model_name_or_path ${model} \\\n        --dataset_name imagenet-1k\
          \ \\\n        --do_eval \\\n        --remove_unused_columns false \\\n \
          \       --per_device_eval_batch_size 32 \\\n        --use_auth_token true\
          \ \\\n        --overwrite_output_dir \\\n        --save_steps 1 \\\n   \
          \     --ignore_mismatched_sizes true \\\n        --output_dir ~/${base_dir}\
          \ 2&gt;&amp;1 | tee ~/${base_dir}/${model_simplified}_test.txt\n</code></pre>\n\
          <p>The eval_accuracy is 0.0011. Is this expected?</p>\n"
        raw: "I am using the following script to measure model accuracy on imagenet-1k:\r\
          \n\r\n```\r\npython3 transformer-sparsity/examples/pytorch/image-classification/run_image_classification.py\
          \ \\\r\n        --model_name_or_path ${model} \\\r\n        --dataset_name\
          \ imagenet-1k \\\r\n        --do_eval \\\r\n        --remove_unused_columns\
          \ false \\\r\n        --per_device_eval_batch_size 32 \\\r\n        --use_auth_token\
          \ true \\\r\n        --overwrite_output_dir \\\r\n        --save_steps 1\
          \ \\\r\n        --ignore_mismatched_sizes true \\\r\n        --output_dir\
          \ ~/${base_dir} 2>&1 | tee ~/${base_dir}/${model_simplified}_test.txt\r\n\
          ```\r\n\r\nThe eval_accuracy is 0.0011. Is this expected?"
        updatedAt: '2022-12-07T03:34:51.750Z'
      numEdits: 0
      reactions: []
    id: 639009dbc3f0d3c3f0cd19dc
    type: comment
  author: ayazdan
  content: "I am using the following script to measure model accuracy on imagenet-1k:\r\
    \n\r\n```\r\npython3 transformer-sparsity/examples/pytorch/image-classification/run_image_classification.py\
    \ \\\r\n        --model_name_or_path ${model} \\\r\n        --dataset_name imagenet-1k\
    \ \\\r\n        --do_eval \\\r\n        --remove_unused_columns false \\\r\n \
    \       --per_device_eval_batch_size 32 \\\r\n        --use_auth_token true \\\
    \r\n        --overwrite_output_dir \\\r\n        --save_steps 1 \\\r\n       \
    \ --ignore_mismatched_sizes true \\\r\n        --output_dir ~/${base_dir} 2>&1\
    \ | tee ~/${base_dir}/${model_simplified}_test.txt\r\n```\r\n\r\nThe eval_accuracy\
    \ is 0.0011. Is this expected?"
  created_at: 2022-12-07 03:34:51+00:00
  edited: false
  hidden: false
  id: 639009dbc3f0d3c3f0cd19dc
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/76e5e7b51515b58e207c7d2a4b360d30.svg
      fullname: Amir Yazdanbakhsh
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ayazdan
      type: user
    createdAt: '2022-12-07T03:55:47.000Z'
    data:
      edited: false
      editors:
      - ayazdan
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/76e5e7b51515b58e207c7d2a4b360d30.svg
          fullname: Amir Yazdanbakhsh
          isHf: false
          isPro: false
          name: ayazdan
          type: user
        html: '<p>It could be because of the difference for class sizes, giving the
          following error:</p>

          <pre><code>[WARNING|modeling_utils.py:2628] 2022-12-07 03:53:36,920 &gt;&gt;
          Some weights of MobileNetV1ForImageClassification were not initialized from
          the model checkpoint at Matthijs/mobilenet_v1_0.75_192 and are newly initialized
          because the shapes did not match:

          - classifier.weight: found shape torch.Size([1001, 768]) in the checkpoint
          and torch.Size([1000, 768]) in the model instantiated

          - classifier.bias: found shape torch.Size([1001]) in the checkpoint and
          torch.Size([1000]) in the model instantiated

          You should probably TRAIN this model on a down-stream task to be able to
          use it for predictions and inference.

          </code></pre>

          '
        raw: 'It could be because of the difference for class sizes, giving the following
          error:


          ```

          [WARNING|modeling_utils.py:2628] 2022-12-07 03:53:36,920 >> Some weights
          of MobileNetV1ForImageClassification were not initialized from the model
          checkpoint at Matthijs/mobilenet_v1_0.75_192 and are newly initialized because
          the shapes did not match:

          - classifier.weight: found shape torch.Size([1001, 768]) in the checkpoint
          and torch.Size([1000, 768]) in the model instantiated

          - classifier.bias: found shape torch.Size([1001]) in the checkpoint and
          torch.Size([1000]) in the model instantiated

          You should probably TRAIN this model on a down-stream task to be able to
          use it for predictions and inference.

          ```'
        updatedAt: '2022-12-07T03:55:47.901Z'
      numEdits: 0
      reactions: []
    id: 63900ec31c5a623727261242
    type: comment
  author: ayazdan
  content: 'It could be because of the difference for class sizes, giving the following
    error:


    ```

    [WARNING|modeling_utils.py:2628] 2022-12-07 03:53:36,920 >> Some weights of MobileNetV1ForImageClassification
    were not initialized from the model checkpoint at Matthijs/mobilenet_v1_0.75_192
    and are newly initialized because the shapes did not match:

    - classifier.weight: found shape torch.Size([1001, 768]) in the checkpoint and
    torch.Size([1000, 768]) in the model instantiated

    - classifier.bias: found shape torch.Size([1001]) in the checkpoint and torch.Size([1000])
    in the model instantiated

    You should probably TRAIN this model on a down-stream task to be able to use it
    for predictions and inference.

    ```'
  created_at: 2022-12-07 03:55:47+00:00
  edited: false
  hidden: false
  id: 63900ec31c5a623727261242
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/76e5e7b51515b58e207c7d2a4b360d30.svg
      fullname: Amir Yazdanbakhsh
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ayazdan
      type: user
    createdAt: '2022-12-07T21:40:53.000Z'
    data:
      edited: false
      editors:
      - ayazdan
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/76e5e7b51515b58e207c7d2a4b360d30.svg
          fullname: Amir Yazdanbakhsh
          isHf: false
          isPro: false
          name: ayazdan
          type: user
        html: "<p>I have tried the following training as well but so far the accuracy\
          \ is very low <code>eval_accuracy -&gt; 0.001</code></p>\n<pre><code>lr=0.01\n\
          epochs=20\n\nmodel=${1}\n\n\nbase_dir=mobilenetv1_lr${lr}_epochs_${epochs}_optim_${optim}_lr_schedule_${lr_schedule}\n\
          rm -rf ${base_dir}\n\npython3 transformer-sparsity/examples/pytorch/image-classification/run_image_classification.py\
          \ \\\n    --model_name_or_path ${model} \\\n    --dataset_name imagenet-1k\
          \ \\\n    --remove_unused_columns false \\\n    --per_device_train_batch_size\
          \ 256 \\\n    --per_device_eval_batch_size 256 \\\n    --do_train \\\n \
          \   --do_eval \\\n    --lr_scheduler_type constant \\\n    --weight_decay\
          \ 0.00004 \\\n    --load_best_model_at_end \\\n    --eval_steps ${eval_steps}\
          \ \\\n    --save_steps ${eval_steps} \\\n    --evaluation_strategy steps\
          \ \\\n    --logging_steps ${eval_steps} \\\n    --logging_strategy steps\
          \ \\\n    --num_train_epochs ${epochs} \\\n    --learning_rate ${lr} \\\n\
          \    --optim rmsprop \\\n    --ignore_mismatched_sizes true \\\n    --save_total_limit\
          \ 2 \\\n    --overwrite_output_dir \\\n    --output_dir ~/${base_dir} 2&gt;&amp;1\
          \ | tee ~/${base_dir}/mobilenetv1_finetune.txt\n</code></pre>\n"
        raw: "I have tried the following training as well but so far the accuracy\
          \ is very low `eval_accuracy -> 0.001`\n\n```\nlr=0.01\nepochs=20\n\nmodel=${1}\n\
          \n\nbase_dir=mobilenetv1_lr${lr}_epochs_${epochs}_optim_${optim}_lr_schedule_${lr_schedule}\n\
          rm -rf ${base_dir}\n\npython3 transformer-sparsity/examples/pytorch/image-classification/run_image_classification.py\
          \ \\\n\t--model_name_or_path ${model} \\\n\t--dataset_name imagenet-1k \\\
          \n\t--remove_unused_columns false \\\n\t--per_device_train_batch_size 256\
          \ \\\n\t--per_device_eval_batch_size 256 \\\n\t--do_train \\\n\t--do_eval\
          \ \\\n\t--lr_scheduler_type constant \\\n\t--weight_decay 0.00004 \\\n\t\
          --load_best_model_at_end \\\n\t--eval_steps ${eval_steps} \\\n\t--save_steps\
          \ ${eval_steps} \\\n\t--evaluation_strategy steps \\\n\t--logging_steps\
          \ ${eval_steps} \\\n\t--logging_strategy steps \\\n\t--num_train_epochs\
          \ ${epochs} \\\n\t--learning_rate ${lr} \\\n\t--optim rmsprop \\\n\t--ignore_mismatched_sizes\
          \ true \\\n\t--save_total_limit 2 \\\n\t--overwrite_output_dir \\\n\t--output_dir\
          \ ~/${base_dir} 2>&1 | tee ~/${base_dir}/mobilenetv1_finetune.txt\n```"
        updatedAt: '2022-12-07T21:40:53.930Z'
      numEdits: 0
      reactions: []
    id: 63910865b73a0f8c02a82a30
    type: comment
  author: ayazdan
  content: "I have tried the following training as well but so far the accuracy is\
    \ very low `eval_accuracy -> 0.001`\n\n```\nlr=0.01\nepochs=20\n\nmodel=${1}\n\
    \n\nbase_dir=mobilenetv1_lr${lr}_epochs_${epochs}_optim_${optim}_lr_schedule_${lr_schedule}\n\
    rm -rf ${base_dir}\n\npython3 transformer-sparsity/examples/pytorch/image-classification/run_image_classification.py\
    \ \\\n\t--model_name_or_path ${model} \\\n\t--dataset_name imagenet-1k \\\n\t\
    --remove_unused_columns false \\\n\t--per_device_train_batch_size 256 \\\n\t--per_device_eval_batch_size\
    \ 256 \\\n\t--do_train \\\n\t--do_eval \\\n\t--lr_scheduler_type constant \\\n\
    \t--weight_decay 0.00004 \\\n\t--load_best_model_at_end \\\n\t--eval_steps ${eval_steps}\
    \ \\\n\t--save_steps ${eval_steps} \\\n\t--evaluation_strategy steps \\\n\t--logging_steps\
    \ ${eval_steps} \\\n\t--logging_strategy steps \\\n\t--num_train_epochs ${epochs}\
    \ \\\n\t--learning_rate ${lr} \\\n\t--optim rmsprop \\\n\t--ignore_mismatched_sizes\
    \ true \\\n\t--save_total_limit 2 \\\n\t--overwrite_output_dir \\\n\t--output_dir\
    \ ~/${base_dir} 2>&1 | tee ~/${base_dir}/mobilenetv1_finetune.txt\n```"
  created_at: 2022-12-07 21:40:53+00:00
  edited: false
  hidden: false
  id: 63910865b73a0f8c02a82a30
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: google/mobilenet_v2_1.0_224
repo_type: model
status: open
target_branch: null
title: Accuracy?
