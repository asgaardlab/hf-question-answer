!!python/object:huggingface_hub.community.DiscussionWithDetails
author: patrickvonplaten
conflicting_files: []
created_at: 2023-11-16 00:02:20+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2023-11-16T00:02:20.000Z'
    data:
      edited: false
      editors:
      - patrickvonplaten
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9783039093017578
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
          fullname: Patrick von Platen
          isHf: true
          isPro: false
          name: patrickvonplaten
          type: user
        html: '<p>In the example above we advertise using tiny in a ForCausalLM class
          which can''t work since tiny does <strong>not</strong> share the same encoder
          as large-v3. We can advertise it as soon as distil-v3 is out.</p>

          '
        raw: In the example above we advertise using tiny in a ForCausalLM class which
          can't work since tiny does **not** share the same encoder as large-v3. We
          can advertise it as soon as distil-v3 is out.
        updatedAt: '2023-11-16T00:02:20.726Z'
      numEdits: 0
      reactions: []
    id: 65555c0c89fd41f8afe90ac4
    type: comment
  author: patrickvonplaten
  content: In the example above we advertise using tiny in a ForCausalLM class which
    can't work since tiny does **not** share the same encoder as large-v3. We can
    advertise it as soon as distil-v3 is out.
  created_at: 2023-11-16 00:02:20+00:00
  edited: false
  hidden: false
  id: 65555c0c89fd41f8afe90ac4
  type: comment
- !!python/object:huggingface_hub.community.DiscussionCommit
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2023-11-16T00:02:21.000Z'
    data:
      oid: 3264a14fc680cf148949b17860f045ce2cf81edb
      parents:
      - f36413183a6aeb4e19ecb935a2f3fdec6e9078c3
      subject: Speculative Decoding doesn't work yet with Whisper-v3
    id: 65555c0d0000000000000000
    type: commit
  author: patrickvonplaten
  created_at: 2023-11-16 00:02:21+00:00
  id: 65555c0d0000000000000000
  oid: 3264a14fc680cf148949b17860f045ce2cf81edb
  summary: Speculative Decoding doesn't work yet with Whisper-v3
  type: commit
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2023-11-16T00:02:38.000Z'
    data:
      edited: false
      editors:
      - patrickvonplaten
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7310240864753723
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
          fullname: Patrick von Platen
          isHf: true
          isPro: false
          name: patrickvonplaten
          type: user
        html: "<p>cc <span data-props=\"{&quot;user&quot;:&quot;sanchit-gandhi&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/sanchit-gandhi\"\
          >@<span class=\"underline\">sanchit-gandhi</span></a></span>\n\n\t</span></span>\
          \ to double check</p>\n"
        raw: cc @sanchit-gandhi to double check
        updatedAt: '2023-11-16T00:02:38.378Z'
      numEdits: 0
      reactions: []
    id: 65555c1ebce11b9cde7dd6f0
    type: comment
  author: patrickvonplaten
  content: cc @sanchit-gandhi to double check
  created_at: 2023-11-16 00:02:38+00:00
  edited: false
  hidden: false
  id: 65555c1ebce11b9cde7dd6f0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1653243468328-61f91cf54a8e5a275b2b3e7c.jpeg?w=200&h=200&f=face
      fullname: Sanchit Gandhi
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: sanchit-gandhi
      type: user
    createdAt: '2023-11-16T11:02:20.000Z'
    data:
      edited: true
      editors:
      - sanchit-gandhi
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9917218685150146
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1653243468328-61f91cf54a8e5a275b2b3e7c.jpeg?w=200&h=200&f=face
          fullname: Sanchit Gandhi
          isHf: true
          isPro: false
          name: sanchit-gandhi
          type: user
        html: "<p>Good with me! Note that in an ideal world, having the same encoder\
          \ dimensions should not be a pre-requisite for speculative decoding. We\
          \ should be able to run speculative decoding with two models even if they\
          \ have different encoder dims (we just need to run a forward pass through\
          \ each encoder once). The only constraint should be having the same <strong>vocab\
          \ size</strong> (so that the logit space is shared) -&gt; this is the violated\
          \ condition with <code>large-v3</code>,  since it uses a bigger vocab size\
          \ than previous Whisper models</p>\n<p>cc <span data-props=\"{&quot;user&quot;:&quot;reach-vb&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/reach-vb\"\
          >@<span class=\"underline\">reach-vb</span></a></span>\n\n\t</span></span>\
          \ as well</p>\n"
        raw: 'Good with me! Note that in an ideal world, having the same encoder dimensions
          should not be a pre-requisite for speculative decoding. We should be able
          to run speculative decoding with two models even if they have different
          encoder dims (we just need to run a forward pass through each encoder once).
          The only constraint should be having the same **vocab size** (so that the
          logit space is shared) -> this is the violated condition with `large-v3`,  since
          it uses a bigger vocab size than previous Whisper models


          cc @reach-vb as well'
        updatedAt: '2023-11-16T11:26:22.424Z'
      numEdits: 1
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - patrickvonplaten
    id: 6555f6bc2ddc237c7cda64d5
    type: comment
  author: sanchit-gandhi
  content: 'Good with me! Note that in an ideal world, having the same encoder dimensions
    should not be a pre-requisite for speculative decoding. We should be able to run
    speculative decoding with two models even if they have different encoder dims
    (we just need to run a forward pass through each encoder once). The only constraint
    should be having the same **vocab size** (so that the logit space is shared) ->
    this is the violated condition with `large-v3`,  since it uses a bigger vocab
    size than previous Whisper models


    cc @reach-vb as well'
  created_at: 2023-11-16 11:02:20+00:00
  edited: true
  hidden: false
  id: 6555f6bc2ddc237c7cda64d5
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2023-11-16T11:40:52.000Z'
    data:
      edited: false
      editors:
      - patrickvonplaten
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9693029522895813
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
          fullname: Patrick von Platen
          isHf: true
          isPro: false
          name: patrickvonplaten
          type: user
        html: '<p>Good catch with the vocabulary! RE: encoder dims, yes it''s definitely
          possible, but it would also mean that we run the audio through two different
          whisper processors (to get the correct mel dimensions) which is not supported
          at the moment and I''m not sure it will be in the near future.</p>

          <p>=&gt; So I think it''ll be best to wait for distil-whisper-v3 here for
          spec decoding :-) </p>

          '
        raw: 'Good catch with the vocabulary! RE: encoder dims, yes it''s definitely
          possible, but it would also mean that we run the audio through two different
          whisper processors (to get the correct mel dimensions) which is not supported
          at the moment and I''m not sure it will be in the near future.


          => So I think it''ll be best to wait for distil-whisper-v3 here for spec
          decoding :-) '
        updatedAt: '2023-11-16T11:40:52.802Z'
      numEdits: 0
      reactions: []
    id: 6555ffc440aecb7ea4fbd2db
    type: comment
  author: patrickvonplaten
  content: 'Good catch with the vocabulary! RE: encoder dims, yes it''s definitely
    possible, but it would also mean that we run the audio through two different whisper
    processors (to get the correct mel dimensions) which is not supported at the moment
    and I''m not sure it will be in the near future.


    => So I think it''ll be best to wait for distil-whisper-v3 here for spec decoding
    :-) '
  created_at: 2023-11-16 11:40:52+00:00
  edited: false
  hidden: false
  id: 6555ffc440aecb7ea4fbd2db
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2023-11-16T11:43:26.000Z'
    data:
      status: merged
    id: 6556005e10428134ff1990b2
    type: status-change
  author: patrickvonplaten
  created_at: 2023-11-16 11:43:26+00:00
  id: 6556005e10428134ff1990b2
  new_status: merged
  type: status-change
is_pull_request: true
merge_commit_oid: 77b8369da9a8dcbe7c1434007cde675a0200fa38
num: 23
repo_id: openai/whisper-large-v3
repo_type: model
status: merged
target_branch: refs/heads/main
title: Speculative Decoding doesn't work yet with Whisper-v3
