!!python/object:huggingface_hub.community.DiscussionWithDetails
author: j35t3r
conflicting_files: null
created_at: 2023-10-25 13:19:40+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/4d0b9d0d58ab3cb7097fe714a5377a7d.svg
      fullname: Peter Lorenz
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: j35t3r
      type: user
    createdAt: '2023-10-25T14:19:40.000Z'
    data:
      edited: false
      editors:
      - j35t3r
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6209955811500549
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/4d0b9d0d58ab3cb7097fe714a5377a7d.svg
          fullname: Peter Lorenz
          isHf: false
          isPro: false
          name: j35t3r
          type: user
        html: "<pre><code>import timm\nmodel = timm.create_model(\"hf_hub:edadaltocg/resnet18_svhn\"\
          , pretrained=True)\n</code></pre>\n<pre><code>   Rraise RuntimeError('Error(s)\
          \ in loading state_dict for {}:\\n\\t{}'.format(\nRuntimeError: Error(s)\
          \ in loading state_dict for ResNet:\n        size mismatch for conv1.weight:\
          \ copying a param with shape torch.Size([64, 3, 3, 3]) from checkpoint,\
          \ the shape in current model is torch.Size([64, 3, 7, 7]).\n</code></pre>\n"
        raw: "```\r\nimport timm\r\nmodel = timm.create_model(\"hf_hub:edadaltocg/resnet18_svhn\"\
          , pretrained=True)\r\n```\r\n```\r\n   Rraise RuntimeError('Error(s) in\
          \ loading state_dict for {}:\\n\\t{}'.format(\r\nRuntimeError: Error(s)\
          \ in loading state_dict for ResNet:\r\n        size mismatch for conv1.weight:\
          \ copying a param with shape torch.Size([64, 3, 3, 3]) from checkpoint,\
          \ the shape in current model is torch.Size([64, 3, 7, 7]).\r\n```"
        updatedAt: '2023-10-25T14:19:40.741Z'
      numEdits: 0
      reactions: []
    id: 653923fc5c8e4863e1983c8b
    type: comment
  author: j35t3r
  content: "```\r\nimport timm\r\nmodel = timm.create_model(\"hf_hub:edadaltocg/resnet18_svhn\"\
    , pretrained=True)\r\n```\r\n```\r\n   Rraise RuntimeError('Error(s) in loading\
    \ state_dict for {}:\\n\\t{}'.format(\r\nRuntimeError: Error(s) in loading state_dict\
    \ for ResNet:\r\n        size mismatch for conv1.weight: copying a param with\
    \ shape torch.Size([64, 3, 3, 3]) from checkpoint, the shape in current model\
    \ is torch.Size([64, 3, 7, 7]).\r\n```"
  created_at: 2023-10-25 13:19:40+00:00
  edited: false
  hidden: false
  id: 653923fc5c8e4863e1983c8b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/4d0b9d0d58ab3cb7097fe714a5377a7d.svg
      fullname: Peter Lorenz
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: j35t3r
      type: user
    createdAt: '2023-10-25T14:37:28.000Z'
    data:
      edited: true
      editors:
      - j35t3r
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.4794667065143585
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/4d0b9d0d58ab3cb7097fe714a5377a7d.svg
          fullname: Peter Lorenz
          isHf: false
          isPro: false
          name: j35t3r
          type: user
        html: "<p>This seems to work for me:</p>\n<pre><code>        model = timm.create_model(\"\
          hf_hub:edadaltocg/resnet18_svhn\", pretrained=False)\n        # override\
          \ model\n        model.conv1 = nn.Conv2d(3, 64, kernel_size=(3, 3), stride=(1,\
          \ 1), padding=(1, 1), bias=False)\n        model.maxpool = nn.Identity()\
          \  # type: ignore\n        model.fc = nn.Linear(512, 10)\n\n        if args.mode\
          \ == 'spatial':\n            model.load_state_dict(\n            torch.hub.load_state_dict_from_url(\n\
          \                \"https://huggingface.co/edadaltocg/resnet18_svhn/resolve/main/pytorch_model.bin\"\
          ,\n                map_location=\"cpu\", \n                file_name=\"\
          resnet18_cifar10.pth\",\n                )\n            )\n</code></pre>\n\
          <p>More testing needed</p>\n"
        raw: "This seems to work for me:\n\n```\n        model = timm.create_model(\"\
          hf_hub:edadaltocg/resnet18_svhn\", pretrained=False)\n        # override\
          \ model\n        model.conv1 = nn.Conv2d(3, 64, kernel_size=(3, 3), stride=(1,\
          \ 1), padding=(1, 1), bias=False)\n        model.maxpool = nn.Identity()\
          \  # type: ignore\n        model.fc = nn.Linear(512, 10)\n\n        if args.mode\
          \ == 'spatial':\n            model.load_state_dict(\n            torch.hub.load_state_dict_from_url(\n\
          \                \"https://huggingface.co/edadaltocg/resnet18_svhn/resolve/main/pytorch_model.bin\"\
          ,\n                map_location=\"cpu\", \n                file_name=\"\
          resnet18_cifar10.pth\",\n                )\n            )\n```\n\nMore testing\
          \ needed"
        updatedAt: '2023-10-25T14:46:32.861Z'
      numEdits: 1
      reactions: []
    id: 65392828f84b13616678289e
    type: comment
  author: j35t3r
  content: "This seems to work for me:\n\n```\n        model = timm.create_model(\"\
    hf_hub:edadaltocg/resnet18_svhn\", pretrained=False)\n        # override model\n\
    \        model.conv1 = nn.Conv2d(3, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1,\
    \ 1), bias=False)\n        model.maxpool = nn.Identity()  # type: ignore\n   \
    \     model.fc = nn.Linear(512, 10)\n\n        if args.mode == 'spatial':\n  \
    \          model.load_state_dict(\n            torch.hub.load_state_dict_from_url(\n\
    \                \"https://huggingface.co/edadaltocg/resnet18_svhn/resolve/main/pytorch_model.bin\"\
    ,\n                map_location=\"cpu\", \n                file_name=\"resnet18_cifar10.pth\"\
    ,\n                )\n            )\n```\n\nMore testing needed"
  created_at: 2023-10-25 13:37:28+00:00
  edited: true
  hidden: false
  id: 65392828f84b13616678289e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1670087621682-638b80f9b0cc3ae137c44899.jpeg?w=200&h=200&f=face
      fullname: Eduardo Dadalto
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: edadaltocg
      type: user
    createdAt: '2023-10-25T14:38:17.000Z'
    data:
      edited: false
      editors:
      - edadaltocg
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8420456051826477
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1670087621682-638b80f9b0cc3ae137c44899.jpeg?w=200&h=200&f=face
          fullname: Eduardo Dadalto
          isHf: false
          isPro: false
          name: edadaltocg
          type: user
        html: '<p>Please load the model in the following manner as suggested in the
          model card.</p>

          <pre><code>import detectors

          import timm


          model = timm.create_model("resnet18_svhn", pretrained=True)

          </code></pre>

          <p>The conv1 layer implemented in timm is oriented towards larger images,
          in which the convolutional kernel has a size of 7x7. To deal with smaller
          images, I swapped this layer to have a kernel with sizes 3x3, as you can
          see in the error message. That''s why loading from the default resnet18
          model in timm fails, and you should import detectors to load the correct
          model architecture module.</p>

          <p>Please see <code>https://github.com/edadaltocg/detectors/blob/3555ebada096694a69d7f030691ca233ec288190/src/detectors/models/resnet.py#L116</code>for
          the modifications made in the model architecture.</p>

          '
        raw: 'Please load the model in the following manner as suggested in the model
          card.


          ```

          import detectors

          import timm


          model = timm.create_model("resnet18_svhn", pretrained=True)

          ```


          The conv1 layer implemented in timm is oriented towards larger images, in
          which the convolutional kernel has a size of 7x7. To deal with smaller images,
          I swapped this layer to have a kernel with sizes 3x3, as you can see in
          the error message. That''s why loading from the default resnet18 model in
          timm fails, and you should import detectors to load the correct model architecture
          module.


          Please see `https://github.com/edadaltocg/detectors/blob/3555ebada096694a69d7f030691ca233ec288190/src/detectors/models/resnet.py#L116`for
          the modifications made in the model architecture.'
        updatedAt: '2023-10-25T14:38:17.588Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F917"
        users:
        - j35t3r
    id: 653928593483211cc7af858c
    type: comment
  author: edadaltocg
  content: 'Please load the model in the following manner as suggested in the model
    card.


    ```

    import detectors

    import timm


    model = timm.create_model("resnet18_svhn", pretrained=True)

    ```


    The conv1 layer implemented in timm is oriented towards larger images, in which
    the convolutional kernel has a size of 7x7. To deal with smaller images, I swapped
    this layer to have a kernel with sizes 3x3, as you can see in the error message.
    That''s why loading from the default resnet18 model in timm fails, and you should
    import detectors to load the correct model architecture module.


    Please see `https://github.com/edadaltocg/detectors/blob/3555ebada096694a69d7f030691ca233ec288190/src/detectors/models/resnet.py#L116`for
    the modifications made in the model architecture.'
  created_at: 2023-10-25 13:38:17+00:00
  edited: false
  hidden: false
  id: 653928593483211cc7af858c
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 3
repo_id: edadaltocg/resnet18_svhn
repo_type: model
status: open
target_branch: null
title: Model and weights do not fit together
