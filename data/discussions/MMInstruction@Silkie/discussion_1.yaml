!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Neman
conflicting_files: null
created_at: 2023-12-19 17:15:33+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/643095dd23c81b522be33a94/jPDsH-gkQDSNhsh1WVmag.png?w=200&h=200&f=face
      fullname: Zeze Nene
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Neman
      type: user
    createdAt: '2023-12-19T17:15:33.000Z'
    data:
      edited: false
      editors:
      - Neman
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5516089797019958
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/643095dd23c81b522be33a94/jPDsH-gkQDSNhsh1WVmag.png?w=200&h=200&f=face
          fullname: Zeze Nene
          isHf: false
          isPro: false
          name: Neman
          type: user
        html: '<p>I get this error when trying to run example code snippet:<br>Exception
          has occurred: AttributeError<br>''QWenTokenizer'' object has no attribute
          ''IMAGE_ST''<br>  File "/home/neman/.cache/huggingface/modules/transformers_modules/MMInstruction_Silkie/tokenization_qwen.py",
          line 223, in _add_tokens<br>    if surface_form not in SPECIAL_TOKENS +
          self.IMAGE_ST:<br>  File "/home/neman/.cache/huggingface/modules/transformers_modules/MMInstruction_Silkie/tokenization_qwen.py",
          line 120, in <strong>init</strong><br>    super().<strong>init</strong>(**kwargs)<br>  File
          "/home/neman/PROGRAMMING/PYTHON/QwenVL/SilkieVL_test1.py", line 6, in <br>    tokenizer
          = AutoTokenizer.from_pretrained(<br>AttributeError: ''QWenTokenizer'' object
          has no attribute ''IMAGE_ST''</p>

          '
        raw: "I get this error when trying to run example code snippet:\r\nException\
          \ has occurred: AttributeError\r\n'QWenTokenizer' object has no attribute\
          \ 'IMAGE_ST'\r\n  File \"/home/neman/.cache/huggingface/modules/transformers_modules/MMInstruction_Silkie/tokenization_qwen.py\"\
          , line 223, in _add_tokens\r\n    if surface_form not in SPECIAL_TOKENS\
          \ + self.IMAGE_ST:\r\n  File \"/home/neman/.cache/huggingface/modules/transformers_modules/MMInstruction_Silkie/tokenization_qwen.py\"\
          , line 120, in __init__\r\n    super().__init__(**kwargs)\r\n  File \"/home/neman/PROGRAMMING/PYTHON/QwenVL/SilkieVL_test1.py\"\
          , line 6, in <module>\r\n    tokenizer = AutoTokenizer.from_pretrained(\r\
          \nAttributeError: 'QWenTokenizer' object has no attribute 'IMAGE_ST'"
        updatedAt: '2023-12-19T17:15:33.308Z'
      numEdits: 0
      reactions: []
    id: 6581cfb54ab06cdc836ba05c
    type: comment
  author: Neman
  content: "I get this error when trying to run example code snippet:\r\nException\
    \ has occurred: AttributeError\r\n'QWenTokenizer' object has no attribute 'IMAGE_ST'\r\
    \n  File \"/home/neman/.cache/huggingface/modules/transformers_modules/MMInstruction_Silkie/tokenization_qwen.py\"\
    , line 223, in _add_tokens\r\n    if surface_form not in SPECIAL_TOKENS + self.IMAGE_ST:\r\
    \n  File \"/home/neman/.cache/huggingface/modules/transformers_modules/MMInstruction_Silkie/tokenization_qwen.py\"\
    , line 120, in __init__\r\n    super().__init__(**kwargs)\r\n  File \"/home/neman/PROGRAMMING/PYTHON/QwenVL/SilkieVL_test1.py\"\
    , line 6, in <module>\r\n    tokenizer = AutoTokenizer.from_pretrained(\r\nAttributeError:\
    \ 'QWenTokenizer' object has no attribute 'IMAGE_ST'"
  created_at: 2023-12-19 17:15:33+00:00
  edited: false
  hidden: false
  id: 6581cfb54ab06cdc836ba05c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/b0c7cd29835d92c2cd584947fcd5d520.svg
      fullname: Xie
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: Zhihui
      type: user
    createdAt: '2023-12-20T02:52:10.000Z'
    data:
      edited: false
      editors:
      - Zhihui
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8176173567771912
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/b0c7cd29835d92c2cd584947fcd5d520.svg
          fullname: Xie
          isHf: false
          isPro: false
          name: Zhihui
          type: user
        html: "<p>Hello <span data-props=\"{&quot;user&quot;:&quot;Neman&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/Neman\"\
          >@<span class=\"underline\">Neman</span></a></span>\n\n\t</span></span>\
          \ thank you for your interest in Silkie!</p>\n<p>Regarding the issue you\
          \ encountered, could you please provide more information about your environment\
          \ so we can reproduce the issue? It is strange since <code>QwenTRokenizer</code>\
          \ does have the attribute <code>IMAGE_ST</code> (see <a href=\"https://huggingface.co/MMInstruction/Silkie/blob/45d883de3ff6ce3d5a96a793dcc885daf7c25b1e/tokenization_qwen.py#L130\"\
          >here</a>). It might be related to dependencies. You can find the installation\
          \ instructions for our environment in our <a rel=\"nofollow\" href=\"https://github.com/vlf-silkie/VLFeedback#installation\"\
          >Github repository</a>.</p>\n"
        raw: 'Hello @Neman thank you for your interest in Silkie!


          Regarding the issue you encountered, could you please provide more information
          about your environment so we can reproduce the issue? It is strange since
          `QwenTRokenizer` does have the attribute `IMAGE_ST` (see [here](https://huggingface.co/MMInstruction/Silkie/blob/45d883de3ff6ce3d5a96a793dcc885daf7c25b1e/tokenization_qwen.py#L130)).
          It might be related to dependencies. You can find the installation instructions
          for our environment in our [Github repository](https://github.com/vlf-silkie/VLFeedback#installation).'
        updatedAt: '2023-12-20T02:52:10.818Z'
      numEdits: 0
      reactions: []
    id: 658256da41dad8f2f3025b79
    type: comment
  author: Zhihui
  content: 'Hello @Neman thank you for your interest in Silkie!


    Regarding the issue you encountered, could you please provide more information
    about your environment so we can reproduce the issue? It is strange since `QwenTRokenizer`
    does have the attribute `IMAGE_ST` (see [here](https://huggingface.co/MMInstruction/Silkie/blob/45d883de3ff6ce3d5a96a793dcc885daf7c25b1e/tokenization_qwen.py#L130)).
    It might be related to dependencies. You can find the installation instructions
    for our environment in our [Github repository](https://github.com/vlf-silkie/VLFeedback#installation).'
  created_at: 2023-12-20 02:52:10+00:00
  edited: false
  hidden: false
  id: 658256da41dad8f2f3025b79
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/6bfe03d82594744fc1f0060f5fee9561.svg
      fullname: Eric Engelhart
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: bob80333
      type: user
    createdAt: '2023-12-20T04:49:01.000Z'
    data:
      edited: false
      editors:
      - bob80333
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9072052240371704
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/6bfe03d82594744fc1f0060f5fee9561.svg
          fullname: Eric Engelhart
          isHf: false
          isPro: false
          name: bob80333
          type: user
        html: '<p>I took a quick look at this, since I ran into the problem myself.  The
          error is because the <code>super().__init__(**kwargs)</code> of <code>QWenTokenizer</code>
          calls <code>QWenTokenizer._add_tokens()</code>, which requires <code>IMAGE_ST</code>,
          but the <code>super().__init__()</code> call happens before <code>IMAGE_ST</code>
          is defined in the initializer, so the <code>_add_tokens()</code> call crashes
          with an error.  Commenting out lines 223 and 224 seems to fix it as a quick
          hack, but hopefully someone with a better understanding can fix it more
          properly.</p>

          '
        raw: I took a quick look at this, since I ran into the problem myself.  The
          error is because the `super().__init__(**kwargs)` of `QWenTokenizer` calls
          `QWenTokenizer._add_tokens()`, which requires `IMAGE_ST`, but the `super().__init__()`
          call happens before `IMAGE_ST` is defined in the initializer, so the `_add_tokens()`
          call crashes with an error.  Commenting out lines 223 and 224 seems to fix
          it as a quick hack, but hopefully someone with a better understanding can
          fix it more properly.
        updatedAt: '2023-12-20T04:49:01.514Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - Zhihui
    id: 6582723d118a2bdc5160c351
    type: comment
  author: bob80333
  content: I took a quick look at this, since I ran into the problem myself.  The
    error is because the `super().__init__(**kwargs)` of `QWenTokenizer` calls `QWenTokenizer._add_tokens()`,
    which requires `IMAGE_ST`, but the `super().__init__()` call happens before `IMAGE_ST`
    is defined in the initializer, so the `_add_tokens()` call crashes with an error.  Commenting
    out lines 223 and 224 seems to fix it as a quick hack, but hopefully someone with
    a better understanding can fix it more properly.
  created_at: 2023-12-20 04:49:01+00:00
  edited: false
  hidden: false
  id: 6582723d118a2bdc5160c351
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/b0c7cd29835d92c2cd584947fcd5d520.svg
      fullname: Xie
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: Zhihui
      type: user
    createdAt: '2023-12-20T05:28:07.000Z'
    data:
      edited: false
      editors:
      - Zhihui
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8866443634033203
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/b0c7cd29835d92c2cd584947fcd5d520.svg
          fullname: Xie
          isHf: false
          isPro: false
          name: Zhihui
          type: user
        html: "<blockquote>\n<p>I took a quick look at this, since I ran into the\
          \ problem myself.  The error is because the <code>super().__init__(**kwargs)</code>\
          \ of <code>QWenTokenizer</code> calls <code>QWenTokenizer._add_tokens()</code>,\
          \ which requires <code>IMAGE_ST</code>, but the <code>super().__init__()</code>\
          \ call happens before <code>IMAGE_ST</code> is defined in the initializer,\
          \ so the <code>_add_tokens()</code> call crashes with an error.  Commenting\
          \ out lines 223 and 224 seems to fix it as a quick hack, but hopefully someone\
          \ with a better understanding can fix it more properly.</p>\n</blockquote>\n\
          <p>Hi <span data-props=\"{&quot;user&quot;:&quot;bob80333&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/bob80333\">@<span class=\"\
          underline\">bob80333</span></a></span>\n\n\t</span></span> I think you are\
          \ right! After a deeper investigation, I found the issue comes from the\
          \ refactor of <code>PreTrainedTokenizer</code> in <a rel=\"nofollow\" href=\"\
          https://github.com/huggingface/transformers/releases/tag/v4.34.0\">Transformers\
          \ release 4.34</a>. Since v4.34, <code>self._add_tokens</code> is called\
          \ in the initializer of <code>PreTrainedTokenizer</code>.  We followed <a\
          \ rel=\"nofollow\" href=\"https://github.com/QwenLM/Qwen-VL/blob/f81c390f5414c2a141823f8f15ab7e4339409010/requirements.txt#L1\"\
          >Qwen-VL</a> and used <code>transformers &lt; 4.34</code>, which prevented\
          \ us from encountering this issue. I suggest using the same version to reproduce\
          \ our experiments, or customizing <code>tokenization_qwen.py</code> as suggested\
          \ by <span data-props=\"{&quot;user&quot;:&quot;bob80333&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/bob80333\">@<span class=\"\
          underline\">bob80333</span></a></span>\n\n\t</span></span>.</p>\n"
        raw: '> I took a quick look at this, since I ran into the problem myself.  The
          error is because the `super().__init__(**kwargs)` of `QWenTokenizer` calls
          `QWenTokenizer._add_tokens()`, which requires `IMAGE_ST`, but the `super().__init__()`
          call happens before `IMAGE_ST` is defined in the initializer, so the `_add_tokens()`
          call crashes with an error.  Commenting out lines 223 and 224 seems to fix
          it as a quick hack, but hopefully someone with a better understanding can
          fix it more properly.


          Hi @bob80333 I think you are right! After a deeper investigation, I found
          the issue comes from the refactor of `PreTrainedTokenizer` in [Transformers
          release 4.34](https://github.com/huggingface/transformers/releases/tag/v4.34.0).
          Since v4.34, `self._add_tokens` is called in the initializer of `PreTrainedTokenizer`.  We
          followed [Qwen-VL](https://github.com/QwenLM/Qwen-VL/blob/f81c390f5414c2a141823f8f15ab7e4339409010/requirements.txt#L1)
          and used `transformers < 4.34`, which prevented us from encountering this
          issue. I suggest using the same version to reproduce our experiments, or
          customizing `tokenization_qwen.py` as suggested by @bob80333.'
        updatedAt: '2023-12-20T05:28:07.144Z'
      numEdits: 0
      reactions: []
    id: 65827b675def15befa32cd3a
    type: comment
  author: Zhihui
  content: '> I took a quick look at this, since I ran into the problem myself.  The
    error is because the `super().__init__(**kwargs)` of `QWenTokenizer` calls `QWenTokenizer._add_tokens()`,
    which requires `IMAGE_ST`, but the `super().__init__()` call happens before `IMAGE_ST`
    is defined in the initializer, so the `_add_tokens()` call crashes with an error.  Commenting
    out lines 223 and 224 seems to fix it as a quick hack, but hopefully someone with
    a better understanding can fix it more properly.


    Hi @bob80333 I think you are right! After a deeper investigation, I found the
    issue comes from the refactor of `PreTrainedTokenizer` in [Transformers release
    4.34](https://github.com/huggingface/transformers/releases/tag/v4.34.0). Since
    v4.34, `self._add_tokens` is called in the initializer of `PreTrainedTokenizer`.  We
    followed [Qwen-VL](https://github.com/QwenLM/Qwen-VL/blob/f81c390f5414c2a141823f8f15ab7e4339409010/requirements.txt#L1)
    and used `transformers < 4.34`, which prevented us from encountering this issue.
    I suggest using the same version to reproduce our experiments, or customizing
    `tokenization_qwen.py` as suggested by @bob80333.'
  created_at: 2023-12-20 05:28:07+00:00
  edited: false
  hidden: false
  id: 65827b675def15befa32cd3a
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/643095dd23c81b522be33a94/jPDsH-gkQDSNhsh1WVmag.png?w=200&h=200&f=face
      fullname: Zeze Nene
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Neman
      type: user
    createdAt: '2023-12-20T13:49:37.000Z'
    data:
      edited: false
      editors:
      - Neman
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9790844321250916
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/643095dd23c81b522be33a94/jPDsH-gkQDSNhsh1WVmag.png?w=200&h=200&f=face
          fullname: Zeze Nene
          isHf: false
          isPro: false
          name: Neman
          type: user
        html: '<p>Thank you both. Bob''s suggestion solved it.<br>I did few tests
          with random photos and compared with Qwen-VL-Chat-Int4. It is little bit
          better (need more testing). I should have compared with not quantized Qwen,
          but just to report.</p>

          '
        raw: "Thank you both. Bob's suggestion solved it. \nI did few tests with random\
          \ photos and compared with Qwen-VL-Chat-Int4. It is little bit better (need\
          \ more testing). I should have compared with not quantized Qwen, but just\
          \ to report."
        updatedAt: '2023-12-20T13:49:37.432Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\u2764\uFE0F"
        users:
        - Zhihui
    id: 6582f0f18659a21f54c1e725
    type: comment
  author: Neman
  content: "Thank you both. Bob's suggestion solved it. \nI did few tests with random\
    \ photos and compared with Qwen-VL-Chat-Int4. It is little bit better (need more\
    \ testing). I should have compared with not quantized Qwen, but just to report."
  created_at: 2023-12-20 13:49:37+00:00
  edited: false
  hidden: false
  id: 6582f0f18659a21f54c1e725
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: MMInstruction/Silkie
repo_type: model
status: open
target_branch: null
title: '''QWenTokenizer'' object has no attribute ''IMAGE_ST'''
