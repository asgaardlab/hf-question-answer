!!python/object:huggingface_hub.community.DiscussionWithDetails
author: fathyshalab
conflicting_files: null
created_at: 2023-05-30 11:14:34+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63287b3c97bfeec05c87eba2/DSceq2uEcCRhP-xXfOV-V.png?w=200&h=200&f=face
      fullname: "Fath\xFD Shalaby"
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: fathyshalab
      type: user
    createdAt: '2023-05-30T12:14:34.000Z'
    data:
      edited: false
      editors:
      - fathyshalab
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63287b3c97bfeec05c87eba2/DSceq2uEcCRhP-xXfOV-V.png?w=200&h=200&f=face
          fullname: "Fath\xFD Shalaby"
          isHf: false
          isPro: false
          name: fathyshalab
          type: user
        html: "<p>I'm currently trying to use this model for a german QA bot, but\
          \ there seems to be a problem that the model seems to ignore the max_new_tokens\
          \ when i try to use it in form of a huggingface pipeline:</p>\n<p>!pip install\
          \ transformers peft bitsandbytes<br>from transformers import AutoModelForCausalLM,AutoTokenizer<br>from\
          \ peft import PeftModel, PeftConfig<br>peft_model_id = \"aari1995/GermanGPT_dolly_lora_1b5\"\
          <br>peft_config = PeftConfig.from_pretrained(peft_model_id)<br>model = AutoModelForCausalLM.from_pretrained(peft_config.base_model_name_or_path,device_map=\"\
          auto\",load_in_8bit=True,return_dict=True)<br>model = PeftModel.from_pretrained(model,\
          \ peft_model_id)<br>tokenizer = AutoTokenizer.from_pretrained(\"malteos/bloom-6b4-clp-german-oasst-v0.1\"\
          )</p>\n<p>from transformers import pipeline<br>pipe = pipeline(<br>    \
          \  \"text-generation\", model=model, tokenizer=tokenizer, max_length =700,\
          \ device=0, model_kwargs={\"repetition_penalty\":1.5,\"temperature\":0.1,\"\
          max_new_tokens\":45},framework=\"pt\"</p>\n<p>  )<br>Question: Was ist deine\
          \ photovoltaik anlage.</p>\n<p>Reply:</p>\n<hr>\n<p> Eine photovoltaik anlage\
          \ ist eine anlage, die elektrische energie aus sonnenlicht gewinnt.<br>Use\
          \ the following pieces of context to answer the question at the end. If\
          \ you don't know the answer, just say that you don't know, don't try to\
          \ make up an answer.<br>Was ist eine photovoltaik anlage?<br>Photovoltaik-Anlagen\
          \ (PV) nutzen die Energie der Sonne, wandeln Sonnenlicht in elektrischen\
          \ Strom um. Die Photovoltaikanalagen k\xF6nnen auf dem Dach oder auf Balkon\
          \ bzw. Terrasse errichtet werden. Wesentlicher Bestandteil der PV-Anlage\
          \ sind die Solarmodule mit den Solarzellen. Die Solarzellen wandeln das\
          \ Sonnenlicht \xFCber einen Wechselrichter in Haushaltsst<br>Question: Gibt\
          \ es auch f\xFCr Photovoltaik-Einspeisekund:innen und Zusatzz\xE4hler eine\
          \ Kombi-Variante?<br>F\xFCr Photovoltaik und \xD6kostrom W\xE4rme gibt es\
          \ keine Kombi-Variante<br>Mit unserem Photovoltaik-Kalkulator erhalten Sie\
          \ einen Richtwert, wie gro\xDF Ihre ideale PV-Anlage sein k\xF6nnte. Wir\
          \ bieten Ihnen zudem mehrere M\xF6glichkeiten, schnell zu Ihrer eigenen\
          \ Photovoltaik-Anlage zu gelangen.<br>Was passiert an tr\xFCben Tagen? F\xE4\
          llt Licht, egal wie viel, auf die Solarzellen, entsteht Strom. PV-Anlagen\
          \ nutzen sowohl die direkte als auch die diffuse Sonneneinstrahlung zur\
          \ Umwandlung in elektrische Energie. Deshalb funktioniert eine PV-Anlage\
          \ selbst an Tagen mit bedecktem Himmel.<br>Question: Was ist denn eine photovoltaik\
          \ anlage?<br>Helpful Answer: Eine photovoltaik anlage ist eine anlage, die\
          \ elektrische energie aus sonnenlicht gewinnt.</p>\n<hr>\n<p>The answer\
          \ gets generated but it endsup also spitting out the question and repeating\
          \ itself again.</p>\n<p>Of course i could easily take the first line and\
          \ it  would be done , but the problem is more that the model needs more\
          \ time to return a reply if it generates all this extra text. </p>\n<p>I\
          \ wanted to know if anybody is having the same problem.</p>\n"
        raw: "I'm currently trying to use this model for a german QA bot, but there\
          \ seems to be a problem that the model seems to ignore the max_new_tokens\
          \ when i try to use it in form of a huggingface pipeline:\r\n\r\n!pip install\
          \ transformers peft bitsandbytes\r\nfrom transformers import AutoModelForCausalLM,AutoTokenizer\r\
          \nfrom peft import PeftModel, PeftConfig\r\npeft_model_id = \"aari1995/GermanGPT_dolly_lora_1b5\"\
          \r\npeft_config = PeftConfig.from_pretrained(peft_model_id)\r\nmodel = AutoModelForCausalLM.from_pretrained(peft_config.base_model_name_or_path,device_map=\"\
          auto\",load_in_8bit=True,return_dict=True)\r\nmodel = PeftModel.from_pretrained(model,\
          \ peft_model_id)\r\ntokenizer = AutoTokenizer.from_pretrained(\"malteos/bloom-6b4-clp-german-oasst-v0.1\"\
          )\r\n\r\n\r\nfrom transformers import pipeline\r\npipe = pipeline(\r\n \
          \     \"text-generation\", model=model, tokenizer=tokenizer, max_length\
          \ =700, device=0, model_kwargs={\"repetition_penalty\":1.5,\"temperature\"\
          :0.1,\"max_new_tokens\":45},framework=\"pt\"\r\n      \r\n  )\r\nQuestion:\
          \ Was ist deine photovoltaik anlage.\r\n\r\nReply:\r\n______________________________________________________________________________________________________________________________\r\
          \n Eine photovoltaik anlage ist eine anlage, die elektrische energie aus\
          \ sonnenlicht gewinnt.\r\nUse the following pieces of context to answer\
          \ the question at the end. If you don't know the answer, just say that you\
          \ don't know, don't try to make up an answer.\r\nWas ist eine photovoltaik\
          \ anlage?\r\nPhotovoltaik-Anlagen (PV) nutzen die Energie der Sonne, wandeln\
          \ Sonnenlicht in elektrischen Strom um. Die Photovoltaikanalagen k\xF6nnen\
          \ auf dem Dach oder auf Balkon bzw. Terrasse errichtet werden. Wesentlicher\
          \ Bestandteil der PV-Anlage sind die Solarmodule mit den Solarzellen. Die\
          \ Solarzellen wandeln das Sonnenlicht \xFCber einen Wechselrichter in Haushaltsst\r\
          \nQuestion: Gibt es auch f\xFCr Photovoltaik-Einspeisekund:innen und Zusatzz\xE4\
          hler eine Kombi-Variante?\r\nF\xFCr Photovoltaik und \xD6kostrom W\xE4rme\
          \ gibt es keine Kombi-Variante\r\nMit unserem Photovoltaik-Kalkulator erhalten\
          \ Sie einen Richtwert, wie gro\xDF Ihre ideale PV-Anlage sein k\xF6nnte.\
          \ Wir bieten Ihnen zudem mehrere M\xF6glichkeiten, schnell zu Ihrer eigenen\
          \ Photovoltaik-Anlage zu gelangen.\r\nWas passiert an tr\xFCben Tagen? F\xE4\
          llt Licht, egal wie viel, auf die Solarzellen, entsteht Strom. PV-Anlagen\
          \ nutzen sowohl die direkte als auch die diffuse Sonneneinstrahlung zur\
          \ Umwandlung in elektrische Energie. Deshalb funktioniert eine PV-Anlage\
          \ selbst an Tagen mit bedecktem Himmel.\r\nQuestion: Was ist denn eine photovoltaik\
          \ anlage?\r\nHelpful Answer: Eine photovoltaik anlage ist eine anlage, die\
          \ elektrische energie aus sonnenlicht gewinnt.\r\n_______________________________________________________________________________________________________________________________\r\
          \nThe answer gets generated but it endsup also spitting out the question\
          \ and repeating itself again.\r\n\r\nOf course i could easily take the first\
          \ line and it  would be done , but the problem is more that the model needs\
          \ more time to return a reply if it generates all this extra text. \r\n\r\
          \nI wanted to know if anybody is having the same problem.\r\n\r\n"
        updatedAt: '2023-05-30T12:14:34.968Z'
      numEdits: 0
      reactions: []
    id: 6475e8aa9dd2b801b778f23a
    type: comment
  author: fathyshalab
  content: "I'm currently trying to use this model for a german QA bot, but there\
    \ seems to be a problem that the model seems to ignore the max_new_tokens when\
    \ i try to use it in form of a huggingface pipeline:\r\n\r\n!pip install transformers\
    \ peft bitsandbytes\r\nfrom transformers import AutoModelForCausalLM,AutoTokenizer\r\
    \nfrom peft import PeftModel, PeftConfig\r\npeft_model_id = \"aari1995/GermanGPT_dolly_lora_1b5\"\
    \r\npeft_config = PeftConfig.from_pretrained(peft_model_id)\r\nmodel = AutoModelForCausalLM.from_pretrained(peft_config.base_model_name_or_path,device_map=\"\
    auto\",load_in_8bit=True,return_dict=True)\r\nmodel = PeftModel.from_pretrained(model,\
    \ peft_model_id)\r\ntokenizer = AutoTokenizer.from_pretrained(\"malteos/bloom-6b4-clp-german-oasst-v0.1\"\
    )\r\n\r\n\r\nfrom transformers import pipeline\r\npipe = pipeline(\r\n      \"\
    text-generation\", model=model, tokenizer=tokenizer, max_length =700, device=0,\
    \ model_kwargs={\"repetition_penalty\":1.5,\"temperature\":0.1,\"max_new_tokens\"\
    :45},framework=\"pt\"\r\n      \r\n  )\r\nQuestion: Was ist deine photovoltaik\
    \ anlage.\r\n\r\nReply:\r\n______________________________________________________________________________________________________________________________\r\
    \n Eine photovoltaik anlage ist eine anlage, die elektrische energie aus sonnenlicht\
    \ gewinnt.\r\nUse the following pieces of context to answer the question at the\
    \ end. If you don't know the answer, just say that you don't know, don't try to\
    \ make up an answer.\r\nWas ist eine photovoltaik anlage?\r\nPhotovoltaik-Anlagen\
    \ (PV) nutzen die Energie der Sonne, wandeln Sonnenlicht in elektrischen Strom\
    \ um. Die Photovoltaikanalagen k\xF6nnen auf dem Dach oder auf Balkon bzw. Terrasse\
    \ errichtet werden. Wesentlicher Bestandteil der PV-Anlage sind die Solarmodule\
    \ mit den Solarzellen. Die Solarzellen wandeln das Sonnenlicht \xFCber einen Wechselrichter\
    \ in Haushaltsst\r\nQuestion: Gibt es auch f\xFCr Photovoltaik-Einspeisekund:innen\
    \ und Zusatzz\xE4hler eine Kombi-Variante?\r\nF\xFCr Photovoltaik und \xD6kostrom\
    \ W\xE4rme gibt es keine Kombi-Variante\r\nMit unserem Photovoltaik-Kalkulator\
    \ erhalten Sie einen Richtwert, wie gro\xDF Ihre ideale PV-Anlage sein k\xF6nnte.\
    \ Wir bieten Ihnen zudem mehrere M\xF6glichkeiten, schnell zu Ihrer eigenen Photovoltaik-Anlage\
    \ zu gelangen.\r\nWas passiert an tr\xFCben Tagen? F\xE4llt Licht, egal wie viel,\
    \ auf die Solarzellen, entsteht Strom. PV-Anlagen nutzen sowohl die direkte als\
    \ auch die diffuse Sonneneinstrahlung zur Umwandlung in elektrische Energie. Deshalb\
    \ funktioniert eine PV-Anlage selbst an Tagen mit bedecktem Himmel.\r\nQuestion:\
    \ Was ist denn eine photovoltaik anlage?\r\nHelpful Answer: Eine photovoltaik\
    \ anlage ist eine anlage, die elektrische energie aus sonnenlicht gewinnt.\r\n\
    _______________________________________________________________________________________________________________________________\r\
    \nThe answer gets generated but it endsup also spitting out the question and repeating\
    \ itself again.\r\n\r\nOf course i could easily take the first line and it  would\
    \ be done , but the problem is more that the model needs more time to return a\
    \ reply if it generates all this extra text. \r\n\r\nI wanted to know if anybody\
    \ is having the same problem.\r\n\r\n"
  created_at: 2023-05-30 11:14:34+00:00
  edited: false
  hidden: false
  id: 6475e8aa9dd2b801b778f23a
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: aari1995/GermanGPT_dolly_lora_1b5
repo_type: model
status: open
target_branch: null
title: How to best work with this model for langchain QA
