!!python/object:huggingface_hub.community.DiscussionWithDetails
author: smooth-operator94
conflicting_files: null
created_at: 2023-08-29 02:48:01+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/79f0e85bd0d058977245caf9b5c95dd7.svg
      fullname: SOURAV K PATEL
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: smooth-operator94
      type: user
    createdAt: '2023-08-29T03:48:01.000Z'
    data:
      edited: false
      editors:
      - smooth-operator94
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.4555228054523468
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/79f0e85bd0d058977245caf9b5c95dd7.svg
          fullname: SOURAV K PATEL
          isHf: false
          isPro: false
          name: smooth-operator94
          type: user
        html: '<p>Hi NumberStation team,</p>

          <p>I have deployed this model in sagemaker in ml.g5.2xlarge compute. In
          most of the cases i''m getting incomplete query response. I have tried increasing
          response token size using "max_tokens": 999999 but the issue still persists.
          </p>

          <p>I have also tried the nsql-350M version and that''s working fine with
          complete query being generated. Seeing this issue only with nsql-2B model</p>

          <p>This is the Input Query :<br>CREATE TABLE git_worklog_gpt (<br>    org_id
          text,<br>    type text,<br>    repository text,<br>    value integer,<br>    date
          date,<br>    author_email text<br>)</p>

          <p>CREATE TABLE burnout_worklog_gpt (<br>    org_id text,<br>    person
          text,<br>    date date<br>)</p>

          <p>CREATE TABLE work_cycletime_gpt (<br>    org_id text,<br>    type text,<br>    project
          text,<br>    time_in_minutes integer,<br>    date date<br>)</p>

          <p>CREATE TABLE issue_worklog_gpt (<br>    org_id text,<br>    type text,<br>    project
          text,<br>    value integer,<br>    date date,<br>    status text<br>)</p>

          <p>CREATE TABLE investment_report_gpt (<br>    org_id text,<br>    investment_name
          text,<br>    value integer,<br>    date date,<br>    story_point integer,<br>    estimate
          integer<br>)</p>

          <p>CREATE TABLE issue_lead_time_gpt (<br>    org_id text,<br>    project
          text,<br>    type text,<br>    status text,<br>    priority text,<br>    lead_time_in_minutes
          double precision,<br>    date date<br>)</p>

          <p>-- Using valid SQLite, answer the following questions for the tables
          provided above.</p>

          <p>-- list all issues closed in last 30 days<br>SELECT</p>

          <p>Tis is the Response which I''m getting :<br>CREATE TABLE git_worklog_gpt
          (<br>    org_id text,<br>    type text,<br>    repository text,<br>    value
          integer,<br>    date date,<br>    author_email text<br>)</p>

          <p>CREATE TABLE burnout_worklog_gpt (<br>    org_id text,<br>    person
          text,<br>    date date<br>)</p>

          <p>CREATE TABLE work_cycletime_gpt (<br>    org_id text,<br>    type text,<br>    project
          text,<br>    time_in_minutes integer,<br>    date date<br>)</p>

          <p>CREATE TABLE issue_worklog_gpt (<br>    org_id text,<br>    type text,<br>    project
          text,<br>    value integer,<br>    date date,<br>    status text<br>)</p>

          <p>CREATE TABLE investment_report_gpt (<br>    org_id text,<br>    investment_name
          text,<br>    value integer,<br>    date date,<br>    story_point integer,<br>    estimate
          integer<br>)</p>

          <p>CREATE TABLE issue_lead_time_gpt (<br>    org_id text,<br>    project
          text,<br>    type text,<br>    status text,<br>    priority text,<br>    lead_time_in_minutes
          double precision,<br>    date date<br>)</p>

          <p>-- Using valid SQLite, answer the following questions for the tables
          provided above.</p>

          <p>-- list all issues closed in last 30 days<br>SELECT * FROM issue_worklog_gpt
          WHERE status = "Closed" AND DATE(</p>

          <p>Will really appreciate some help getting around this.</p>

          <p>Thanks</p>

          '
        raw: "Hi NumberStation team,\r\n\r\nI have deployed this model in sagemaker\
          \ in ml.g5.2xlarge compute. In most of the cases i'm getting incomplete\
          \ query response. I have tried increasing response token size using \"max_tokens\"\
          : 999999 but the issue still persists. \r\n\r\nI have also tried the nsql-350M\
          \ version and that's working fine with complete query being generated. Seeing\
          \ this issue only with nsql-2B model\r\n\r\nThis is the Input Query : \r\
          \nCREATE TABLE git_worklog_gpt (\r\n    org_id text,\r\n    type text,\r\
          \n    repository text,\r\n    value integer,\r\n    date date,\r\n    author_email\
          \ text\r\n)\r\n\r\nCREATE TABLE burnout_worklog_gpt (\r\n    org_id text,\r\
          \n    person text,\r\n    date date\r\n)\r\n\r\nCREATE TABLE work_cycletime_gpt\
          \ (\r\n    org_id text,\r\n    type text,\r\n    project text,\r\n    time_in_minutes\
          \ integer,\r\n    date date\r\n)\r\n\r\nCREATE TABLE issue_worklog_gpt (\r\
          \n    org_id text,\r\n    type text,\r\n    project text,\r\n    value integer,\r\
          \n    date date,\r\n    status text\r\n)\r\n\r\nCREATE TABLE investment_report_gpt\
          \ (\r\n    org_id text,\r\n    investment_name text,\r\n    value integer,\r\
          \n    date date,\r\n    story_point integer,\r\n    estimate integer\r\n\
          )\r\n\r\nCREATE TABLE issue_lead_time_gpt (\r\n    org_id text,\r\n    project\
          \ text,\r\n    type text,\r\n    status text,\r\n    priority text,\r\n\
          \    lead_time_in_minutes double precision,\r\n    date date\r\n)\r\n\r\n\
          \r\n-- Using valid SQLite, answer the following questions for the tables\
          \ provided above.\r\n\r\n-- list all issues closed in last 30 days\r\nSELECT\r\
          \n\r\nTis is the Response which I'm getting :\r\nCREATE TABLE git_worklog_gpt\
          \ (\r\n    org_id text,\r\n    type text,\r\n    repository text,\r\n  \
          \  value integer,\r\n    date date,\r\n    author_email text\r\n)\r\n\r\n\
          CREATE TABLE burnout_worklog_gpt (\r\n    org_id text,\r\n    person text,\r\
          \n    date date\r\n)\r\n\r\nCREATE TABLE work_cycletime_gpt (\r\n    org_id\
          \ text,\r\n    type text,\r\n    project text,\r\n    time_in_minutes integer,\r\
          \n    date date\r\n)\r\n\r\nCREATE TABLE issue_worklog_gpt (\r\n    org_id\
          \ text,\r\n    type text,\r\n    project text,\r\n    value integer,\r\n\
          \    date date,\r\n    status text\r\n)\r\n\r\nCREATE TABLE investment_report_gpt\
          \ (\r\n    org_id text,\r\n    investment_name text,\r\n    value integer,\r\
          \n    date date,\r\n    story_point integer,\r\n    estimate integer\r\n\
          )\r\n\r\nCREATE TABLE issue_lead_time_gpt (\r\n    org_id text,\r\n    project\
          \ text,\r\n    type text,\r\n    status text,\r\n    priority text,\r\n\
          \    lead_time_in_minutes double precision,\r\n    date date\r\n)\r\n\r\n\
          \r\n-- Using valid SQLite, answer the following questions for the tables\
          \ provided above.\r\n\r\n-- list all issues closed in last 30 days\r\nSELECT\
          \ * FROM issue_worklog_gpt WHERE status = \"Closed\" AND DATE(\r\n\r\nWill\
          \ really appreciate some help getting around this.\r\n\r\nThanks"
        updatedAt: '2023-08-29T03:48:01.902Z'
      numEdits: 0
      reactions: []
    id: 64ed6a718a351f5b73a24425
    type: comment
  author: smooth-operator94
  content: "Hi NumberStation team,\r\n\r\nI have deployed this model in sagemaker\
    \ in ml.g5.2xlarge compute. In most of the cases i'm getting incomplete query\
    \ response. I have tried increasing response token size using \"max_tokens\":\
    \ 999999 but the issue still persists. \r\n\r\nI have also tried the nsql-350M\
    \ version and that's working fine with complete query being generated. Seeing\
    \ this issue only with nsql-2B model\r\n\r\nThis is the Input Query : \r\nCREATE\
    \ TABLE git_worklog_gpt (\r\n    org_id text,\r\n    type text,\r\n    repository\
    \ text,\r\n    value integer,\r\n    date date,\r\n    author_email text\r\n)\r\
    \n\r\nCREATE TABLE burnout_worklog_gpt (\r\n    org_id text,\r\n    person text,\r\
    \n    date date\r\n)\r\n\r\nCREATE TABLE work_cycletime_gpt (\r\n    org_id text,\r\
    \n    type text,\r\n    project text,\r\n    time_in_minutes integer,\r\n    date\
    \ date\r\n)\r\n\r\nCREATE TABLE issue_worklog_gpt (\r\n    org_id text,\r\n  \
    \  type text,\r\n    project text,\r\n    value integer,\r\n    date date,\r\n\
    \    status text\r\n)\r\n\r\nCREATE TABLE investment_report_gpt (\r\n    org_id\
    \ text,\r\n    investment_name text,\r\n    value integer,\r\n    date date,\r\
    \n    story_point integer,\r\n    estimate integer\r\n)\r\n\r\nCREATE TABLE issue_lead_time_gpt\
    \ (\r\n    org_id text,\r\n    project text,\r\n    type text,\r\n    status text,\r\
    \n    priority text,\r\n    lead_time_in_minutes double precision,\r\n    date\
    \ date\r\n)\r\n\r\n\r\n-- Using valid SQLite, answer the following questions for\
    \ the tables provided above.\r\n\r\n-- list all issues closed in last 30 days\r\
    \nSELECT\r\n\r\nTis is the Response which I'm getting :\r\nCREATE TABLE git_worklog_gpt\
    \ (\r\n    org_id text,\r\n    type text,\r\n    repository text,\r\n    value\
    \ integer,\r\n    date date,\r\n    author_email text\r\n)\r\n\r\nCREATE TABLE\
    \ burnout_worklog_gpt (\r\n    org_id text,\r\n    person text,\r\n    date date\r\
    \n)\r\n\r\nCREATE TABLE work_cycletime_gpt (\r\n    org_id text,\r\n    type text,\r\
    \n    project text,\r\n    time_in_minutes integer,\r\n    date date\r\n)\r\n\r\
    \nCREATE TABLE issue_worklog_gpt (\r\n    org_id text,\r\n    type text,\r\n \
    \   project text,\r\n    value integer,\r\n    date date,\r\n    status text\r\
    \n)\r\n\r\nCREATE TABLE investment_report_gpt (\r\n    org_id text,\r\n    investment_name\
    \ text,\r\n    value integer,\r\n    date date,\r\n    story_point integer,\r\n\
    \    estimate integer\r\n)\r\n\r\nCREATE TABLE issue_lead_time_gpt (\r\n    org_id\
    \ text,\r\n    project text,\r\n    type text,\r\n    status text,\r\n    priority\
    \ text,\r\n    lead_time_in_minutes double precision,\r\n    date date\r\n)\r\n\
    \r\n\r\n-- Using valid SQLite, answer the following questions for the tables provided\
    \ above.\r\n\r\n-- list all issues closed in last 30 days\r\nSELECT * FROM issue_worklog_gpt\
    \ WHERE status = \"Closed\" AND DATE(\r\n\r\nWill really appreciate some help\
    \ getting around this.\r\n\r\nThanks"
  created_at: 2023-08-29 02:48:01+00:00
  edited: false
  hidden: false
  id: 64ed6a718a351f5b73a24425
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0c4682fe1fe9d9219f46b73bbe2e7b08.svg
      fullname: Sen Wu
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: senwu
      type: user
    createdAt: '2023-08-29T05:32:52.000Z'
    data:
      edited: false
      editors:
      - senwu
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.3833574652671814
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0c4682fe1fe9d9219f46b73bbe2e7b08.svg
          fullname: Sen Wu
          isHf: false
          isPro: false
          name: senwu
          type: user
        html: "<p>Hi <span data-props=\"{&quot;user&quot;:&quot;smooth-operator94&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/smooth-operator94\"\
          >@<span class=\"underline\">smooth-operator94</span></a></span>\n\n\t</span></span>\
          \ ,</p>\n<p>I am not very familiar with sagemaker setup. Can you provide\
          \ some more details about your settings and the config you sent to the sagemaker?</p>\n\
          <p>FYI: Here is the response I got from a local deployment:</p>\n<pre><code>from\
          \ transformers import AutoTokenizer, AutoModelForCausalLM\ntokenizer = AutoTokenizer.from_pretrained(\"\
          NumbersStation/nsql-2B\")\nmodel = AutoModelForCausalLM.from_pretrained(\"\
          NumbersStation/nsql-2B\", torch_dtype=torch.float16).to(0)\n\ntext = \"\"\
          \"CREATE TABLE git_worklog_gpt (\n    org_id text,\n    type text,\n   \
          \ repository text,\n    value integer,\n    date date,\n    author_email\
          \ text\n)\n\nCREATE TABLE burnout_worklog_gpt (\n    org_id text,\n    person\
          \ text,\n    date date\n)\n\nCREATE TABLE work_cycletime_gpt (\n    org_id\
          \ text,\n    type text,\n    project text,\n    time_in_minutes integer,\n\
          \    date date\n)\n\nCREATE TABLE issue_worklog_gpt (\n    org_id text,\n\
          \    type text,\n    project text,\n    value integer,\n    date date,\n\
          \    status text\n)\n\nCREATE TABLE investment_report_gpt (\n    org_id\
          \ text,\n    investment_name text,\n    value integer,\n    date date,\n\
          \    story_point integer,\n    estimate integer\n)\n\nCREATE TABLE issue_lead_time_gpt\
          \ (\n    org_id text,\n    project text,\n    type text,\n    status text,\n\
          \    priority text,\n    lead_time_in_minutes double precision,\n    date\
          \ date\n)\n\n-- Using valid SQLite, answer the following questions for the\
          \ tables provided above.\n\n-- list all issues closed in last 30 days\n\n\
          SELECT\"\"\"\n\ninput_ids = tokenizer(text, return_tensors=\"pt\").input_ids.to(0)\n\
          \ngenerated_ids = model.generate(input_ids, max_length=500)\nprint(tokenizer.decode(generated_ids[0],\
          \ skip_special_tokens=True))\n</code></pre>\n<p>And output is </p>\n<pre><code>SELECT\
          \ * FROM issue_worklog_gpt WHERE status = \"Closed\" AND date &gt;= DATEADD(DAY,\
          \ -30, GETDATE());\n</code></pre>\n"
        raw: "Hi @smooth-operator94 ,\n\nI am not very familiar with sagemaker setup.\
          \ Can you provide some more details about your settings and the config you\
          \ sent to the sagemaker?\n\nFYI: Here is the response I got from a local\
          \ deployment:\n\n```\nfrom transformers import AutoTokenizer, AutoModelForCausalLM\n\
          tokenizer = AutoTokenizer.from_pretrained(\"NumbersStation/nsql-2B\")\n\
          model = AutoModelForCausalLM.from_pretrained(\"NumbersStation/nsql-2B\"\
          , torch_dtype=torch.float16).to(0)\n\ntext = \"\"\"CREATE TABLE git_worklog_gpt\
          \ (\n    org_id text,\n    type text,\n    repository text,\n    value integer,\n\
          \    date date,\n    author_email text\n)\n\nCREATE TABLE burnout_worklog_gpt\
          \ (\n    org_id text,\n    person text,\n    date date\n)\n\nCREATE TABLE\
          \ work_cycletime_gpt (\n    org_id text,\n    type text,\n    project text,\n\
          \    time_in_minutes integer,\n    date date\n)\n\nCREATE TABLE issue_worklog_gpt\
          \ (\n    org_id text,\n    type text,\n    project text,\n    value integer,\n\
          \    date date,\n    status text\n)\n\nCREATE TABLE investment_report_gpt\
          \ (\n    org_id text,\n    investment_name text,\n    value integer,\n \
          \   date date,\n    story_point integer,\n    estimate integer\n)\n\nCREATE\
          \ TABLE issue_lead_time_gpt (\n    org_id text,\n    project text,\n   \
          \ type text,\n    status text,\n    priority text,\n    lead_time_in_minutes\
          \ double precision,\n    date date\n)\n\n-- Using valid SQLite, answer the\
          \ following questions for the tables provided above.\n\n-- list all issues\
          \ closed in last 30 days\n\nSELECT\"\"\"\n\ninput_ids = tokenizer(text,\
          \ return_tensors=\"pt\").input_ids.to(0)\n\ngenerated_ids = model.generate(input_ids,\
          \ max_length=500)\nprint(tokenizer.decode(generated_ids[0], skip_special_tokens=True))\n\
          ```\n\nAnd output is \n```\nSELECT * FROM issue_worklog_gpt WHERE status\
          \ = \"Closed\" AND date >= DATEADD(DAY, -30, GETDATE());\n```"
        updatedAt: '2023-08-29T05:32:52.770Z'
      numEdits: 0
      reactions: []
    id: 64ed8304af912efd1af51691
    type: comment
  author: senwu
  content: "Hi @smooth-operator94 ,\n\nI am not very familiar with sagemaker setup.\
    \ Can you provide some more details about your settings and the config you sent\
    \ to the sagemaker?\n\nFYI: Here is the response I got from a local deployment:\n\
    \n```\nfrom transformers import AutoTokenizer, AutoModelForCausalLM\ntokenizer\
    \ = AutoTokenizer.from_pretrained(\"NumbersStation/nsql-2B\")\nmodel = AutoModelForCausalLM.from_pretrained(\"\
    NumbersStation/nsql-2B\", torch_dtype=torch.float16).to(0)\n\ntext = \"\"\"CREATE\
    \ TABLE git_worklog_gpt (\n    org_id text,\n    type text,\n    repository text,\n\
    \    value integer,\n    date date,\n    author_email text\n)\n\nCREATE TABLE\
    \ burnout_worklog_gpt (\n    org_id text,\n    person text,\n    date date\n)\n\
    \nCREATE TABLE work_cycletime_gpt (\n    org_id text,\n    type text,\n    project\
    \ text,\n    time_in_minutes integer,\n    date date\n)\n\nCREATE TABLE issue_worklog_gpt\
    \ (\n    org_id text,\n    type text,\n    project text,\n    value integer,\n\
    \    date date,\n    status text\n)\n\nCREATE TABLE investment_report_gpt (\n\
    \    org_id text,\n    investment_name text,\n    value integer,\n    date date,\n\
    \    story_point integer,\n    estimate integer\n)\n\nCREATE TABLE issue_lead_time_gpt\
    \ (\n    org_id text,\n    project text,\n    type text,\n    status text,\n \
    \   priority text,\n    lead_time_in_minutes double precision,\n    date date\n\
    )\n\n-- Using valid SQLite, answer the following questions for the tables provided\
    \ above.\n\n-- list all issues closed in last 30 days\n\nSELECT\"\"\"\n\ninput_ids\
    \ = tokenizer(text, return_tensors=\"pt\").input_ids.to(0)\n\ngenerated_ids =\
    \ model.generate(input_ids, max_length=500)\nprint(tokenizer.decode(generated_ids[0],\
    \ skip_special_tokens=True))\n```\n\nAnd output is \n```\nSELECT * FROM issue_worklog_gpt\
    \ WHERE status = \"Closed\" AND date >= DATEADD(DAY, -30, GETDATE());\n```"
  created_at: 2023-08-29 04:32:52+00:00
  edited: false
  hidden: false
  id: 64ed8304af912efd1af51691
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/79f0e85bd0d058977245caf9b5c95dd7.svg
      fullname: SOURAV K PATEL
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: smooth-operator94
      type: user
    createdAt: '2023-08-29T07:54:17.000Z'
    data:
      edited: true
      editors:
      - smooth-operator94
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.49522334337234497
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/79f0e85bd0d058977245caf9b5c95dd7.svg
          fullname: SOURAV K PATEL
          isHf: false
          isPro: false
          name: smooth-operator94
          type: user
        html: '<p>Hi senwu,</p>

          <p>I''m using following script for sagemaker deployment </p>

          <p>try:<br>    role = sagemaker.get_execution_role()<br>except ValueError:<br>    iam
          = boto3.client(''iam'')<br>    role = iam.get_role(RoleName=''AmazonSageMaker-ExecutionRole-20230723T133694'')[''Role''][''Arn'']</p>

          <h1 id="hub-model-configuration-httpshuggingfacecomodels">Hub Model configuration.
          <a href="https://huggingface.co/models">https://huggingface.co/models</a></h1>

          <p>hub = {<br>    ''HF_MODEL_ID'':''NumbersStation/nsql-2B'',<br>    ''SM_NUM_GPUS'':
          json.dumps(1)<br>}</p>

          <h1 id="create-hugging-face-model-class">create Hugging Face Model Class</h1>

          <p>huggingface_model = HuggingFaceModel(<br>    image_uri=get_huggingface_llm_image_uri("huggingface",version="0.9.3"),<br>    env=hub,<br>    role=role,<br>)</p>

          <h1 id="deploy-model-to-sagemaker-inference">deploy model to SageMaker Inference</h1>

          <p>predictor = huggingface_model.deploy(<br>    initial_instance_count=1,<br>    instance_type="ml.g5.2xlarge",<br>    container_startup_health_check_timeout=300<br>)</p>

          <p>After going through the aws Cloudwatch logs, i found these configs being
          used during model deployment </p>

          <p>Args { model_id: "NumbersStation/nsql-2B", revision: None, validation_workers:
          2, sharded: None, num_shard: Some(1), quantize: None, dtype: None, trust_remote_code:
          false, max_concurrent_requests: 128, max_best_of: 2, max_stop_sequences:
          4, max_input_length: 1024, max_total_tokens: 2048, waiting_served_ratio:
          1.2, max_batch_prefill_tokens: 4096, max_batch_total_tokens: 16000, max_waiting_tokens:
          20, hostname: "container-0.local", port: 8080, shard_uds_path: "/tmp/text-generation-server",
          master_addr: "localhost", master_port: 29500, huggingface_hub_cache: Some("/tmp"),
          weights_cache_override: None, disable_custom_kernels: false, json_output:
          false, otlp_endpoint: None, cors_allow_origin: [], watermark_gamma: None,
          watermark_delta: None, ngrok: false, ngrok_authtoken: None, ngrok_domain:
          None, ngrok_username: None, ngrok_password: None, env: false }</p>

          '
        raw: "Hi senwu,\n\nI'm using following script for sagemaker deployment \n\n\
          try:\n\trole = sagemaker.get_execution_role()\nexcept ValueError:\n\tiam\
          \ = boto3.client('iam')\n\trole = iam.get_role(RoleName='AmazonSageMaker-ExecutionRole-20230723T133694')['Role']['Arn']\n\
          \n# Hub Model configuration. https://huggingface.co/models\nhub = {\n\t\
          'HF_MODEL_ID':'NumbersStation/nsql-2B',\n\t'SM_NUM_GPUS': json.dumps(1)\n\
          }\n\n# create Hugging Face Model Class\nhuggingface_model = HuggingFaceModel(\n\
          \timage_uri=get_huggingface_llm_image_uri(\"huggingface\",version=\"0.9.3\"\
          ),\n\tenv=hub,\n\trole=role, \n)\n\n# deploy model to SageMaker Inference\n\
          predictor = huggingface_model.deploy(\n\tinitial_instance_count=1,\n\tinstance_type=\"\
          ml.g5.2xlarge\",\n\tcontainer_startup_health_check_timeout=300\n)\n\n\n\
          After going through the aws Cloudwatch logs, i found these configs being\
          \ used during model deployment \n\nArgs { model_id: \"NumbersStation/nsql-2B\"\
          , revision: None, validation_workers: 2, sharded: None, num_shard: Some(1),\
          \ quantize: None, dtype: None, trust_remote_code: false, max_concurrent_requests:\
          \ 128, max_best_of: 2, max_stop_sequences: 4, max_input_length: 1024, max_total_tokens:\
          \ 2048, waiting_served_ratio: 1.2, max_batch_prefill_tokens: 4096, max_batch_total_tokens:\
          \ 16000, max_waiting_tokens: 20, hostname: \"container-0.local\", port:\
          \ 8080, shard_uds_path: \"/tmp/text-generation-server\", master_addr: \"\
          localhost\", master_port: 29500, huggingface_hub_cache: Some(\"/tmp\"),\
          \ weights_cache_override: None, disable_custom_kernels: false, json_output:\
          \ false, otlp_endpoint: None, cors_allow_origin: [], watermark_gamma: None,\
          \ watermark_delta: None, ngrok: false, ngrok_authtoken: None, ngrok_domain:\
          \ None, ngrok_username: None, ngrok_password: None, env: false }"
        updatedAt: '2023-08-29T07:59:05.074Z'
      numEdits: 1
      reactions: []
    id: 64eda429b1ff0bd44f75c03f
    type: comment
  author: smooth-operator94
  content: "Hi senwu,\n\nI'm using following script for sagemaker deployment \n\n\
    try:\n\trole = sagemaker.get_execution_role()\nexcept ValueError:\n\tiam = boto3.client('iam')\n\
    \trole = iam.get_role(RoleName='AmazonSageMaker-ExecutionRole-20230723T133694')['Role']['Arn']\n\
    \n# Hub Model configuration. https://huggingface.co/models\nhub = {\n\t'HF_MODEL_ID':'NumbersStation/nsql-2B',\n\
    \t'SM_NUM_GPUS': json.dumps(1)\n}\n\n# create Hugging Face Model Class\nhuggingface_model\
    \ = HuggingFaceModel(\n\timage_uri=get_huggingface_llm_image_uri(\"huggingface\"\
    ,version=\"0.9.3\"),\n\tenv=hub,\n\trole=role, \n)\n\n# deploy model to SageMaker\
    \ Inference\npredictor = huggingface_model.deploy(\n\tinitial_instance_count=1,\n\
    \tinstance_type=\"ml.g5.2xlarge\",\n\tcontainer_startup_health_check_timeout=300\n\
    )\n\n\nAfter going through the aws Cloudwatch logs, i found these configs being\
    \ used during model deployment \n\nArgs { model_id: \"NumbersStation/nsql-2B\"\
    , revision: None, validation_workers: 2, sharded: None, num_shard: Some(1), quantize:\
    \ None, dtype: None, trust_remote_code: false, max_concurrent_requests: 128, max_best_of:\
    \ 2, max_stop_sequences: 4, max_input_length: 1024, max_total_tokens: 2048, waiting_served_ratio:\
    \ 1.2, max_batch_prefill_tokens: 4096, max_batch_total_tokens: 16000, max_waiting_tokens:\
    \ 20, hostname: \"container-0.local\", port: 8080, shard_uds_path: \"/tmp/text-generation-server\"\
    , master_addr: \"localhost\", master_port: 29500, huggingface_hub_cache: Some(\"\
    /tmp\"), weights_cache_override: None, disable_custom_kernels: false, json_output:\
    \ false, otlp_endpoint: None, cors_allow_origin: [], watermark_gamma: None, watermark_delta:\
    \ None, ngrok: false, ngrok_authtoken: None, ngrok_domain: None, ngrok_username:\
    \ None, ngrok_password: None, env: false }"
  created_at: 2023-08-29 06:54:17+00:00
  edited: true
  hidden: false
  id: 64eda429b1ff0bd44f75c03f
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 3
repo_id: NumbersStation/nsql-2B
repo_type: model
status: open
target_branch: null
title: Getting Incomplete Query in most cases
