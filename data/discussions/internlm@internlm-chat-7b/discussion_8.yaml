!!python/object:huggingface_hub.community.DiscussionWithDetails
author: kosung
conflicting_files: null
created_at: 2024-01-10 09:17:00+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/175e3ac2f24107d064cc3bf7b3b8a4f3.svg
      fullname: kosung
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: kosung
      type: user
    createdAt: '2024-01-10T09:17:00.000Z'
    data:
      edited: true
      editors:
      - kosung
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5093591213226318
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/175e3ac2f24107d064cc3bf7b3b8a4f3.svg
          fullname: kosung
          isHf: false
          isPro: false
          name: kosung
          type: user
        html: "<p>v1.0.3 : AttributeError: 'InternLMConfig' object has no attribute\
          \ 'rotary'</p>\n<p>hello, why is \"rotary\" removed from InternLMConfig,\
          \ but InternLMAttention is still called?</p>\n<pre><code class=\"language-python\"\
          >    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\"\
          >_init_rope</span>(<span class=\"hljs-params\">self</span>):\n        <span\
          \ class=\"hljs-keyword\">if</span> self.config.rotary[<span class=\"hljs-string\"\
          >\"type\"</span>] == <span class=\"hljs-string\">\"origin\"</span>:\n  \
          \          self.rotary_emb = InternLMRotaryEmbedding(\n                self.head_dim,\n\
          \                max_position_embeddings=self.max_position_embeddings,\n\
          \                base=self.config.rotary[<span class=\"hljs-string\">\"\
          base\"</span>],\n            )\n        <span class=\"hljs-keyword\">elif</span>\
          \ self.config.rotary[<span class=\"hljs-string\">\"type\"</span>] == <span\
          \ class=\"hljs-string\">\"dynamic\"</span>:\n            self.rotary_emb\
          \ = InternLMDynamicNTKScalingRotaryEmbedding(\n                self.head_dim,\n\
          \                max_position_embeddings=self.max_position_embeddings,\n\
          \                base=self.config.rotary[<span class=\"hljs-string\">\"\
          base\"</span>],\n                scaling_factor=self.config.rotary.get(<span\
          \ class=\"hljs-string\">\"scaling_factor\"</span>, <span class=\"hljs-number\"\
          >1.0</span>),\n            )\n        <span class=\"hljs-keyword\">else</span>:\n\
          \            <span class=\"hljs-keyword\">raise</span> ValueError(<span\
          \ class=\"hljs-string\">\"Currently we only support rotary embedding's type\
          \ being one of ('origin', 'dynamic').\"</span>)\n        <span class=\"\
          hljs-keyword\">return</span> self.rotary_emb\n</code></pre>\n<p><a rel=\"\
          nofollow\" href=\"https://cdn-uploads.huggingface.co/production/uploads/645891ea4b7baff9a8488313/_Rox_FRGOH7wt-wxiukY5.png\"\
          ><img alt=\"image.png\" src=\"https://cdn-uploads.huggingface.co/production/uploads/645891ea4b7baff9a8488313/_Rox_FRGOH7wt-wxiukY5.png\"\
          ></a></p>\n"
        raw: "v1.0.3 : AttributeError: 'InternLMConfig' object has no attribute 'rotary'\n\
          \nhello, why is \"rotary\" removed from InternLMConfig, but InternLMAttention\
          \ is still called?\n```python\n    def _init_rope(self):\n        if self.config.rotary[\"\
          type\"] == \"origin\":\n            self.rotary_emb = InternLMRotaryEmbedding(\n\
          \                self.head_dim,\n                max_position_embeddings=self.max_position_embeddings,\n\
          \                base=self.config.rotary[\"base\"],\n            )\n   \
          \     elif self.config.rotary[\"type\"] == \"dynamic\":\n            self.rotary_emb\
          \ = InternLMDynamicNTKScalingRotaryEmbedding(\n                self.head_dim,\n\
          \                max_position_embeddings=self.max_position_embeddings,\n\
          \                base=self.config.rotary[\"base\"],\n                scaling_factor=self.config.rotary.get(\"\
          scaling_factor\", 1.0),\n            )\n        else:\n            raise\
          \ ValueError(\"Currently we only support rotary embedding's type being one\
          \ of ('origin', 'dynamic').\")\n        return self.rotary_emb\n```\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/645891ea4b7baff9a8488313/_Rox_FRGOH7wt-wxiukY5.png)\n"
        updatedAt: '2024-01-10T09:27:49.486Z'
      numEdits: 1
      reactions: []
    id: 659e608ca0751e7e76dfe202
    type: comment
  author: kosung
  content: "v1.0.3 : AttributeError: 'InternLMConfig' object has no attribute 'rotary'\n\
    \nhello, why is \"rotary\" removed from InternLMConfig, but InternLMAttention\
    \ is still called?\n```python\n    def _init_rope(self):\n        if self.config.rotary[\"\
    type\"] == \"origin\":\n            self.rotary_emb = InternLMRotaryEmbedding(\n\
    \                self.head_dim,\n                max_position_embeddings=self.max_position_embeddings,\n\
    \                base=self.config.rotary[\"base\"],\n            )\n        elif\
    \ self.config.rotary[\"type\"] == \"dynamic\":\n            self.rotary_emb =\
    \ InternLMDynamicNTKScalingRotaryEmbedding(\n                self.head_dim,\n\
    \                max_position_embeddings=self.max_position_embeddings,\n     \
    \           base=self.config.rotary[\"base\"],\n                scaling_factor=self.config.rotary.get(\"\
    scaling_factor\", 1.0),\n            )\n        else:\n            raise ValueError(\"\
    Currently we only support rotary embedding's type being one of ('origin', 'dynamic').\"\
    )\n        return self.rotary_emb\n```\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/645891ea4b7baff9a8488313/_Rox_FRGOH7wt-wxiukY5.png)\n"
  created_at: 2024-01-10 09:17:00+00:00
  edited: true
  hidden: false
  id: 659e608ca0751e7e76dfe202
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/af6e5a6611af2d8b4117377aef660274.svg
      fullname: lil
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: amu
      type: user
    createdAt: '2024-01-10T12:43:28.000Z'
    data:
      edited: false
      editors:
      - amu
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5250781178474426
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/af6e5a6611af2d8b4117377aef660274.svg
          fullname: lil
          isHf: false
          isPro: false
          name: amu
          type: user
        html: "<blockquote>\n<p>v1.0.3 : AttributeError: 'InternLMConfig' object has\
          \ no attribute 'rotary'</p>\n<p>hello, why is \"rotary\" removed from InternLMConfig,\
          \ but InternLMAttention is still called?</p>\n<pre><code class=\"language-python\"\
          >    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\"\
          >_init_rope</span>(<span class=\"hljs-params\">self</span>):\n        <span\
          \ class=\"hljs-keyword\">if</span> self.config.rotary[<span class=\"hljs-string\"\
          >\"type\"</span>] == <span class=\"hljs-string\">\"origin\"</span>:\n  \
          \          self.rotary_emb = InternLMRotaryEmbedding(\n                self.head_dim,\n\
          \                max_position_embeddings=self.max_position_embeddings,\n\
          \                base=self.config.rotary[<span class=\"hljs-string\">\"\
          base\"</span>],\n            )\n        <span class=\"hljs-keyword\">elif</span>\
          \ self.config.rotary[<span class=\"hljs-string\">\"type\"</span>] == <span\
          \ class=\"hljs-string\">\"dynamic\"</span>:\n            self.rotary_emb\
          \ = InternLMDynamicNTKScalingRotaryEmbedding(\n                self.head_dim,\n\
          \                max_position_embeddings=self.max_position_embeddings,\n\
          \                base=self.config.rotary[<span class=\"hljs-string\">\"\
          base\"</span>],\n                scaling_factor=self.config.rotary.get(<span\
          \ class=\"hljs-string\">\"scaling_factor\"</span>, <span class=\"hljs-number\"\
          >1.0</span>),\n            )\n        <span class=\"hljs-keyword\">else</span>:\n\
          \            <span class=\"hljs-keyword\">raise</span> ValueError(<span\
          \ class=\"hljs-string\">\"Currently we only support rotary embedding's type\
          \ being one of ('origin', 'dynamic').\"</span>)\n        <span class=\"\
          hljs-keyword\">return</span> self.rotary_emb\n</code></pre>\n<p><a rel=\"\
          nofollow\" href=\"https://cdn-uploads.huggingface.co/production/uploads/645891ea4b7baff9a8488313/_Rox_FRGOH7wt-wxiukY5.png\"\
          ><img alt=\"image.png\" src=\"https://cdn-uploads.huggingface.co/production/uploads/645891ea4b7baff9a8488313/_Rox_FRGOH7wt-wxiukY5.png\"\
          ></a></p>\n</blockquote>\n<p>You can add this to the <code>config.json</code>.</p>\n\
          <pre><code>  \"rotary\": {\n    \"base\": 10000,\n    \"type\": \"dynamic\"\
          \n  }\n</code></pre>\n<p>It seems the maintainer delete it incorrectly.</p>\n"
        raw: "> v1.0.3 : AttributeError: 'InternLMConfig' object has no attribute\
          \ 'rotary'\n> \n> hello, why is \"rotary\" removed from InternLMConfig,\
          \ but InternLMAttention is still called?\n> ```python\n>     def _init_rope(self):\n\
          >         if self.config.rotary[\"type\"] == \"origin\":\n>            \
          \ self.rotary_emb = InternLMRotaryEmbedding(\n>                 self.head_dim,\n\
          >                 max_position_embeddings=self.max_position_embeddings,\n\
          >                 base=self.config.rotary[\"base\"],\n>             )\n\
          >         elif self.config.rotary[\"type\"] == \"dynamic\":\n>         \
          \    self.rotary_emb = InternLMDynamicNTKScalingRotaryEmbedding(\n>    \
          \             self.head_dim,\n>                 max_position_embeddings=self.max_position_embeddings,\n\
          >                 base=self.config.rotary[\"base\"],\n>                \
          \ scaling_factor=self.config.rotary.get(\"scaling_factor\", 1.0),\n>   \
          \          )\n>         else:\n>             raise ValueError(\"Currently\
          \ we only support rotary embedding's type being one of ('origin', 'dynamic').\"\
          )\n>         return self.rotary_emb\n> ```\n> ![image.png](https://cdn-uploads.huggingface.co/production/uploads/645891ea4b7baff9a8488313/_Rox_FRGOH7wt-wxiukY5.png)\n\
          \nYou can add this to the `config.json`.\n```\n  \"rotary\": {\n    \"base\"\
          : 10000,\n    \"type\": \"dynamic\"\n  }\n```\nIt seems the maintainer delete\
          \ it incorrectly."
        updatedAt: '2024-01-10T12:43:28.611Z'
      numEdits: 0
      reactions: []
    id: 659e90f0b5c950aab151331f
    type: comment
  author: amu
  content: "> v1.0.3 : AttributeError: 'InternLMConfig' object has no attribute 'rotary'\n\
    > \n> hello, why is \"rotary\" removed from InternLMConfig, but InternLMAttention\
    \ is still called?\n> ```python\n>     def _init_rope(self):\n>         if self.config.rotary[\"\
    type\"] == \"origin\":\n>             self.rotary_emb = InternLMRotaryEmbedding(\n\
    >                 self.head_dim,\n>                 max_position_embeddings=self.max_position_embeddings,\n\
    >                 base=self.config.rotary[\"base\"],\n>             )\n>     \
    \    elif self.config.rotary[\"type\"] == \"dynamic\":\n>             self.rotary_emb\
    \ = InternLMDynamicNTKScalingRotaryEmbedding(\n>                 self.head_dim,\n\
    >                 max_position_embeddings=self.max_position_embeddings,\n>   \
    \              base=self.config.rotary[\"base\"],\n>                 scaling_factor=self.config.rotary.get(\"\
    scaling_factor\", 1.0),\n>             )\n>         else:\n>             raise\
    \ ValueError(\"Currently we only support rotary embedding's type being one of\
    \ ('origin', 'dynamic').\")\n>         return self.rotary_emb\n> ```\n> ![image.png](https://cdn-uploads.huggingface.co/production/uploads/645891ea4b7baff9a8488313/_Rox_FRGOH7wt-wxiukY5.png)\n\
    \nYou can add this to the `config.json`.\n```\n  \"rotary\": {\n    \"base\":\
    \ 10000,\n    \"type\": \"dynamic\"\n  }\n```\nIt seems the maintainer delete\
    \ it incorrectly."
  created_at: 2024-01-10 12:43:28+00:00
  edited: false
  hidden: false
  id: 659e90f0b5c950aab151331f
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 8
repo_id: internlm/internlm-chat-7b
repo_type: model
status: open
target_branch: null
title: 'AttributeError: ''InternLMConfig'' object has no attribute ''rotary'''
