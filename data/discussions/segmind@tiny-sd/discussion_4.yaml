!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Palawat
conflicting_files: null
created_at: 2023-08-23 18:48:25+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/004c8b7088298dd6949ed96740929924.svg
      fullname: Palawat Busaranuvong
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Palawat
      type: user
    createdAt: '2023-08-23T19:48:25.000Z'
    data:
      edited: false
      editors:
      - Palawat
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5254018902778625
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/004c8b7088298dd6949ed96740929924.svg
          fullname: Palawat Busaranuvong
          isHf: false
          isPro: false
          name: Palawat
          type: user
        html: '<p>I want to finetune tiny-sd on a different dataset by following <em>text_to_image</em>
          training (<a href="https://huggingface.co/docs/diffusers/main/en/training/text2image">https://huggingface.co/docs/diffusers/main/en/training/text2image</a>)
          and change the model_name to "segmind/tiny-sd". However, once I run the
          following code, I get this error.<br>export MODEL_NAME="segmind/tiny-sd"<br>export
          dataset_name="lambdalabs/pokemon-blip-captions"</p>

          <p>accelerate launch examples/text_to_image/train_text_to_image.py <br>  --pretrained_model_name_or_path=$MODEL_NAME
          <br>  --dataset_name=$dataset_name <br>  --use_ema <br>  --resolution=512
          --center_crop --random_flip <br>  --train_batch_size=1 <br>  --gradient_accumulation_steps=4
          <br>  --gradient_checkpointing <br>  --mixed_precision="fp16" <br>  --max_train_steps=20
          <br>  --learning_rate=1e-05 <br>  --max_grad_norm=1 <br>  --lr_scheduler="constant"
          --lr_warmup_steps=0 <br>  --output_dir="sd-pokemon-model" </p>

          <p>======================Error=====================================</p>

          <p><a rel="nofollow" href="https://cdn-uploads.huggingface.co/production/uploads/64e65f52e319ef0ac72a72a3/sG3pNRX4dmPeNK8caYMc1.png"><img
          alt="image.png" src="https://cdn-uploads.huggingface.co/production/uploads/64e65f52e319ef0ac72a72a3/sG3pNRX4dmPeNK8caYMc1.png"></a></p>

          <p>Note that the small-sd version doesn''t have this problem. Only the <strong>tiny-sd</strong>
          version has this issue.<br>Thank you,</p>

          '
        raw: "I want to finetune tiny-sd on a different dataset by following *text_to_image*\
          \ training (https://huggingface.co/docs/diffusers/main/en/training/text2image)\
          \ and change the model_name to \"segmind/tiny-sd\". However, once I run\
          \ the following code, I get this error.\r\nexport MODEL_NAME=\"segmind/tiny-sd\"\
          \r\nexport dataset_name=\"lambdalabs/pokemon-blip-captions\"\r\n\r\naccelerate\
          \ launch examples/text_to_image/train_text_to_image.py \\\r\n  --pretrained_model_name_or_path=$MODEL_NAME\
          \ \\\r\n  --dataset_name=$dataset_name \\\r\n  --use_ema \\\r\n  --resolution=512\
          \ --center_crop --random_flip \\\r\n  --train_batch_size=1 \\\r\n  --gradient_accumulation_steps=4\
          \ \\\r\n  --gradient_checkpointing \\\r\n  --mixed_precision=\"fp16\" \\\
          \r\n  --max_train_steps=20 \\\r\n  --learning_rate=1e-05 \\\r\n  --max_grad_norm=1\
          \ \\\r\n  --lr_scheduler=\"constant\" --lr_warmup_steps=0 \\\r\n  --output_dir=\"\
          sd-pokemon-model\" \r\n\r\n======================Error=====================================\r\
          \n\r\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/64e65f52e319ef0ac72a72a3/sG3pNRX4dmPeNK8caYMc1.png)\r\
          \n\r\nNote that the small-sd version doesn't have this problem. Only the\
          \ **tiny-sd** version has this issue.\r\nThank you,\r\n\r\n"
        updatedAt: '2023-08-23T19:48:25.253Z'
      numEdits: 0
      reactions: []
    id: 64e66289d27a8292c36cbe48
    type: comment
  author: Palawat
  content: "I want to finetune tiny-sd on a different dataset by following *text_to_image*\
    \ training (https://huggingface.co/docs/diffusers/main/en/training/text2image)\
    \ and change the model_name to \"segmind/tiny-sd\". However, once I run the following\
    \ code, I get this error.\r\nexport MODEL_NAME=\"segmind/tiny-sd\"\r\nexport dataset_name=\"\
    lambdalabs/pokemon-blip-captions\"\r\n\r\naccelerate launch examples/text_to_image/train_text_to_image.py\
    \ \\\r\n  --pretrained_model_name_or_path=$MODEL_NAME \\\r\n  --dataset_name=$dataset_name\
    \ \\\r\n  --use_ema \\\r\n  --resolution=512 --center_crop --random_flip \\\r\n\
    \  --train_batch_size=1 \\\r\n  --gradient_accumulation_steps=4 \\\r\n  --gradient_checkpointing\
    \ \\\r\n  --mixed_precision=\"fp16\" \\\r\n  --max_train_steps=20 \\\r\n  --learning_rate=1e-05\
    \ \\\r\n  --max_grad_norm=1 \\\r\n  --lr_scheduler=\"constant\" --lr_warmup_steps=0\
    \ \\\r\n  --output_dir=\"sd-pokemon-model\" \r\n\r\n======================Error=====================================\r\
    \n\r\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/64e65f52e319ef0ac72a72a3/sG3pNRX4dmPeNK8caYMc1.png)\r\
    \n\r\nNote that the small-sd version doesn't have this problem. Only the **tiny-sd**\
    \ version has this issue.\r\nThank you,\r\n\r\n"
  created_at: 2023-08-23 18:48:25+00:00
  edited: false
  hidden: false
  id: 64e66289d27a8292c36cbe48
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/1696abd2c4e107043cd85a1ab8e90381.svg
      fullname: Poxin Peng
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: neurlang
      type: user
    createdAt: '2023-09-07T07:43:31.000Z'
    data:
      edited: false
      editors:
      - neurlang
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9452534914016724
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/1696abd2c4e107043cd85a1ab8e90381.svg
          fullname: Poxin Peng
          isHf: false
          isPro: false
          name: neurlang
          type: user
        html: '<p>same problem, Only the tiny-sd version has this issue.<br>segmind/small-sd
          don''t have issue </p>

          '
        raw: 'same problem, Only the tiny-sd version has this issue.

          segmind/small-sd don''t have issue '
        updatedAt: '2023-09-07T07:43:31.464Z'
      numEdits: 0
      reactions: []
    id: 64f97f235515d7dccecb6b73
    type: comment
  author: neurlang
  content: 'same problem, Only the tiny-sd version has this issue.

    segmind/small-sd don''t have issue '
  created_at: 2023-09-07 06:43:31+00:00
  edited: false
  hidden: false
  id: 64f97f235515d7dccecb6b73
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/d6a6d922028e8b447b87fca56c00c679.svg
      fullname: T
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: kopyl
      type: user
    createdAt: '2024-01-19T23:57:18.000Z'
    data:
      edited: false
      editors:
      - kopyl
      hidden: false
      identifiedLanguage:
        language: it
        probability: 0.3597632944583893
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/d6a6d922028e8b447b87fca56c00c679.svg
          fullname: T
          isHf: false
          isPro: false
          name: kopyl
          type: user
        html: '<p>Same. What the hell bro? :(</p>

          '
        raw: Same. What the hell bro? :(
        updatedAt: '2024-01-19T23:57:18.285Z'
      numEdits: 0
      reactions: []
    id: 65ab0c5eac588f2a1c2c141c
    type: comment
  author: kopyl
  content: Same. What the hell bro? :(
  created_at: 2024-01-19 23:57:18+00:00
  edited: false
  hidden: false
  id: 65ab0c5eac588f2a1c2c141c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/d6a6d922028e8b447b87fca56c00c679.svg
      fullname: T
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: kopyl
      type: user
    createdAt: '2024-01-20T00:05:21.000Z'
    data:
      edited: false
      editors:
      - kopyl
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.4224657416343689
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/d6a6d922028e8b447b87fca56c00c679.svg
          fullname: T
          isHf: false
          isPro: false
          name: kopyl
          type: user
        html: "<p>Here is a simple reproducible example:</p>\n<pre><code>from diffusers\
          \ import UNet2DConditionModel\n\n\nunet = UNet2DConditionModel.from_pretrained(\n\
          \    \"segmind/tiny-sd\", subfolder=\"unet\"\n)\n\nunet.save_pretrained(\"\
          /test\")\n</code></pre>\n"
        raw: "Here is a simple reproducible example:\n\n```\nfrom diffusers import\
          \ UNet2DConditionModel\n\n\nunet = UNet2DConditionModel.from_pretrained(\n\
          \    \"segmind/tiny-sd\", subfolder=\"unet\"\n)\n\nunet.save_pretrained(\"\
          /test\")\n```"
        updatedAt: '2024-01-20T00:05:21.559Z'
      numEdits: 0
      reactions: []
    id: 65ab0e419c81170e310b09bc
    type: comment
  author: kopyl
  content: "Here is a simple reproducible example:\n\n```\nfrom diffusers import UNet2DConditionModel\n\
    \n\nunet = UNet2DConditionModel.from_pretrained(\n    \"segmind/tiny-sd\", subfolder=\"\
    unet\"\n)\n\nunet.save_pretrained(\"/test\")\n```"
  created_at: 2024-01-20 00:05:21+00:00
  edited: false
  hidden: false
  id: 65ab0e419c81170e310b09bc
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/d6a6d922028e8b447b87fca56c00c679.svg
      fullname: T
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: kopyl
      type: user
    createdAt: '2024-01-20T00:07:57.000Z'
    data:
      edited: false
      editors:
      - kopyl
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.40693387389183044
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/d6a6d922028e8b447b87fca56c00c679.svg
          fullname: T
          isHf: false
          isPro: false
          name: kopyl
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;Palawat&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/Palawat\">@<span class=\"\
          underline\">Palawat</span></a></span>\n\n\t</span></span> <span data-props=\"\
          {&quot;user&quot;:&quot;neurlang&quot;}\" data-target=\"UserMention\" class=\"\
          SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"inline-block\"><span\
          \ class=\"contents\"><a href=\"/neurlang\">@<span class=\"underline\">neurlang</span></a></span>\n\
          \n\t</span></span> ChatGPT helped me to fix it:</p>\n<pre><code>for param\
          \ in unet.parameters():\n    param.data = param.data.contiguous()\n</code></pre>\n"
        raw: "@Palawat @neurlang ChatGPT helped me to fix it:\n\n```\nfor param in\
          \ unet.parameters():\n    param.data = param.data.contiguous()\n```"
        updatedAt: '2024-01-20T00:07:57.427Z'
      numEdits: 0
      reactions: []
    id: 65ab0edd2f560c70ff2f0358
    type: comment
  author: kopyl
  content: "@Palawat @neurlang ChatGPT helped me to fix it:\n\n```\nfor param in unet.parameters():\n\
    \    param.data = param.data.contiguous()\n```"
  created_at: 2024-01-20 00:07:57+00:00
  edited: false
  hidden: false
  id: 65ab0edd2f560c70ff2f0358
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 4
repo_id: segmind/tiny-sd
repo_type: model
status: open
target_branch: null
title: 'Unable to save the unet weights after finetuning the model using text_to_image.py
  (ValueError: You are trying to save a non contiguous tensor: `conv_in.weight` which
  is not allowed))'
