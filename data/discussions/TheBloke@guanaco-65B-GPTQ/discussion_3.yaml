!!python/object:huggingface_hub.community.DiscussionWithDetails
author: nichedreams
conflicting_files: null
created_at: 2023-05-27 06:36:39+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/42648bec3fc52ddb3b8a11d485d4548c.svg
      fullname: King  Bull
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: nichedreams
      type: user
    createdAt: '2023-05-27T07:36:39.000Z'
    data:
      edited: false
      editors:
      - nichedreams
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/42648bec3fc52ddb3b8a11d485d4548c.svg
          fullname: King  Bull
          isHf: false
          isPro: false
          name: nichedreams
          type: user
        html: '<p>Hey Bloke, I''m trying to run this on your runpod with a 3090 but
          I get the<br>CUDA out of memory. Tried to allocate 86.00 MiB (GPU 0; 23.69
          GiB total capacity; 22.64 GiB already allocated; 41.81 MiB free; 22.65 GiB
          reserved in total by PyTorch) If reserved memory is &gt;&gt; allocated memory
          try setting max_split_size_mb to avoid fragmentation. See documentation
          for Memory Management and PYTORCH_CUDA_ALLOC_CONF</p>

          <p>Any idea why that is?</p>

          '
        raw: "Hey Bloke, I'm trying to run this on your runpod with a 3090 but I get\
          \ the \r\nCUDA out of memory. Tried to allocate 86.00 MiB (GPU 0; 23.69\
          \ GiB total capacity; 22.64 GiB already allocated; 41.81 MiB free; 22.65\
          \ GiB reserved in total by PyTorch) If reserved memory is >> allocated memory\
          \ try setting max_split_size_mb to avoid fragmentation. See documentation\
          \ for Memory Management and PYTORCH_CUDA_ALLOC_CONF\r\n\r\nAny idea why\
          \ that is?"
        updatedAt: '2023-05-27T07:36:39.594Z'
      numEdits: 0
      reactions: []
    id: 6471b307021b8f492f058a58
    type: comment
  author: nichedreams
  content: "Hey Bloke, I'm trying to run this on your runpod with a 3090 but I get\
    \ the \r\nCUDA out of memory. Tried to allocate 86.00 MiB (GPU 0; 23.69 GiB total\
    \ capacity; 22.64 GiB already allocated; 41.81 MiB free; 22.65 GiB reserved in\
    \ total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb\
    \ to avoid fragmentation. See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF\r\
    \n\r\nAny idea why that is?"
  created_at: 2023-05-27 06:36:39+00:00
  edited: false
  hidden: false
  id: 6471b307021b8f492f058a58
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
      fullname: Tom Jobbins
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: true
      name: TheBloke
      type: user
    createdAt: '2023-05-27T07:40:56.000Z'
    data:
      edited: false
      editors:
      - TheBloke
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
          fullname: Tom Jobbins
          isHf: false
          isPro: true
          name: TheBloke
          type: user
        html: '<p>Hmm that''s odd. Normally a 30/33B GPTQ with no groupsize will just
          fit into 24GB VRAM at max context length, ie around 2000 tokens returned.</p>

          <p>What were you doing at the time?</p>

          '
        raw: 'Hmm that''s odd. Normally a 30/33B GPTQ with no groupsize will just
          fit into 24GB VRAM at max context length, ie around 2000 tokens returned.


          What were you doing at the time?'
        updatedAt: '2023-05-27T07:40:56.559Z'
      numEdits: 0
      reactions: []
    id: 6471b4080211f85270f81370
    type: comment
  author: TheBloke
  content: 'Hmm that''s odd. Normally a 30/33B GPTQ with no groupsize will just fit
    into 24GB VRAM at max context length, ie around 2000 tokens returned.


    What were you doing at the time?'
  created_at: 2023-05-27 06:40:56+00:00
  edited: false
  hidden: false
  id: 6471b4080211f85270f81370
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/42648bec3fc52ddb3b8a11d485d4548c.svg
      fullname: King  Bull
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: nichedreams
      type: user
    createdAt: '2023-05-27T07:44:30.000Z'
    data:
      edited: true
      editors:
      - nichedreams
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/42648bec3fc52ddb3b8a11d485d4548c.svg
          fullname: King  Bull
          isHf: false
          isPro: false
          name: nichedreams
          type: user
        html: '<p>I wasn''t doing anything really, after it finally downloaded I just
          selected it from the model list and set the wbits and model type as per
          instructions. After clicking save and then reload I got the error.</p>

          '
        raw: I wasn't doing anything really, after it finally downloaded I just selected
          it from the model list and set the wbits and model type as per instructions.
          After clicking save and then reload I got the error.
        updatedAt: '2023-05-27T07:46:41.852Z'
      numEdits: 3
      reactions: []
    id: 6471b4de0211f85270f827ed
    type: comment
  author: nichedreams
  content: I wasn't doing anything really, after it finally downloaded I just selected
    it from the model list and set the wbits and model type as per instructions. After
    clicking save and then reload I got the error.
  created_at: 2023-05-27 06:44:30+00:00
  edited: true
  hidden: false
  id: 6471b4de0211f85270f827ed
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
      fullname: Tom Jobbins
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: true
      name: TheBloke
      type: user
    createdAt: '2023-05-27T08:31:27.000Z'
    data:
      edited: false
      editors:
      - TheBloke
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
          fullname: Tom Jobbins
          isHf: false
          isPro: true
          name: TheBloke
          type: user
        html: '<p>Oh wait, I just noticed what repo we''re in :P</p>

          <p>Yes a 65B will not load on 1x 24GB card!  A 30/33B will. A 65B needs
          2 x 24GB cards.  Or else you could offload half the layers to CPU, but it
          will be slow as hell</p>

          '
        raw: 'Oh wait, I just noticed what repo we''re in :P


          Yes a 65B will not load on 1x 24GB card!  A 30/33B will. A 65B needs 2 x
          24GB cards.  Or else you could offload half the layers to CPU, but it will
          be slow as hell'
        updatedAt: '2023-05-27T08:31:27.173Z'
      numEdits: 0
      reactions:
      - count: 2
        reaction: "\U0001F92F"
        users:
        - nichedreams
        - CodingJunkie
    id: 6471bfdf83da304b49d7cbbe
    type: comment
  author: TheBloke
  content: 'Oh wait, I just noticed what repo we''re in :P


    Yes a 65B will not load on 1x 24GB card!  A 30/33B will. A 65B needs 2 x 24GB
    cards.  Or else you could offload half the layers to CPU, but it will be slow
    as hell'
  created_at: 2023-05-27 07:31:27+00:00
  edited: false
  hidden: false
  id: 6471bfdf83da304b49d7cbbe
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/42648bec3fc52ddb3b8a11d485d4548c.svg
      fullname: King  Bull
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: nichedreams
      type: user
    createdAt: '2023-05-27T08:37:21.000Z'
    data:
      status: closed
    id: 6471c14197a75cc77aa647d6
    type: status-change
  author: nichedreams
  created_at: 2023-05-27 07:37:21+00:00
  id: 6471c14197a75cc77aa647d6
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/b074c243d82f5b110fb8b9933d474747.svg
      fullname: Harry Xiao
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: shawhu2023
      type: user
    createdAt: '2023-05-28T14:05:24.000Z'
    data:
      edited: false
      editors:
      - shawhu2023
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/b074c243d82f5b110fb8b9933d474747.svg
          fullname: Harry Xiao
          isHf: false
          isPro: false
          name: shawhu2023
          type: user
        html: '<blockquote>

          <p>Oh wait, I just noticed what repo we''re in :P</p>

          <p>Yes a 65B will not load on 1x 24GB card!  A 30/33B will. A 65B needs
          2 x 24GB cards.  Or else you could offload half the layers to CPU, but it
          will be slow as hell</p>

          </blockquote>

          <p>can you load this 65B model on 2 x 3090? with oobabooga webui?</p>

          '
        raw: "> Oh wait, I just noticed what repo we're in :P\n> \n> Yes a 65B will\
          \ not load on 1x 24GB card!  A 30/33B will. A 65B needs 2 x 24GB cards.\
          \  Or else you could offload half the layers to CPU, but it will be slow\
          \ as hell\n\ncan you load this 65B model on 2 x 3090? with oobabooga webui?"
        updatedAt: '2023-05-28T14:05:24.805Z'
      numEdits: 0
      reactions: []
    id: 64735fa463001a0002ca92d6
    type: comment
  author: shawhu2023
  content: "> Oh wait, I just noticed what repo we're in :P\n> \n> Yes a 65B will\
    \ not load on 1x 24GB card!  A 30/33B will. A 65B needs 2 x 24GB cards.  Or else\
    \ you could offload half the layers to CPU, but it will be slow as hell\n\ncan\
    \ you load this 65B model on 2 x 3090? with oobabooga webui?"
  created_at: 2023-05-28 13:05:24+00:00
  edited: false
  hidden: false
  id: 64735fa463001a0002ca92d6
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
      fullname: Tom Jobbins
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: true
      name: TheBloke
      type: user
    createdAt: '2023-05-28T14:18:55.000Z'
    data:
      edited: false
      editors:
      - TheBloke
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/6426d3f3a7723d62b53c259b/tvPikpAzKTKGN5wrpadOJ.jpeg?w=200&h=200&f=face
          fullname: Tom Jobbins
          isHf: false
          isPro: true
          name: TheBloke
          type: user
        html: '<p>Yes you can. You should be able to  achieve this with something
          like: <code>--pre_layer 35 55</code> to put 35 layers on GPU 1 and 55 on
          GPU 2.  You need to put fewer layers on GPU 1 as it also has to run the
          context</p>

          <p>I don''t know the exact numbers so you will need to experiment. But it
          is possible.</p>

          '
        raw: 'Yes you can. You should be able to  achieve this with something like:
          `--pre_layer 35 55` to put 35 layers on GPU 1 and 55 on GPU 2.  You need
          to put fewer layers on GPU 1 as it also has to run the context


          I don''t know the exact numbers so you will need to experiment. But it is
          possible.'
        updatedAt: '2023-05-28T14:18:55.279Z'
      numEdits: 0
      reactions: []
    id: 647362cf6cff2f8672044e71
    type: comment
  author: TheBloke
  content: 'Yes you can. You should be able to  achieve this with something like:
    `--pre_layer 35 55` to put 35 layers on GPU 1 and 55 on GPU 2.  You need to put
    fewer layers on GPU 1 as it also has to run the context


    I don''t know the exact numbers so you will need to experiment. But it is possible.'
  created_at: 2023-05-28 13:18:55+00:00
  edited: false
  hidden: false
  id: 647362cf6cff2f8672044e71
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 3
repo_id: TheBloke/guanaco-65B-GPTQ
repo_type: model
status: closed
target_branch: null
title: Out of memory with 24 GB VRAM on Runpod?
