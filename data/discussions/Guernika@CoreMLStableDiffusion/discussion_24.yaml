!!python/object:huggingface_hub.community.DiscussionWithDetails
author: akaMarukyu
conflicting_files: null
created_at: 2023-07-22 06:56:13+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/3518eb98393ba8f981fb8052bf3dc5e1.svg
      fullname: k
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: akaMarukyu
      type: user
    createdAt: '2023-07-22T07:56:13.000Z'
    data:
      edited: false
      editors:
      - akaMarukyu
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6595005393028259
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/3518eb98393ba8f981fb8052bf3dc5e1.svg
          fullname: k
          isHf: false
          isPro: false
          name: akaMarukyu
          type: user
        html: "<p>Hello,</p>\n<p>I just updated to the latest version of Guernika\
          \ and am trying to convert some models but it fails every time. I have tried\
          \ a few different models and they all fail with the same error. I have tried\
          \ using CPU &amp; NE and CPU &amp; GPU but they both fail to convert.</p>\n\
          <p>I have converted models successfully a few months ago with the older\
          \ version.</p>\n<p>I've attached a screenshot of the options I used and\
          \ the error log.</p>\n<p>Thanks for any help.</p>\n<pre><code>Starting python\
          \ converter\nInitializing StableDiffusionPipeline from /Users/[MY_NAME]/Downloads/meinamix_meinaV11.safetensors..\n\
          `text_config_dict` is provided which will be used to initialize `CLIPTextConfig`.\
          \ The value `text_config[\"id2label\"]` will be overriden.\ntransformers/models/clip/feature_extraction_clip.py:28:\
          \ FutureWarning: The class CLIPFeatureExtractor is deprecated and will be\
          \ removed in version 5 of Transformers. Please use CLIPImageProcessor instead.\n\
          \  warnings.warn(\n`text_config_dict` is provided which will be used to\
          \ initialize `CLIPTextConfig`. The value `text_config[\"id2label\"]` will\
          \ be overriden.\nDone.\nOutput size will be 512x512\nConverting vae_encoder\n\
          `vae_encoder` already exists at /var/folders/j0/c81y2q2j6vx2vr4rdr1_p_dh0000gn/T/meinamix_meinaV11_vae_encoder.mlpackage,\
          \ skipping conversion.\nConverted vae_encoder\nConverting vae_decoder\n\
          `vae_decoder` already exists at /var/folders/j0/c81y2q2j6vx2vr4rdr1_p_dh0000gn/T/meinamix_meinaV11_vae_decoder.mlpackage,\
          \ skipping conversion.\nConverted vae_decoder\nConverting unet\n AttentionImplementations.SPLIT_EINSUM\n\
          \ (torch.Size([2, 1280, 8, 8]), torch.float32)}\nJIT tracing..\nguernikatools/layer_norm.py:61:\
          \ TracerWarning: Converting a tensor to a Python boolean might cause the\
          \ trace to be incorrect. We can't record the data flow of Python values,\
          \ so this value will be treated as a constant in the future. This means\
          \ that the trace might not generalize to other inputs!\nTraceback (most\
          \ recent call last):\n  File \"guernikatools/torch2coreml.py\", line 1682,\
          \ in &lt;module&gt;\n  File \"guernikatools/torch2coreml.py\", line 1495,\
          \ in main\n  File \"guernikatools/torch2coreml.py\", line 1072, in convert_unet\n\
          \  File \"torch/jit/_trace.py\", line 794, in trace\n    return trace_module(\n\
          \  File \"torch/jit/_trace.py\", line 1056, in trace_module\n    module._c._create_method_from_trace(\n\
          \  File \"torch/nn/modules/module.py\", line 1501, in _call_impl\n    return\
          \ forward_call(*args, **kwargs)\n  File \"torch/nn/modules/module.py\",\
          \ line 1488, in _slow_forward\n    result = self.forward(*input, **kwargs)\n\
          \  File \"guernikatools/unet.py\", line 1003, in forward\nRuntimeError:\
          \ The size of tensor a (64) must match the size of tensor b (32) at non-singleton\
          \ dimension 3\n[31812] Failed to execute script 'torch2coreml' due to unhandled\
          \ exception: The size of tensor a (64) must match the size of tensor b (32)\
          \ at non-singleton dimension 3\n[31812] Traceback:\nTraceback (most recent\
          \ call last):\n  File \"guernikatools/torch2coreml.py\", line 1682, in &lt;module&gt;\n\
          \  File \"guernikatools/torch2coreml.py\", line 1495, in main\n  File \"\
          guernikatools/torch2coreml.py\", line 1072, in convert_unet\n  File \"torch/jit/_trace.py\"\
          , line 794, in trace\n    return trace_module(\n  File \"torch/jit/_trace.py\"\
          , line 1056, in trace_module\n    module._c._create_method_from_trace(\n\
          \  File \"torch/nn/modules/module.py\", line 1501, in _call_impl\n    return\
          \ forward_call(*args, **kwargs)\n  File \"torch/nn/modules/module.py\",\
          \ line 1488, in _slow_forward\n    result = self.forward(*input, **kwargs)\n\
          \  File \"guernikatools/unet.py\", line 1003, in forward\nRuntimeError:\
          \ The size of tensor a (64) must match the size of tensor b (32) at non-singleton\
          \ dimension 3\n</code></pre>\n<p><a rel=\"nofollow\" href=\"https://cdn-uploads.huggingface.co/production/uploads/64089e913461c51cf730c5f5/ckdbut-wZUhzm8cJfy9kt.png\"\
          ><img alt=\"Screenshot 2023-07-22 at 5.54.55 pm.png\" src=\"https://cdn-uploads.huggingface.co/production/uploads/64089e913461c51cf730c5f5/ckdbut-wZUhzm8cJfy9kt.png\"\
          ></a></p>\n"
        raw: "Hello,\r\n\r\nI just updated to the latest version of Guernika and am\
          \ trying to convert some models but it fails every time. I have tried a\
          \ few different models and they all fail with the same error. I have tried\
          \ using CPU & NE and CPU & GPU but they both fail to convert.\r\n\r\nI have\
          \ converted models successfully a few months ago with the older version.\r\
          \n\r\nI've attached a screenshot of the options I used and the error log.\r\
          \n\r\nThanks for any help.\r\n\r\n```\r\nStarting python converter\r\nInitializing\
          \ StableDiffusionPipeline from /Users/[MY_NAME]/Downloads/meinamix_meinaV11.safetensors..\r\
          \n`text_config_dict` is provided which will be used to initialize `CLIPTextConfig`.\
          \ The value `text_config[\"id2label\"]` will be overriden.\r\ntransformers/models/clip/feature_extraction_clip.py:28:\
          \ FutureWarning: The class CLIPFeatureExtractor is deprecated and will be\
          \ removed in version 5 of Transformers. Please use CLIPImageProcessor instead.\r\
          \n  warnings.warn(\r\n`text_config_dict` is provided which will be used\
          \ to initialize `CLIPTextConfig`. The value `text_config[\"id2label\"]`\
          \ will be overriden.\r\nDone.\r\nOutput size will be 512x512\r\nConverting\
          \ vae_encoder\r\n`vae_encoder` already exists at /var/folders/j0/c81y2q2j6vx2vr4rdr1_p_dh0000gn/T/meinamix_meinaV11_vae_encoder.mlpackage,\
          \ skipping conversion.\r\nConverted vae_encoder\r\nConverting vae_decoder\r\
          \n`vae_decoder` already exists at /var/folders/j0/c81y2q2j6vx2vr4rdr1_p_dh0000gn/T/meinamix_meinaV11_vae_decoder.mlpackage,\
          \ skipping conversion.\r\nConverted vae_decoder\r\nConverting unet\r\n AttentionImplementations.SPLIT_EINSUM\r\
          \n (torch.Size([2, 1280, 8, 8]), torch.float32)}\r\nJIT tracing..\r\nguernikatools/layer_norm.py:61:\
          \ TracerWarning: Converting a tensor to a Python boolean might cause the\
          \ trace to be incorrect. We can't record the data flow of Python values,\
          \ so this value will be treated as a constant in the future. This means\
          \ that the trace might not generalize to other inputs!\r\nTraceback (most\
          \ recent call last):\r\n  File \"guernikatools/torch2coreml.py\", line 1682,\
          \ in <module>\r\n  File \"guernikatools/torch2coreml.py\", line 1495, in\
          \ main\r\n  File \"guernikatools/torch2coreml.py\", line 1072, in convert_unet\r\
          \n  File \"torch/jit/_trace.py\", line 794, in trace\r\n    return trace_module(\r\
          \n  File \"torch/jit/_trace.py\", line 1056, in trace_module\r\n    module._c._create_method_from_trace(\r\
          \n  File \"torch/nn/modules/module.py\", line 1501, in _call_impl\r\n  \
          \  return forward_call(*args, **kwargs)\r\n  File \"torch/nn/modules/module.py\"\
          , line 1488, in _slow_forward\r\n    result = self.forward(*input, **kwargs)\r\
          \n  File \"guernikatools/unet.py\", line 1003, in forward\r\nRuntimeError:\
          \ The size of tensor a (64) must match the size of tensor b (32) at non-singleton\
          \ dimension 3\r\n[31812] Failed to execute script 'torch2coreml' due to\
          \ unhandled exception: The size of tensor a (64) must match the size of\
          \ tensor b (32) at non-singleton dimension 3\r\n[31812] Traceback:\r\nTraceback\
          \ (most recent call last):\r\n  File \"guernikatools/torch2coreml.py\",\
          \ line 1682, in <module>\r\n  File \"guernikatools/torch2coreml.py\", line\
          \ 1495, in main\r\n  File \"guernikatools/torch2coreml.py\", line 1072,\
          \ in convert_unet\r\n  File \"torch/jit/_trace.py\", line 794, in trace\r\
          \n    return trace_module(\r\n  File \"torch/jit/_trace.py\", line 1056,\
          \ in trace_module\r\n    module._c._create_method_from_trace(\r\n  File\
          \ \"torch/nn/modules/module.py\", line 1501, in _call_impl\r\n    return\
          \ forward_call(*args, **kwargs)\r\n  File \"torch/nn/modules/module.py\"\
          , line 1488, in _slow_forward\r\n    result = self.forward(*input, **kwargs)\r\
          \n  File \"guernikatools/unet.py\", line 1003, in forward\r\nRuntimeError:\
          \ The size of tensor a (64) must match the size of tensor b (32) at non-singleton\
          \ dimension 3\r\n```\r\n\r\n\r\n![Screenshot 2023-07-22 at 5.54.55 pm.png](https://cdn-uploads.huggingface.co/production/uploads/64089e913461c51cf730c5f5/ckdbut-wZUhzm8cJfy9kt.png)\r\
          \n"
        updatedAt: '2023-07-22T07:56:13.373Z'
      numEdits: 0
      reactions: []
    id: 64bb8b9db8cd0087190ae726
    type: comment
  author: akaMarukyu
  content: "Hello,\r\n\r\nI just updated to the latest version of Guernika and am\
    \ trying to convert some models but it fails every time. I have tried a few different\
    \ models and they all fail with the same error. I have tried using CPU & NE and\
    \ CPU & GPU but they both fail to convert.\r\n\r\nI have converted models successfully\
    \ a few months ago with the older version.\r\n\r\nI've attached a screenshot of\
    \ the options I used and the error log.\r\n\r\nThanks for any help.\r\n\r\n```\r\
    \nStarting python converter\r\nInitializing StableDiffusionPipeline from /Users/[MY_NAME]/Downloads/meinamix_meinaV11.safetensors..\r\
    \n`text_config_dict` is provided which will be used to initialize `CLIPTextConfig`.\
    \ The value `text_config[\"id2label\"]` will be overriden.\r\ntransformers/models/clip/feature_extraction_clip.py:28:\
    \ FutureWarning: The class CLIPFeatureExtractor is deprecated and will be removed\
    \ in version 5 of Transformers. Please use CLIPImageProcessor instead.\r\n  warnings.warn(\r\
    \n`text_config_dict` is provided which will be used to initialize `CLIPTextConfig`.\
    \ The value `text_config[\"id2label\"]` will be overriden.\r\nDone.\r\nOutput\
    \ size will be 512x512\r\nConverting vae_encoder\r\n`vae_encoder` already exists\
    \ at /var/folders/j0/c81y2q2j6vx2vr4rdr1_p_dh0000gn/T/meinamix_meinaV11_vae_encoder.mlpackage,\
    \ skipping conversion.\r\nConverted vae_encoder\r\nConverting vae_decoder\r\n\
    `vae_decoder` already exists at /var/folders/j0/c81y2q2j6vx2vr4rdr1_p_dh0000gn/T/meinamix_meinaV11_vae_decoder.mlpackage,\
    \ skipping conversion.\r\nConverted vae_decoder\r\nConverting unet\r\n AttentionImplementations.SPLIT_EINSUM\r\
    \n (torch.Size([2, 1280, 8, 8]), torch.float32)}\r\nJIT tracing..\r\nguernikatools/layer_norm.py:61:\
    \ TracerWarning: Converting a tensor to a Python boolean might cause the trace\
    \ to be incorrect. We can't record the data flow of Python values, so this value\
    \ will be treated as a constant in the future. This means that the trace might\
    \ not generalize to other inputs!\r\nTraceback (most recent call last):\r\n  File\
    \ \"guernikatools/torch2coreml.py\", line 1682, in <module>\r\n  File \"guernikatools/torch2coreml.py\"\
    , line 1495, in main\r\n  File \"guernikatools/torch2coreml.py\", line 1072, in\
    \ convert_unet\r\n  File \"torch/jit/_trace.py\", line 794, in trace\r\n    return\
    \ trace_module(\r\n  File \"torch/jit/_trace.py\", line 1056, in trace_module\r\
    \n    module._c._create_method_from_trace(\r\n  File \"torch/nn/modules/module.py\"\
    , line 1501, in _call_impl\r\n    return forward_call(*args, **kwargs)\r\n  File\
    \ \"torch/nn/modules/module.py\", line 1488, in _slow_forward\r\n    result =\
    \ self.forward(*input, **kwargs)\r\n  File \"guernikatools/unet.py\", line 1003,\
    \ in forward\r\nRuntimeError: The size of tensor a (64) must match the size of\
    \ tensor b (32) at non-singleton dimension 3\r\n[31812] Failed to execute script\
    \ 'torch2coreml' due to unhandled exception: The size of tensor a (64) must match\
    \ the size of tensor b (32) at non-singleton dimension 3\r\n[31812] Traceback:\r\
    \nTraceback (most recent call last):\r\n  File \"guernikatools/torch2coreml.py\"\
    , line 1682, in <module>\r\n  File \"guernikatools/torch2coreml.py\", line 1495,\
    \ in main\r\n  File \"guernikatools/torch2coreml.py\", line 1072, in convert_unet\r\
    \n  File \"torch/jit/_trace.py\", line 794, in trace\r\n    return trace_module(\r\
    \n  File \"torch/jit/_trace.py\", line 1056, in trace_module\r\n    module._c._create_method_from_trace(\r\
    \n  File \"torch/nn/modules/module.py\", line 1501, in _call_impl\r\n    return\
    \ forward_call(*args, **kwargs)\r\n  File \"torch/nn/modules/module.py\", line\
    \ 1488, in _slow_forward\r\n    result = self.forward(*input, **kwargs)\r\n  File\
    \ \"guernikatools/unet.py\", line 1003, in forward\r\nRuntimeError: The size of\
    \ tensor a (64) must match the size of tensor b (32) at non-singleton dimension\
    \ 3\r\n```\r\n\r\n\r\n![Screenshot 2023-07-22 at 5.54.55 pm.png](https://cdn-uploads.huggingface.co/production/uploads/64089e913461c51cf730c5f5/ckdbut-wZUhzm8cJfy9kt.png)\r\
    \n"
  created_at: 2023-07-22 06:56:13+00:00
  edited: false
  hidden: false
  id: 64bb8b9db8cd0087190ae726
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1672782907557-6313af200b24eab4746e7d34.jpeg?w=200&h=200&f=face
      fullname: Guillermo Cique
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: GuiyeC
      type: user
    createdAt: '2023-07-22T16:46:44.000Z'
    data:
      edited: false
      editors:
      - GuiyeC
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.890760600566864
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1672782907557-6313af200b24eab4746e7d34.jpeg?w=200&h=200&f=face
          fullname: Guillermo Cique
          isHf: false
          isPro: false
          name: GuiyeC
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;akaMarukyu&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/akaMarukyu\">@<span class=\"\
          underline\">akaMarukyu</span></a></span>\n\n\t</span></span> thanks for\
          \ the detailed report! I think this should be fixed in the latest update\
          \ 5.0.3, let me know if you still have problems :)</p>\n"
        raw: '@akaMarukyu thanks for the detailed report! I think this should be fixed
          in the latest update 5.0.3, let me know if you still have problems :)'
        updatedAt: '2023-07-22T16:46:44.587Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F91D"
        users:
        - ZProphete
    id: 64bc07f49a69e8da48abd9ef
    type: comment
  author: GuiyeC
  content: '@akaMarukyu thanks for the detailed report! I think this should be fixed
    in the latest update 5.0.3, let me know if you still have problems :)'
  created_at: 2023-07-22 15:46:44+00:00
  edited: false
  hidden: false
  id: 64bc07f49a69e8da48abd9ef
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/3518eb98393ba8f981fb8052bf3dc5e1.svg
      fullname: k
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: akaMarukyu
      type: user
    createdAt: '2023-07-23T01:06:58.000Z'
    data:
      edited: false
      editors:
      - akaMarukyu
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9988358020782471
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/3518eb98393ba8f981fb8052bf3dc5e1.svg
          fullname: k
          isHf: false
          isPro: false
          name: akaMarukyu
          type: user
        html: '<p>Thanks, it''s working great now.</p>

          '
        raw: Thanks, it's working great now.
        updatedAt: '2023-07-23T01:06:58.944Z'
      numEdits: 0
      reactions: []
    id: 64bc7d32e38420aababaefe5
    type: comment
  author: akaMarukyu
  content: Thanks, it's working great now.
  created_at: 2023-07-23 00:06:58+00:00
  edited: false
  hidden: false
  id: 64bc7d32e38420aababaefe5
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1672782907557-6313af200b24eab4746e7d34.jpeg?w=200&h=200&f=face
      fullname: Guillermo Cique
      isHf: false
      isOrgMember: true
      isOwner: false
      isPro: false
      name: GuiyeC
      type: user
    createdAt: '2023-07-25T22:26:16.000Z'
    data:
      status: closed
    id: 64c04c08a2ec8cb2f570ce38
    type: status-change
  author: GuiyeC
  created_at: 2023-07-25 21:26:16+00:00
  id: 64c04c08a2ec8cb2f570ce38
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 24
repo_id: Guernika/CoreMLStableDiffusion
repo_type: model
status: closed
target_branch: null
title: Model conversion keeps failing with Guernika Model Converter 5.0.2
