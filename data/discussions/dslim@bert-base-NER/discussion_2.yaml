!!python/object:huggingface_hub.community.DiscussionWithDetails
author: clive777
conflicting_files: null
created_at: 2022-06-18 09:23:00+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/57e8309c096e775d1e3491ad733ca285.svg
      fullname: fernangdes
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: clive777
      type: user
    createdAt: '2022-06-18T10:23:00.000Z'
    data:
      edited: true
      editors:
      - clive777
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/57e8309c096e775d1e3491ad733ca285.svg
          fullname: fernangdes
          isHf: false
          isPro: false
          name: clive777
          type: user
        html: "<p>Dataset used : <a href=\"https://huggingface.co/datasets/conll2003\"\
          >https://huggingface.co/datasets/conll2003</a></p>\n<p>Evaluation Metric\
          \ : load_metric(\"seqeval\")</p>\n<p>**Results Obtained : **<br>{'eval_loss':\
          \ 2.3160810470581055,<br> 'eval_precision': 0.6153949670300094,<br> 'eval_recall':\
          \ 0.7696061932009425,<br> 'eval_f1': 0.6839153518283106,<br> 'eval_accuracy':\
          \ 0.9621769588508859,<br> 'eval_runtime': 556.8392,<br> 'eval_samples_per_second':\
          \ 5.838,<br> 'eval_steps_per_second': 0.731}</p>\n<p>Ner label alignment\
          \ code :  Code from : <a href=\"https://huggingface.co/course/chapter7/2\"\
          >https://huggingface.co/course/chapter7/2</a></p>\n<h1 id=\"\"></h1>\n<p>def\
          \ align_labels_with_tokens(labels, word_ids):<br>    new_labels = []<br>\
          \    current_word = None<br>    for word_id in word_ids:<br>        if word_id\
          \ != current_word:<br>            # Start of a new word!<br>           \
          \ current_word = word_id<br>            label = -100 if word_id is None\
          \ else labels[word_id]<br>            new_labels.append(label)<br>     \
          \   elif word_id is None:<br>            # Special token<br>           \
          \ new_labels.append(-100)<br>        else:<br>            # Same word as\
          \ previous token<br>            label = labels[word_id]<br>            #\
          \ If the label is B-XXX we change it to I-XXX<br>            if label %\
          \ 2 == 1:<br>                label += 1<br>            new_labels.append(label)</p>\n\
          <pre><code>return new_labels\n</code></pre>\n<p>Compute Metric </p>\n<h1\
          \ id=\"-1\"></h1>\n<p>def compute_metrics(eval_preds):<br>    logits, labels\
          \ = eval_preds<br>    predictions = np.argmax(logits, axis=-1)</p>\n<pre><code>true_labels\
          \ = [[label_names[l] for l in label if l != -100] for label in labels]\n\
          true_predictions = [\n    [id2labels[str(p)] for (p, l) in zip(prediction,\
          \ label) if l != -100]\n    for prediction, label in zip(predictions, labels)\n\
          ]\nall_metrics = metric.compute(predictions=true_predictions, references=true_labels)\n\
          return {\n    \"precision\": all_metrics[\"overall_precision\"],\n    \"\
          recall\": all_metrics[\"overall_recall\"],\n    \"f1\": all_metrics[\"overall_f1\"\
          ],\n    \"accuracy\": all_metrics[\"overall_accuracy\"],\n}\n</code></pre>\n\
          <p>Note :  Using id2labels from ur models. Please comment on this </p>\n"
        raw: "Dataset used : https://huggingface.co/datasets/conll2003\n\nEvaluation\
          \ Metric : load_metric(\"seqeval\")\n\n**Results Obtained : **\n{'eval_loss':\
          \ 2.3160810470581055,\n 'eval_precision': 0.6153949670300094,\n 'eval_recall':\
          \ 0.7696061932009425,\n 'eval_f1': 0.6839153518283106,\n 'eval_accuracy':\
          \ 0.9621769588508859,\n 'eval_runtime': 556.8392,\n 'eval_samples_per_second':\
          \ 5.838,\n 'eval_steps_per_second': 0.731}\n\n\nNer label alignment code\
          \ :  Code from : https://huggingface.co/course/chapter7/2\n\n#\ndef align_labels_with_tokens(labels,\
          \ word_ids):\n    new_labels = []\n    current_word = None\n    for word_id\
          \ in word_ids:\n        if word_id != current_word:\n            # Start\
          \ of a new word!\n            current_word = word_id\n            label\
          \ = -100 if word_id is None else labels[word_id]\n            new_labels.append(label)\n\
          \        elif word_id is None:\n            # Special token\n          \
          \  new_labels.append(-100)\n        else:\n            # Same word as previous\
          \ token\n            label = labels[word_id]\n            # If the label\
          \ is B-XXX we change it to I-XXX\n            if label % 2 == 1:\n     \
          \           label += 1\n            new_labels.append(label)\n\n    return\
          \ new_labels\n\n\nCompute Metric \n\n#\ndef compute_metrics(eval_preds):\n\
          \    logits, labels = eval_preds\n    predictions = np.argmax(logits, axis=-1)\n\
          \n    true_labels = [[label_names[l] for l in label if l != -100] for label\
          \ in labels]\n    true_predictions = [\n        [id2labels[str(p)] for (p,\
          \ l) in zip(prediction, label) if l != -100]\n        for prediction, label\
          \ in zip(predictions, labels)\n    ]\n    all_metrics = metric.compute(predictions=true_predictions,\
          \ references=true_labels)\n    return {\n        \"precision\": all_metrics[\"\
          overall_precision\"],\n        \"recall\": all_metrics[\"overall_recall\"\
          ],\n        \"f1\": all_metrics[\"overall_f1\"],\n        \"accuracy\":\
          \ all_metrics[\"overall_accuracy\"],\n    }\n\n\nNote :  Using id2labels\
          \ from ur models. Please comment on this \n\n"
        updatedAt: '2022-06-18T10:24:36.742Z'
      numEdits: 2
      reactions: []
    id: 62ada784c56dba0b06298f26
    type: comment
  author: clive777
  content: "Dataset used : https://huggingface.co/datasets/conll2003\n\nEvaluation\
    \ Metric : load_metric(\"seqeval\")\n\n**Results Obtained : **\n{'eval_loss':\
    \ 2.3160810470581055,\n 'eval_precision': 0.6153949670300094,\n 'eval_recall':\
    \ 0.7696061932009425,\n 'eval_f1': 0.6839153518283106,\n 'eval_accuracy': 0.9621769588508859,\n\
    \ 'eval_runtime': 556.8392,\n 'eval_samples_per_second': 5.838,\n 'eval_steps_per_second':\
    \ 0.731}\n\n\nNer label alignment code :  Code from : https://huggingface.co/course/chapter7/2\n\
    \n#\ndef align_labels_with_tokens(labels, word_ids):\n    new_labels = []\n  \
    \  current_word = None\n    for word_id in word_ids:\n        if word_id != current_word:\n\
    \            # Start of a new word!\n            current_word = word_id\n    \
    \        label = -100 if word_id is None else labels[word_id]\n            new_labels.append(label)\n\
    \        elif word_id is None:\n            # Special token\n            new_labels.append(-100)\n\
    \        else:\n            # Same word as previous token\n            label =\
    \ labels[word_id]\n            # If the label is B-XXX we change it to I-XXX\n\
    \            if label % 2 == 1:\n                label += 1\n            new_labels.append(label)\n\
    \n    return new_labels\n\n\nCompute Metric \n\n#\ndef compute_metrics(eval_preds):\n\
    \    logits, labels = eval_preds\n    predictions = np.argmax(logits, axis=-1)\n\
    \n    true_labels = [[label_names[l] for l in label if l != -100] for label in\
    \ labels]\n    true_predictions = [\n        [id2labels[str(p)] for (p, l) in\
    \ zip(prediction, label) if l != -100]\n        for prediction, label in zip(predictions,\
    \ labels)\n    ]\n    all_metrics = metric.compute(predictions=true_predictions,\
    \ references=true_labels)\n    return {\n        \"precision\": all_metrics[\"\
    overall_precision\"],\n        \"recall\": all_metrics[\"overall_recall\"],\n\
    \        \"f1\": all_metrics[\"overall_f1\"],\n        \"accuracy\": all_metrics[\"\
    overall_accuracy\"],\n    }\n\n\nNote :  Using id2labels from ur models. Please\
    \ comment on this \n\n"
  created_at: 2022-06-18 09:23:00+00:00
  edited: true
  hidden: false
  id: 62ada784c56dba0b06298f26
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/738a3c97956f3b9fb432bd5594e16e1c.svg
      fullname: Georgios Sidiropoulos
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: gsidiro
      type: user
    createdAt: '2022-07-29T09:59:50.000Z'
    data:
      edited: false
      editors:
      - gsidiro
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/738a3c97956f3b9fb432bd5594e16e1c.svg
          fullname: Georgios Sidiropoulos
          isHf: false
          isPro: false
          name: gsidiro
          type: user
        html: '<p>Was there any update on this? Did you manage to reproduce the results?</p>

          '
        raw: Was there any update on this? Did you manage to reproduce the results?
        updatedAt: '2022-07-29T09:59:50.184Z'
      numEdits: 0
      reactions: []
    id: 62e3af960c2a907c388e1e9b
    type: comment
  author: gsidiro
  content: Was there any update on this? Did you manage to reproduce the results?
  created_at: 2022-07-29 08:59:50+00:00
  edited: false
  hidden: false
  id: 62e3af960c2a907c388e1e9b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/57e8309c096e775d1e3491ad733ca285.svg
      fullname: fernangdes
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: clive777
      type: user
    createdAt: '2022-08-17T04:20:15.000Z'
    data:
      edited: false
      editors:
      - clive777
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/57e8309c096e775d1e3491ad733ca285.svg
          fullname: fernangdes
          isHf: false
          isPro: false
          name: clive777
          type: user
        html: '<p>no</p>

          '
        raw: 'no'
        updatedAt: '2022-08-17T04:20:15.823Z'
      numEdits: 0
      reactions: []
    id: 62fc6c7ff60cc3ae0740d7de
    type: comment
  author: clive777
  content: 'no'
  created_at: 2022-08-17 03:20:15+00:00
  edited: false
  hidden: false
  id: 62fc6c7ff60cc3ae0740d7de
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 2
repo_id: dslim/bert-base-NER
repo_type: model
status: open
target_branch: null
title: Unable to produce the same Eval and Test Results
