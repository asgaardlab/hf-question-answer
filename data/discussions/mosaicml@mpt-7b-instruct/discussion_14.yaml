!!python/object:huggingface_hub.community.DiscussionWithDetails
author: FriendlyVisage
conflicting_files: null
created_at: 2023-05-10 18:26:22+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0c9e354ce5414bced11d5abf4bd26d27.svg
      fullname: Friendly Visage
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: FriendlyVisage
      type: user
    createdAt: '2023-05-10T19:26:22.000Z'
    data:
      edited: false
      editors:
      - FriendlyVisage
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0c9e354ce5414bced11d5abf4bd26d27.svg
          fullname: Friendly Visage
          isHf: false
          isPro: false
          name: FriendlyVisage
          type: user
        html: '<p>Finally got a working colab. However, I''m getting duplicated answers.
          For example:</p>

          <pre><code>generate(""""

          Below is an instruction that describes a task. Write a response that appropriately
          completes the request.


          ### Instruction:

          Who was the first president of the United States?



          ### Response:""")

          </code></pre>

          <p>It will respond with:</p>

          <pre><code>George Washington.

          &lt;|endoftext|&gt;

          George Washington.

          &lt;|endoftext|&gt;

          </code></pre>

          <p>Is that expected, and if so, what is the right way to handle it? I could
          just keep everything that appears before the first &lt;|endoftext|&gt; marker,
          but that seems like a bit of a hack.</p>

          '
        raw: "Finally got a working colab. However, I'm getting duplicated answers.\
          \ For example:\r\n```\r\ngenerate(\"\"\"\"\r\nBelow is an instruction that\
          \ describes a task. Write a response that appropriately completes the request.\r\
          \n\r\n### Instruction:\r\nWho was the first president of the United States?\r\
          \n\r\n\r\n### Response:\"\"\")\r\n```\r\nIt will respond with:\r\n```\r\n\
          George Washington.\r\n<|endoftext|>\r\nGeorge Washington.\r\n<|endoftext|>\r\
          \n```\r\n\r\nIs that expected, and if so, what is the right way to handle\
          \ it? I could just keep everything that appears before the first <|endoftext|>\
          \ marker, but that seems like a bit of a hack."
        updatedAt: '2023-05-10T19:26:22.248Z'
      numEdits: 0
      reactions: []
    id: 645befde9522edfc8e51766d
    type: comment
  author: FriendlyVisage
  content: "Finally got a working colab. However, I'm getting duplicated answers.\
    \ For example:\r\n```\r\ngenerate(\"\"\"\"\r\nBelow is an instruction that describes\
    \ a task. Write a response that appropriately completes the request.\r\n\r\n###\
    \ Instruction:\r\nWho was the first president of the United States?\r\n\r\n\r\n\
    ### Response:\"\"\")\r\n```\r\nIt will respond with:\r\n```\r\nGeorge Washington.\r\
    \n<|endoftext|>\r\nGeorge Washington.\r\n<|endoftext|>\r\n```\r\n\r\nIs that expected,\
    \ and if so, what is the right way to handle it? I could just keep everything\
    \ that appears before the first <|endoftext|> marker, but that seems like a bit\
    \ of a hack."
  created_at: 2023-05-10 18:26:22+00:00
  edited: false
  hidden: false
  id: 645befde9522edfc8e51766d
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0c9e354ce5414bced11d5abf4bd26d27.svg
      fullname: Friendly Visage
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: FriendlyVisage
      type: user
    createdAt: '2023-05-10T19:52:24.000Z'
    data:
      edited: false
      editors:
      - FriendlyVisage
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0c9e354ce5414bced11d5abf4bd26d27.svg
          fullname: Friendly Visage
          isHf: false
          isPro: false
          name: FriendlyVisage
          type: user
        html: '<p>Never mind. I was printing it twice.</p>

          '
        raw: Never mind. I was printing it twice.
        updatedAt: '2023-05-10T19:52:24.913Z'
      numEdits: 0
      reactions: []
      relatedEventId: 645bf5f88bbb8592d91ac7c6
    id: 645bf5f88bbb8592d91ac7c5
    type: comment
  author: FriendlyVisage
  content: Never mind. I was printing it twice.
  created_at: 2023-05-10 18:52:24+00:00
  edited: false
  hidden: false
  id: 645bf5f88bbb8592d91ac7c5
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/0c9e354ce5414bced11d5abf4bd26d27.svg
      fullname: Friendly Visage
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: FriendlyVisage
      type: user
    createdAt: '2023-05-10T19:52:24.000Z'
    data:
      status: closed
    id: 645bf5f88bbb8592d91ac7c6
    type: status-change
  author: FriendlyVisage
  created_at: 2023-05-10 18:52:24+00:00
  id: 645bf5f88bbb8592d91ac7c6
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63ba46aa0a9866b28cb19a14/5LilSOacmZeRRIIfimi7s.png?w=200&h=200&f=face
      fullname: Souvik Datta
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: souvik0306
      type: user
    createdAt: '2023-05-19T13:52:17.000Z'
    data:
      edited: false
      editors:
      - souvik0306
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63ba46aa0a9866b28cb19a14/5LilSOacmZeRRIIfimi7s.png?w=200&h=200&f=face
          fullname: Souvik Datta
          isHf: false
          isPro: false
          name: souvik0306
          type: user
        html: '<blockquote>

          <p>Finally got a working colab. However, I''m getting duplicated answers.
          For example:</p>

          <pre><code>generate(""""

          Below is an instruction that describes a task. Write a response that appropriately
          completes the request.


          ### Instruction:

          Who was the first president of the United States?



          ### Response:""")

          </code></pre>

          <p>It will respond with:</p>

          <pre><code>George Washington.

          &lt;|endoftext|&gt;

          George Washington.

          &lt;|endoftext|&gt;

          </code></pre>

          <p>Is that expected, and if so, what is the right way to handle it? I could
          just keep everything that appears before the first &lt;|endoftext|&gt; marker,
          but that seems like a bit of a hack.</p>

          </blockquote>

          <p>Hi, I was trying to build a Colab Implementation and was running into
          errors, can you please share your Notebook?</p>

          '
        raw: "> Finally got a working colab. However, I'm getting duplicated answers.\
          \ For example:\n> ```\n> generate(\"\"\"\"\n> Below is an instruction that\
          \ describes a task. Write a response that appropriately completes the request.\n\
          > \n> ### Instruction:\n> Who was the first president of the United States?\n\
          > \n> \n> ### Response:\"\"\")\n> ```\n> It will respond with:\n> ```\n\
          > George Washington.\n> <|endoftext|>\n> George Washington.\n> <|endoftext|>\n\
          > ```\n> \n> Is that expected, and if so, what is the right way to handle\
          \ it? I could just keep everything that appears before the first <|endoftext|>\
          \ marker, but that seems like a bit of a hack.\n\nHi, I was trying to build\
          \ a Colab Implementation and was running into errors, can you please share\
          \ your Notebook?"
        updatedAt: '2023-05-19T13:52:17.962Z'
      numEdits: 0
      reactions: []
    id: 64677f11a48c2b6f0d611626
    type: comment
  author: souvik0306
  content: "> Finally got a working colab. However, I'm getting duplicated answers.\
    \ For example:\n> ```\n> generate(\"\"\"\"\n> Below is an instruction that describes\
    \ a task. Write a response that appropriately completes the request.\n> \n> ###\
    \ Instruction:\n> Who was the first president of the United States?\n> \n> \n\
    > ### Response:\"\"\")\n> ```\n> It will respond with:\n> ```\n> George Washington.\n\
    > <|endoftext|>\n> George Washington.\n> <|endoftext|>\n> ```\n> \n> Is that expected,\
    \ and if so, what is the right way to handle it? I could just keep everything\
    \ that appears before the first <|endoftext|> marker, but that seems like a bit\
    \ of a hack.\n\nHi, I was trying to build a Colab Implementation and was running\
    \ into errors, can you please share your Notebook?"
  created_at: 2023-05-19 12:52:17+00:00
  edited: false
  hidden: false
  id: 64677f11a48c2b6f0d611626
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0c9e354ce5414bced11d5abf4bd26d27.svg
      fullname: Friendly Visage
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: FriendlyVisage
      type: user
    createdAt: '2023-05-19T19:27:36.000Z'
    data:
      edited: false
      editors:
      - FriendlyVisage
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0c9e354ce5414bced11d5abf4bd26d27.svg
          fullname: Friendly Visage
          isHf: false
          isPro: false
          name: FriendlyVisage
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;souvik0306&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/souvik0306\">@<span class=\"\
          underline\">souvik0306</span></a></span>\n\n\t</span></span> Here is a youtube\
          \ video about using it and he has a link to his colab in the description,\
          \ which is much better than my cobbled together crap. A couple things. The\
          \ triton/flash attention takes a long time to build and for some reason,\
          \ loading the model into memory is super slow. </p>\n<p><a rel=\"nofollow\"\
          \ href=\"https://www.youtube.com/watch?v=DXpk9K7DgMo&amp;t=950s\">https://www.youtube.com/watch?v=DXpk9K7DgMo&amp;t=950s</a></p>\n"
        raw: "@souvik0306 Here is a youtube video about using it and he has a link\
          \ to his colab in the description, which is much better than my cobbled\
          \ together crap. A couple things. The triton/flash attention takes a long\
          \ time to build and for some reason, loading the model into memory is super\
          \ slow. \n\nhttps://www.youtube.com/watch?v=DXpk9K7DgMo&t=950s"
        updatedAt: '2023-05-19T19:27:36.964Z'
      numEdits: 0
      reactions: []
    id: 6467cda8ab75d9cb3c4c7d4d
    type: comment
  author: FriendlyVisage
  content: "@souvik0306 Here is a youtube video about using it and he has a link to\
    \ his colab in the description, which is much better than my cobbled together\
    \ crap. A couple things. The triton/flash attention takes a long time to build\
    \ and for some reason, loading the model into memory is super slow. \n\nhttps://www.youtube.com/watch?v=DXpk9K7DgMo&t=950s"
  created_at: 2023-05-19 18:27:36+00:00
  edited: false
  hidden: false
  id: 6467cda8ab75d9cb3c4c7d4d
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0c9e354ce5414bced11d5abf4bd26d27.svg
      fullname: Friendly Visage
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: FriendlyVisage
      type: user
    createdAt: '2023-05-20T16:14:03.000Z'
    data:
      edited: false
      editors:
      - FriendlyVisage
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0c9e354ce5414bced11d5abf4bd26d27.svg
          fullname: Friendly Visage
          isHf: false
          isPro: false
          name: FriendlyVisage
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;souvik0306&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/souvik0306\">@<span class=\"\
          underline\">souvik0306</span></a></span>\n\n\t</span></span>  I found a\
          \ colab that works better for MPT 7B Instruct. I had to modify it a little.\
          \ I put it in a git repo here: <a rel=\"nofollow\" href=\"https://github.com/curtisshipley/llm-info\"\
          >https://github.com/curtisshipley/llm-info</a></p>\n"
        raw: '@souvik0306  I found a colab that works better for MPT 7B Instruct.
          I had to modify it a little. I put it in a git repo here: https://github.com/curtisshipley/llm-info'
        updatedAt: '2023-05-20T16:14:03.242Z'
      numEdits: 0
      reactions: []
    id: 6468f1cb511e5cdeb0e94073
    type: comment
  author: FriendlyVisage
  content: '@souvik0306  I found a colab that works better for MPT 7B Instruct. I
    had to modify it a little. I put it in a git repo here: https://github.com/curtisshipley/llm-info'
  created_at: 2023-05-20 15:14:03+00:00
  edited: false
  hidden: false
  id: 6468f1cb511e5cdeb0e94073
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63ba46aa0a9866b28cb19a14/5LilSOacmZeRRIIfimi7s.png?w=200&h=200&f=face
      fullname: Souvik Datta
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: souvik0306
      type: user
    createdAt: '2023-05-21T03:43:20.000Z'
    data:
      edited: false
      editors:
      - souvik0306
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/63ba46aa0a9866b28cb19a14/5LilSOacmZeRRIIfimi7s.png?w=200&h=200&f=face
          fullname: Souvik Datta
          isHf: false
          isPro: false
          name: souvik0306
          type: user
        html: "<p>I followed your colab notebook and it worked fine till the point\
          \ I tried to load the model -</p>\n<pre><code># Initialize the model and\
          \ tokenizer\ngenerate = InstructionTextGenerationPipeline(\n    \"mosaicml/mpt-7b-instruct\"\
          ,\n    torch_dtype=torch.bfloat16,\n    trust_remote_code=True,\n)\nstop_token_ids\
          \ = generate.tokenizer.convert_tokens_to_ids([\"&lt;|endoftext|&gt;\"])\n\
          \n\n# Define a custom stopping criteria\nclass StopOnTokens(StoppingCriteria):\n\
          \    def __call__(self, input_ids: torch.LongTensor, scores: torch.FloatTensor,\
          \ **kwargs) -&gt; bool:\n        for stop_id in stop_token_ids:\n      \
          \      if input_ids[0][-1] == stop_id:\n                return True\n  \
          \      return False\n</code></pre>\n<p>To mention I tried to execute this\
          \ on the Free Version of Colab as well as on a Linux system with -<br>RAM\
          \ - 24 GB<br>NVIDIA GeForce RTX 4090<br>PyTorch Cuda 11.7</p>\n"
        raw: "I followed your colab notebook and it worked fine till the point I tried\
          \ to load the model -\n```\n# Initialize the model and tokenizer\ngenerate\
          \ = InstructionTextGenerationPipeline(\n    \"mosaicml/mpt-7b-instruct\"\
          ,\n    torch_dtype=torch.bfloat16,\n    trust_remote_code=True,\n)\nstop_token_ids\
          \ = generate.tokenizer.convert_tokens_to_ids([\"<|endoftext|>\"])\n\n\n\
          # Define a custom stopping criteria\nclass StopOnTokens(StoppingCriteria):\n\
          \    def __call__(self, input_ids: torch.LongTensor, scores: torch.FloatTensor,\
          \ **kwargs) -> bool:\n        for stop_id in stop_token_ids:\n         \
          \   if input_ids[0][-1] == stop_id:\n                return True\n     \
          \   return False\n```\nTo mention I tried to execute this on the Free Version\
          \ of Colab as well as on a Linux system with -\nRAM - 24 GB\nNVIDIA GeForce\
          \ RTX 4090\nPyTorch Cuda 11.7"
        updatedAt: '2023-05-21T03:43:20.565Z'
      numEdits: 0
      reactions: []
    id: 6469935897ffc33d43d25579
    type: comment
  author: souvik0306
  content: "I followed your colab notebook and it worked fine till the point I tried\
    \ to load the model -\n```\n# Initialize the model and tokenizer\ngenerate = InstructionTextGenerationPipeline(\n\
    \    \"mosaicml/mpt-7b-instruct\",\n    torch_dtype=torch.bfloat16,\n    trust_remote_code=True,\n\
    )\nstop_token_ids = generate.tokenizer.convert_tokens_to_ids([\"<|endoftext|>\"\
    ])\n\n\n# Define a custom stopping criteria\nclass StopOnTokens(StoppingCriteria):\n\
    \    def __call__(self, input_ids: torch.LongTensor, scores: torch.FloatTensor,\
    \ **kwargs) -> bool:\n        for stop_id in stop_token_ids:\n            if input_ids[0][-1]\
    \ == stop_id:\n                return True\n        return False\n```\nTo mention\
    \ I tried to execute this on the Free Version of Colab as well as on a Linux system\
    \ with -\nRAM - 24 GB\nNVIDIA GeForce RTX 4090\nPyTorch Cuda 11.7"
  created_at: 2023-05-21 02:43:20+00:00
  edited: false
  hidden: false
  id: 6469935897ffc33d43d25579
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0c9e354ce5414bced11d5abf4bd26d27.svg
      fullname: Friendly Visage
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: FriendlyVisage
      type: user
    createdAt: '2023-05-21T15:09:16.000Z'
    data:
      edited: false
      editors:
      - FriendlyVisage
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0c9e354ce5414bced11d5abf4bd26d27.svg
          fullname: Friendly Visage
          isHf: false
          isPro: false
          name: FriendlyVisage
          type: user
        html: '<p>It''s hard to say what the problem is, without seeing the exact
          error. I have colab pro, and tested it on an A100.</p>

          '
        raw: It's hard to say what the problem is, without seeing the exact error.
          I have colab pro, and tested it on an A100.
        updatedAt: '2023-05-21T15:09:16.540Z'
      numEdits: 0
      reactions: []
    id: 646a341c3721aab2edf46ce6
    type: comment
  author: FriendlyVisage
  content: It's hard to say what the problem is, without seeing the exact error. I
    have colab pro, and tested it on an A100.
  created_at: 2023-05-21 14:09:16+00:00
  edited: false
  hidden: false
  id: 646a341c3721aab2edf46ce6
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 14
repo_id: mosaicml/mpt-7b-instruct
repo_type: model
status: closed
target_branch: null
title: Duplicated responses and <|endoftext|> markers.
