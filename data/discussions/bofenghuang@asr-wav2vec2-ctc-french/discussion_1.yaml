!!python/object:huggingface_hub.community.DiscussionWithDetails
author: qwertyuu
conflicting_files: null
created_at: 2023-03-15 01:36:49+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/56e35b10efeddf3133efd7e90b29f69b.svg
      fullname: Raphael Cote
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: qwertyuu
      type: user
    createdAt: '2023-03-15T02:36:49.000Z'
    data:
      edited: false
      editors:
      - qwertyuu
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/56e35b10efeddf3133efd7e90b29f69b.svg
          fullname: Raphael Cote
          isHf: false
          isPro: false
          name: qwertyuu
          type: user
        html: '<p>Hello!<br>Thanks for taking time to make this model. I''m trying
          to use it on my PC (windows 10 on WSL, torch 1.13)</p>

          <p>At line 25 where model is called, I get <code>RuntimeError: Expected
          2D (unbatched) or 3D (batched) input to conv1d, but got input of size: [1,
          1, 2, 63169]</code></p>

          <p>I was loading my own .wav on my disk</p>

          '
        raw: "Hello!\r\nThanks for taking time to make this model. I'm trying to use\
          \ it on my PC (windows 10 on WSL, torch 1.13)\r\n\r\nAt line 25 where model\
          \ is called, I get `RuntimeError: Expected 2D (unbatched) or 3D (batched)\
          \ input to conv1d, but got input of size: [1, 1, 2, 63169]`\r\n\r\nI was\
          \ loading my own .wav on my disk"
        updatedAt: '2023-03-15T02:36:49.123Z'
      numEdits: 0
      reactions: []
    id: 64112f41a8d20679261f18cd
    type: comment
  author: qwertyuu
  content: "Hello!\r\nThanks for taking time to make this model. I'm trying to use\
    \ it on my PC (windows 10 on WSL, torch 1.13)\r\n\r\nAt line 25 where model is\
    \ called, I get `RuntimeError: Expected 2D (unbatched) or 3D (batched) input to\
    \ conv1d, but got input of size: [1, 1, 2, 63169]`\r\n\r\nI was loading my own\
    \ .wav on my disk"
  created_at: 2023-03-15 01:36:49+00:00
  edited: false
  hidden: false
  id: 64112f41a8d20679261f18cd
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/ea3c8a9f178dfc1df3f75d71ecbe39dd.svg
      fullname: bofeng huang
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: bofenghuang
      type: user
    createdAt: '2023-03-15T09:20:24.000Z'
    data:
      edited: false
      editors:
      - bofenghuang
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/ea3c8a9f178dfc1df3f75d71ecbe39dd.svg
          fullname: bofeng huang
          isHf: false
          isPro: false
          name: bofenghuang
          type: user
        html: '<p>Hi!</p>

          <p>Thanks for your interest!</p>

          <p>Could you maybe share a colab notebook with the audio file you are using?
          It''ll be easier to debug</p>

          '
        raw: 'Hi!


          Thanks for your interest!


          Could you maybe share a colab notebook with the audio file you are using?
          It''ll be easier to debug'
        updatedAt: '2023-03-15T09:20:24.441Z'
      numEdits: 0
      reactions: []
    id: 64118dd8ad9ec2183fc0a109
    type: comment
  author: bofenghuang
  content: 'Hi!


    Thanks for your interest!


    Could you maybe share a colab notebook with the audio file you are using? It''ll
    be easier to debug'
  created_at: 2023-03-15 08:20:24+00:00
  edited: false
  hidden: false
  id: 64118dd8ad9ec2183fc0a109
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/c294572cd27e4a947a21a6edec6e1717.svg
      fullname: Marine Prost
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Abaddon
      type: user
    createdAt: '2023-04-07T13:44:00.000Z'
    data:
      edited: true
      editors:
      - Abaddon
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/c294572cd27e4a947a21a6edec6e1717.svg
          fullname: Marine Prost
          isHf: false
          isPro: false
          name: Abaddon
          type: user
        html: '<p>Hi, </p>

          <p>I''m getting the same issue.<br>Here''s a link of the google collab <a
          rel="nofollow" href="https://colab.research.google.com/drive/1JNQMxiPueSfX9eIM52dPmuCkbNPLEszK?usp=sharing">https://colab.research.google.com/drive/1JNQMxiPueSfX9eIM52dPmuCkbNPLEszK?usp=sharing</a></p>

          <p>I''m not very familiar with GC, so I''m not sure if the uploaded content
          is available to other people. Just in case, attached is the audio file I''m
          working with</p>

          <p><audio src="https://cdn-uploads.huggingface.co/production/uploads/60c0e98bf6cf4127c1930793/Imk7lHS4HKn-1H33daOhX.wav"
          controls=""></audio></p>

          '
        raw: "Hi, \n\nI'm getting the same issue. \nHere's a link of the google collab\
          \ https://colab.research.google.com/drive/1JNQMxiPueSfX9eIM52dPmuCkbNPLEszK?usp=sharing\n\
          \nI'm not very familiar with GC, so I'm not sure if the uploaded content\
          \ is available to other people. Just in case, attached is the audio file\
          \ I'm working with\n\n<audio controls src=\"https://cdn-uploads.huggingface.co/production/uploads/60c0e98bf6cf4127c1930793/Imk7lHS4HKn-1H33daOhX.wav\"\
          ></audio>"
        updatedAt: '2023-04-07T14:09:56.067Z'
      numEdits: 1
      reactions:
      - count: 1
        reaction: "\u2764\uFE0F"
        users:
        - bofenghuang
    id: 64301e20ec768944a8beb451
    type: comment
  author: Abaddon
  content: "Hi, \n\nI'm getting the same issue. \nHere's a link of the google collab\
    \ https://colab.research.google.com/drive/1JNQMxiPueSfX9eIM52dPmuCkbNPLEszK?usp=sharing\n\
    \nI'm not very familiar with GC, so I'm not sure if the uploaded content is available\
    \ to other people. Just in case, attached is the audio file I'm working with\n\
    \n<audio controls src=\"https://cdn-uploads.huggingface.co/production/uploads/60c0e98bf6cf4127c1930793/Imk7lHS4HKn-1H33daOhX.wav\"\
    ></audio>"
  created_at: 2023-04-07 12:44:00+00:00
  edited: true
  hidden: false
  id: 64301e20ec768944a8beb451
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/ea3c8a9f178dfc1df3f75d71ecbe39dd.svg
      fullname: bofeng huang
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: bofenghuang
      type: user
    createdAt: '2023-04-17T08:46:59.000Z'
    data:
      edited: false
      editors:
      - bofenghuang
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/ea3c8a9f178dfc1df3f75d71ecbe39dd.svg
          fullname: bofeng huang
          isHf: false
          isPro: false
          name: bofenghuang
          type: user
        html: "<p>Hi <span data-props=\"{&quot;user&quot;:&quot;Abaddon&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/Abaddon\">@<span class=\"\
          underline\">Abaddon</span></a></span>\n\n\t</span></span>,</p>\n<p>Thank\
          \ you for your feedback and the provided notebook!</p>\n<p>I've reproduced\
          \ the error. In fact, when the input audio has multiple channels, we have\
          \ to convert it to mono before passing it to the wav2vec model.</p>\n<p>Please\
          \ try with the following updated code :)</p>\n<pre><code class=\"language-python\"\
          ><span class=\"hljs-keyword\">import</span> torch\n<span class=\"hljs-keyword\"\
          >import</span> torchaudio\n<span class=\"hljs-keyword\">import</span> torchaudio.sox_effects\
          \ <span class=\"hljs-keyword\">as</span> ta_sox\n\n<span class=\"hljs-keyword\"\
          >from</span> transformers <span class=\"hljs-keyword\">import</span> AutoModelForCTC,\
          \ Wav2Vec2Processor\n\ndevice = torch.device(<span class=\"hljs-string\"\
          >\"cuda:0\"</span> <span class=\"hljs-keyword\">if</span> torch.cuda.is_available()\
          \ <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">\"\
          cpu\"</span>)\n\nmodel = AutoModelForCTC.from_pretrained(<span class=\"\
          hljs-string\">\"bhuang/asr-wav2vec2-french\"</span>).to(device)\nprocessor\
          \ = Wav2Vec2Processor.from_pretrained(<span class=\"hljs-string\">\"bhuang/asr-wav2vec2-french\"\
          </span>)\nmodel_sample_rate = processor.feature_extractor.sampling_rate\n\
          \naudio_path = <span class=\"hljs-string\">\"example.wav\"</span>  <span\
          \ class=\"hljs-comment\"># path to your audio file</span>\nwaveform, sample_rate\
          \ = torchaudio.load(audio_path)\n\neffects = []\n<span class=\"hljs-keyword\"\
          >if</span> model_sample_rate != sample_rate:\n    <span class=\"hljs-comment\"\
          ># resample</span>\n    effects.append([<span class=\"hljs-string\">\"rate\"\
          </span>, <span class=\"hljs-string\">f\"<span class=\"hljs-subst\">{model_sample_rate}</span>\"\
          </span>])\n<span class=\"hljs-keyword\">if</span> waveform.shape[<span class=\"\
          hljs-number\">0</span>] &gt; <span class=\"hljs-number\">1</span>:\n   \
          \ <span class=\"hljs-comment\"># convert to mono</span>\n    effects.append([<span\
          \ class=\"hljs-string\">\"channels\"</span>, <span class=\"hljs-string\"\
          >\"1\"</span>])\n<span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\"\
          >len</span>(effects) &gt; <span class=\"hljs-number\">0</span>:\n    converted_waveform,\
          \ _ = ta_sox.apply_effects_tensor(waveform, sample_rate, effects)\n\n<span\
          \ class=\"hljs-comment\"># 1d array</span>\nconverted_waveform = converted_waveform.squeeze(axis=<span\
          \ class=\"hljs-number\">0</span>)\n\n<span class=\"hljs-comment\"># normalize</span>\n\
          input_dict = processor(converted_waveform, sampling_rate=model_sample_rate,\
          \ return_tensors=<span class=\"hljs-string\">\"pt\"</span>)\n\n<span class=\"\
          hljs-keyword\">with</span> torch.inference_mode():\n    <span class=\"hljs-comment\"\
          ># forward</span>\n    logits = model(input_dict.input_values.to(device)).logits\n\
          \n<span class=\"hljs-comment\"># decode</span>\npredicted_ids = torch.argmax(logits,\
          \ dim=-<span class=\"hljs-number\">1</span>)\npredicted_sentence = processor.batch_decode(predicted_ids)[<span\
          \ class=\"hljs-number\">0</span>]\n</code></pre>\n"
        raw: "Hi @Abaddon,\n\nThank you for your feedback and the provided notebook!\n\
          \nI've reproduced the error. In fact, when the input audio has multiple\
          \ channels, we have to convert it to mono before passing it to the wav2vec\
          \ model.\n\nPlease try with the following updated code :)\n\n```python\n\
          import torch\nimport torchaudio\nimport torchaudio.sox_effects as ta_sox\n\
          \nfrom transformers import AutoModelForCTC, Wav2Vec2Processor\n\ndevice\
          \ = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\")\n\
          \nmodel = AutoModelForCTC.from_pretrained(\"bhuang/asr-wav2vec2-french\"\
          ).to(device)\nprocessor = Wav2Vec2Processor.from_pretrained(\"bhuang/asr-wav2vec2-french\"\
          )\nmodel_sample_rate = processor.feature_extractor.sampling_rate\n\naudio_path\
          \ = \"example.wav\"  # path to your audio file\nwaveform, sample_rate =\
          \ torchaudio.load(audio_path)\n\neffects = []\nif model_sample_rate != sample_rate:\n\
          \    # resample\n    effects.append([\"rate\", f\"{model_sample_rate}\"\
          ])\nif waveform.shape[0] > 1:\n    # convert to mono\n    effects.append([\"\
          channels\", \"1\"])\nif len(effects) > 0:\n    converted_waveform, _ = ta_sox.apply_effects_tensor(waveform,\
          \ sample_rate, effects)\n\n# 1d array\nconverted_waveform = converted_waveform.squeeze(axis=0)\n\
          \n# normalize\ninput_dict = processor(converted_waveform, sampling_rate=model_sample_rate,\
          \ return_tensors=\"pt\")\n\nwith torch.inference_mode():\n    # forward\n\
          \    logits = model(input_dict.input_values.to(device)).logits\n\n# decode\n\
          predicted_ids = torch.argmax(logits, dim=-1)\npredicted_sentence = processor.batch_decode(predicted_ids)[0]\n\
          ```"
        updatedAt: '2023-04-17T08:46:59.703Z'
      numEdits: 0
      reactions: []
    id: 643d07831c29e1386bb74c0d
    type: comment
  author: bofenghuang
  content: "Hi @Abaddon,\n\nThank you for your feedback and the provided notebook!\n\
    \nI've reproduced the error. In fact, when the input audio has multiple channels,\
    \ we have to convert it to mono before passing it to the wav2vec model.\n\nPlease\
    \ try with the following updated code :)\n\n```python\nimport torch\nimport torchaudio\n\
    import torchaudio.sox_effects as ta_sox\n\nfrom transformers import AutoModelForCTC,\
    \ Wav2Vec2Processor\n\ndevice = torch.device(\"cuda:0\" if torch.cuda.is_available()\
    \ else \"cpu\")\n\nmodel = AutoModelForCTC.from_pretrained(\"bhuang/asr-wav2vec2-french\"\
    ).to(device)\nprocessor = Wav2Vec2Processor.from_pretrained(\"bhuang/asr-wav2vec2-french\"\
    )\nmodel_sample_rate = processor.feature_extractor.sampling_rate\n\naudio_path\
    \ = \"example.wav\"  # path to your audio file\nwaveform, sample_rate = torchaudio.load(audio_path)\n\
    \neffects = []\nif model_sample_rate != sample_rate:\n    # resample\n    effects.append([\"\
    rate\", f\"{model_sample_rate}\"])\nif waveform.shape[0] > 1:\n    # convert to\
    \ mono\n    effects.append([\"channels\", \"1\"])\nif len(effects) > 0:\n    converted_waveform,\
    \ _ = ta_sox.apply_effects_tensor(waveform, sample_rate, effects)\n\n# 1d array\n\
    converted_waveform = converted_waveform.squeeze(axis=0)\n\n# normalize\ninput_dict\
    \ = processor(converted_waveform, sampling_rate=model_sample_rate, return_tensors=\"\
    pt\")\n\nwith torch.inference_mode():\n    # forward\n    logits = model(input_dict.input_values.to(device)).logits\n\
    \n# decode\npredicted_ids = torch.argmax(logits, dim=-1)\npredicted_sentence =\
    \ processor.batch_decode(predicted_ids)[0]\n```"
  created_at: 2023-04-17 07:46:59+00:00
  edited: false
  hidden: false
  id: 643d07831c29e1386bb74c0d
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/c294572cd27e4a947a21a6edec6e1717.svg
      fullname: Marine Prost
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Abaddon
      type: user
    createdAt: '2023-04-25T12:57:36.000Z'
    data:
      edited: true
      editors:
      - Abaddon
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/c294572cd27e4a947a21a6edec6e1717.svg
          fullname: Marine Prost
          isHf: false
          isPro: false
          name: Abaddon
          type: user
        html: "<p>Hi, </p>\n<p>Thank you so much for taking to time to look into this\
          \ <span data-props=\"{&quot;user&quot;:&quot;bofenghuang&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/bofenghuang\">@<span\
          \ class=\"underline\">bofenghuang</span></a></span>\n\n\t</span></span>.<br>It\
          \ works on the google collab!<br>Sadly it doesn't work locally: pytorch\
          \ audio (especially libsox) doesn't seem to be having a hard time with Windows.\
          \ </p>\n<p>EDIT: I added another way to resolve this by loading with librosa\
          \ directly into a 16kHz mono, so no problem for me anymore. It is on the\
          \ collab if anyone has the same issue!</p>\n"
        raw: "Hi, \n\nThank you so much for taking to time to look into this @bofenghuang.\
          \ \nIt works on the google collab! \nSadly it doesn't work locally: pytorch\
          \ audio (especially libsox) doesn't seem to be having a hard time with Windows.\
          \ \n\nEDIT: I added another way to resolve this by loading with librosa\
          \ directly into a 16kHz mono, so no problem for me anymore. It is on the\
          \ collab if anyone has the same issue!"
        updatedAt: '2023-04-25T13:42:18.053Z'
      numEdits: 2
      reactions:
      - count: 2
        reaction: "\u2764\uFE0F"
        users:
        - bofenghuang
        - kokominot
    id: 6447ce403e498d66918f0e59
    type: comment
  author: Abaddon
  content: "Hi, \n\nThank you so much for taking to time to look into this @bofenghuang.\
    \ \nIt works on the google collab! \nSadly it doesn't work locally: pytorch audio\
    \ (especially libsox) doesn't seem to be having a hard time with Windows. \n\n\
    EDIT: I added another way to resolve this by loading with librosa directly into\
    \ a 16kHz mono, so no problem for me anymore. It is on the collab if anyone has\
    \ the same issue!"
  created_at: 2023-04-25 11:57:36+00:00
  edited: true
  hidden: false
  id: 6447ce403e498d66918f0e59
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/ea3c8a9f178dfc1df3f75d71ecbe39dd.svg
      fullname: bofeng huang
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: bofenghuang
      type: user
    createdAt: '2023-12-19T20:57:43.000Z'
    data:
      status: closed
    id: 658203c741dad8f2f3f6413b
    type: status-change
  author: bofenghuang
  created_at: 2023-12-19 20:57:43+00:00
  id: 658203c741dad8f2f3f6413b
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/56e35b10efeddf3133efd7e90b29f69b.svg
      fullname: Raphael Cote
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: qwertyuu
      type: user
    createdAt: '2023-12-19T22:12:08.000Z'
    data:
      edited: true
      editors:
      - qwertyuu
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9550856351852417
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/56e35b10efeddf3133efd7e90b29f69b.svg
          fullname: Raphael Cote
          isHf: false
          isPro: false
          name: qwertyuu
          type: user
        html: '<p>Hello!<br>I can confirm this fix not only works but has been running
          on my discord bot for a while now. Thanks and sorry for not updating this
          issue earlier!</p>

          <p>Contrary to abaddon, I am using ubuntu which works wonderfully. </p>

          '
        raw: 'Hello!

          I can confirm this fix not only works but has been running on my discord
          bot for a while now. Thanks and sorry for not updating this issue earlier!


          Contrary to abaddon, I am using ubuntu which works wonderfully. '
        updatedAt: '2023-12-19T22:13:12.586Z'
      numEdits: 1
      reactions:
      - count: 1
        reaction: "\u2764\uFE0F"
        users:
        - bofenghuang
    id: 6582153890aa0254b09dc0ee
    type: comment
  author: qwertyuu
  content: 'Hello!

    I can confirm this fix not only works but has been running on my discord bot for
    a while now. Thanks and sorry for not updating this issue earlier!


    Contrary to abaddon, I am using ubuntu which works wonderfully. '
  created_at: 2023-12-19 22:12:08+00:00
  edited: true
  hidden: false
  id: 6582153890aa0254b09dc0ee
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/ea3c8a9f178dfc1df3f75d71ecbe39dd.svg
      fullname: bofeng huang
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: bofenghuang
      type: user
    createdAt: '2023-12-30T14:04:45.000Z'
    data:
      edited: false
      editors:
      - bofenghuang
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9620300531387329
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/ea3c8a9f178dfc1df3f75d71ecbe39dd.svg
          fullname: bofeng huang
          isHf: false
          isPro: false
          name: bofenghuang
          type: user
        html: '<p>That''s awesome !!</p>

          '
        raw: That's awesome !!
        updatedAt: '2023-12-30T14:04:45.530Z'
      numEdits: 0
      reactions: []
    id: 6590237da41c3cbad57cf764
    type: comment
  author: bofenghuang
  content: That's awesome !!
  created_at: 2023-12-30 14:04:45+00:00
  edited: false
  hidden: false
  id: 6590237da41c3cbad57cf764
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: bofenghuang/asr-wav2vec2-ctc-french
repo_type: model
status: closed
target_branch: null
title: 'RuntimeError: Expected 2D (unbatched) or 3D (batched) input to conv1d, but
  got input of size: [1, 1, 2, 63169] using example in readme'
