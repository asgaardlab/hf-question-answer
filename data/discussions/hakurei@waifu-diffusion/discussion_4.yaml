!!python/object:huggingface_hub.community.DiscussionWithDetails
author: skytnt
conflicting_files: null
created_at: 2022-09-09 04:25:40+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1650375870480-noauth.png?w=200&h=200&f=face
      fullname: skytnt
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: skytnt
      type: user
    createdAt: '2022-09-09T05:25:40.000Z'
    data:
      edited: false
      editors:
      - skytnt
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1650375870480-noauth.png?w=200&h=200&f=face
          fullname: skytnt
          isHf: false
          isPro: false
          name: skytnt
          type: user
        html: '<p>Now  diffusers introduce a new (and experimental) Stable Diffusion
          pipeline compatible with the ONNX Runtime. This allows you to run Stable
          Diffusion on any hardware that supports ONNX (including a significant speedup
          on CPUs).</p>

          <p>You can use this script to convert the model: <a rel="nofollow" href="https://github.com/huggingface/diffusers/blob/main/scripts/convert_stable_diffusion_checkpoint_to_onnx.py">https://github.com/huggingface/diffusers/blob/main/scripts/convert_stable_diffusion_checkpoint_to_onnx.py</a></p>

          <p>Refer: <a rel="nofollow" href="https://github.com/huggingface/diffusers/releases/tag/v0.3.0">https://github.com/huggingface/diffusers/releases/tag/v0.3.0</a>.</p>

          '
        raw: "Now  diffusers introduce a new (and experimental) Stable Diffusion pipeline\
          \ compatible with the ONNX Runtime. This allows you to run Stable Diffusion\
          \ on any hardware that supports ONNX (including a significant speedup on\
          \ CPUs).\r\n\r\nYou can use this script to convert the model: https://github.com/huggingface/diffusers/blob/main/scripts/convert_stable_diffusion_checkpoint_to_onnx.py\r\
          \n\r\nRefer: https://github.com/huggingface/diffusers/releases/tag/v0.3.0."
        updatedAt: '2022-09-09T05:25:40.872Z'
      numEdits: 0
      reactions: []
    id: 631ace54a1ed5fb6a4b9095f
    type: comment
  author: skytnt
  content: "Now  diffusers introduce a new (and experimental) Stable Diffusion pipeline\
    \ compatible with the ONNX Runtime. This allows you to run Stable Diffusion on\
    \ any hardware that supports ONNX (including a significant speedup on CPUs).\r\
    \n\r\nYou can use this script to convert the model: https://github.com/huggingface/diffusers/blob/main/scripts/convert_stable_diffusion_checkpoint_to_onnx.py\r\
    \n\r\nRefer: https://github.com/huggingface/diffusers/releases/tag/v0.3.0."
  created_at: 2022-09-09 04:25:40+00:00
  edited: false
  hidden: false
  id: 631ace54a1ed5fb6a4b9095f
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1645138575893-606918bb3959960e820cb47d.jpeg?w=200&h=200&f=face
      fullname: Reimu Hakurei
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: hakurei
      type: user
    createdAt: '2022-09-09T08:16:43.000Z'
    data:
      edited: false
      editors:
      - hakurei
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1645138575893-606918bb3959960e820cb47d.jpeg?w=200&h=200&f=face
          fullname: Reimu Hakurei
          isHf: false
          isPro: false
          name: hakurei
          type: user
        html: '<p>I''ll see if I can convert it and push it to a separate branch</p>

          '
        raw: I'll see if I can convert it and push it to a separate branch
        updatedAt: '2022-09-09T08:16:43.588Z'
      numEdits: 0
      reactions:
      - count: 6
        reaction: "\U0001F917"
        users:
        - Hinga
        - denizkiler
        - BrightFan
        - srbazy
        - huguser96
        - batch42
    id: 631af66bb043abe8c4fccb2a
    type: comment
  author: hakurei
  content: I'll see if I can convert it and push it to a separate branch
  created_at: 2022-09-09 07:16:43+00:00
  edited: false
  hidden: false
  id: 631af66bb043abe8c4fccb2a
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/805bf6bc4bef55cf4ac602000210e037.svg
      fullname: Anon Anon 23
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ponut64
      type: user
    createdAt: '2022-09-16T02:18:47.000Z'
    data:
      edited: false
      editors:
      - ponut64
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/805bf6bc4bef55cf4ac602000210e037.svg
          fullname: Anon Anon 23
          isHf: false
          isPro: false
          name: ponut64
          type: user
        html: '<p>I have tried converting it, but there seems to be a problem with
          the conversion. It is not running; something about onnx expecting a int64
          tensor but the software giving an int32 tensor.</p>

          '
        raw: I have tried converting it, but there seems to be a problem with the
          conversion. It is not running; something about onnx expecting a int64 tensor
          but the software giving an int32 tensor.
        updatedAt: '2022-09-16T02:18:47.031Z'
      numEdits: 0
      reactions: []
    id: 6323dd0770edc53f51cfe31d
    type: comment
  author: ponut64
  content: I have tried converting it, but there seems to be a problem with the conversion.
    It is not running; something about onnx expecting a int64 tensor but the software
    giving an int32 tensor.
  created_at: 2022-09-16 01:18:47+00:00
  edited: false
  hidden: false
  id: 6323dd0770edc53f51cfe31d
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1650375870480-noauth.png?w=200&h=200&f=face
      fullname: skytnt
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: skytnt
      type: user
    createdAt: '2022-09-16T03:08:44.000Z'
    data:
      edited: false
      editors:
      - skytnt
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1650375870480-noauth.png?w=200&h=200&f=face
          fullname: skytnt
          isHf: false
          isPro: false
          name: skytnt
          type: user
        html: "<blockquote>\n<p>I have tried converting it, but there seems to be\
          \ a problem with the conversion. It is not running; something about onnx\
          \ expecting a int64 tensor but the software giving an int32 tensor.</p>\n\
          </blockquote>\n<p>it can be fixed by setting dtype=np.int64 in pipeline_stable_diffusion_onnx.py\
          \ line 133:</p>\n<pre><code class=\"language-python\">noise_pred = self.unet(\n\
          \     sample=latent_model_input, timestep=np.array([t], dtype=np.int64),\
          \ encoder_hidden_states=text_embeddings\n)\n</code></pre>\n<p>I am too busy\
          \ to test again and open an issue or PR in github. You can do that.</p>\n"
        raw: "> I have tried converting it, but there seems to be a problem with the\
          \ conversion. It is not running; something about onnx expecting a int64\
          \ tensor but the software giving an int32 tensor.\n\nit can be fixed by\
          \ setting dtype=np.int64 in pipeline_stable_diffusion_onnx.py line 133:\n\
          \n```python\nnoise_pred = self.unet(\n     sample=latent_model_input, timestep=np.array([t],\
          \ dtype=np.int64), encoder_hidden_states=text_embeddings\n)\n```\n\nI am\
          \ too busy to test again and open an issue or PR in github. You can do that."
        updatedAt: '2022-09-16T03:08:44.142Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - ponut64
    id: 6323e8bc70edc53f51d05eff
    type: comment
  author: skytnt
  content: "> I have tried converting it, but there seems to be a problem with the\
    \ conversion. It is not running; something about onnx expecting a int64 tensor\
    \ but the software giving an int32 tensor.\n\nit can be fixed by setting dtype=np.int64\
    \ in pipeline_stable_diffusion_onnx.py line 133:\n\n```python\nnoise_pred = self.unet(\n\
    \     sample=latent_model_input, timestep=np.array([t], dtype=np.int64), encoder_hidden_states=text_embeddings\n\
    )\n```\n\nI am too busy to test again and open an issue or PR in github. You can\
    \ do that."
  created_at: 2022-09-16 02:08:44+00:00
  edited: false
  hidden: false
  id: 6323e8bc70edc53f51d05eff
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/805bf6bc4bef55cf4ac602000210e037.svg
      fullname: Anon Anon 23
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ponut64
      type: user
    createdAt: '2022-09-16T03:20:19.000Z'
    data:
      edited: true
      editors:
      - ponut64
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/805bf6bc4bef55cf4ac602000210e037.svg
          fullname: Anon Anon 23
          isHf: false
          isPro: false
          name: ponut64
          type: user
        html: '<p>I actually fixed it  JUST NOW another way, but I really appreciate
          the rapid response!<br>Between the <code>model_index.json</code> of waifu-diffusion
          and stable-diffusion (grapped on sept 14th 2022 from <code>CompVis/stable-diffusion-v1-4</code>
          there is only one difference.<br>That is line <a href="/hakurei/waifu-diffusion/discussions/14">#14</a>.<br>In
          waifu-diffusion, as slated on the git, it is <code>   "DDIMScheduler"</code>.<br>In
          stable-diffusion-v1.4 as pulled, it is <code>    "PNDMScheduler"</code>.<br>To
          get it to work for me, I just had to put     "PNDMScheduler" instead of
          "DDIMScheduler".</p>

          <p>It should be noted this is after conversion to onnx running via DirectML
          (AMD hardware acceleration).</p>

          '
        raw: 'I actually fixed it  JUST NOW another way, but I really appreciate the
          rapid response!

          Between the ``model_index.json`` of waifu-diffusion and stable-diffusion
          (grapped on sept 14th 2022 from ``CompVis/stable-diffusion-v1-4`` there
          is only one difference.

          That is line #14.

          In waifu-diffusion, as slated on the git, it is ``    "DDIMScheduler" ``.

          In stable-diffusion-v1.4 as pulled, it is ``     "PNDMScheduler" ``.

          To get it to work for me, I just had to put     "PNDMScheduler" instead
          of "DDIMScheduler".


          It should be noted this is after conversion to onnx running via DirectML
          (AMD hardware acceleration).'
        updatedAt: '2022-09-16T03:21:24.766Z'
      numEdits: 1
      reactions: []
    id: 6323eb73c2d792d382de133b
    type: comment
  author: ponut64
  content: 'I actually fixed it  JUST NOW another way, but I really appreciate the
    rapid response!

    Between the ``model_index.json`` of waifu-diffusion and stable-diffusion (grapped
    on sept 14th 2022 from ``CompVis/stable-diffusion-v1-4`` there is only one difference.

    That is line #14.

    In waifu-diffusion, as slated on the git, it is ``    "DDIMScheduler" ``.

    In stable-diffusion-v1.4 as pulled, it is ``     "PNDMScheduler" ``.

    To get it to work for me, I just had to put     "PNDMScheduler" instead of "DDIMScheduler".


    It should be noted this is after conversion to onnx running via DirectML (AMD
    hardware acceleration).'
  created_at: 2022-09-16 02:20:19+00:00
  edited: true
  hidden: false
  id: 6323eb73c2d792d382de133b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1650375870480-noauth.png?w=200&h=200&f=face
      fullname: skytnt
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: skytnt
      type: user
    createdAt: '2022-09-16T04:04:45.000Z'
    data:
      edited: false
      editors:
      - skytnt
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1650375870480-noauth.png?w=200&h=200&f=face
          fullname: skytnt
          isHf: false
          isPro: false
          name: skytnt
          type: user
        html: '<blockquote>

          <p>I actually fixed it  JUST NOW another way, but I really appreciate the
          rapid response!<br>Between the <code>model_index.json</code> of waifu-diffusion
          and stable-diffusion (grapped on sept 14th 2022 from <code>CompVis/stable-diffusion-v1-4</code>
          there is only one difference.<br>That is line <a href="/hakurei/waifu-diffusion/discussions/14">#14</a>.<br>In
          waifu-diffusion, as slated on the git, it is <code>   "DDIMScheduler"</code>.<br>In
          stable-diffusion-v1.4 as pulled, it is <code>    "PNDMScheduler"</code>.<br>To
          get it to work for me, I just had to put     "PNDMScheduler" instead of
          "DDIMScheduler".</p>

          <p>It should be noted this is after conversion to onnx running via DirectML
          (AMD hardware acceleration).</p>

          </blockquote>

          <p>I see astype(np.int64) in scheduling_pndm.py line 168 but not in other
          schedulers that''s why change to PNDMScheduler can fix it.</p>

          '
        raw: "> I actually fixed it  JUST NOW another way, but I really appreciate\
          \ the rapid response!\n> Between the ``model_index.json`` of waifu-diffusion\
          \ and stable-diffusion (grapped on sept 14th 2022 from ``CompVis/stable-diffusion-v1-4``\
          \ there is only one difference.\n> That is line #14.\n> In waifu-diffusion,\
          \ as slated on the git, it is ``    \"DDIMScheduler\" ``.\n> In stable-diffusion-v1.4\
          \ as pulled, it is ``     \"PNDMScheduler\" ``.\n> To get it to work for\
          \ me, I just had to put     \"PNDMScheduler\" instead of \"DDIMScheduler\"\
          .\n> \n> It should be noted this is after conversion to onnx running via\
          \ DirectML (AMD hardware acceleration).\n\nI see astype(np.int64) in scheduling_pndm.py\
          \ line 168 but not in other schedulers that's why change to PNDMScheduler\
          \ can fix it."
        updatedAt: '2022-09-16T04:04:45.977Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - ponut64
    id: 6323f5ddc2d8cfcd8099b43f
    type: comment
  author: skytnt
  content: "> I actually fixed it  JUST NOW another way, but I really appreciate the\
    \ rapid response!\n> Between the ``model_index.json`` of waifu-diffusion and stable-diffusion\
    \ (grapped on sept 14th 2022 from ``CompVis/stable-diffusion-v1-4`` there is only\
    \ one difference.\n> That is line #14.\n> In waifu-diffusion, as slated on the\
    \ git, it is ``    \"DDIMScheduler\" ``.\n> In stable-diffusion-v1.4 as pulled,\
    \ it is ``     \"PNDMScheduler\" ``.\n> To get it to work for me, I just had to\
    \ put     \"PNDMScheduler\" instead of \"DDIMScheduler\".\n> \n> It should be\
    \ noted this is after conversion to onnx running via DirectML (AMD hardware acceleration).\n\
    \nI see astype(np.int64) in scheduling_pndm.py line 168 but not in other schedulers\
    \ that's why change to PNDMScheduler can fix it."
  created_at: 2022-09-16 03:04:45+00:00
  edited: false
  hidden: false
  id: 6323f5ddc2d8cfcd8099b43f
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/805bf6bc4bef55cf4ac602000210e037.svg
      fullname: Anon Anon 23
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ponut64
      type: user
    createdAt: '2022-09-16T04:16:47.000Z'
    data:
      edited: false
      editors:
      - ponut64
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/805bf6bc4bef55cf4ac602000210e037.svg
          fullname: Anon Anon 23
          isHf: false
          isPro: false
          name: ponut64
          type: user
        html: '<p>Interesting!</p>

          '
        raw: Interesting!
        updatedAt: '2022-09-16T04:16:47.958Z'
      numEdits: 0
      reactions: []
    id: 6323f8af92e07e3ca20a3501
    type: comment
  author: ponut64
  content: Interesting!
  created_at: 2022-09-16 03:16:47+00:00
  edited: false
  hidden: false
  id: 6323f8af92e07e3ca20a3501
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0b13aeb0fe44f06c57477b39d8220206.svg
      fullname: Jasper
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Waghlon
      type: user
    createdAt: '2022-09-24T22:36:00.000Z'
    data:
      edited: false
      editors:
      - Waghlon
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0b13aeb0fe44f06c57477b39d8220206.svg
          fullname: Jasper
          isHf: false
          isPro: false
          name: Waghlon
          type: user
        html: '<p>Bonjour Hakurei and others. Is there any update on this? It''s pretty
          much the last piece I need to get the stack to work.</p>

          '
        raw: Bonjour Hakurei and others. Is there any update on this? It's pretty
          much the last piece I need to get the stack to work.
        updatedAt: '2022-09-24T22:36:00.607Z'
      numEdits: 0
      reactions: []
    id: 632f8650961ceed0882e755f
    type: comment
  author: Waghlon
  content: Bonjour Hakurei and others. Is there any update on this? It's pretty much
    the last piece I need to get the stack to work.
  created_at: 2022-09-24 21:36:00+00:00
  edited: false
  hidden: false
  id: 632f8650961ceed0882e755f
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 4
repo_id: hakurei/waifu-diffusion
repo_type: model
status: open
target_branch: null
title: Add onnx version
