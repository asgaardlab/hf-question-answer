!!python/object:huggingface_hub.community.DiscussionWithDetails
author: aambati
conflicting_files: null
created_at: 2023-07-17 20:26:13+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/27434b7dabcf83cf9f7a9bda1f5c812e.svg
      fullname: An Amb
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: aambati
      type: user
    createdAt: '2023-07-17T21:26:13.000Z'
    data:
      edited: false
      editors:
      - aambati
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.39919522404670715
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/27434b7dabcf83cf9f7a9bda1f5c812e.svg
          fullname: An Amb
          isHf: false
          isPro: false
          name: aambati
          type: user
        html: "<p>Hello,</p>\n<h2 id=\"i-am-trying-to-finetune-the-git-model-on-a-custom-dataset-while-doing-so-i-getting-the-following-error\"\
          >I am trying to finetune the GiT model on a custom dataset. While doing\
          \ so, I getting the following error:</h2>\n<pre><code>AttributeError :Traceback\
          \ (most recent call last)\n&lt;ipython-input-19-0bf9eb119ab0&gt; in &lt;cell\
          \ line: 19&gt;()\n     17 )\n     18 \n---&gt; 19 trainer.train()\n\n/usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py\
          \ in __getattr__(self, name)\n   1612             if name in modules:\n\
          \   1613                 return modules[name]\n-&gt; 1614         raise\
          \ AttributeError(\"'{}' object has no attribute '{}'\".format(\n   1615\
          \             type(self).__name__, name))\n   1616 \n\nAttributeError: 'GitModel'\
          \ object has no attribute 'img_temperal_embedding'\n</code></pre>\n<p><b>I\
          \ am using the following function to update the dataset:</b></p>\n<pre><code>def\
          \ prepare_dataset(example):\n    image = example[\"image\"]\n    example.update(processor(images=image,\
          \ text=example[\"text\"]))\n    return example\n</code></pre>\n<p><b>And\
          \ this is how I am loading the processor and model: </b></p>\n<pre><code>processor\
          \ = GitProcessor.from_pretrained(\"microsoft/git-base-coco\")\nmodel = AutoModelForCausalLM.from_pretrained(\"\
          microsoft/git-base-coco\")\n</code></pre>\n<p><b>And here is the training\
          \ script: </b><br>    metric = evaluate.load(\"accuracy\")</p>\n<pre><code>\
          \ def compute_metrics(eval_pred):\n     logits, labels = eval_pred\n   \
          \  predictions = np.argmax(logits, axis=-1)\n     return metric.compute(predictions=predictions,\
          \ references=labels)\n\ntraining_args = TrainingArguments(output_dir=\"\
          output\",)\n\ntrainer = Trainer(\n    model=model,\n    args=training_args,\n\
          \    train_dataset=data,\n    eval_dataset=data,\n    compute_metrics=compute_metrics,\n\
          )\n\ntrainer.train()\n</code></pre>\n"
        raw: "Hello,\r\n\r\nI am trying to finetune the GiT model on a custom dataset.\
          \ While doing so, I getting the following error:\r\n---------------------------------------------------------------------------\
          \ \r\n    AttributeError :Traceback (most recent call last)\r\n    <ipython-input-19-0bf9eb119ab0>\
          \ in <cell line: 19>()\r\n         17 )\r\n         18 \r\n    ---> 19 trainer.train()\r\
          \n\r\n    /usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py\
          \ in __getattr__(self, name)\r\n       1612             if name in modules:\r\
          \n       1613                 return modules[name]\r\n    -> 1614      \
          \   raise AttributeError(\"'{}' object has no attribute '{}'\".format(\r\
          \n       1615             type(self).__name__, name))\r\n       1616 \r\n\
          \r\n    AttributeError: 'GitModel' object has no attribute 'img_temperal_embedding'\r\
          \n\r\n<b>I am using the following function to update the dataset:</b>\r\n\
          \r\n    def prepare_dataset(example):\r\n        image = example[\"image\"\
          ]\r\n        example.update(processor(images=image, text=example[\"text\"\
          ]))\r\n        return example\r\n\r\n<b>And this is how I am loading the\
          \ processor and model: </b>\r\n\r\n    processor = GitProcessor.from_pretrained(\"\
          microsoft/git-base-coco\")\r\n    model = AutoModelForCausalLM.from_pretrained(\"\
          microsoft/git-base-coco\")\r\n\r\n<b>And here is the training script: </b>\r\
          \n    metric = evaluate.load(\"accuracy\")\r\n\r\n     def compute_metrics(eval_pred):\r\
          \n         logits, labels = eval_pred\r\n         predictions = np.argmax(logits,\
          \ axis=-1)\r\n         return metric.compute(predictions=predictions, references=labels)\r\
          \n\r\n    training_args = TrainingArguments(output_dir=\"output\",)\r\n\r\
          \n    trainer = Trainer(\r\n        model=model,\r\n        args=training_args,\r\
          \n        train_dataset=data,\r\n        eval_dataset=data,\r\n        compute_metrics=compute_metrics,\r\
          \n    )\r\n\r\n    trainer.train()\r\n"
        updatedAt: '2023-07-17T21:26:13.195Z'
      numEdits: 0
      reactions: []
    id: 64b5b1f573b823a2c28da0a6
    type: comment
  author: aambati
  content: "Hello,\r\n\r\nI am trying to finetune the GiT model on a custom dataset.\
    \ While doing so, I getting the following error:\r\n---------------------------------------------------------------------------\
    \ \r\n    AttributeError :Traceback (most recent call last)\r\n    <ipython-input-19-0bf9eb119ab0>\
    \ in <cell line: 19>()\r\n         17 )\r\n         18 \r\n    ---> 19 trainer.train()\r\
    \n\r\n    /usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py in\
    \ __getattr__(self, name)\r\n       1612             if name in modules:\r\n \
    \      1613                 return modules[name]\r\n    -> 1614         raise\
    \ AttributeError(\"'{}' object has no attribute '{}'\".format(\r\n       1615\
    \             type(self).__name__, name))\r\n       1616 \r\n\r\n    AttributeError:\
    \ 'GitModel' object has no attribute 'img_temperal_embedding'\r\n\r\n<b>I am using\
    \ the following function to update the dataset:</b>\r\n\r\n    def prepare_dataset(example):\r\
    \n        image = example[\"image\"]\r\n        example.update(processor(images=image,\
    \ text=example[\"text\"]))\r\n        return example\r\n\r\n<b>And this is how\
    \ I am loading the processor and model: </b>\r\n\r\n    processor = GitProcessor.from_pretrained(\"\
    microsoft/git-base-coco\")\r\n    model = AutoModelForCausalLM.from_pretrained(\"\
    microsoft/git-base-coco\")\r\n\r\n<b>And here is the training script: </b>\r\n\
    \    metric = evaluate.load(\"accuracy\")\r\n\r\n     def compute_metrics(eval_pred):\r\
    \n         logits, labels = eval_pred\r\n         predictions = np.argmax(logits,\
    \ axis=-1)\r\n         return metric.compute(predictions=predictions, references=labels)\r\
    \n\r\n    training_args = TrainingArguments(output_dir=\"output\",)\r\n\r\n  \
    \  trainer = Trainer(\r\n        model=model,\r\n        args=training_args,\r\
    \n        train_dataset=data,\r\n        eval_dataset=data,\r\n        compute_metrics=compute_metrics,\r\
    \n    )\r\n\r\n    trainer.train()\r\n"
  created_at: 2023-07-17 20:26:13+00:00
  edited: false
  hidden: false
  id: 64b5b1f573b823a2c28da0a6
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
      fullname: Niels Rogge
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: nielsr
      type: user
    createdAt: '2023-12-27T13:34:32.000Z'
    data:
      edited: false
      editors:
      - nielsr
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.4534567892551422
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1608042047613-5f1158120c833276f61f1a84.jpeg?w=200&h=200&f=face
          fullname: Niels Rogge
          isHf: true
          isPro: false
          name: nielsr
          type: user
        html: '<p>Hi,</p>

          <p>You should not use the <code>AutoModelForCausalLM</code> class for fine-tuning
          GIT. Rather, use the <code>GitForCausalLM</code> or <code>AutoModelForVision2Seq</code>
          class.</p>

          '
        raw: 'Hi,


          You should not use the `AutoModelForCausalLM` class for fine-tuning GIT.
          Rather, use the `GitForCausalLM` or `AutoModelForVision2Seq` class.'
        updatedAt: '2023-12-27T13:34:32.190Z'
      numEdits: 0
      reactions: []
    id: 658c27e8c5e29d4516a859a8
    type: comment
  author: nielsr
  content: 'Hi,


    You should not use the `AutoModelForCausalLM` class for fine-tuning GIT. Rather,
    use the `GitForCausalLM` or `AutoModelForVision2Seq` class.'
  created_at: 2023-12-27 13:34:32+00:00
  edited: false
  hidden: false
  id: 658c27e8c5e29d4516a859a8
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 3
repo_id: microsoft/git-large-coco
repo_type: model
status: open
target_branch: null
title: Error while fine-tuning GIT on custom dataset
