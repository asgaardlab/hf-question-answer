!!python/object:huggingface_hub.community.DiscussionWithDetails
author: patrickvonplaten
conflicting_files: []
created_at: 2023-06-23 06:41:24+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2023-06-23T07:41:24.000Z'
    data:
      edited: false
      editors:
      - patrickvonplaten
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.11044929921627045
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
          fullname: Patrick von Platen
          isHf: true
          isPro: false
          name: patrickvonplaten
          type: user
        html: ''
        raw: ''
        updatedAt: '2023-06-23T07:41:24.164Z'
      numEdits: 0
      reactions: []
    id: 64954ca441e83ccfef5a035d
    type: comment
  author: patrickvonplaten
  content: ''
  created_at: 2023-06-23 06:41:24+00:00
  edited: false
  hidden: false
  id: 64954ca441e83ccfef5a035d
  type: comment
- !!python/object:huggingface_hub.community.DiscussionCommit
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2023-06-23T07:43:07.000Z'
    data:
      oid: 746a432af71613c43a8cf7bab68b631aa29ffeb8
      parents:
      - 8c7a3583335de4dba1b07182dbf81c75137ce67b
      subject: correct tokenizer
    id: 64954d0b0000000000000000
    type: commit
  author: patrickvonplaten
  created_at: 2023-06-23 06:43:07+00:00
  id: 64954d0b0000000000000000
  oid: 746a432af71613c43a8cf7bab68b631aa29ffeb8
  summary: correct tokenizer
  type: commit
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2023-06-23T07:47:59.000Z'
    data:
      edited: false
      editors:
      - patrickvonplaten
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5086886882781982
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
          fullname: Patrick von Platen
          isHf: true
          isPro: false
          name: patrickvonplaten
          type: user
        html: "<pre><code class=\"language-py\"><span class=\"hljs-keyword\">import</span>\
          \ open_clip\n\ntokenizer = open_clip.get_tokenizer(<span class=\"hljs-string\"\
          >'ViT-bigG-14'</span>)\n\n<span class=\"hljs-built_in\">print</span>(tokenizer(<span\
          \ class=\"hljs-string\">\"hello\"</span>))\n</code></pre>\n<p>gives:</p>\n\
          <pre><code>tensor([[49406,  3306, 49407,     0,     0,     0,     0,   \
          \  0,     0,     0,\n             0,     0,     0,     0,     0,     0,\
          \     0,     0,     0,     0,\n             0,     0,     0,     0,    \
          \ 0,     0,     0,     0,     0,     0,\n             0,     0,     0, \
          \    0,     0,     0,     0,     0,     0,     0,\n             0,     0,\
          \     0,     0,     0,     0,     0,     0,     0,     0,\n            \
          \ 0,     0,     0,     0,     0,     0,     0,     0,     0,     0,\n  \
          \           0,     0,     0,     0,     0,     0,     0,     0,     0, \
          \    0,\n             0,     0,     0,     0,     0,     0,     0]])\n</code></pre>\n\
          <p>which means the padding token should be <code>0</code> not <code>49407</code>.</p>\n\
          <p>This PR corrects the Hugging Face Transformers version so that it matches\
          \ the open_clip tokenizer:</p>\n<pre><code class=\"language-py\"><span class=\"\
          hljs-keyword\">from</span> transformers <span class=\"hljs-keyword\">import</span>\
          \ CLIPTokenizer\n\ntokenizer = CLIPTokenizer.from_pretrained(<span class=\"\
          hljs-string\">\"laion/CLIP-ViT-bigG-14-laion2B-39B-b160k\"</span>)\n\n<span\
          \ class=\"hljs-built_in\">print</span>(tokenizer(<span class=\"hljs-string\"\
          >\"hello\"</span>, max_length=<span class=\"hljs-number\">77</span>, padding=<span\
          \ class=\"hljs-string\">\"max_length\"</span>, truncation=<span class=\"\
          hljs-literal\">True</span>))\n</code></pre>\n"
        raw: "```py\nimport open_clip\n\ntokenizer = open_clip.get_tokenizer('ViT-bigG-14')\n\
          \nprint(tokenizer(\"hello\"))\n```\ngives:\n```\ntensor([[49406,  3306,\
          \ 49407,     0,     0,     0,     0,     0,     0,     0,\n            \
          \ 0,     0,     0,     0,     0,     0,     0,     0,     0,     0,\n  \
          \           0,     0,     0,     0,     0,     0,     0,     0,     0, \
          \    0,\n             0,     0,     0,     0,     0,     0,     0,     0,\
          \     0,     0,\n             0,     0,     0,     0,     0,     0,    \
          \ 0,     0,     0,     0,\n             0,     0,     0,     0,     0, \
          \    0,     0,     0,     0,     0,\n             0,     0,     0,     0,\
          \     0,     0,     0,     0,     0,     0,\n             0,     0,    \
          \ 0,     0,     0,     0,     0]])\n```\n\nwhich means the padding token\
          \ should be `0` not `49407`.\n\nThis PR corrects the Hugging Face Transformers\
          \ version so that it matches the open_clip tokenizer:\n\n```py\nfrom transformers\
          \ import CLIPTokenizer\n\ntokenizer = CLIPTokenizer.from_pretrained(\"laion/CLIP-ViT-bigG-14-laion2B-39B-b160k\"\
          )\n\nprint(tokenizer(\"hello\", max_length=77, padding=\"max_length\", truncation=True))\n\
          ```"
        updatedAt: '2023-06-23T07:47:59.618Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F92F"
        users:
        - julien-c
      relatedEventId: 64954e2f86e1286a1de27165
    id: 64954e2f86e1286a1de27161
    type: comment
  author: patrickvonplaten
  content: "```py\nimport open_clip\n\ntokenizer = open_clip.get_tokenizer('ViT-bigG-14')\n\
    \nprint(tokenizer(\"hello\"))\n```\ngives:\n```\ntensor([[49406,  3306, 49407,\
    \     0,     0,     0,     0,     0,     0,     0,\n             0,     0,   \
    \  0,     0,     0,     0,     0,     0,     0,     0,\n             0,     0,\
    \     0,     0,     0,     0,     0,     0,     0,     0,\n             0,   \
    \  0,     0,     0,     0,     0,     0,     0,     0,     0,\n             0,\
    \     0,     0,     0,     0,     0,     0,     0,     0,     0,\n           \
    \  0,     0,     0,     0,     0,     0,     0,     0,     0,     0,\n       \
    \      0,     0,     0,     0,     0,     0,     0,     0,     0,     0,\n   \
    \          0,     0,     0,     0,     0,     0,     0]])\n```\n\nwhich means\
    \ the padding token should be `0` not `49407`.\n\nThis PR corrects the Hugging\
    \ Face Transformers version so that it matches the open_clip tokenizer:\n\n```py\n\
    from transformers import CLIPTokenizer\n\ntokenizer = CLIPTokenizer.from_pretrained(\"\
    laion/CLIP-ViT-bigG-14-laion2B-39B-b160k\")\n\nprint(tokenizer(\"hello\", max_length=77,\
    \ padding=\"max_length\", truncation=True))\n```"
  created_at: 2023-06-23 06:47:59+00:00
  edited: false
  hidden: false
  id: 64954e2f86e1286a1de27161
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2023-06-23T07:47:59.000Z'
    data:
      status: open
    id: 64954e2f86e1286a1de27165
    type: status-change
  author: patrickvonplaten
  created_at: 2023-06-23 06:47:59+00:00
  id: 64954e2f86e1286a1de27165
  new_status: open
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionTitleChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: false
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2023-06-23T07:48:50.000Z'
    data:
      from: Correct pad token tokenizer
      to: Correrct Transformers Pad Token
    id: 64954e62f02a9f75bfc70374
    type: title-change
  author: patrickvonplaten
  created_at: 2023-06-23 06:48:50+00:00
  id: 64954e62f02a9f75bfc70374
  new_title: Correrct Transformers Pad Token
  old_title: Correct pad token tokenizer
  type: title-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1667002643224-604a5184dca2c7ac7508b849.jpeg?w=200&h=200&f=face
      fullname: Ross Wightman
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: rwightman
      type: user
    createdAt: '2023-06-23T18:09:00.000Z'
    data:
      edited: false
      editors:
      - rwightman
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9706042408943176
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1667002643224-604a5184dca2c7ac7508b849.jpeg?w=200&h=200&f=face
          fullname: Ross Wightman
          isHf: true
          isPro: false
          name: rwightman
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;patrickvonplaten&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/patrickvonplaten\"\
          >@<span class=\"underline\">patrickvonplaten</span></a></span>\n\n\t</span></span>\
          \ <span data-props=\"{&quot;user&quot;:&quot;julien-c&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/julien-c\">@<span class=\"\
          underline\">julien-c</span></a></span>\n\n\t</span></span>  it is indeed\
          \ wrong, but as mentioned in slack, this probably means all HF Transformers\
          \ based tokenizers for OpenCLIP AND probably the OpenAI originals are wrong\
          \ as OpenCLIP Transformers tokenizer config was just copied from the <code>openai/</code>\
          \ ones on the hub. I can't merge as I'm not the owner, that's <span data-props=\"\
          {&quot;user&quot;:&quot;mitchellw&quot;}\" data-target=\"UserMention\" class=\"\
          SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"inline-block\"><span\
          \ class=\"contents\"><a href=\"/mitchellw\">@<span class=\"underline\">mitchellw</span></a></span>\n\
          \n\t</span></span> </p>\n"
        raw: '@patrickvonplaten @julien-c  it is indeed wrong, but as mentioned in
          slack, this probably means all HF Transformers based tokenizers for OpenCLIP
          AND probably the OpenAI originals are wrong as OpenCLIP Transformers tokenizer
          config was just copied from the `openai/` ones on the hub. I can''t merge
          as I''m not the owner, that''s @mitchellw '
        updatedAt: '2023-06-23T18:09:00.417Z'
      numEdits: 0
      reactions: []
    id: 6495dfbc15d8ef6f01bdb0b9
    type: comment
  author: rwightman
  content: '@patrickvonplaten @julien-c  it is indeed wrong, but as mentioned in slack,
    this probably means all HF Transformers based tokenizers for OpenCLIP AND probably
    the OpenAI originals are wrong as OpenCLIP Transformers tokenizer config was just
    copied from the `openai/` ones on the hub. I can''t merge as I''m not the owner,
    that''s @mitchellw '
  created_at: 2023-06-23 17:09:00+00:00
  edited: false
  hidden: false
  id: 6495dfbc15d8ef6f01bdb0b9
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1667002643224-604a5184dca2c7ac7508b849.jpeg?w=200&h=200&f=face
      fullname: Ross Wightman
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: rwightman
      type: user
    createdAt: '2024-01-16T21:32:49.000Z'
    data:
      edited: false
      editors:
      - rwightman
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9218249917030334
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1667002643224-604a5184dca2c7ac7508b849.jpeg?w=200&h=200&f=face
          fullname: Ross Wightman
          isHf: true
          isPro: false
          name: rwightman
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;patrickvonplaten&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/patrickvonplaten\"\
          >@<span class=\"underline\">patrickvonplaten</span></a></span>\n\n\t</span></span>\
          \ so I have write access and can merge this now, is this still a desired\
          \ change making it match original tokenizer or think people are relying\
          \ on this behaviour?</p>\n"
        raw: '@patrickvonplaten so I have write access and can merge this now, is
          this still a desired change making it match original tokenizer or think
          people are relying on this behaviour?'
        updatedAt: '2024-01-16T21:32:49.588Z'
      numEdits: 0
      reactions: []
    id: 65a6f601c2cf664a51917f7c
    type: comment
  author: rwightman
  content: '@patrickvonplaten so I have write access and can merge this now, is this
    still a desired change making it match original tokenizer or think people are
    relying on this behaviour?'
  created_at: 2024-01-16 21:32:49+00:00
  edited: false
  hidden: false
  id: 65a6f601c2cf664a51917f7c
  type: comment
is_pull_request: true
merge_commit_oid: null
num: 7
repo_id: laion/CLIP-ViT-bigG-14-laion2B-39B-b160k
repo_type: model
status: open
target_branch: refs/heads/main
title: Correrct Transformers Pad Token
