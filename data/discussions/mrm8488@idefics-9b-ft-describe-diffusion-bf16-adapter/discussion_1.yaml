!!python/object:huggingface_hub.community.DiscussionWithDetails
author: diogovelho
conflicting_files: null
created_at: 2023-09-01 01:19:25+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/80ada7aa7ce7d79cdcb6d56f078e980f.svg
      fullname: Diogo Velho
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: diogovelho
      type: user
    createdAt: '2023-09-01T02:19:25.000Z'
    data:
      edited: true
      editors:
      - diogovelho
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.20652201771736145
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/80ada7aa7ce7d79cdcb6d56f078e980f.svg
          fullname: Diogo Velho
          isHf: false
          isPro: false
          name: diogovelho
          type: user
        html: "<p>Hola Manuel, estoy intentando aplicar pesos LoRA pero  parece que\
          \ no consigo cargar los pesos y el modelo no parece tener LoRA en las respuestas.\
          \ \xBFPuedes ayudarme? Gracias :)</p>\n<p>device = \"cuda\" if torch.cuda.is_available()\
          \ else \"cpu\"</p>\n<p>checkpoint = \"HuggingFaceM4/idefics-9b\"</p>\n<p>bnb_config\
          \ = BitsAndBytesConfig(<br>load_in_4bit=True,<br>bnb_4bit_use_double_quant=True,<br>bnb_4bit_quant_type=\"\
          nf4\",<br>bnb_4bit_compute_dtype=torch.float16,<br>llm_int8_skip_modules=[\"\
          lm_head\", \"embed_tokens\"],<br>)</p>\n<p>processor = AutoProcessor.from_pretrained(checkpoint,\
          \ use_auth_token=False)<br>model = IdeficsForVisionText2Text.from_pretrained(checkpoint,\
          \ quantization_config=bnb_config, device_map=\"auto\")<br>model = PeftModel.from_pretrained(model,\
          \ \"mrm8488/idefics-9b-ft-describe-diffusion-bf16\")<br>model = model.merge_and_unload()</p>\n"
        raw: "Hola Manuel, estoy intentando aplicar pesos LoRA pero  parece que no\
          \ consigo cargar los pesos y el modelo no parece tener LoRA en las respuestas.\
          \ \xBFPuedes ayudarme? Gracias :)\n\ndevice = \"cuda\" if torch.cuda.is_available()\
          \ else \"cpu\"\n\ncheckpoint = \"HuggingFaceM4/idefics-9b\"\n\nbnb_config\
          \ = BitsAndBytesConfig(\nload_in_4bit=True,\nbnb_4bit_use_double_quant=True,\n\
          bnb_4bit_quant_type=\"nf4\",\nbnb_4bit_compute_dtype=torch.float16,\nllm_int8_skip_modules=[\"\
          lm_head\", \"embed_tokens\"],\n)\n\nprocessor = AutoProcessor.from_pretrained(checkpoint,\
          \ use_auth_token=False)\nmodel = IdeficsForVisionText2Text.from_pretrained(checkpoint,\
          \ quantization_config=bnb_config, device_map=\"auto\")\nmodel = PeftModel.from_pretrained(model,\
          \ \"mrm8488/idefics-9b-ft-describe-diffusion-bf16\")\nmodel = model.merge_and_unload()"
        updatedAt: '2023-09-01T02:28:29.174Z'
      numEdits: 2
      reactions: []
    id: 64f14a2dd2a6ead34f70d7e4
    type: comment
  author: diogovelho
  content: "Hola Manuel, estoy intentando aplicar pesos LoRA pero  parece que no consigo\
    \ cargar los pesos y el modelo no parece tener LoRA en las respuestas. \xBFPuedes\
    \ ayudarme? Gracias :)\n\ndevice = \"cuda\" if torch.cuda.is_available() else\
    \ \"cpu\"\n\ncheckpoint = \"HuggingFaceM4/idefics-9b\"\n\nbnb_config = BitsAndBytesConfig(\n\
    load_in_4bit=True,\nbnb_4bit_use_double_quant=True,\nbnb_4bit_quant_type=\"nf4\"\
    ,\nbnb_4bit_compute_dtype=torch.float16,\nllm_int8_skip_modules=[\"lm_head\",\
    \ \"embed_tokens\"],\n)\n\nprocessor = AutoProcessor.from_pretrained(checkpoint,\
    \ use_auth_token=False)\nmodel = IdeficsForVisionText2Text.from_pretrained(checkpoint,\
    \ quantization_config=bnb_config, device_map=\"auto\")\nmodel = PeftModel.from_pretrained(model,\
    \ \"mrm8488/idefics-9b-ft-describe-diffusion-bf16\")\nmodel = model.merge_and_unload()"
  created_at: 2023-09-01 01:19:25+00:00
  edited: true
  hidden: false
  id: 64f14a2dd2a6ead34f70d7e4
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: mrm8488/idefics-9b-ft-describe-diffusion-bf16-adapter
repo_type: model
status: open
target_branch: null
title: Ayuda para aplicar pesos LoRA
