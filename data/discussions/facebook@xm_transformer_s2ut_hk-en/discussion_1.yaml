!!python/object:huggingface_hub.community.DiscussionWithDetails
author: qqq22558
conflicting_files: null
created_at: 2023-03-03 09:16:52+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e4580d0eca43aa0d8055f3da0d7230f0.svg
      fullname: zheyu
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: qqq22558
      type: user
    createdAt: '2023-03-03T09:16:52.000Z'
    data:
      edited: false
      editors:
      - qqq22558
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e4580d0eca43aa0d8055f3da0d7230f0.svg
          fullname: zheyu
          isHf: false
          isPro: false
          name: qqq22558
          type: user
        html: "<p>Hi all,</p>\n<p>When I run the code, it first download model and\
          \ config file successfully, but get error after downloading.</p>\n<p>models,\
          \ cfg, task = load_model_ensemble_and_task_from_hf_hub(<br>    \"facebook/xm_transformer_s2ut_hk-en\"\
          ,<br>    arg_overrides={\"config_yaml\": \"config.yaml\", \"task\": \"speech_to_text\"\
          },<br>    cache_dir='cache_dir_unity_hken',<br>)</p>\n<p>Error message:</p>\n\
          <h2 id=\"fetching-5-files-100\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588-55-00000000-4211149its\">Fetching 5 files: 100%|\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 5/5\
          \ [00:00&lt;00:00, 42111.49it/s]</h2>\n<p>TypeError                    \
          \             Traceback (most recent call last)<br>File ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:303,\
          \ in DictConfig.<strong>getattr</strong>(self, key)<br>    301         raise\
          \ ConfigAttributeError()<br>--&gt; 303     return self._get_impl(key=key,\
          \ default_value=DEFAULT_VALUE_MARKER)<br>    304 except Exception as e:</p>\n\
          <p>File ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:361,\
          \ in DictConfig._get_impl(self, key, default_value)<br>    360 try:<br>--&gt;\
          \ 361     node = self._get_node(key=key)<br>    362 except ConfigAttributeError:</p>\n\
          <p>File ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:375,\
          \ in DictConfig._get_node(self, key, validate_access)<br>    374 try:<br>--&gt;\
          \ 375     key = self._validate_and_normalize_key(key)<br>    376 except\
          \ KeyValidationError:</p>\n<p>File ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:222,\
          \ in DictConfig._validate_and_normalize_key(self, key)<br>    221 def _validate_and_normalize_key(self,\
          \ key: Any) -&gt; Union[str, Enum]:<br>--&gt; 222     return self._s_validate_and_normalize_key(self._metadata.key_type,\
          \ key)</p>\n<p>File ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:241,\
          \ in DictConfig._s_validate_and_normalize_key(self, key_type, key)<br> \
          \   240     return key<br>--&gt; 241 elif issubclass(key_type, Enum):<br>\
          \    242     try:</p>\n<p>TypeError: issubclass() arg 1 must be a class</p>\n\
          <p>During handling of the above exception, another exception occurred:</p>\n\
          <p>TypeError                                 Traceback (most recent call\
          \ last)<br>Cell In[5], line 1<br>----&gt; 1 models, cfg, task = load_model_ensemble_and_task_from_hf_hub(<br>\
          \      2     \"facebook/xm_transformer_s2ut_hk-en\",<br>      3     arg_overrides={\"\
          config_yaml\": \"config.yaml\", \"task\": \"speech_to_text\"},<br>     \
          \ 4     cache_dir='cache_dir_unity_hken',<br>      5 )<br>      6 #model\
          \ = models[0].cpu()<br>      7 #cfg[\"task\"].cpu = True<br>      8 generator\
          \ = task.build_generator([model], cfg)</p>\n<p>File /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:532,\
          \ in load_model_ensemble_and_task_from_hf_hub(model_id, cache_dir, arg_overrides,\
          \ *<em>kwargs)<br>    530 _arg_overrides = arg_overrides or {}<br>    531\
          \ _arg_overrides[\"data\"] = cache_dir<br>--&gt; 532 return load_model_ensemble_and_task(<br>\
          \    533     [p.as_posix() for p in Path(cache_dir).glob(\"</em>.pt\")],<br>\
          \    534     arg_overrides=_arg_overrides,<br>    535 )</p>\n<p>File /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:432,\
          \ in load_model_ensemble_and_task(filenames, arg_overrides, task, strict,\
          \ suffix, num_shards, state)<br>    430     raise IOError(\"Model file not\
          \ found: {}\".format(filename))<br>    431 if state is None:<br>--&gt; 432\
          \     state = load_checkpoint_to_cpu(filename, arg_overrides)<br>    433\
          \ if \"args\" in state and state[\"args\"] is not None:<br>    434     cfg\
          \ = convert_namespace_to_omegaconf(state[\"args\"])</p>\n<p>File /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:350,\
          \ in load_checkpoint_to_cpu(path, arg_overrides, load_on_all_ranks)<br>\
          \    347     if arg_overrides is not None:<br>    348         overwrite_args_by_name(state[\"\
          cfg\"], arg_overrides)<br>--&gt; 350 state = _upgrade_state_dict(state)<br>\
          \    351 return state</p>\n<p>File /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:715,\
          \ in _upgrade_state_dict(state)<br>    706         if \"generation\" in\
          \ cfg and isinstance(cfg.generation.print_alignment, bool):<br>    707 \
          \            cfg.generation.print_alignment = (<br>    708             \
          \    \"hard\" if cfg.generation.print_alignment else None<br>    709   \
          \          )<br>    710         if (<br>    711             \"model\" in\
          \ cfg<br>    712             and \"w2v_args\" in cfg.model<br>    713  \
          \           and cfg.model.w2v_args is not None<br>    714             and\
          \ (<br>--&gt; 715                 hasattr(cfg.model.w2v_args, \"task\")\
          \ or \"task\" in cfg.model.w2v_args<br>    716             )<br>    717\
          \             and hasattr(cfg.model.w2v_args.task, \"eval_wer_config\")<br>\
          \    718             and cfg.model.w2v_args.task.eval_wer_config is not\
          \ None<br>    719             and isinstance(<br>    720               \
          \  cfg.model.w2v_args.task.eval_wer_config.print_alignment, bool<br>   \
          \ 721             )<br>    722         ):<br>    723             cfg.model.w2v_args.task.eval_wer_config.print_alignment\
          \ = \"hard\"<br>    725 return state</p>\n<p>File ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:305,\
          \ in DictConfig.<strong>getattr</strong>(self, key)<br>    303     return\
          \ self._get_impl(key=key, default_value=DEFAULT_VALUE_MARKER)<br>    304\
          \ except Exception as e:<br>--&gt; 305     self._format_and_raise(key=key,\
          \ value=None, cause=e)</p>\n<p>File ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/base.py:95,\
          \ in Node._format_and_raise(self, key, value, cause, type_override)<br>\
          \     92 def _format_and_raise(<br>     93     self, key: Any, value: Any,\
          \ cause: Exception, type_override: Any = None<br>     94 ) -&gt; None:<br>---&gt;\
          \ 95     format_and_raise(<br>     96         node=self,<br>     97    \
          \     key=key,<br>     98         value=value,<br>     99         msg=str(cause),<br>\
          \    100         cause=cause,<br>    101         type_override=type_override,<br>\
          \    102     )<br>    103     assert False</p>\n<p>File ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/_utils.py:644,\
          \ in format_and_raise(node, key, value, msg, cause, type_override)<br> \
          \   642 else:<br>    643     if key is not None and not OmegaConf.is_none(node):<br>--&gt;\
          \ 644         child_node = node._get_node(key, validate_access=False)<br>\
          \    646     full_key = node._get_full_key(key=key)<br>    648     object_type\
          \ = OmegaConf.get_type(node)</p>\n<p>File ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:375,\
          \ in DictConfig._get_node(self, key, validate_access)<br>    371 def _get_node(<br>\
          \    372     self, key: Union[str, Enum], validate_access: bool = True<br>\
          \    373 ) -&gt; Optional[Node]:<br>    374     try:<br>--&gt; 375     \
          \    key = self._validate_and_normalize_key(key)<br>    376     except KeyValidationError:<br>\
          \    377         if validate_access:</p>\n<p>File ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:222,\
          \ in DictConfig._validate_and_normalize_key(self, key)<br>    221 def _validate_and_normalize_key(self,\
          \ key: Any) -&gt; Union[str, Enum]:<br>--&gt; 222     return self._s_validate_and_normalize_key(self._metadata.key_type,\
          \ key)</p>\n<p>File ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:241,\
          \ in DictConfig._s_validate_and_normalize_key(self, key_type, key)<br> \
          \   236         raise KeyValidationError(<br>    237             f\"Key\
          \ $KEY ($KEY_TYPE) is incompatible with ({key_type.<strong>name</strong>})\"\
          <br>    238         )<br>    240     return key<br>--&gt; 241 elif issubclass(key_type,\
          \ Enum):<br>    242     try:<br>    243         ret = EnumNode.validate_and_convert_to_enum(key_type,\
          \ key)</p>\n<p>TypeError: issubclass() arg 1 must be a class</p>\n<p>I can't\
          \ figure out what's wrong with the error message.<br>Any one can help?<br>Thanks!!</p>\n"
        raw: "Hi all,\r\n\r\nWhen I run the code, it first download model and config\
          \ file successfully, but get error after downloading.\r\n\r\nmodels, cfg,\
          \ task = load_model_ensemble_and_task_from_hf_hub(\r\n    \"facebook/xm_transformer_s2ut_hk-en\"\
          ,\r\n    arg_overrides={\"config_yaml\": \"config.yaml\", \"task\": \"speech_to_text\"\
          },\r\n    cache_dir='cache_dir_unity_hken',\r\n)\r\n\r\nError message:\r\
          \n\r\nFetching 5 files: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588| 5/5 [00:00<00:00, 42111.49it/s]\r\n---------------------------------------------------------------------------\r\
          \nTypeError                                 Traceback (most recent call\
          \ last)\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:303,\
          \ in DictConfig.__getattr__(self, key)\r\n    301         raise ConfigAttributeError()\r\
          \n--> 303     return self._get_impl(key=key, default_value=DEFAULT_VALUE_MARKER)\r\
          \n    304 except Exception as e:\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:361,\
          \ in DictConfig._get_impl(self, key, default_value)\r\n    360 try:\r\n\
          --> 361     node = self._get_node(key=key)\r\n    362 except ConfigAttributeError:\r\
          \n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:375,\
          \ in DictConfig._get_node(self, key, validate_access)\r\n    374 try:\r\n\
          --> 375     key = self._validate_and_normalize_key(key)\r\n    376 except\
          \ KeyValidationError:\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:222,\
          \ in DictConfig._validate_and_normalize_key(self, key)\r\n    221 def _validate_and_normalize_key(self,\
          \ key: Any) -> Union[str, Enum]:\r\n--> 222     return self._s_validate_and_normalize_key(self._metadata.key_type,\
          \ key)\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:241,\
          \ in DictConfig._s_validate_and_normalize_key(self, key_type, key)\r\n \
          \   240     return key\r\n--> 241 elif issubclass(key_type, Enum):\r\n \
          \   242     try:\r\n\r\nTypeError: issubclass() arg 1 must be a class\r\n\
          \r\nDuring handling of the above exception, another exception occurred:\r\
          \n\r\nTypeError                                 Traceback (most recent call\
          \ last)\r\nCell In[5], line 1\r\n----> 1 models, cfg, task = load_model_ensemble_and_task_from_hf_hub(\r\
          \n      2     \"facebook/xm_transformer_s2ut_hk-en\",\r\n      3     arg_overrides={\"\
          config_yaml\": \"config.yaml\", \"task\": \"speech_to_text\"},\r\n     \
          \ 4     cache_dir='cache_dir_unity_hken',\r\n      5 )\r\n      6 #model\
          \ = models[0].cpu()\r\n      7 #cfg[\"task\"].cpu = True\r\n      8 generator\
          \ = task.build_generator([model], cfg)\r\n\r\nFile /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:532,\
          \ in load_model_ensemble_and_task_from_hf_hub(model_id, cache_dir, arg_overrides,\
          \ **kwargs)\r\n    530 _arg_overrides = arg_overrides or {}\r\n    531 _arg_overrides[\"\
          data\"] = cache_dir\r\n--> 532 return load_model_ensemble_and_task(\r\n\
          \    533     [p.as_posix() for p in Path(cache_dir).glob(\"*.pt\")],\r\n\
          \    534     arg_overrides=_arg_overrides,\r\n    535 )\r\n\r\nFile /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:432,\
          \ in load_model_ensemble_and_task(filenames, arg_overrides, task, strict,\
          \ suffix, num_shards, state)\r\n    430     raise IOError(\"Model file not\
          \ found: {}\".format(filename))\r\n    431 if state is None:\r\n--> 432\
          \     state = load_checkpoint_to_cpu(filename, arg_overrides)\r\n    433\
          \ if \"args\" in state and state[\"args\"] is not None:\r\n    434     cfg\
          \ = convert_namespace_to_omegaconf(state[\"args\"])\r\n\r\nFile /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:350,\
          \ in load_checkpoint_to_cpu(path, arg_overrides, load_on_all_ranks)\r\n\
          \    347     if arg_overrides is not None:\r\n    348         overwrite_args_by_name(state[\"\
          cfg\"], arg_overrides)\r\n--> 350 state = _upgrade_state_dict(state)\r\n\
          \    351 return state\r\n\r\nFile /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:715,\
          \ in _upgrade_state_dict(state)\r\n    706         if \"generation\" in\
          \ cfg and isinstance(cfg.generation.print_alignment, bool):\r\n    707 \
          \            cfg.generation.print_alignment = (\r\n    708             \
          \    \"hard\" if cfg.generation.print_alignment else None\r\n    709   \
          \          )\r\n    710         if (\r\n    711             \"model\" in\
          \ cfg\r\n    712             and \"w2v_args\" in cfg.model\r\n    713  \
          \           and cfg.model.w2v_args is not None\r\n    714             and\
          \ (\r\n--> 715                 hasattr(cfg.model.w2v_args, \"task\") or\
          \ \"task\" in cfg.model.w2v_args\r\n    716             )\r\n    717   \
          \          and hasattr(cfg.model.w2v_args.task, \"eval_wer_config\")\r\n\
          \    718             and cfg.model.w2v_args.task.eval_wer_config is not\
          \ None\r\n    719             and isinstance(\r\n    720               \
          \  cfg.model.w2v_args.task.eval_wer_config.print_alignment, bool\r\n   \
          \ 721             )\r\n    722         ):\r\n    723             cfg.model.w2v_args.task.eval_wer_config.print_alignment\
          \ = \"hard\"\r\n    725 return state\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:305,\
          \ in DictConfig.__getattr__(self, key)\r\n    303     return self._get_impl(key=key,\
          \ default_value=DEFAULT_VALUE_MARKER)\r\n    304 except Exception as e:\r\
          \n--> 305     self._format_and_raise(key=key, value=None, cause=e)\r\n\r\
          \nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/base.py:95,\
          \ in Node._format_and_raise(self, key, value, cause, type_override)\r\n\
          \     92 def _format_and_raise(\r\n     93     self, key: Any, value: Any,\
          \ cause: Exception, type_override: Any = None\r\n     94 ) -> None:\r\n\
          ---> 95     format_and_raise(\r\n     96         node=self,\r\n     97 \
          \        key=key,\r\n     98         value=value,\r\n     99         msg=str(cause),\r\
          \n    100         cause=cause,\r\n    101         type_override=type_override,\r\
          \n    102     )\r\n    103     assert False\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/_utils.py:644,\
          \ in format_and_raise(node, key, value, msg, cause, type_override)\r\n \
          \   642 else:\r\n    643     if key is not None and not OmegaConf.is_none(node):\r\
          \n--> 644         child_node = node._get_node(key, validate_access=False)\r\
          \n    646     full_key = node._get_full_key(key=key)\r\n    648     object_type\
          \ = OmegaConf.get_type(node)\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:375,\
          \ in DictConfig._get_node(self, key, validate_access)\r\n    371 def _get_node(\r\
          \n    372     self, key: Union[str, Enum], validate_access: bool = True\r\
          \n    373 ) -> Optional[Node]:\r\n    374     try:\r\n--> 375         key\
          \ = self._validate_and_normalize_key(key)\r\n    376     except KeyValidationError:\r\
          \n    377         if validate_access:\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:222,\
          \ in DictConfig._validate_and_normalize_key(self, key)\r\n    221 def _validate_and_normalize_key(self,\
          \ key: Any) -> Union[str, Enum]:\r\n--> 222     return self._s_validate_and_normalize_key(self._metadata.key_type,\
          \ key)\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:241,\
          \ in DictConfig._s_validate_and_normalize_key(self, key_type, key)\r\n \
          \   236         raise KeyValidationError(\r\n    237             f\"Key\
          \ $KEY ($KEY_TYPE) is incompatible with ({key_type.__name__})\"\r\n    238\
          \         )\r\n    240     return key\r\n--> 241 elif issubclass(key_type,\
          \ Enum):\r\n    242     try:\r\n    243         ret = EnumNode.validate_and_convert_to_enum(key_type,\
          \ key)\r\n\r\nTypeError: issubclass() arg 1 must be a class\r\n\r\nI can't\
          \ figure out what's wrong with the error message.\r\nAny one can help?\r\
          \nThanks!!"
        updatedAt: '2023-03-03T09:16:52.983Z'
      numEdits: 0
      reactions: []
    id: 6401bb04f98fbc64bcd74104
    type: comment
  author: qqq22558
  content: "Hi all,\r\n\r\nWhen I run the code, it first download model and config\
    \ file successfully, but get error after downloading.\r\n\r\nmodels, cfg, task\
    \ = load_model_ensemble_and_task_from_hf_hub(\r\n    \"facebook/xm_transformer_s2ut_hk-en\"\
    ,\r\n    arg_overrides={\"config_yaml\": \"config.yaml\", \"task\": \"speech_to_text\"\
    },\r\n    cache_dir='cache_dir_unity_hken',\r\n)\r\n\r\nError message:\r\n\r\n\
    Fetching 5 files: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
    \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
    \u2588| 5/5 [00:00<00:00, 42111.49it/s]\r\n---------------------------------------------------------------------------\r\
    \nTypeError                                 Traceback (most recent call last)\r\
    \nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:303,\
    \ in DictConfig.__getattr__(self, key)\r\n    301         raise ConfigAttributeError()\r\
    \n--> 303     return self._get_impl(key=key, default_value=DEFAULT_VALUE_MARKER)\r\
    \n    304 except Exception as e:\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:361,\
    \ in DictConfig._get_impl(self, key, default_value)\r\n    360 try:\r\n--> 361\
    \     node = self._get_node(key=key)\r\n    362 except ConfigAttributeError:\r\
    \n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:375,\
    \ in DictConfig._get_node(self, key, validate_access)\r\n    374 try:\r\n--> 375\
    \     key = self._validate_and_normalize_key(key)\r\n    376 except KeyValidationError:\r\
    \n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:222,\
    \ in DictConfig._validate_and_normalize_key(self, key)\r\n    221 def _validate_and_normalize_key(self,\
    \ key: Any) -> Union[str, Enum]:\r\n--> 222     return self._s_validate_and_normalize_key(self._metadata.key_type,\
    \ key)\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:241,\
    \ in DictConfig._s_validate_and_normalize_key(self, key_type, key)\r\n    240\
    \     return key\r\n--> 241 elif issubclass(key_type, Enum):\r\n    242     try:\r\
    \n\r\nTypeError: issubclass() arg 1 must be a class\r\n\r\nDuring handling of\
    \ the above exception, another exception occurred:\r\n\r\nTypeError          \
    \                       Traceback (most recent call last)\r\nCell In[5], line\
    \ 1\r\n----> 1 models, cfg, task = load_model_ensemble_and_task_from_hf_hub(\r\
    \n      2     \"facebook/xm_transformer_s2ut_hk-en\",\r\n      3     arg_overrides={\"\
    config_yaml\": \"config.yaml\", \"task\": \"speech_to_text\"},\r\n      4    \
    \ cache_dir='cache_dir_unity_hken',\r\n      5 )\r\n      6 #model = models[0].cpu()\r\
    \n      7 #cfg[\"task\"].cpu = True\r\n      8 generator = task.build_generator([model],\
    \ cfg)\r\n\r\nFile /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:532,\
    \ in load_model_ensemble_and_task_from_hf_hub(model_id, cache_dir, arg_overrides,\
    \ **kwargs)\r\n    530 _arg_overrides = arg_overrides or {}\r\n    531 _arg_overrides[\"\
    data\"] = cache_dir\r\n--> 532 return load_model_ensemble_and_task(\r\n    533\
    \     [p.as_posix() for p in Path(cache_dir).glob(\"*.pt\")],\r\n    534     arg_overrides=_arg_overrides,\r\
    \n    535 )\r\n\r\nFile /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:432,\
    \ in load_model_ensemble_and_task(filenames, arg_overrides, task, strict, suffix,\
    \ num_shards, state)\r\n    430     raise IOError(\"Model file not found: {}\"\
    .format(filename))\r\n    431 if state is None:\r\n--> 432     state = load_checkpoint_to_cpu(filename,\
    \ arg_overrides)\r\n    433 if \"args\" in state and state[\"args\"] is not None:\r\
    \n    434     cfg = convert_namespace_to_omegaconf(state[\"args\"])\r\n\r\nFile\
    \ /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:350,\
    \ in load_checkpoint_to_cpu(path, arg_overrides, load_on_all_ranks)\r\n    347\
    \     if arg_overrides is not None:\r\n    348         overwrite_args_by_name(state[\"\
    cfg\"], arg_overrides)\r\n--> 350 state = _upgrade_state_dict(state)\r\n    351\
    \ return state\r\n\r\nFile /data3/backup/speech/xm_transformer_unity_hk-en/fairseq/fairseq/checkpoint_utils.py:715,\
    \ in _upgrade_state_dict(state)\r\n    706         if \"generation\" in cfg and\
    \ isinstance(cfg.generation.print_alignment, bool):\r\n    707             cfg.generation.print_alignment\
    \ = (\r\n    708                 \"hard\" if cfg.generation.print_alignment else\
    \ None\r\n    709             )\r\n    710         if (\r\n    711           \
    \  \"model\" in cfg\r\n    712             and \"w2v_args\" in cfg.model\r\n \
    \   713             and cfg.model.w2v_args is not None\r\n    714            \
    \ and (\r\n--> 715                 hasattr(cfg.model.w2v_args, \"task\") or \"\
    task\" in cfg.model.w2v_args\r\n    716             )\r\n    717             and\
    \ hasattr(cfg.model.w2v_args.task, \"eval_wer_config\")\r\n    718           \
    \  and cfg.model.w2v_args.task.eval_wer_config is not None\r\n    719        \
    \     and isinstance(\r\n    720                 cfg.model.w2v_args.task.eval_wer_config.print_alignment,\
    \ bool\r\n    721             )\r\n    722         ):\r\n    723             cfg.model.w2v_args.task.eval_wer_config.print_alignment\
    \ = \"hard\"\r\n    725 return state\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:305,\
    \ in DictConfig.__getattr__(self, key)\r\n    303     return self._get_impl(key=key,\
    \ default_value=DEFAULT_VALUE_MARKER)\r\n    304 except Exception as e:\r\n-->\
    \ 305     self._format_and_raise(key=key, value=None, cause=e)\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/base.py:95,\
    \ in Node._format_and_raise(self, key, value, cause, type_override)\r\n     92\
    \ def _format_and_raise(\r\n     93     self, key: Any, value: Any, cause: Exception,\
    \ type_override: Any = None\r\n     94 ) -> None:\r\n---> 95     format_and_raise(\r\
    \n     96         node=self,\r\n     97         key=key,\r\n     98         value=value,\r\
    \n     99         msg=str(cause),\r\n    100         cause=cause,\r\n    101 \
    \        type_override=type_override,\r\n    102     )\r\n    103     assert False\r\
    \n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/_utils.py:644,\
    \ in format_and_raise(node, key, value, msg, cause, type_override)\r\n    642\
    \ else:\r\n    643     if key is not None and not OmegaConf.is_none(node):\r\n\
    --> 644         child_node = node._get_node(key, validate_access=False)\r\n  \
    \  646     full_key = node._get_full_key(key=key)\r\n    648     object_type =\
    \ OmegaConf.get_type(node)\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:375,\
    \ in DictConfig._get_node(self, key, validate_access)\r\n    371 def _get_node(\r\
    \n    372     self, key: Union[str, Enum], validate_access: bool = True\r\n  \
    \  373 ) -> Optional[Node]:\r\n    374     try:\r\n--> 375         key = self._validate_and_normalize_key(key)\r\
    \n    376     except KeyValidationError:\r\n    377         if validate_access:\r\
    \n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:222,\
    \ in DictConfig._validate_and_normalize_key(self, key)\r\n    221 def _validate_and_normalize_key(self,\
    \ key: Any) -> Union[str, Enum]:\r\n--> 222     return self._s_validate_and_normalize_key(self._metadata.key_type,\
    \ key)\r\n\r\nFile ~/anaconda3/envs/hokkien/lib/python3.8/site-packages/omegaconf/dictconfig.py:241,\
    \ in DictConfig._s_validate_and_normalize_key(self, key_type, key)\r\n    236\
    \         raise KeyValidationError(\r\n    237             f\"Key $KEY ($KEY_TYPE)\
    \ is incompatible with ({key_type.__name__})\"\r\n    238         )\r\n    240\
    \     return key\r\n--> 241 elif issubclass(key_type, Enum):\r\n    242     try:\r\
    \n    243         ret = EnumNode.validate_and_convert_to_enum(key_type, key)\r\
    \n\r\nTypeError: issubclass() arg 1 must be a class\r\n\r\nI can't figure out\
    \ what's wrong with the error message.\r\nAny one can help?\r\nThanks!!"
  created_at: 2023-03-03 09:16:52+00:00
  edited: false
  hidden: false
  id: 6401bb04f98fbc64bcd74104
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/c2ff50d40114d7dd3b26fcf292e6b7aa.svg
      fullname: le
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jacky1
      type: user
    createdAt: '2023-07-15T13:57:21.000Z'
    data:
      edited: false
      editors:
      - jacky1
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8357351422309875
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/c2ff50d40114d7dd3b26fcf292e6b7aa.svg
          fullname: le
          isHf: false
          isPro: false
          name: jacky1
          type: user
        html: '<p>i have  the same error</p>

          '
        raw: i have  the same error
        updatedAt: '2023-07-15T13:57:21.130Z'
      numEdits: 0
      reactions: []
    id: 64b2a5c125882acb62bd8e27
    type: comment
  author: jacky1
  content: i have  the same error
  created_at: 2023-07-15 12:57:21+00:00
  edited: false
  hidden: false
  id: 64b2a5c125882acb62bd8e27
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 1
repo_id: facebook/xm_transformer_s2ut_hk-en
repo_type: model
status: open
target_branch: null
title: Error in load_model_ensemble_and_task_from_hf_hub()
