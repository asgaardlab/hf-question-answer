!!python/object:huggingface_hub.community.DiscussionWithDetails
author: JinzZuoyou
conflicting_files: null
created_at: 2023-07-01 05:59:34+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/f0c77aaa8df3a7d294daf93f40fe1385.svg
      fullname: Jin Zuoyou
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: JinzZuoyou
      type: user
    createdAt: '2023-07-01T06:59:34.000Z'
    data:
      edited: false
      editors:
      - JinzZuoyou
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.43100062012672424
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/f0c77aaa8df3a7d294daf93f40fe1385.svg
          fullname: Jin Zuoyou
          isHf: false
          isPro: false
          name: JinzZuoyou
          type: user
        html: "<p>Thanks for sharing this milestone work!</p>\n<p>I have one question\
          \ about the <code>quant_layers</code> function in <a href=\"https://huggingface.co/ctheodoris/Geneformer/blob/main/geneformer/in_silico_perturber.py#L43\"\
          >in_silico_perturber.py</a>:</p>\n<pre><code>def quant_layers(model):\n\
          \    layer_nums = []\n    for name, parameter in model.named_parameters():\n\
          \        if \"layer\" in name:\n            layer_nums += [name.split(\"\
          layer.\")[1].split(\".\")[0]]\n    return int(max(layer_nums))+1\n</code></pre>\n\
          <p>Is it supposed to be:</p>\n<pre><code>def quant_layers(model):\n    layer_nums\
          \ = []\n    for name, parameter in model.named_parameters():\n        if\
          \ \"layer\" in name:\n            l_num = int(name.split(\"layer.\")[1].split(\"\
          .\")[0])    # add int() here, otherwise l_num is a str type and max(layer_nums)\
          \  will return 9\n            layer_nums += [l_num]\n    return int(max(layer_nums))+1\n\
          </code></pre>\n"
        raw: "Thanks for sharing this milestone work!\r\n\r\nI have one question about\
          \ the `quant_layers` function in [in_silico_perturber.py](https://huggingface.co/ctheodoris/Geneformer/blob/main/geneformer/in_silico_perturber.py#L43):\r\
          \n\r\n```\r\ndef quant_layers(model):\r\n    layer_nums = []\r\n    for\
          \ name, parameter in model.named_parameters():\r\n        if \"layer\" in\
          \ name:\r\n            layer_nums += [name.split(\"layer.\")[1].split(\"\
          .\")[0]]\r\n    return int(max(layer_nums))+1\r\n```\r\n\r\nIs it supposed\
          \ to be:\r\n```\r\ndef quant_layers(model):\r\n    layer_nums = []\r\n \
          \   for name, parameter in model.named_parameters():\r\n        if \"layer\"\
          \ in name:\r\n            l_num = int(name.split(\"layer.\")[1].split(\"\
          .\")[0])    # add int() here, otherwise l_num is a str type and max(layer_nums)\
          \  will return 9\r\n            layer_nums += [l_num]\r\n    return int(max(layer_nums))+1\r\
          \n```\r\n\r\n"
        updatedAt: '2023-07-01T06:59:34.044Z'
      numEdits: 0
      reactions: []
    id: 649fced619a15b1fc989d193
    type: comment
  author: JinzZuoyou
  content: "Thanks for sharing this milestone work!\r\n\r\nI have one question about\
    \ the `quant_layers` function in [in_silico_perturber.py](https://huggingface.co/ctheodoris/Geneformer/blob/main/geneformer/in_silico_perturber.py#L43):\r\
    \n\r\n```\r\ndef quant_layers(model):\r\n    layer_nums = []\r\n    for name,\
    \ parameter in model.named_parameters():\r\n        if \"layer\" in name:\r\n\
    \            layer_nums += [name.split(\"layer.\")[1].split(\".\")[0]]\r\n   \
    \ return int(max(layer_nums))+1\r\n```\r\n\r\nIs it supposed to be:\r\n```\r\n\
    def quant_layers(model):\r\n    layer_nums = []\r\n    for name, parameter in\
    \ model.named_parameters():\r\n        if \"layer\" in name:\r\n            l_num\
    \ = int(name.split(\"layer.\")[1].split(\".\")[0])    # add int() here, otherwise\
    \ l_num is a str type and max(layer_nums)  will return 9\r\n            layer_nums\
    \ += [l_num]\r\n    return int(max(layer_nums))+1\r\n```\r\n\r\n"
  created_at: 2023-07-01 05:59:34+00:00
  edited: false
  hidden: false
  id: 649fced619a15b1fc989d193
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-07-03T06:51:05.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9390913248062134
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for noting this. max(layer_nums) does not cause an error
          but it will obtain the max in a lexicographical manner if the layer_nums
          are strings. This is not an issue for models with &lt;10 layers, but it
          would be a problem for models  &gt;10 layers. I changed the function as
          you suggested to convert the layer numbers to integers prior to obtaining
          the max.</p>

          '
        raw: Thank you for noting this. max(layer_nums) does not cause an error but
          it will obtain the max in a lexicographical manner if the layer_nums are
          strings. This is not an issue for models with <10 layers, but it would be
          a problem for models  >10 layers. I changed the function as you suggested
          to convert the layer numbers to integers prior to obtaining the max.
        updatedAt: '2023-07-03T06:51:05.079Z'
      numEdits: 0
      reactions: []
      relatedEventId: 64a26fd975674aeb39367e95
    id: 64a26fd975674aeb39367e94
    type: comment
  author: ctheodoris
  content: Thank you for noting this. max(layer_nums) does not cause an error but
    it will obtain the max in a lexicographical manner if the layer_nums are strings.
    This is not an issue for models with <10 layers, but it would be a problem for
    models  >10 layers. I changed the function as you suggested to convert the layer
    numbers to integers prior to obtaining the max.
  created_at: 2023-07-03 05:51:05+00:00
  edited: false
  hidden: false
  id: 64a26fd975674aeb39367e94
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-07-03T06:51:05.000Z'
    data:
      status: closed
    id: 64a26fd975674aeb39367e95
    type: status-change
  author: ctheodoris
  created_at: 2023-07-03 05:51:05+00:00
  id: 64a26fd975674aeb39367e95
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 78
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: Question about the quant_layers function in in_silico_perturber.py
