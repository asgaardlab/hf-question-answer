!!python/object:huggingface_hub.community.DiscussionWithDetails
author: junguyen
conflicting_files: null
created_at: 2023-08-10 16:24:23+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/ecd4d674b85b6b6038b47181966e7b53.svg
      fullname: Julie Nguyen
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: junguyen
      type: user
    createdAt: '2023-08-10T17:24:23.000Z'
    data:
      edited: false
      editors:
      - junguyen
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5434620380401611
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/ecd4d674b85b6b6038b47181966e7b53.svg
          fullname: Julie Nguyen
          isHf: false
          isPro: false
          name: junguyen
          type: user
        html: "<p>Thank you for the quick responses thus far!</p>\n<p>I am running\
          \ InSilicoPerturber on the cell_type_train_data.dataset and would like to\
          \ observe changes in gene embeddings after perturbation of a single gene.\
          \ I've had previous success running InSilicoPerturber with the same parameters,\
          \ but only changing emb_mode=\"cell\".  However, when running emb_mode=\"\
          cell_and_gene\", it raises the AttributeError below. I also have the latest\
          \ version of Geneformer pulled. Could I get help on this error? Thanks!</p>\n\
          <pre><code>isp = InSilicoPerturber(perturb_type=\"delete\",\n          \
          \              perturb_rank_shift=None,\n                        genes_to_perturb=[\"\
          ENSG00000021826\"],\n                        combos=0,\n               \
          \         anchor_gene=None,\n                        model_type=\"Pretrained\"\
          ,\n                        num_classes=0,\n                        emb_mode=\"\
          cell_and_gene\",\n                        cell_emb_style=\"mean_pool\",\n\
          \                        filter_data={'organ_major':['liver']},\n      \
          \                  cell_states_to_model=None,\n                        max_ncells=50,\n\
          \                        emb_layer=-1,\n                        forward_batch_size=50,\n\
          \                        nproc=16,\n                        token_dictionary_file\
          \ = \"/home/ubuntu/Geneformer/geneformer/token_dictionary.pkl\")\n\nisp.perturb_data(\"\
          /home/ubuntu/Geneformer/\",\n                 \"/data/cell/\",\n       \
          \          \"/data/cell/delete_cell_and_gene/liver/\",\n               \
          \  \"delete_cell_and_gene_CPS1\")\n</code></pre>\n<pre><code>Filter (num_proc=16):\
          \ 100%|\u2588| 28376/28376 [00:13&lt;00:00, 20\nMap (num_proc=16): 100%|\u2588\
          | 50/50 [00:13&lt;00:00,  3.80 examp\nMap (num_proc=16): 100%|\u2588| 50/50\
          \ [00:00&lt;00:00, 217.76 exam\nMap (num_proc=16): 100%|\u2588| 50/50 [00:00&lt;00:00,\
          \ 206.18 exam\nMap (num_proc=16): 100%|\u2588| 50/50 [00:00&lt;00:00, 197.06\
          \ exam\nTraceback (most recent call last):                        \n  File\
          \ \"&lt;stdin&gt;\", line 1, in &lt;module&gt;                     \n  File\
          \ \"/home/ubuntu/Geneformer/geneformer/in_silico_pertu\nrber.py\", line\
          \ 975, in perturb_data                       \n    self.in_silico_perturb(model,\
          \                         \n  File \"/home/ubuntu/Geneformer/geneformer/in_silico_pertu\n\
          rber.py\", line 1091, in in_silico_perturb                 \n    affected_gene\
          \ = gene_list[k].item()                   \nAttributeError: 'int' object\
          \ has no attribute 'item'      \n</code></pre>\n"
        raw: "Thank you for the quick responses thus far!\r\n\r\nI am running InSilicoPerturber\
          \ on the cell_type_train_data.dataset and would like to observe changes\
          \ in gene embeddings after perturbation of a single gene. I've had previous\
          \ success running InSilicoPerturber with the same parameters, but only changing\
          \ emb_mode=\"cell\".  However, when running emb_mode=\"cell_and_gene\",\
          \ it raises the AttributeError below. I also have the latest version of\
          \ Geneformer pulled. Could I get help on this error? Thanks!\r\n\r\n```\r\
          \nisp = InSilicoPerturber(perturb_type=\"delete\",\r\n                 \
          \       perturb_rank_shift=None,\r\n                        genes_to_perturb=[\"\
          ENSG00000021826\"],\r\n                        combos=0,\r\n           \
          \             anchor_gene=None,\r\n                        model_type=\"\
          Pretrained\",\r\n                        num_classes=0,\r\n            \
          \            emb_mode=\"cell_and_gene\",\r\n                        cell_emb_style=\"\
          mean_pool\",\r\n                        filter_data={'organ_major':['liver']},\r\
          \n                        cell_states_to_model=None,\r\n               \
          \         max_ncells=50,\r\n                        emb_layer=-1,\r\n  \
          \                      forward_batch_size=50,\r\n                      \
          \  nproc=16,\r\n                        token_dictionary_file = \"/home/ubuntu/Geneformer/geneformer/token_dictionary.pkl\"\
          )\r\n\r\nisp.perturb_data(\"/home/ubuntu/Geneformer/\",\r\n            \
          \     \"/data/cell/\",\r\n                 \"/data/cell/delete_cell_and_gene/liver/\"\
          ,\r\n                 \"delete_cell_and_gene_CPS1\")\r\n```\r\n\r\n```\r\
          \nFilter (num_proc=16): 100%|\u2588| 28376/28376 [00:13<00:00, 20\r\nMap\
          \ (num_proc=16): 100%|\u2588| 50/50 [00:13<00:00,  3.80 examp\r\nMap (num_proc=16):\
          \ 100%|\u2588| 50/50 [00:00<00:00, 217.76 exam\r\nMap (num_proc=16): 100%|\u2588\
          | 50/50 [00:00<00:00, 206.18 exam\r\nMap (num_proc=16): 100%|\u2588| 50/50\
          \ [00:00<00:00, 197.06 exam\r\nTraceback (most recent call last):      \
          \                  \r\n  File \"<stdin>\", line 1, in <module>         \
          \            \r\n  File \"/home/ubuntu/Geneformer/geneformer/in_silico_pertu\r\
          \nrber.py\", line 975, in perturb_data                       \r\n    self.in_silico_perturb(model,\
          \                         \r\n  File \"/home/ubuntu/Geneformer/geneformer/in_silico_pertu\r\
          \nrber.py\", line 1091, in in_silico_perturb                 \r\n    affected_gene\
          \ = gene_list[k].item()                   \r\nAttributeError: 'int' object\
          \ has no attribute 'item'      \r\n```"
        updatedAt: '2023-08-10T17:24:23.660Z'
      numEdits: 0
      reactions: []
    id: 64d51d47d7e30889c63cef4d
    type: comment
  author: junguyen
  content: "Thank you for the quick responses thus far!\r\n\r\nI am running InSilicoPerturber\
    \ on the cell_type_train_data.dataset and would like to observe changes in gene\
    \ embeddings after perturbation of a single gene. I've had previous success running\
    \ InSilicoPerturber with the same parameters, but only changing emb_mode=\"cell\"\
    .  However, when running emb_mode=\"cell_and_gene\", it raises the AttributeError\
    \ below. I also have the latest version of Geneformer pulled. Could I get help\
    \ on this error? Thanks!\r\n\r\n```\r\nisp = InSilicoPerturber(perturb_type=\"\
    delete\",\r\n                        perturb_rank_shift=None,\r\n            \
    \            genes_to_perturb=[\"ENSG00000021826\"],\r\n                     \
    \   combos=0,\r\n                        anchor_gene=None,\r\n               \
    \         model_type=\"Pretrained\",\r\n                        num_classes=0,\r\
    \n                        emb_mode=\"cell_and_gene\",\r\n                    \
    \    cell_emb_style=\"mean_pool\",\r\n                        filter_data={'organ_major':['liver']},\r\
    \n                        cell_states_to_model=None,\r\n                     \
    \   max_ncells=50,\r\n                        emb_layer=-1,\r\n              \
    \          forward_batch_size=50,\r\n                        nproc=16,\r\n   \
    \                     token_dictionary_file = \"/home/ubuntu/Geneformer/geneformer/token_dictionary.pkl\"\
    )\r\n\r\nisp.perturb_data(\"/home/ubuntu/Geneformer/\",\r\n                 \"\
    /data/cell/\",\r\n                 \"/data/cell/delete_cell_and_gene/liver/\"\
    ,\r\n                 \"delete_cell_and_gene_CPS1\")\r\n```\r\n\r\n```\r\nFilter\
    \ (num_proc=16): 100%|\u2588| 28376/28376 [00:13<00:00, 20\r\nMap (num_proc=16):\
    \ 100%|\u2588| 50/50 [00:13<00:00,  3.80 examp\r\nMap (num_proc=16): 100%|\u2588\
    | 50/50 [00:00<00:00, 217.76 exam\r\nMap (num_proc=16): 100%|\u2588| 50/50 [00:00<00:00,\
    \ 206.18 exam\r\nMap (num_proc=16): 100%|\u2588| 50/50 [00:00<00:00, 197.06 exam\r\
    \nTraceback (most recent call last):                        \r\n  File \"<stdin>\"\
    , line 1, in <module>                     \r\n  File \"/home/ubuntu/Geneformer/geneformer/in_silico_pertu\r\
    \nrber.py\", line 975, in perturb_data                       \r\n    self.in_silico_perturb(model,\
    \                         \r\n  File \"/home/ubuntu/Geneformer/geneformer/in_silico_pertu\r\
    \nrber.py\", line 1091, in in_silico_perturb                 \r\n    affected_gene\
    \ = gene_list[k].item()                   \r\nAttributeError: 'int' object has\
    \ no attribute 'item'      \r\n```"
  created_at: 2023-08-10 16:24:23+00:00
  edited: false
  hidden: false
  id: 64d51d47d7e30889c63cef4d
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/ecd4d674b85b6b6038b47181966e7b53.svg
      fullname: Julie Nguyen
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: junguyen
      type: user
    createdAt: '2023-10-05T13:58:40.000Z'
    data:
      edited: false
      editors:
      - junguyen
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6739762425422668
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/ecd4d674b85b6b6038b47181966e7b53.svg
          fullname: Julie Nguyen
          isHf: false
          isPro: false
          name: junguyen
          type: user
        html: "<p>I believe I've managed to fix this issue by changing the following,\
          \ starting at <a href=\"https://huggingface.co/ctheodoris/Geneformer/blob/624349c351a94b9559e02425d4b8029d8ea148e5/geneformer/in_silico_perturber.py#L1094\"\
          >line 1094</a>:</p>\n<pre><code>if self.emb_mode == \"cell_and_gene\":\n\
          \    for k in range(nonpadding_cos_sims_data.shape[1]):\n        cos_sim_value\
          \ = nonpadding_cos_sims_data[k]\n        gene_list_1 = np.array(gene_list)\n\
          \        gene_list_1 = tuple(gene_list_1)\n        affected_gene = gene_list_1[k].item()\n\
          \        cos_sims_dict[(perturbed_genes, affected_gene)] += [cos_sim_value.item()]\n\
          </code></pre>\n<p>This allowed me to run the functions without errors, but\
          \ I was not able to get gene embeddings like I had hoped. New discussion\
          \ posted on Discussion <a href=\"/ctheodoris/Geneformer/discussions/256\"\
          >#256</a>.</p>\n"
        raw: "I believe I've managed to fix this issue by changing the following,\
          \ starting at [line 1094](https://huggingface.co/ctheodoris/Geneformer/blob/624349c351a94b9559e02425d4b8029d8ea148e5/geneformer/in_silico_perturber.py#L1094):\n\
          ```\nif self.emb_mode == \"cell_and_gene\":\n    for k in range(nonpadding_cos_sims_data.shape[1]):\n\
          \        cos_sim_value = nonpadding_cos_sims_data[k]\n        gene_list_1\
          \ = np.array(gene_list)\n        gene_list_1 = tuple(gene_list_1)\n    \
          \    affected_gene = gene_list_1[k].item()\n        cos_sims_dict[(perturbed_genes,\
          \ affected_gene)] += [cos_sim_value.item()]\n```\nThis allowed me to run\
          \ the functions without errors, but I was not able to get gene embeddings\
          \ like I had hoped. New discussion posted on Discussion #256."
        updatedAt: '2023-10-05T13:58:40.627Z'
      numEdits: 0
      reactions: []
    id: 651ec110e3c862805586a1b1
    type: comment
  author: junguyen
  content: "I believe I've managed to fix this issue by changing the following, starting\
    \ at [line 1094](https://huggingface.co/ctheodoris/Geneformer/blob/624349c351a94b9559e02425d4b8029d8ea148e5/geneformer/in_silico_perturber.py#L1094):\n\
    ```\nif self.emb_mode == \"cell_and_gene\":\n    for k in range(nonpadding_cos_sims_data.shape[1]):\n\
    \        cos_sim_value = nonpadding_cos_sims_data[k]\n        gene_list_1 = np.array(gene_list)\n\
    \        gene_list_1 = tuple(gene_list_1)\n        affected_gene = gene_list_1[k].item()\n\
    \        cos_sims_dict[(perturbed_genes, affected_gene)] += [cos_sim_value.item()]\n\
    ```\nThis allowed me to run the functions without errors, but I was not able to\
    \ get gene embeddings like I had hoped. New discussion posted on Discussion #256."
  created_at: 2023-10-05 12:58:40+00:00
  edited: false
  hidden: false
  id: 651ec110e3c862805586a1b1
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-12-15T08:59:05.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9056812524795532
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your interest in Geneformer and for your patience!
          We pushed an update that should resolve this issue. If you continue to face
          errors after pulling the updated code, please let us know by either reopening
          this discussion if it''s the same error or opening a new discussion if it''s
          a new error. Thank you!</p>

          '
        raw: Thank you for your interest in Geneformer and for your patience! We pushed
          an update that should resolve this issue. If you continue to face errors
          after pulling the updated code, please let us know by either reopening this
          discussion if it's the same error or opening a new discussion if it's a
          new error. Thank you!
        updatedAt: '2023-12-15T08:59:05.681Z'
      numEdits: 0
      reactions: []
      relatedEventId: 657c1559e34a7de14b17a81e
    id: 657c1559e34a7de14b17a81c
    type: comment
  author: ctheodoris
  content: Thank you for your interest in Geneformer and for your patience! We pushed
    an update that should resolve this issue. If you continue to face errors after
    pulling the updated code, please let us know by either reopening this discussion
    if it's the same error or opening a new discussion if it's a new error. Thank
    you!
  created_at: 2023-12-15 08:59:05+00:00
  edited: false
  hidden: false
  id: 657c1559e34a7de14b17a81c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-12-15T08:59:05.000Z'
    data:
      status: closed
    id: 657c1559e34a7de14b17a81e
    type: status-change
  author: ctheodoris
  created_at: 2023-12-15 08:59:05+00:00
  id: 657c1559e34a7de14b17a81e
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 211
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: 'Attribute Error: ''int'' object has no attribute ''item'' when running emb_mode="cell_and_gene"
  in InSilicoPerturber'
