!!python/object:huggingface_hub.community.DiscussionWithDetails
author: lihf
conflicting_files: null
created_at: 2023-10-25 17:34:37+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/57cf7d5fb8343b9858403fcf59da722a.svg
      fullname: Hongfu
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: lihf
      type: user
    createdAt: '2023-10-25T18:34:37.000Z'
    data:
      edited: true
      editors:
      - lihf
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.37237951159477234
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/57cf7d5fb8343b9858403fcf59da722a.svg
          fullname: Hongfu
          isHf: false
          isPro: false
          name: lihf
          type: user
        html: '<p>Hi, thank you for this tool. I am interested in the iPSCs part of
          your manuscript. I encountered this error when I tried to run your code
          in discussion <a href="/ctheodoris/Geneformer/discussions/101">#101</a>
          on my machine. As far as I understand, there are no iPSCs and fibroblasts
          in dataset. How can I deal with this issue? Thank you.</p>

          <p>Code:<br>isp = InSilicoPerturber(perturb_type="overexpress",<br>                        perturb_rank_shift=None,<br>                        genes_to_perturb=["ENSG00000204531",
          "ENSG00000181449", "ENSG00000136826", "ENSG00000136997"],<br>                        combos=0,<br>                        anchor_gene=None,<br>                        model_type="Pretrained",<br>                        num_classes=0,<br>                        emb_mode="cell",<br>                        cell_emb_style="mean_pool",<br>                        filter_data={"cell_type":["fibroblasts","iPSCs"]},<br>                        cell_states_to_model={''state_key'':
          ''cell_type'',<br>                                                 ''start_state'':
          ''fibroblasts'',<br>                                                 ''goal_state'':
          ''iPSCs'',<br>                                                 ''alt_states'':
          []},<br>                        max_ncells=None,<br>                        emb_layer=-1,<br>                        forward_batch_size=100,<br>                        nproc=72)</p>

          <p>ispstats = InSilicoPerturberStats(mode="goal_state_shift",<br>                                genes_perturbed=["ENSG00000204531",
          "ENSG00000181449", "ENSG00000136826", "ENSG00000136997"],<br>                                combos=0,<br>                                anchor_gene=None,<br>                                cell_states_to_model={''state_key'':
          ''cell_type'',<br>                                                 ''start_state'':
          ''fibroblasts'',<br>                                                 ''goal_state'':
          ''iPSCs'',<br>                                                 ''alt_states'':
          []})</p>

          <p>Error:<br>No cells remain after filtering. Check filtering criteria.</p>

          <hr>

          <p>RuntimeError                              Traceback (most recent call
          last)<br>Cell In[15], line 29<br>      1 isp = InSilicoPerturber(perturb_type="overexpress",<br>      2                         perturb_rank_shift=None,<br>      3                         genes_to_perturb=["ENSG00000204531",
          "ENSG00000181449", "ENSG00000136826", "ENSG00000136997"],<br>   (...)<br>     17                         forward_batch_size=100,<br>     18                         nproc=72)<br>     20
          ispstats = InSilicoPerturberStats(mode="goal_state_shift",<br>     21                                 genes_perturbed=["ENSG00000204531",
          "ENSG00000181449", "ENSG00000136826", "ENSG00000136997"],<br>     22                                 combos=0,<br>   (...)<br>     26                                                  ''goal_state'':
          ''iPSCs'',<br>     27                                                  ''alt_states'':
          []})<br>---&gt; 29 isp.perturb_data("",<br>     30                  "",<br>     31                  "",<br>     32                  "output_prefix")</p>

          <p>File /usr/local/lib/python3.10/dist-packages/geneformer/in_silico_perturber.py:944,
          in InSilicoPerturber.perturb_data(self, model_directory, input_data_file,
          output_directory, output_prefix)<br>    924 def perturb_data(self,<br>    925                  model_directory,<br>    926                  input_data_file,<br>    927                  output_directory,<br>    928                  output_prefix):<br>    929     """<br>    930     Perturb
          genes in input data and save as results in output_directory.<br>    931<br>   (...)<br>    941         Prefix
          for output files<br>    942     """<br>--&gt; 944     filtered_input_data
          = load_and_filter(self.filter_data, self.nproc, input_data_file)<br>    945     model
          = load_model(self.model_type, self.num_classes, model_directory)<br>    946     layer_to_quant
          = quant_layers(model)+self.emb_layer</p>

          <p>File /usr/local/lib/python3.10/dist-packages/geneformer/in_silico_perturber.py:56,
          in load_and_filter(filter_data, nproc, input_data_file)<br>     53     if
          len(data) == 0:<br>     54         logger.error(<br>     55                 "No
          cells remain after filtering. Check filtering criteria.")<br>---&gt; 56         raise<br>     57
          data_shuffled = data.shuffle(seed=42)<br>     58 return data_shuffled</p>

          <p>RuntimeError: No active exception to reraise</p>

          '
        raw: "Hi, thank you for this tool. I am interested in the iPSCs part of your\
          \ manuscript. I encountered this error when I tried to run your code in\
          \ discussion #101 on my machine. As far as I understand, there are no iPSCs\
          \ and fibroblasts in dataset. How can I deal with this issue? Thank you.\n\
          \nCode:\nisp = InSilicoPerturber(perturb_type=\"overexpress\",\n       \
          \                 perturb_rank_shift=None,\n                        genes_to_perturb=[\"\
          ENSG00000204531\", \"ENSG00000181449\", \"ENSG00000136826\", \"ENSG00000136997\"\
          ],\n                        combos=0,\n                        anchor_gene=None,\n\
          \                        model_type=\"Pretrained\",\n                  \
          \      num_classes=0,\n                        emb_mode=\"cell\",\n    \
          \                    cell_emb_style=\"mean_pool\",\n                   \
          \     filter_data={\"cell_type\":[\"fibroblasts\",\"iPSCs\"]},\n       \
          \                 cell_states_to_model={'state_key': 'cell_type',\n    \
          \                                             'start_state': 'fibroblasts',\n\
          \                                                 'goal_state': 'iPSCs',\n\
          \                                                 'alt_states': []},\n \
          \                       max_ncells=None,\n                        emb_layer=-1,\n\
          \                        forward_batch_size=100,\n                     \
          \   nproc=72)\n\nispstats = InSilicoPerturberStats(mode=\"goal_state_shift\"\
          ,\n                                genes_perturbed=[\"ENSG00000204531\"\
          , \"ENSG00000181449\", \"ENSG00000136826\", \"ENSG00000136997\"],\n    \
          \                            combos=0,\n                               \
          \ anchor_gene=None,\n                                cell_states_to_model={'state_key':\
          \ 'cell_type',\n                                                 'start_state':\
          \ 'fibroblasts',\n                                                 'goal_state':\
          \ 'iPSCs',\n                                                 'alt_states':\
          \ []})\n\nError:\nNo cells remain after filtering. Check filtering criteria.\n\
          ---------------------------------------------------------------------------\n\
          RuntimeError                              Traceback (most recent call last)\n\
          Cell In[15], line 29\n      1 isp = InSilicoPerturber(perturb_type=\"overexpress\"\
          ,\n      2                         perturb_rank_shift=None,\n      3   \
          \                      genes_to_perturb=[\"ENSG00000204531\", \"ENSG00000181449\"\
          , \"ENSG00000136826\", \"ENSG00000136997\"],\n   (...)\n     17        \
          \                 forward_batch_size=100,\n     18                     \
          \    nproc=72)\n     20 ispstats = InSilicoPerturberStats(mode=\"goal_state_shift\"\
          ,\n     21                                 genes_perturbed=[\"ENSG00000204531\"\
          , \"ENSG00000181449\", \"ENSG00000136826\", \"ENSG00000136997\"],\n    \
          \ 22                                 combos=0,\n   (...)\n     26      \
          \                                            'goal_state': 'iPSCs',\n  \
          \   27                                                  'alt_states': []})\n\
          ---> 29 isp.perturb_data(\"\",\n     30                  \"\",\n     31\
          \                  \"\",\n     32                  \"output_prefix\")\n\n\
          File /usr/local/lib/python3.10/dist-packages/geneformer/in_silico_perturber.py:944,\
          \ in InSilicoPerturber.perturb_data(self, model_directory, input_data_file,\
          \ output_directory, output_prefix)\n    924 def perturb_data(self, \n  \
          \  925                  model_directory,\n    926                  input_data_file,\n\
          \    927                  output_directory,\n    928                  output_prefix):\n\
          \    929     \"\"\"\n    930     Perturb genes in input data and save as\
          \ results in output_directory.\n    931 \n   (...)\n    941         Prefix\
          \ for output files\n    942     \"\"\"\n--> 944     filtered_input_data\
          \ = load_and_filter(self.filter_data, self.nproc, input_data_file)\n   \
          \ 945     model = load_model(self.model_type, self.num_classes, model_directory)\n\
          \    946     layer_to_quant = quant_layers(model)+self.emb_layer\n\nFile\
          \ /usr/local/lib/python3.10/dist-packages/geneformer/in_silico_perturber.py:56,\
          \ in load_and_filter(filter_data, nproc, input_data_file)\n     53     if\
          \ len(data) == 0:\n     54         logger.error(\n     55              \
          \   \"No cells remain after filtering. Check filtering criteria.\")\n--->\
          \ 56         raise\n     57 data_shuffled = data.shuffle(seed=42)\n    \
          \ 58 return data_shuffled\n\nRuntimeError: No active exception to reraise"
        updatedAt: '2023-10-25T18:36:20.304Z'
      numEdits: 1
      reactions: []
    id: 65395fbdb5a5431cee2fa615
    type: comment
  author: lihf
  content: "Hi, thank you for this tool. I am interested in the iPSCs part of your\
    \ manuscript. I encountered this error when I tried to run your code in discussion\
    \ #101 on my machine. As far as I understand, there are no iPSCs and fibroblasts\
    \ in dataset. How can I deal with this issue? Thank you.\n\nCode:\nisp = InSilicoPerturber(perturb_type=\"\
    overexpress\",\n                        perturb_rank_shift=None,\n           \
    \             genes_to_perturb=[\"ENSG00000204531\", \"ENSG00000181449\", \"ENSG00000136826\"\
    , \"ENSG00000136997\"],\n                        combos=0,\n                 \
    \       anchor_gene=None,\n                        model_type=\"Pretrained\",\n\
    \                        num_classes=0,\n                        emb_mode=\"cell\"\
    ,\n                        cell_emb_style=\"mean_pool\",\n                   \
    \     filter_data={\"cell_type\":[\"fibroblasts\",\"iPSCs\"]},\n             \
    \           cell_states_to_model={'state_key': 'cell_type',\n                \
    \                                 'start_state': 'fibroblasts',\n            \
    \                                     'goal_state': 'iPSCs',\n               \
    \                                  'alt_states': []},\n                      \
    \  max_ncells=None,\n                        emb_layer=-1,\n                 \
    \       forward_batch_size=100,\n                        nproc=72)\n\nispstats\
    \ = InSilicoPerturberStats(mode=\"goal_state_shift\",\n                      \
    \          genes_perturbed=[\"ENSG00000204531\", \"ENSG00000181449\", \"ENSG00000136826\"\
    , \"ENSG00000136997\"],\n                                combos=0,\n         \
    \                       anchor_gene=None,\n                                cell_states_to_model={'state_key':\
    \ 'cell_type',\n                                                 'start_state':\
    \ 'fibroblasts',\n                                                 'goal_state':\
    \ 'iPSCs',\n                                                 'alt_states': []})\n\
    \nError:\nNo cells remain after filtering. Check filtering criteria.\n---------------------------------------------------------------------------\n\
    RuntimeError                              Traceback (most recent call last)\n\
    Cell In[15], line 29\n      1 isp = InSilicoPerturber(perturb_type=\"overexpress\"\
    ,\n      2                         perturb_rank_shift=None,\n      3         \
    \                genes_to_perturb=[\"ENSG00000204531\", \"ENSG00000181449\", \"\
    ENSG00000136826\", \"ENSG00000136997\"],\n   (...)\n     17                  \
    \       forward_batch_size=100,\n     18                         nproc=72)\n \
    \    20 ispstats = InSilicoPerturberStats(mode=\"goal_state_shift\",\n     21\
    \                                 genes_perturbed=[\"ENSG00000204531\", \"ENSG00000181449\"\
    , \"ENSG00000136826\", \"ENSG00000136997\"],\n     22                        \
    \         combos=0,\n   (...)\n     26                                       \
    \           'goal_state': 'iPSCs',\n     27                                  \
    \                'alt_states': []})\n---> 29 isp.perturb_data(\"\",\n     30 \
    \                 \"\",\n     31                  \"\",\n     32             \
    \     \"output_prefix\")\n\nFile /usr/local/lib/python3.10/dist-packages/geneformer/in_silico_perturber.py:944,\
    \ in InSilicoPerturber.perturb_data(self, model_directory, input_data_file, output_directory,\
    \ output_prefix)\n    924 def perturb_data(self, \n    925                  model_directory,\n\
    \    926                  input_data_file,\n    927                  output_directory,\n\
    \    928                  output_prefix):\n    929     \"\"\"\n    930     Perturb\
    \ genes in input data and save as results in output_directory.\n    931 \n   (...)\n\
    \    941         Prefix for output files\n    942     \"\"\"\n--> 944     filtered_input_data\
    \ = load_and_filter(self.filter_data, self.nproc, input_data_file)\n    945  \
    \   model = load_model(self.model_type, self.num_classes, model_directory)\n \
    \   946     layer_to_quant = quant_layers(model)+self.emb_layer\n\nFile /usr/local/lib/python3.10/dist-packages/geneformer/in_silico_perturber.py:56,\
    \ in load_and_filter(filter_data, nproc, input_data_file)\n     53     if len(data)\
    \ == 0:\n     54         logger.error(\n     55                 \"No cells remain\
    \ after filtering. Check filtering criteria.\")\n---> 56         raise\n     57\
    \ data_shuffled = data.shuffle(seed=42)\n     58 return data_shuffled\n\nRuntimeError:\
    \ No active exception to reraise"
  created_at: 2023-10-25 17:34:37+00:00
  edited: true
  hidden: false
  id: 65395fbdb5a5431cee2fa615
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-10-25T19:20:52.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9578863382339478
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your interest in Geneformer! If the issue is that
          you are getting no cells filtered after the filtering criteria, then you
          should check to make sure your "cell_type" attribute in your dataset has
          the two states you wrote in your code, which are ["fibroblasts","iPSCs"].
          If those are not present, then you need to modify the code to include the
          labels you have in your dataset for these two states.</p>

          '
        raw: Thank you for your interest in Geneformer! If the issue is that you are
          getting no cells filtered after the filtering criteria, then you should
          check to make sure your "cell_type" attribute in your dataset has the two
          states you wrote in your code, which are ["fibroblasts","iPSCs"]. If those
          are not present, then you need to modify the code to include the labels
          you have in your dataset for these two states.
        updatedAt: '2023-10-25T19:20:52.260Z'
      numEdits: 0
      reactions: []
      relatedEventId: 65396a944037a1bc44000cc2
    id: 65396a944037a1bc44000cc0
    type: comment
  author: ctheodoris
  content: Thank you for your interest in Geneformer! If the issue is that you are
    getting no cells filtered after the filtering criteria, then you should check
    to make sure your "cell_type" attribute in your dataset has the two states you
    wrote in your code, which are ["fibroblasts","iPSCs"]. If those are not present,
    then you need to modify the code to include the labels you have in your dataset
    for these two states.
  created_at: 2023-10-25 18:20:52+00:00
  edited: false
  hidden: false
  id: 65396a944037a1bc44000cc0
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-10-25T19:20:52.000Z'
    data:
      status: closed
    id: 65396a944037a1bc44000cc2
    type: status-change
  author: ctheodoris
  created_at: 2023-10-25 18:20:52+00:00
  id: 65396a944037a1bc44000cc2
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 270
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: 'Error: No cells remain after filtering.'
