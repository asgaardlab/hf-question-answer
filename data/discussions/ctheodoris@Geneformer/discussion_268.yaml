!!python/object:huggingface_hub.community.DiscussionWithDetails
author: kchen360
conflicting_files: null
created_at: 2023-10-19 05:14:42+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/947ad2da1f7a9a2466ab90e75e86ab07.svg
      fullname: Kai Chen
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: kchen360
      type: user
    createdAt: '2023-10-19T06:14:42.000Z'
    data:
      edited: false
      editors:
      - kchen360
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6815062165260315
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/947ad2da1f7a9a2466ab90e75e86ab07.svg
          fullname: Kai Chen
          isHf: false
          isPro: false
          name: kchen360
          type: user
        html: "<p>Hi,</p>\n<p>I tried to repeat hyperparameter optimization progress\
          \ using pretrained model geneformer-6L-30M_CellClassifier_cardiomyopathies_220224\
          \ and embedded input dataset human_dcm_hcm_nf.dataset as suggested in the\
          \ example. However I encounter the following error:  </p>\n<pre><code>Traceback\
          \ (most recent call last):\n  File \"/home/Geneformer/hyperparam_optimiz_for_disease_classifier.py\"\
          , line 214, in &lt;module&gt;\n    trainer.hyperparameter_search(\n  File\
          \ \"/home/anaconda3/envs/lib/python3.9/site-packages/transformers/trainer.py\"\
          , line 2672, in hyperparameter_search\n    best_run = backend_obj.run(self,\
          \ n_trials, direction, **kwargs)\n  File \"/home/anaconda3/envs/lib/python3.9/site-packages/transformers/hyperparameter_search.py\"\
          , line 87,in run\n    return run_hp_search_ray(trainer, n_trials, direction,\
          \ **kwargs)\n  File \"/home/anaconda3/envs/lib/python3.9/site-packages/transformers/integrations/integration_utils.py\"\
          ,line 334, in run_hp_search_ray\n    trainable = ray.tune.with_parameters(_objective,\
          \ local_trainer=trainer)\n  File \"/home/anaconda3/envs/lib/python3.9/site-packages/ray/tune/trainable/util.py\"\
          , line 315, in with_parameters\n    raise DeprecationWarning(_CHECKPOINT_DIR_ARG_DEPRECATION_MSG)\n\
          DeprecationWarning: Accepting a `checkpoint_dir` argument in your training\
          \ function is deprecated.\nPlease use `ray.train.get_checkpoint()` to access\
          \ your checkpoint as a\n`ray.train.Checkpoint` object instead. See below\
          \ for an example:\n</code></pre>\n<p>I guess I was using different python\
          \ package version, could you please share what version of ray you use for\
          \ your code? Thank you very much.</p>\n"
        raw: "Hi,\r\n\r\nI tried to repeat hyperparameter optimization progress using\
          \ pretrained model geneformer-6L-30M_CellClassifier_cardiomyopathies_220224\
          \ and embedded input dataset human_dcm_hcm_nf.dataset as suggested in the\
          \ example. However I encounter the following error:  \r\n\r\n```\r\nTraceback\
          \ (most recent call last):\r\n  File \"/home/Geneformer/hyperparam_optimiz_for_disease_classifier.py\"\
          , line 214, in <module>\r\n    trainer.hyperparameter_search(\r\n  File\
          \ \"/home/anaconda3/envs/lib/python3.9/site-packages/transformers/trainer.py\"\
          , line 2672, in hyperparameter_search\r\n    best_run = backend_obj.run(self,\
          \ n_trials, direction, **kwargs)\r\n  File \"/home/anaconda3/envs/lib/python3.9/site-packages/transformers/hyperparameter_search.py\"\
          , line 87,in run\r\n    return run_hp_search_ray(trainer, n_trials, direction,\
          \ **kwargs)\r\n  File \"/home/anaconda3/envs/lib/python3.9/site-packages/transformers/integrations/integration_utils.py\"\
          ,line 334, in run_hp_search_ray\r\n    trainable = ray.tune.with_parameters(_objective,\
          \ local_trainer=trainer)\r\n  File \"/home/anaconda3/envs/lib/python3.9/site-packages/ray/tune/trainable/util.py\"\
          , line 315, in with_parameters\r\n    raise DeprecationWarning(_CHECKPOINT_DIR_ARG_DEPRECATION_MSG)\r\
          \nDeprecationWarning: Accepting a `checkpoint_dir` argument in your training\
          \ function is deprecated.\r\nPlease use `ray.train.get_checkpoint()` to\
          \ access your checkpoint as a\r\n`ray.train.Checkpoint` object instead.\
          \ See below for an example:\r\n```\r\n\r\nI guess I was using different\
          \ python package version, could you please share what version of ray you\
          \ use for your code? Thank you very much."
        updatedAt: '2023-10-19T06:14:42.313Z'
      numEdits: 0
      reactions: []
    id: 6530c95201a1a4ee278d7e83
    type: comment
  author: kchen360
  content: "Hi,\r\n\r\nI tried to repeat hyperparameter optimization progress using\
    \ pretrained model geneformer-6L-30M_CellClassifier_cardiomyopathies_220224 and\
    \ embedded input dataset human_dcm_hcm_nf.dataset as suggested in the example.\
    \ However I encounter the following error:  \r\n\r\n```\r\nTraceback (most recent\
    \ call last):\r\n  File \"/home/Geneformer/hyperparam_optimiz_for_disease_classifier.py\"\
    , line 214, in <module>\r\n    trainer.hyperparameter_search(\r\n  File \"/home/anaconda3/envs/lib/python3.9/site-packages/transformers/trainer.py\"\
    , line 2672, in hyperparameter_search\r\n    best_run = backend_obj.run(self,\
    \ n_trials, direction, **kwargs)\r\n  File \"/home/anaconda3/envs/lib/python3.9/site-packages/transformers/hyperparameter_search.py\"\
    , line 87,in run\r\n    return run_hp_search_ray(trainer, n_trials, direction,\
    \ **kwargs)\r\n  File \"/home/anaconda3/envs/lib/python3.9/site-packages/transformers/integrations/integration_utils.py\"\
    ,line 334, in run_hp_search_ray\r\n    trainable = ray.tune.with_parameters(_objective,\
    \ local_trainer=trainer)\r\n  File \"/home/anaconda3/envs/lib/python3.9/site-packages/ray/tune/trainable/util.py\"\
    , line 315, in with_parameters\r\n    raise DeprecationWarning(_CHECKPOINT_DIR_ARG_DEPRECATION_MSG)\r\
    \nDeprecationWarning: Accepting a `checkpoint_dir` argument in your training function\
    \ is deprecated.\r\nPlease use `ray.train.get_checkpoint()` to access your checkpoint\
    \ as a\r\n`ray.train.Checkpoint` object instead. See below for an example:\r\n\
    ```\r\n\r\nI guess I was using different python package version, could you please\
    \ share what version of ray you use for your code? Thank you very much."
  created_at: 2023-10-19 05:14:42+00:00
  edited: false
  hidden: false
  id: 6530c95201a1a4ee278d7e83
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-10-25T19:22:19.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8476341366767883
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your interest in Geneformer! Please see discussions
          <a href="/ctheodoris/Geneformer/discussions/217">#217</a>-218.</p>

          '
        raw: 'Thank you for your interest in Geneformer! Please see discussions #217-218.'
        updatedAt: '2023-10-25T19:22:19.143Z'
      numEdits: 0
      reactions: []
      relatedEventId: 65396aeb821b9e4a34a33838
    id: 65396aeb821b9e4a34a33836
    type: comment
  author: ctheodoris
  content: 'Thank you for your interest in Geneformer! Please see discussions #217-218.'
  created_at: 2023-10-25 18:22:19+00:00
  edited: false
  hidden: false
  id: 65396aeb821b9e4a34a33836
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-10-25T19:22:19.000Z'
    data:
      status: closed
    id: 65396aeb821b9e4a34a33838
    type: status-change
  author: ctheodoris
  created_at: 2023-10-25 18:22:19+00:00
  id: 65396aeb821b9e4a34a33838
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/947ad2da1f7a9a2466ab90e75e86ab07.svg
      fullname: Kai Chen
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: kchen360
      type: user
    createdAt: '2023-10-30T19:13:00.000Z'
    data:
      edited: true
      editors:
      - kchen360
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8604191541671753
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/947ad2da1f7a9a2466ab90e75e86ab07.svg
          fullname: Kai Chen
          isHf: false
          isPro: false
          name: kchen360
          type: user
        html: "<p>Just edit this part if anyone happen to have same issue, it was\
          \ something to do with packages dependency in virtual environment if you\
          \ use a virtual env to run the script:</p>\n<p>We installed python 3.10\
          \ followed by ray==2.6.2 as suggested. Yet we found module notFound error\
          \ when executing ray in virtual environment even it's installed. This was\
          \ because the script was trying to find default libraries in python library\
          \ directs but not libraries in virtual env:</p>\n<pre><code>(raylet)   File\
          \ \"/home/anaconda3/envs/myvirenv_py310/lib/python3.10/site-packages/ray/_private/workers/default_worker.py\"\
          , line 7, in &lt;module&gt;\n(raylet)     import ray\n(raylet) ModuleNotFoundError:\
          \ No module named 'ray'\n</code></pre>\n<p>The solution was to tweak this\
          \ two lines of code in the script:</p>\n<pre><code>runtime_env = {\"conda\"\
          : \"&lt;YOUR VIRTUAL ENV NAME&gt;\",\n               \"env_vars\": {\"LD_LIBRARY_PATH\"\
          : \"&lt;path to miniconda&gt;\"}}\n</code></pre>\n<pre><code># Usage:\n\
          ip = '&lt;YOUR IP ADDRESS&gt;:&lt;PORT&gt;'  # Replace with your actual\
          \ IP address and port\nif initialize_ray_with_check(ip):\n    print(\"Ray\
          \ initialized successfully.\")\nelse:\n    print(\"Error during Ray initialization.\"\
          )\n</code></pre>\n"
        raw: "Just edit this part if anyone happen to have same issue, it was something\
          \ to do with packages dependency in virtual environment if you use a virtual\
          \ env to run the script:\n\nWe installed python 3.10 followed by ray==2.6.2\
          \ as suggested. Yet we found module notFound error when executing ray in\
          \ virtual environment even it's installed. This was because the script was\
          \ trying to find default libraries in python library directs but not libraries\
          \ in virtual env:\n\n```\n(raylet)   File \"/home/anaconda3/envs/myvirenv_py310/lib/python3.10/site-packages/ray/_private/workers/default_worker.py\"\
          , line 7, in <module>\n(raylet)     import ray\n(raylet) ModuleNotFoundError:\
          \ No module named 'ray'\n```\n\nThe solution was to tweak this two lines\
          \ of code in the script:\n```\nruntime_env = {\"conda\": \"<YOUR VIRTUAL\
          \ ENV NAME>\",\n               \"env_vars\": {\"LD_LIBRARY_PATH\": \"<path\
          \ to miniconda>\"}}\n```\n\n```\n# Usage:\nip = '<YOUR IP ADDRESS>:<PORT>'\
          \  # Replace with your actual IP address and port\nif initialize_ray_with_check(ip):\n\
          \    print(\"Ray initialized successfully.\")\nelse:\n    print(\"Error\
          \ during Ray initialization.\")\n```\n\n\n"
        updatedAt: '2023-10-30T19:20:04.162Z'
      numEdits: 1
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - ctheodoris
    id: 6540003ccdc9c22e359dcb60
    type: comment
  author: kchen360
  content: "Just edit this part if anyone happen to have same issue, it was something\
    \ to do with packages dependency in virtual environment if you use a virtual env\
    \ to run the script:\n\nWe installed python 3.10 followed by ray==2.6.2 as suggested.\
    \ Yet we found module notFound error when executing ray in virtual environment\
    \ even it's installed. This was because the script was trying to find default\
    \ libraries in python library directs but not libraries in virtual env:\n\n```\n\
    (raylet)   File \"/home/anaconda3/envs/myvirenv_py310/lib/python3.10/site-packages/ray/_private/workers/default_worker.py\"\
    , line 7, in <module>\n(raylet)     import ray\n(raylet) ModuleNotFoundError:\
    \ No module named 'ray'\n```\n\nThe solution was to tweak this two lines of code\
    \ in the script:\n```\nruntime_env = {\"conda\": \"<YOUR VIRTUAL ENV NAME>\",\n\
    \               \"env_vars\": {\"LD_LIBRARY_PATH\": \"<path to miniconda>\"}}\n\
    ```\n\n```\n# Usage:\nip = '<YOUR IP ADDRESS>:<PORT>'  # Replace with your actual\
    \ IP address and port\nif initialize_ray_with_check(ip):\n    print(\"Ray initialized\
    \ successfully.\")\nelse:\n    print(\"Error during Ray initialization.\")\n```\n\
    \n\n"
  created_at: 2023-10-30 18:13:00+00:00
  edited: true
  hidden: false
  id: 6540003ccdc9c22e359dcb60
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 268
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: '[Ray version] for hyperparameters optimization'
