!!python/object:huggingface_hub.community.DiscussionWithDetails
author: mriee
conflicting_files: null
created_at: 2023-07-28 16:02:00+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1655120529835-62a722837b20d46fad81a437.jpeg?w=200&h=200&f=face
      fullname: MRIEE
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: mriee
      type: user
    createdAt: '2023-07-28T17:02:00.000Z'
    data:
      edited: true
      editors:
      - mriee
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.756798505783081
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1655120529835-62a722837b20d46fad81a437.jpeg?w=200&h=200&f=face
          fullname: MRIEE
          isHf: false
          isPro: false
          name: mriee
          type: user
        html: "<p>Thank you for your outstanding work. I encountered difficulties\
          \ while trying to reproduce your results from the \"in silico treatment\
          \ analysis\". I set up my configuration according to the in_silico_perturbation.ipynb:</p>\n\
          <pre><code>isp = InSilicoPerturber(perturb_type=\"delete\",\n          \
          \              perturb_rank_shift=None,\n                        genes_to_perturb=\"\
          all\",\n                        combos=0,\n                        anchor_gene=None,\n\
          \                        model_type=\"CellClassifier\",\n              \
          \          num_classes=3,\n                        emb_mode=\"cell\",\n\
          \                        cell_emb_style=\"mean_pool\",\n               \
          \         filter_data={\"cell_type\":[\"Cardiomyocyte1\",\"Cardiomyocyte2\"\
          ,\"Cardiomyocyte3\"]},\n                        cell_states_to_model={\"\
          disease\":([\"dcm\"],[\"nf\"],[\"hcm\"])},\n                        max_ncells=None,\n\
          \                        emb_layer=0,\n                        forward_batch_size=400,\n\
          \                        nproc=20)\nisp.perturb_data(\"path/to/fine-tuned-model\"\
          ,\n                 \"path/to/Genecorpus-30M/example_input_files/cell_classification/disease_classification/human_dcm_hcm_nf.dataset\"\
          ,\n                 \"path/to/perturb_output_directory\",\n            \
          \     \"output_prefix\")\nispstats = InSilicoPerturberStats(mode=\"goal_state_shift\"\
          ,\n                                  genes_perturbed=\"all\",\n        \
          \                          combos=0,\n                                 \
          \ anchor_gene=None,\n                                  cell_states_to_model={\"\
          disease\":([\"dcm\"],[\"nf\"],[\"hcm\"])})\nispstats.get_stats(\"path/to/perturb_output_directory\"\
          ,\n                   None,\n                   \"path/to/stats_output_directory\"\
          ,\n                   \"stats_prefix\")\n</code></pre>\n<p>However, there\
          \ is a significant discrepancy between the Shift results I obtained and\
          \ those in the DCM_del_tx worksheet of Supplementary Table 12. I also noticed\
          \ that there is a large difference between the N_Detections and #_Detections\
          \ in the results. For example, for the gene RYR2 (Gene_Token=17173, Ensembl_ID=ENSG00000198626),\
          \ the N_Detections in my results was 29981, whereas in Table 12, the #_Detections\
          \ was 9611. I understand that the paper may have selected a subset. So,\
          \ I counted the number of times RYR2 appeared in different individuals with\
          \ dcm among all cardiomyocytes (cell_type=Cardiomyocyte1/2/3 and disease=dcm):</p>\n\
          <pre><code># 'individual': counts\n{'1430': 2091,\n '1371': 4578,\n '1300':\
          \ 1884,\n '1617': 3152,\n '1290': 1818,\n '1437': 2889,\n '1358': 3739,\n\
          \ '1304': 4280,\n '1504': 1115,\n '1472': 3850,\n '1606': 585}\n</code></pre>\n\
          <p>As you can see, their sum is 29981, but I can't figure out how to add\
          \ up to 9611. Did I miss something in the data processing? Thank you!</p>\n"
        raw: "Thank you for your outstanding work. I encountered difficulties while\
          \ trying to reproduce your results from the \"in silico treatment analysis\"\
          . I set up my configuration according to the in_silico_perturbation.ipynb:\n\
          \n```\nisp = InSilicoPerturber(perturb_type=\"delete\",\n              \
          \          perturb_rank_shift=None,\n                        genes_to_perturb=\"\
          all\",\n                        combos=0,\n                        anchor_gene=None,\n\
          \                        model_type=\"CellClassifier\",\n              \
          \          num_classes=3,\n                        emb_mode=\"cell\",\n\
          \                        cell_emb_style=\"mean_pool\",\n               \
          \         filter_data={\"cell_type\":[\"Cardiomyocyte1\",\"Cardiomyocyte2\"\
          ,\"Cardiomyocyte3\"]},\n                        cell_states_to_model={\"\
          disease\":([\"dcm\"],[\"nf\"],[\"hcm\"])},\n                        max_ncells=None,\n\
          \                        emb_layer=0,\n                        forward_batch_size=400,\n\
          \                        nproc=20)\nisp.perturb_data(\"path/to/fine-tuned-model\"\
          ,\n                 \"path/to/Genecorpus-30M/example_input_files/cell_classification/disease_classification/human_dcm_hcm_nf.dataset\"\
          ,\n                 \"path/to/perturb_output_directory\",\n            \
          \     \"output_prefix\")\nispstats = InSilicoPerturberStats(mode=\"goal_state_shift\"\
          ,\n                                  genes_perturbed=\"all\",\n        \
          \                          combos=0,\n                                 \
          \ anchor_gene=None,\n                                  cell_states_to_model={\"\
          disease\":([\"dcm\"],[\"nf\"],[\"hcm\"])})\nispstats.get_stats(\"path/to/perturb_output_directory\"\
          ,\n                   None,\n                   \"path/to/stats_output_directory\"\
          ,\n                   \"stats_prefix\")\n```\n\nHowever, there is a significant\
          \ discrepancy between the Shift results I obtained and those in the DCM_del_tx\
          \ worksheet of Supplementary Table 12. I also noticed that there is a large\
          \ difference between the N_Detections and #_Detections in the results. For\
          \ example, for the gene RYR2 (Gene_Token=17173, Ensembl_ID=ENSG00000198626),\
          \ the N_Detections in my results was 29981, whereas in Table 12, the #_Detections\
          \ was 9611. I understand that the paper may have selected a subset. So,\
          \ I counted the number of times RYR2 appeared in different individuals with\
          \ dcm among all cardiomyocytes (cell_type=Cardiomyocyte1/2/3 and disease=dcm):\n\
          \n```\n# 'individual': counts\n{'1430': 2091,\n '1371': 4578,\n '1300':\
          \ 1884,\n '1617': 3152,\n '1290': 1818,\n '1437': 2889,\n '1358': 3739,\n\
          \ '1304': 4280,\n '1504': 1115,\n '1472': 3850,\n '1606': 585}\n```\n\n\
          As you can see, their sum is 29981, but I can't figure out how to add up\
          \ to 9611. Did I miss something in the data processing? Thank you!"
        updatedAt: '2023-08-04T15:37:53.554Z'
      numEdits: 4
      reactions: []
    id: 64c3f488e4e2212a4fe32b28
    type: comment
  author: mriee
  content: "Thank you for your outstanding work. I encountered difficulties while\
    \ trying to reproduce your results from the \"in silico treatment analysis\".\
    \ I set up my configuration according to the in_silico_perturbation.ipynb:\n\n\
    ```\nisp = InSilicoPerturber(perturb_type=\"delete\",\n                      \
    \  perturb_rank_shift=None,\n                        genes_to_perturb=\"all\"\
    ,\n                        combos=0,\n                        anchor_gene=None,\n\
    \                        model_type=\"CellClassifier\",\n                    \
    \    num_classes=3,\n                        emb_mode=\"cell\",\n            \
    \            cell_emb_style=\"mean_pool\",\n                        filter_data={\"\
    cell_type\":[\"Cardiomyocyte1\",\"Cardiomyocyte2\",\"Cardiomyocyte3\"]},\n   \
    \                     cell_states_to_model={\"disease\":([\"dcm\"],[\"nf\"],[\"\
    hcm\"])},\n                        max_ncells=None,\n                        emb_layer=0,\n\
    \                        forward_batch_size=400,\n                        nproc=20)\n\
    isp.perturb_data(\"path/to/fine-tuned-model\",\n                 \"path/to/Genecorpus-30M/example_input_files/cell_classification/disease_classification/human_dcm_hcm_nf.dataset\"\
    ,\n                 \"path/to/perturb_output_directory\",\n                 \"\
    output_prefix\")\nispstats = InSilicoPerturberStats(mode=\"goal_state_shift\"\
    ,\n                                  genes_perturbed=\"all\",\n              \
    \                    combos=0,\n                                  anchor_gene=None,\n\
    \                                  cell_states_to_model={\"disease\":([\"dcm\"\
    ],[\"nf\"],[\"hcm\"])})\nispstats.get_stats(\"path/to/perturb_output_directory\"\
    ,\n                   None,\n                   \"path/to/stats_output_directory\"\
    ,\n                   \"stats_prefix\")\n```\n\nHowever, there is a significant\
    \ discrepancy between the Shift results I obtained and those in the DCM_del_tx\
    \ worksheet of Supplementary Table 12. I also noticed that there is a large difference\
    \ between the N_Detections and #_Detections in the results. For example, for the\
    \ gene RYR2 (Gene_Token=17173, Ensembl_ID=ENSG00000198626), the N_Detections in\
    \ my results was 29981, whereas in Table 12, the #_Detections was 9611. I understand\
    \ that the paper may have selected a subset. So, I counted the number of times\
    \ RYR2 appeared in different individuals with dcm among all cardiomyocytes (cell_type=Cardiomyocyte1/2/3\
    \ and disease=dcm):\n\n```\n# 'individual': counts\n{'1430': 2091,\n '1371': 4578,\n\
    \ '1300': 1884,\n '1617': 3152,\n '1290': 1818,\n '1437': 2889,\n '1358': 3739,\n\
    \ '1304': 4280,\n '1504': 1115,\n '1472': 3850,\n '1606': 585}\n```\n\nAs you\
    \ can see, their sum is 29981, but I can't figure out how to add up to 9611. Did\
    \ I miss something in the data processing? Thank you!"
  created_at: 2023-07-28 16:02:00+00:00
  edited: true
  hidden: false
  id: 64c3f488e4e2212a4fe32b28
  type: comment
- !!python/object:huggingface_hub.community.DiscussionTitleChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1655120529835-62a722837b20d46fad81a437.jpeg?w=200&h=200&f=face
      fullname: MRIEE
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: mriee
      type: user
    createdAt: '2023-07-28T17:11:57.000Z'
    data:
      from: Problems in replicating data processing in treatment analysis
      to: Problems in replicating in silico treatment analysis
    id: 64c3f6dd8f31d1e6c66ca79c
    type: title-change
  author: mriee
  created_at: 2023-07-28 16:11:57+00:00
  id: 64c3f6dd8f31d1e6c66ca79c
  new_title: Problems in replicating in silico treatment analysis
  old_title: Problems in replicating data processing in treatment analysis
  type: title-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-07-30T02:21:27.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9635339975357056
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your question and interest in Geneformer! We did not
          have the code packaged into modules the way it is now when we ran our analyses
          (we packaged it afterwards to make it easier for others to use) but the
          way you are setting up the in silico perturber is consistent with how we
          ran the analyses. Although we did not select a particular subset of individuals
          for the analysis, our cluster had a max job time limit so we had to run
          a subset of cells from the dataset as a whole for the analysis. One thing
          to keep in mind is because the statistics depend on the number of detections,
          running more cells may lead to a higher number of genes being called as
          significant.</p>

          '
        raw: Thank you for your question and interest in Geneformer! We did not have
          the code packaged into modules the way it is now when we ran our analyses
          (we packaged it afterwards to make it easier for others to use) but the
          way you are setting up the in silico perturber is consistent with how we
          ran the analyses. Although we did not select a particular subset of individuals
          for the analysis, our cluster had a max job time limit so we had to run
          a subset of cells from the dataset as a whole for the analysis. One thing
          to keep in mind is because the statistics depend on the number of detections,
          running more cells may lead to a higher number of genes being called as
          significant.
        updatedAt: '2023-07-30T02:21:27.938Z'
      numEdits: 0
      reactions: []
      relatedEventId: 64c5c9272d07296c7e3e964b
    id: 64c5c9272d07296c7e3e964a
    type: comment
  author: ctheodoris
  content: Thank you for your question and interest in Geneformer! We did not have
    the code packaged into modules the way it is now when we ran our analyses (we
    packaged it afterwards to make it easier for others to use) but the way you are
    setting up the in silico perturber is consistent with how we ran the analyses.
    Although we did not select a particular subset of individuals for the analysis,
    our cluster had a max job time limit so we had to run a subset of cells from the
    dataset as a whole for the analysis. One thing to keep in mind is because the
    statistics depend on the number of detections, running more cells may lead to
    a higher number of genes being called as significant.
  created_at: 2023-07-30 01:21:27+00:00
  edited: false
  hidden: false
  id: 64c5c9272d07296c7e3e964a
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-07-30T02:21:27.000Z'
    data:
      status: closed
    id: 64c5c9272d07296c7e3e964b
    type: status-change
  author: ctheodoris
  created_at: 2023-07-30 01:21:27+00:00
  id: 64c5c9272d07296c7e3e964b
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/2e19b0efd2e371d62a492c416f5d9ca1.svg
      fullname: Matthew Pace
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Pingiotto
      type: user
    createdAt: '2023-08-04T14:40:42.000Z'
    data:
      edited: false
      editors:
      - Pingiotto
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.4578544497489929
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/2e19b0efd2e371d62a492c416f5d9ca1.svg
          fullname: Matthew Pace
          isHf: false
          isPro: false
          name: Pingiotto
          type: user
        html: '<p>Shouldnt the input for ispstats.get_stats() be the intermediate
          files generated by isp.perturb_data()?</p>

          '
        raw: Shouldnt the input for ispstats.get_stats() be the intermediate files
          generated by isp.perturb_data()?
        updatedAt: '2023-08-04T14:40:42.859Z'
      numEdits: 0
      reactions: []
    id: 64cd0dea1e45e08b474596fb
    type: comment
  author: Pingiotto
  content: Shouldnt the input for ispstats.get_stats() be the intermediate files generated
    by isp.perturb_data()?
  created_at: 2023-08-04 13:40:42+00:00
  edited: false
  hidden: false
  id: 64cd0dea1e45e08b474596fb
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-08-04T15:29:32.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8568885326385498
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Yes, that is correct. If you run the perturb_data part with more
          cells, then the result from more cells will be available to the get_stats
          part, so the number of detections will be higher because the genes will
          be observed more times in more cells.</p>

          '
        raw: Yes, that is correct. If you run the perturb_data part with more cells,
          then the result from more cells will be available to the get_stats part,
          so the number of detections will be higher because the genes will be observed
          more times in more cells.
        updatedAt: '2023-08-04T15:29:32.718Z'
      numEdits: 0
      reactions: []
    id: 64cd195c5a8b0a89502c1f6c
    type: comment
  author: ctheodoris
  content: Yes, that is correct. If you run the perturb_data part with more cells,
    then the result from more cells will be available to the get_stats part, so the
    number of detections will be higher because the genes will be observed more times
    in more cells.
  created_at: 2023-08-04 14:29:32+00:00
  edited: false
  hidden: false
  id: 64cd195c5a8b0a89502c1f6c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1655120529835-62a722837b20d46fad81a437.jpeg?w=200&h=200&f=face
      fullname: MRIEE
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: mriee
      type: user
    createdAt: '2023-08-04T15:34:14.000Z'
    data:
      edited: true
      editors:
      - mriee
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6274481415748596
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1655120529835-62a722837b20d46fad81a437.jpeg?w=200&h=200&f=face
          fullname: MRIEE
          isHf: false
          isPro: false
          name: mriee
          type: user
        html: "<blockquote>\n<p>Shouldnt the input for ispstats.get_stats() be the\
          \ intermediate files generated by isp.perturb_data()?</p>\n</blockquote>\n\
          <p>I made a mistake in composing my post, I actually ran the following code:</p>\n\
          <pre><code>ispstats.get_stats(\"path/to/output_directory\",\n          \
          \         None,\n                   \"path/to/output_directory\",\n    \
          \               \"stats_prefix\")\n</code></pre>\n<p>It reads the cos similarity\
          \ data from the output of the first step and then saves the stats in the\
          \ same directory in csv format. I have corrected the relevant statement\
          \ in the middle of my post.</p>\n"
        raw: "> Shouldnt the input for ispstats.get_stats() be the intermediate files\
          \ generated by isp.perturb_data()?\n\nI made a mistake in composing my post,\
          \ I actually ran the following code:\n```\nispstats.get_stats(\"path/to/output_directory\"\
          ,\n                   None,\n                   \"path/to/output_directory\"\
          ,\n                   \"stats_prefix\")\n```\nIt reads the cos similarity\
          \ data from the output of the first step and then saves the stats in the\
          \ same directory in csv format. I have corrected the relevant statement\
          \ in the middle of my post."
        updatedAt: '2023-08-04T15:41:58.316Z'
      numEdits: 2
      reactions: []
    id: 64cd1a763730cb6f34dcf5f2
    type: comment
  author: mriee
  content: "> Shouldnt the input for ispstats.get_stats() be the intermediate files\
    \ generated by isp.perturb_data()?\n\nI made a mistake in composing my post, I\
    \ actually ran the following code:\n```\nispstats.get_stats(\"path/to/output_directory\"\
    ,\n                   None,\n                   \"path/to/output_directory\",\n\
    \                   \"stats_prefix\")\n```\nIt reads the cos similarity data from\
    \ the output of the first step and then saves the stats in the same directory\
    \ in csv format. I have corrected the relevant statement in the middle of my post."
  created_at: 2023-08-04 14:34:14+00:00
  edited: true
  hidden: false
  id: 64cd1a763730cb6f34dcf5f2
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 140
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: Problems in replicating in silico treatment analysis
