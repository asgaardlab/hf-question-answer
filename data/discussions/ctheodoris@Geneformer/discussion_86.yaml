!!python/object:huggingface_hub.community.DiscussionWithDetails
author: Renqing
conflicting_files: null
created_at: 2023-07-04 04:51:48+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/96dfc7cd6acde7bc305a6e3d7cfd8f81.svg
      fullname: Renqing Nie
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Renqing
      type: user
    createdAt: '2023-07-04T05:51:48.000Z'
    data:
      edited: true
      editors:
      - Renqing
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9196073412895203
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/96dfc7cd6acde7bc305a6e3d7cfd8f81.svg
          fullname: Renqing Nie
          isHf: false
          isPro: false
          name: Renqing
          type: user
        html: '<p>Hello, I want to reproduce your paper results in the part of <code>In
          silico treatment analysis</code>.<br>I first fine-tuned the data you provided
          for cardiomyopathy so that the model could differentiate between the different
          states, hcm,nf,dcm.<br>Next, use the <code>InSilicoPerturber function</code>
          to perform gene deletion perturbation, and set the maximum cell number parameter
          to <code>none</code>, that is, use all cells for testing.<br>I have only
          16gb of memory in one GPU here, all will appear OOM, I tried to set the
          batch size to 4, still not working. Finally I tested here with a batch size
          of 4 and a maximum cell count of 6500 can run. But the results obtained
          are very different from your article.<br>In order to get the results conveniently,
          I tested the <code>ADCY5  SRPK3</code> two genes mentioned in this part
          of your article, and the results are as follows.</p>

          <p><a rel="nofollow" href="https://cdn-uploads.huggingface.co/production/uploads/640fc3c5f2d7c41a1ea077df/BbyQA4u8H2IqD2GRYHp7f.png"><img
          alt="image.png" src="https://cdn-uploads.huggingface.co/production/uploads/640fc3c5f2d7c41a1ea077df/BbyQA4u8H2IqD2GRYHp7f.png"></a><br>The
          final point I would like to make is that is the number of cells tested the
          main reason for such a large gap?</p>

          '
        raw: "Hello, I want to reproduce your paper results in the part of `In silico\
          \ treatment analysis`. \nI first fine-tuned the data you provided for cardiomyopathy\
          \ so that the model could differentiate between the different states, hcm,nf,dcm.\n\
          Next, use the `InSilicoPerturber function` to perform gene deletion perturbation,\
          \ and set the maximum cell number parameter to `none`, that is, use all\
          \ cells for testing.\nI have only 16gb of memory in one GPU here, all will\
          \ appear OOM, I tried to set the batch size to 4, still not working. Finally\
          \ I tested here with a batch size of 4 and a maximum cell count of 6500\
          \ can run. But the results obtained are very different from your article.\n\
          In order to get the results conveniently, I tested the `ADCY5  SRPK3` two\
          \ genes mentioned in this part of your article, and the results are as follows.\n\
          \n![image.png](https://cdn-uploads.huggingface.co/production/uploads/640fc3c5f2d7c41a1ea077df/BbyQA4u8H2IqD2GRYHp7f.png)\n\
          The final point I would like to make is that is the number of cells tested\
          \ the main reason for such a large gap?\n\n\n\n"
        updatedAt: '2023-07-04T05:52:02.434Z'
      numEdits: 1
      reactions: []
    id: 64a3b3747068337139e6b10f
    type: comment
  author: Renqing
  content: "Hello, I want to reproduce your paper results in the part of `In silico\
    \ treatment analysis`. \nI first fine-tuned the data you provided for cardiomyopathy\
    \ so that the model could differentiate between the different states, hcm,nf,dcm.\n\
    Next, use the `InSilicoPerturber function` to perform gene deletion perturbation,\
    \ and set the maximum cell number parameter to `none`, that is, use all cells\
    \ for testing.\nI have only 16gb of memory in one GPU here, all will appear OOM,\
    \ I tried to set the batch size to 4, still not working. Finally I tested here\
    \ with a batch size of 4 and a maximum cell count of 6500 can run. But the results\
    \ obtained are very different from your article.\nIn order to get the results\
    \ conveniently, I tested the `ADCY5  SRPK3` two genes mentioned in this part of\
    \ your article, and the results are as follows.\n\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/640fc3c5f2d7c41a1ea077df/BbyQA4u8H2IqD2GRYHp7f.png)\n\
    The final point I would like to make is that is the number of cells tested the\
    \ main reason for such a large gap?\n\n\n\n"
  created_at: 2023-07-04 04:51:48+00:00
  edited: true
  hidden: false
  id: 64a3b3747068337139e6b10f
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/96dfc7cd6acde7bc305a6e3d7cfd8f81.svg
      fullname: Renqing Nie
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Renqing
      type: user
    createdAt: '2023-07-04T05:54:20.000Z'
    data:
      edited: false
      editors:
      - Renqing
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9455748796463013
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/96dfc7cd6acde7bc305a6e3d7cfd8f81.svg
          fullname: Renqing Nie
          isHf: false
          isPro: false
          name: Renqing
          type: user
        html: '<p>Or do you have a minimum threshold for how many cells to test for
          statistical power somewhere?</p>

          '
        raw: Or do you have a minimum threshold for how many cells to test for statistical
          power somewhere?
        updatedAt: '2023-07-04T05:54:20.999Z'
      numEdits: 0
      reactions: []
    id: 64a3b40c6badc2ebd1e357c9
    type: comment
  author: Renqing
  content: Or do you have a minimum threshold for how many cells to test for statistical
    power somewhere?
  created_at: 2023-07-04 04:54:20+00:00
  edited: false
  hidden: false
  id: 64a3b40c6badc2ebd1e357c9
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-07-04T07:02:42.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9489101767539978
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your question. The number of cells will definitely
          have a large effect on the statistical significance. There is no specific
          threshold for the number of cells that would be universal across situations
          - it depends on the effect size expected for the particular perturbation
          you are testing. You could consider doing a power calculation if you would
          like to determine the minimum number of cells to reach statistical significance
          in each situation. </p>

          <p>I am assuming based on your question that you are running out of memory
          with the in silico perturber and not the stats module. The in silico perturber
          saves to disk every 100 cells and clears the memory every 1000 cells. If
          you are working with limited resources, you could alter the code to clear
          the memory more frequently. You can also just keep running each subset of
          cells until you reach all the cells. Then, put all of the raw data in a
          single directory that you pass to the in silico perturber stats function
          so that it can accumulate the data from all of them.</p>

          '
        raw: "Thank you for your question. The number of cells will definitely have\
          \ a large effect on the statistical significance. There is no specific threshold\
          \ for the number of cells that would be universal across situations - it\
          \ depends on the effect size expected for the particular perturbation you\
          \ are testing. You could consider doing a power calculation if you would\
          \ like to determine the minimum number of cells to reach statistical significance\
          \ in each situation. \n\nI am assuming based on your question that you are\
          \ running out of memory with the in silico perturber and not the stats module.\
          \ The in silico perturber saves to disk every 100 cells and clears the memory\
          \ every 1000 cells. If you are working with limited resources, you could\
          \ alter the code to clear the memory more frequently. You can also just\
          \ keep running each subset of cells until you reach all the cells. Then,\
          \ put all of the raw data in a single directory that you pass to the in\
          \ silico perturber stats function so that it can accumulate the data from\
          \ all of them."
        updatedAt: '2023-07-04T07:02:42.856Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - Renqing
      relatedEventId: 64a3c41202617d262f90546d
    id: 64a3c41202617d262f905468
    type: comment
  author: ctheodoris
  content: "Thank you for your question. The number of cells will definitely have\
    \ a large effect on the statistical significance. There is no specific threshold\
    \ for the number of cells that would be universal across situations - it depends\
    \ on the effect size expected for the particular perturbation you are testing.\
    \ You could consider doing a power calculation if you would like to determine\
    \ the minimum number of cells to reach statistical significance in each situation.\
    \ \n\nI am assuming based on your question that you are running out of memory\
    \ with the in silico perturber and not the stats module. The in silico perturber\
    \ saves to disk every 100 cells and clears the memory every 1000 cells. If you\
    \ are working with limited resources, you could alter the code to clear the memory\
    \ more frequently. You can also just keep running each subset of cells until you\
    \ reach all the cells. Then, put all of the raw data in a single directory that\
    \ you pass to the in silico perturber stats function so that it can accumulate\
    \ the data from all of them."
  created_at: 2023-07-04 06:02:42+00:00
  edited: false
  hidden: false
  id: 64a3c41202617d262f905468
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-07-04T07:02:42.000Z'
    data:
      status: closed
    id: 64a3c41202617d262f90546d
    type: status-change
  author: ctheodoris
  created_at: 2023-07-04 06:02:42+00:00
  id: 64a3c41202617d262f90546d
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/96dfc7cd6acde7bc305a6e3d7cfd8f81.svg
      fullname: Renqing Nie
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Renqing
      type: user
    createdAt: '2023-07-04T07:13:55.000Z'
    data:
      edited: false
      editors:
      - Renqing
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9536547660827637
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/96dfc7cd6acde7bc305a6e3d7cfd8f81.svg
          fullname: Renqing Nie
          isHf: false
          isPro: false
          name: Renqing
          type: user
        html: '<p>You are right, the OOM appeared when I ran the perturbation, not
          during the next step of the stats.<br><code>You can also just keep running
          each subset of cells until you reach all the cells. Then, put all of the
          raw data in a single directory that you pass to the in silico perturber
          stats function so that it can accumulate the data from all of them.</code><br>My
          understanding is that there is no difference between the result of running
          in this way and the result of running without splitting the data?</p>

          '
        raw: 'You are right, the OOM appeared when I ran the perturbation, not during
          the next step of the stats.

          `You can also just keep running each subset of cells until you reach all
          the cells. Then, put all of the raw data in a single directory that you
          pass to the in silico perturber stats function so that it can accumulate
          the data from all of them.`

          My understanding is that there is no difference between the result of running
          in this way and the result of running without splitting the data?

          '
        updatedAt: '2023-07-04T07:13:55.845Z'
      numEdits: 0
      reactions: []
    id: 64a3c6b368fe7eed8fc4e109
    type: comment
  author: Renqing
  content: 'You are right, the OOM appeared when I ran the perturbation, not during
    the next step of the stats.

    `You can also just keep running each subset of cells until you reach all the cells.
    Then, put all of the raw data in a single directory that you pass to the in silico
    perturber stats function so that it can accumulate the data from all of them.`

    My understanding is that there is no difference between the result of running
    in this way and the result of running without splitting the data?

    '
  created_at: 2023-07-04 06:13:55+00:00
  edited: false
  hidden: false
  id: 64a3c6b368fe7eed8fc4e109
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-07-04T07:16:21.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9651129245758057
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>You are correct, there is no difference - it runs one cell independently
          from another and you are not training the model, only using it for inference.</p>

          '
        raw: You are correct, there is no difference - it runs one cell independently
          from another and you are not training the model, only using it for inference.
        updatedAt: '2023-07-04T07:16:21.992Z'
      numEdits: 0
      reactions: []
    id: 64a3c74550091725077faae1
    type: comment
  author: ctheodoris
  content: You are correct, there is no difference - it runs one cell independently
    from another and you are not training the model, only using it for inference.
  created_at: 2023-07-04 06:16:21+00:00
  edited: false
  hidden: false
  id: 64a3c74550091725077faae1
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/96dfc7cd6acde7bc305a6e3d7cfd8f81.svg
      fullname: Renqing Nie
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Renqing
      type: user
    createdAt: '2023-07-04T08:26:45.000Z'
    data:
      edited: false
      editors:
      - Renqing
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9975119829177856
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/96dfc7cd6acde7bc305a6e3d7cfd8f81.svg
          fullname: Renqing Nie
          isHf: false
          isPro: false
          name: Renqing
          type: user
        html: '<p>Thank you very much</p>

          '
        raw: Thank you very much
        updatedAt: '2023-07-04T08:26:45.127Z'
      numEdits: 0
      reactions: []
    id: 64a3d7c5c11767e750ddd48e
    type: comment
  author: Renqing
  content: Thank you very much
  created_at: 2023-07-04 07:26:45+00:00
  edited: false
  hidden: false
  id: 64a3d7c5c11767e750ddd48e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/96dfc7cd6acde7bc305a6e3d7cfd8f81.svg
      fullname: Renqing Nie
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Renqing
      type: user
    createdAt: '2023-07-04T10:14:13.000Z'
    data:
      edited: true
      editors:
      - Renqing
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.6290584802627563
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/96dfc7cd6acde7bc305a6e3d7cfd8f81.svg
          fullname: Renqing Nie
          isHf: false
          isPro: false
          name: Renqing
          type: user
        html: '<p>One more question. In the step where I calculate the perturbation
          <code>[InSilicoPerturber]</code>, do the different split data have an effect
          on the results?<br>For example, in the data of  cardiomyopathy disease,
          there are three different categories, dcm, hcm and nf.  Will the combination
          of different proportions of these three categories lead to different results?<br>I''m
          sorry to bother you again.</p>

          '
        raw: 'One more question. In the step where I calculate the perturbation `[InSilicoPerturber]`,
          do the different split data have an effect on the results?

          For example, in the data of  cardiomyopathy disease, there are three different
          categories, dcm, hcm and nf.  Will the combination of different proportions
          of these three categories lead to different results?

          I''m sorry to bother you again.'
        updatedAt: '2023-07-04T10:16:55.022Z'
      numEdits: 1
      reactions: []
    id: 64a3f0f578edd17f9658652b
    type: comment
  author: Renqing
  content: 'One more question. In the step where I calculate the perturbation `[InSilicoPerturber]`,
    do the different split data have an effect on the results?

    For example, in the data of  cardiomyopathy disease, there are three different
    categories, dcm, hcm and nf.  Will the combination of different proportions of
    these three categories lead to different results?

    I''m sorry to bother you again.'
  created_at: 2023-07-04 09:14:13+00:00
  edited: true
  hidden: false
  id: 64a3f0f578edd17f9658652b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-07-04T16:13:49.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9469755291938782
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>If you are asking whether the different categories need to be balanced,
          the answer is no for in silico perturbation because it is not training the
          model, it is only performing inference. You should keep in mind though that
          the number of cells will affect the statistical significance, as discussed
          above. </p>

          '
        raw: 'If you are asking whether the different categories need to be balanced,
          the answer is no for in silico perturbation because it is not training the
          model, it is only performing inference. You should keep in mind though that
          the number of cells will affect the statistical significance, as discussed
          above. '
        updatedAt: '2023-07-04T16:13:49.298Z'
      numEdits: 0
      reactions: []
    id: 64a4453de3cf200cbf8c166f
    type: comment
  author: ctheodoris
  content: 'If you are asking whether the different categories need to be balanced,
    the answer is no for in silico perturbation because it is not training the model,
    it is only performing inference. You should keep in mind though that the number
    of cells will affect the statistical significance, as discussed above. '
  created_at: 2023-07-04 15:13:49+00:00
  edited: false
  hidden: false
  id: 64a4453de3cf200cbf8c166f
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 86
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: About in_silico_perturbation memory problem
