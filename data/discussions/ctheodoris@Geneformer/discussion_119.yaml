!!python/object:huggingface_hub.community.DiscussionWithDetails
author: jinbo1129
conflicting_files: null
created_at: 2023-07-17 06:01:40+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/979d5517514710ed6163619042dbf005.svg
      fullname: zhang
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jinbo1129
      type: user
    createdAt: '2023-07-17T07:01:40.000Z'
    data:
      edited: false
      editors:
      - jinbo1129
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5392934679985046
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/979d5517514710ed6163619042dbf005.svg
          fullname: zhang
          isHf: false
          isPro: false
          name: jinbo1129
          type: user
        html: "<p>hello, thanks for this great tool and your quick response !!!<br>I\
          \ try to do the in_silico_perturbation with my own dataset, where are only\
          \ two cellstates: normal and healthy, so I edit the code to:</p>\n<pre><code>#\
          \ the embedding towards non-failing (nf) state\nisp = InSilicoPerturber(perturb_type=\"\
          delete\",\n                        perturb_rank_shift=None,\n          \
          \              genes_to_perturb=\"all\",\n                        combos=0,\n\
          \                        anchor_gene=None,\n                        model_type=\"\
          CellClassifier\",\n                        num_classes=2,      ## change\
          \ according to my own data !!!\n                        emb_mode=\"cell\"\
          ,\n                        cell_emb_style=\"mean_pool\",\n             \
          \           cell_states_to_model={\"disease\":([\"Normal\"],[\"Disease\"\
          ])},\n                        max_ncells=2000,\n                       \
          \ emb_layer=0,\n                        forward_batch_size=400,\n      \
          \                  nproc=16)\n</code></pre>\n<p>Than I met with the errors:</p>\n\
          <pre><code>IndexError                                Traceback (most recent\
          \ call last)\n    551     # get dictionary of average cell state embeddings\
          \ for comparison\n--&gt; 552     state_embs_dict = get_cell_state_avg_embs(model,\n\
          \    553                                               filtered_input_data,\n\
          \    554                                               self.cell_states_to_model,\n\
          \    555                                               layer_to_quant,\n\
          \    556                                               self.gene_token_dict,\n\
          \    557                                               self.forward_batch_size,\n\
          \    558                                               self.nproc)\n   \
          \ 559 self.in_silico_perturb(model,\n    560                       filtered_input_data,\n\
          \    561                       layer_to_quant,\n    562                \
          \       state_embs_dict,\n    563                       output_directory,\n\
          \    564                       output_prefix)\n\n--&gt; 163     possible_states\
          \ = [value[0]+value[1]+value[2] for value in cell_states_to_model.values()][0]\n\
          \    164     state_embs_dict = dict()\n    165     for possible_state in\
          \ possible_states:\n\nIndexError: tuple index out of range\n</code></pre>\n\
          <p>Should I change the codes of \"in_silico_perturber.py\" according to\
          \ my own dataset ?</p>\n<p>Thanks !!!</p>\n"
        raw: "hello, thanks for this great tool and your quick response !!!\r\nI try\
          \ to do the in_silico_perturbation with my own dataset, where are only two\
          \ cellstates: normal and healthy, so I edit the code to:\r\n\r\n```\r\n\
          # the embedding towards non-failing (nf) state\r\nisp = InSilicoPerturber(perturb_type=\"\
          delete\",\r\n                        perturb_rank_shift=None,\r\n      \
          \                  genes_to_perturb=\"all\",\r\n                       \
          \ combos=0,\r\n                        anchor_gene=None,\r\n           \
          \             model_type=\"CellClassifier\",\r\n                       \
          \ num_classes=2,      ## change according to my own data !!!\r\n       \
          \                 emb_mode=\"cell\",\r\n                        cell_emb_style=\"\
          mean_pool\",\r\n                        cell_states_to_model={\"disease\"\
          :([\"Normal\"],[\"Disease\"])},\r\n                        max_ncells=2000,\r\
          \n                        emb_layer=0,\r\n                        forward_batch_size=400,\r\
          \n                        nproc=16)\r\n```\r\n\r\nThan I met with the errors:\r\
          \n```\r\nIndexError                                Traceback (most recent\
          \ call last)\r\n    551     # get dictionary of average cell state embeddings\
          \ for comparison\r\n--> 552     state_embs_dict = get_cell_state_avg_embs(model,\r\
          \n    553                                               filtered_input_data,\r\
          \n    554                                               self.cell_states_to_model,\r\
          \n    555                                               layer_to_quant,\r\
          \n    556                                               self.gene_token_dict,\r\
          \n    557                                               self.forward_batch_size,\r\
          \n    558                                               self.nproc)\r\n\
          \    559 self.in_silico_perturb(model,\r\n    560                      \
          \ filtered_input_data,\r\n    561                       layer_to_quant,\r\
          \n    562                       state_embs_dict,\r\n    563            \
          \           output_directory,\r\n    564                       output_prefix)\r\
          \n\r\n--> 163     possible_states = [value[0]+value[1]+value[2] for value\
          \ in cell_states_to_model.values()][0]\r\n    164     state_embs_dict =\
          \ dict()\r\n    165     for possible_state in possible_states:\r\n\r\nIndexError:\
          \ tuple index out of range\r\n```\r\n\r\nShould I change the codes of \"\
          in_silico_perturber.py\" according to my own dataset ?\r\n\r\nThanks !!!\r\
          \n\r\n"
        updatedAt: '2023-07-17T07:01:40.883Z'
      numEdits: 0
      reactions: []
    id: 64b4e75434a92b848cacde3e
    type: comment
  author: jinbo1129
  content: "hello, thanks for this great tool and your quick response !!!\r\nI try\
    \ to do the in_silico_perturbation with my own dataset, where are only two cellstates:\
    \ normal and healthy, so I edit the code to:\r\n\r\n```\r\n# the embedding towards\
    \ non-failing (nf) state\r\nisp = InSilicoPerturber(perturb_type=\"delete\",\r\
    \n                        perturb_rank_shift=None,\r\n                       \
    \ genes_to_perturb=\"all\",\r\n                        combos=0,\r\n         \
    \               anchor_gene=None,\r\n                        model_type=\"CellClassifier\"\
    ,\r\n                        num_classes=2,      ## change according to my own\
    \ data !!!\r\n                        emb_mode=\"cell\",\r\n                 \
    \       cell_emb_style=\"mean_pool\",\r\n                        cell_states_to_model={\"\
    disease\":([\"Normal\"],[\"Disease\"])},\r\n                        max_ncells=2000,\r\
    \n                        emb_layer=0,\r\n                        forward_batch_size=400,\r\
    \n                        nproc=16)\r\n```\r\n\r\nThan I met with the errors:\r\
    \n```\r\nIndexError                                Traceback (most recent call\
    \ last)\r\n    551     # get dictionary of average cell state embeddings for comparison\r\
    \n--> 552     state_embs_dict = get_cell_state_avg_embs(model,\r\n    553    \
    \                                           filtered_input_data,\r\n    554  \
    \                                             self.cell_states_to_model,\r\n \
    \   555                                               layer_to_quant,\r\n    556\
    \                                               self.gene_token_dict,\r\n    557\
    \                                               self.forward_batch_size,\r\n \
    \   558                                               self.nproc)\r\n    559 self.in_silico_perturb(model,\r\
    \n    560                       filtered_input_data,\r\n    561              \
    \         layer_to_quant,\r\n    562                       state_embs_dict,\r\n\
    \    563                       output_directory,\r\n    564                  \
    \     output_prefix)\r\n\r\n--> 163     possible_states = [value[0]+value[1]+value[2]\
    \ for value in cell_states_to_model.values()][0]\r\n    164     state_embs_dict\
    \ = dict()\r\n    165     for possible_state in possible_states:\r\n\r\nIndexError:\
    \ tuple index out of range\r\n```\r\n\r\nShould I change the codes of \"in_silico_perturber.py\"\
    \ according to my own dataset ?\r\n\r\nThanks !!!\r\n\r\n"
  created_at: 2023-07-17 06:01:40+00:00
  edited: false
  hidden: false
  id: 64b4e75434a92b848cacde3e
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/979d5517514710ed6163619042dbf005.svg
      fullname: zhang
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jinbo1129
      type: user
    createdAt: '2023-07-17T07:53:12.000Z'
    data:
      edited: false
      editors:
      - jinbo1129
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7970392107963562
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/979d5517514710ed6163619042dbf005.svg
          fullname: zhang
          isHf: false
          isPro: false
          name: jinbo1129
          type: user
        html: "<pre><code>    cell_states_to_model: None, dict\n        Cell states\
          \ to model if testing perturbations that achieve goal state change.\n  \
          \      Single-item dictionary with key being cell attribute (e.g. \"disease\"\
          ).\n        Value is tuple of three lists indicating start state, goal end\
          \ state, and alternate possible end states.\n        If no alternate possible\
          \ end states, third list should be empty (i.e. the third list should be\
          \ []).\n</code></pre>\n"
        raw: "        cell_states_to_model: None, dict\n            Cell states to\
          \ model if testing perturbations that achieve goal state change.\n     \
          \       Single-item dictionary with key being cell attribute (e.g. \"disease\"\
          ).\n            Value is tuple of three lists indicating start state, goal\
          \ end state, and alternate possible end states.\n            If no alternate\
          \ possible end states, third list should be empty (i.e. the third list should\
          \ be [])."
        updatedAt: '2023-07-17T07:53:12.410Z'
      numEdits: 0
      reactions: []
      relatedEventId: 64b4f36861fd81bcefd782a8
    id: 64b4f36861fd81bcefd782a6
    type: comment
  author: jinbo1129
  content: "        cell_states_to_model: None, dict\n            Cell states to model\
    \ if testing perturbations that achieve goal state change.\n            Single-item\
    \ dictionary with key being cell attribute (e.g. \"disease\").\n            Value\
    \ is tuple of three lists indicating start state, goal end state, and alternate\
    \ possible end states.\n            If no alternate possible end states, third\
    \ list should be empty (i.e. the third list should be [])."
  created_at: 2023-07-17 06:53:12+00:00
  edited: false
  hidden: false
  id: 64b4f36861fd81bcefd782a6
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/979d5517514710ed6163619042dbf005.svg
      fullname: zhang
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: jinbo1129
      type: user
    createdAt: '2023-07-17T07:53:12.000Z'
    data:
      status: closed
    id: 64b4f36861fd81bcefd782a8
    type: status-change
  author: jinbo1129
  created_at: 2023-07-17 06:53:12+00:00
  id: 64b4f36861fd81bcefd782a8
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 119
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: "Please help with \uFF1AIndexError: tuple index out of range for cell_states_to_model"
