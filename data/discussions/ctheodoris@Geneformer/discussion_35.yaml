!!python/object:huggingface_hub.community.DiscussionWithDetails
author: weilangchan
conflicting_files: null
created_at: 2023-06-15 11:26:52+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/ae859a330991691f7125208d8ab1906b.svg
      fullname: weilang chan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: weilangchan
      type: user
    createdAt: '2023-06-15T12:26:52.000Z'
    data:
      edited: false
      editors:
      - weilangchan
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9148349761962891
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/ae859a330991691f7125208d8ab1906b.svg
          fullname: weilang chan
          isHf: false
          isPro: false
          name: weilangchan
          type: user
        html: '<p>In its data preprocessing, Geneformer used the median expression
          value of the gene as the normalization factor, thereby reducing the level
          of housekeeping genes that are always highly expressed and elevating the
          level of transcription factor (TF) genes that are lowly expressed.<br>For
          each gene, we calculated the median of its expression values across all
          cells by referring to Geneformer''s approach, and found that the median
          calculation result for many genes is 1.0, which feels puzzling.</p>

          <p><a rel="nofollow" href="https://cdn-uploads.huggingface.co/production/uploads/642e6360113b200fd76720c5/7W2GO-f0k884sXCZBZKAP.png"><img
          alt="image.png" src="https://cdn-uploads.huggingface.co/production/uploads/642e6360113b200fd76720c5/7W2GO-f0k884sXCZBZKAP.png"></a></p>

          <p>Afterwards, we looked at the median file provided by the Geneformer paper
          and discovered that the median expression values they calculated for different
          genes were floating point numbers, and they were not the same.</p>

          <p><a rel="nofollow" href="https://cdn-uploads.huggingface.co/production/uploads/642e6360113b200fd76720c5/pzbFiDe-qwKT3rhGm83TK.png"><img
          alt="image.png" src="https://cdn-uploads.huggingface.co/production/uploads/642e6360113b200fd76720c5/pzbFiDe-qwKT3rhGm83TK.png"></a></p>

          <p>Theoretically, count values are integers, so if the median is calculated
          directly from counts, the result should be an integer. But the medians provided
          by Geneformer are float numbers. We need to inquire with the Geneformer
          authors about the exact way they calculate the median for different genes.</p>

          '
        raw: "In its data preprocessing, Geneformer used the median expression value\
          \ of the gene as the normalization factor, thereby reducing the level of\
          \ housekeeping genes that are always highly expressed and elevating the\
          \ level of transcription factor (TF) genes that are lowly expressed.\r\n\
          For each gene, we calculated the median of its expression values across\
          \ all cells by referring to Geneformer's approach, and found that the median\
          \ calculation result for many genes is 1.0, which feels puzzling.\r\n\r\n\
          ![image.png](https://cdn-uploads.huggingface.co/production/uploads/642e6360113b200fd76720c5/7W2GO-f0k884sXCZBZKAP.png)\r\
          \n\r\nAfterwards, we looked at the median file provided by the Geneformer\
          \ paper and discovered that the median expression values they calculated\
          \ for different genes were floating point numbers, and they were not the\
          \ same.\r\n\r\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/642e6360113b200fd76720c5/pzbFiDe-qwKT3rhGm83TK.png)\r\
          \n\r\nTheoretically, count values are integers, so if the median is calculated\
          \ directly from counts, the result should be an integer. But the medians\
          \ provided by Geneformer are float numbers. We need to inquire with the\
          \ Geneformer authors about the exact way they calculate the median for different\
          \ genes."
        updatedAt: '2023-06-15T12:26:52.980Z'
      numEdits: 0
      reactions: []
    id: 648b038cff6123185eba5ce7
    type: comment
  author: weilangchan
  content: "In its data preprocessing, Geneformer used the median expression value\
    \ of the gene as the normalization factor, thereby reducing the level of housekeeping\
    \ genes that are always highly expressed and elevating the level of transcription\
    \ factor (TF) genes that are lowly expressed.\r\nFor each gene, we calculated\
    \ the median of its expression values across all cells by referring to Geneformer's\
    \ approach, and found that the median calculation result for many genes is 1.0,\
    \ which feels puzzling.\r\n\r\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/642e6360113b200fd76720c5/7W2GO-f0k884sXCZBZKAP.png)\r\
    \n\r\nAfterwards, we looked at the median file provided by the Geneformer paper\
    \ and discovered that the median expression values they calculated for different\
    \ genes were floating point numbers, and they were not the same.\r\n\r\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/642e6360113b200fd76720c5/pzbFiDe-qwKT3rhGm83TK.png)\r\
    \n\r\nTheoretically, count values are integers, so if the median is calculated\
    \ directly from counts, the result should be an integer. But the medians provided\
    \ by Geneformer are float numbers. We need to inquire with the Geneformer authors\
    \ about the exact way they calculate the median for different genes."
  created_at: 2023-06-15 11:26:52+00:00
  edited: false
  hidden: false
  id: 648b038cff6123185eba5ce7
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-06-15T14:20:15.000Z'
    data:
      edited: true
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9202734231948853
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your question. In single cell data, the depth of sequencing
          affects the number of counts detected in each cell. For example, for the
          same exact cell, the counts for gene A and B may be 3 and 4, respectively,
          if sequenced at a certain depth, or 6 and 8 if sequenced at another depth.
          Therefore, as we describe in the Methods of the manuscript, it''s important
          to normalize the raw counts by the total counts per cell before comparing
          their values across cells. This leads to the number being a non-integer
          value. </p>

          <p>Additionally, the normalization factors take advantage of the vast array
          of observations of cell state in Genecorpus-30M to determine the genes that
          uniquely distinguish cell state. This normalization factor for each gene
          is calculated once from the pretraining corpus and is used for all future
          datasets presented to the model. I see you are using mouse genes; so to
          accomplish this goal, the normalization factor for the mouse genes should
          be calculated across your entire pretraining corpus (with tens of millions
          of cells and a vast array of cell states represented) to achieve the richness
          of gene expression variability expected within the organism. Please note
          also that, as discussed in the Methods, we opted to use the non-zero median
          value of expression rather than include zeros in the distribution so as
          not to weight the value by tissue representation within Genecorpus-30M,
          assuming that a representative range of transcript values would be observed
          within the cells in which each gene was detected. Finally, because calculating
          a nonzero median value of expression across tens of millions of cells can
          be memory intensive, we recommend using the approach we describe in the
          Methods to aggregate the transcript count distribution in a memory-efficient
          manner. </p>

          <p>All of the above information is included in the Methods, an excerpt of
          which is below for convenience:</p>

          <p>"To accomplish this, we first calculated the non-zero median value of
          expression of each detected gene across all cells passing quality filtering
          from the entire Genecorpus-30M. We aggregated the transcript count distribution
          for each gene in a memory-efficient manner by scanning through chunks of
          .loom data using loompy, normalizing the gene transcript counts in each
          cell by the total transcript count of that cell to account for varying sequencing
          depth and updating the normalized count distribution of the gene within
          the t-digest data structure developed for accurate online accumulation of
          rank-based statistics. We then normalized the genes in each single-cell
          transcriptome by the non-zero median value of expression of that gene across
          Genecorpus-30M and ordered the genes by the rank of their normalized expression
          in that specific cell. Of note, we opted to use the non-zero median value
          of expression rather than include zeros in the distribution so as not to
          weight the value by tissue representation within Genecorpus-30M, assuming
          that a representative range of transcript values would be observed within
          the cells in which each gene was detected. This normalization factor for
          each gene is calculated once from the pretraining corpus and is used for
          all future datasets presented to the model. The provided tokenizer code
          includes this normalization procedure and should be used for tokenizing
          new datasets presented to Geneformer to ensure consistency of the normalization
          factor used for each gene."</p>

          '
        raw: "Thank you for your question. In single cell data, the depth of sequencing\
          \ affects the number of counts detected in each cell. For example, for the\
          \ same exact cell, the counts for gene A and B may be 3 and 4, respectively,\
          \ if sequenced at a certain depth, or 6 and 8 if sequenced at another depth.\
          \ Therefore, as we describe in the Methods of the manuscript, it's important\
          \ to normalize the raw counts by the total counts per cell before comparing\
          \ their values across cells. This leads to the number being a non-integer\
          \ value. \n\nAdditionally, the normalization factors take advantage of the\
          \ vast array of observations of cell state in Genecorpus-30M to determine\
          \ the genes that uniquely distinguish cell state. This normalization factor\
          \ for each gene is calculated once from the pretraining corpus and is used\
          \ for all future datasets presented to the model. I see you are using mouse\
          \ genes; so to accomplish this goal, the normalization factor for the mouse\
          \ genes should be calculated across your entire pretraining corpus (with\
          \ tens of millions of cells and a vast array of cell states represented)\
          \ to achieve the richness of gene expression variability expected within\
          \ the organism. Please note also that, as discussed in the Methods, we opted\
          \ to use the non-zero median value of expression rather than include zeros\
          \ in the distribution so as not to weight the value by tissue representation\
          \ within Genecorpus-30M, assuming that a representative range of transcript\
          \ values would be observed within the cells in which each gene was detected.\
          \ Finally, because calculating a nonzero median value of expression across\
          \ tens of millions of cells can be memory intensive, we recommend using\
          \ the approach we describe in the Methods to aggregate the transcript count\
          \ distribution in a memory-efficient manner. \n\nAll of the above information\
          \ is included in the Methods, an excerpt of which is below for convenience:\n\
          \n\"To accomplish this, we first calculated the non-zero median value of\
          \ expression of each detected gene across all cells passing quality filtering\
          \ from the entire Genecorpus-30M. We aggregated the transcript count distribution\
          \ for each gene in a memory-efficient manner by scanning through chunks\
          \ of .loom data using loompy, normalizing the gene transcript counts in\
          \ each cell by the total transcript count of that cell to account for varying\
          \ sequencing depth and updating the normalized count distribution of the\
          \ gene within the t-digest data structure developed for accurate online\
          \ accumulation of rank-based statistics. We then normalized the genes in\
          \ each single-cell transcriptome by the non-zero median value of expression\
          \ of that gene across Genecorpus-30M and ordered the genes by the rank of\
          \ their normalized expression in that specific cell. Of note, we opted to\
          \ use the non-zero median value of expression rather than include zeros\
          \ in the distribution so as not to weight the value by tissue representation\
          \ within Genecorpus-30M, assuming that a representative range of transcript\
          \ values would be observed within the cells in which each gene was detected.\
          \ This normalization factor for each gene is calculated once from the pretraining\
          \ corpus and is used for all future datasets presented to the model. The\
          \ provided tokenizer code includes this normalization procedure and should\
          \ be used for tokenizing new datasets presented to Geneformer to ensure\
          \ consistency of the normalization factor used for each gene.\""
        updatedAt: '2023-06-15T20:19:40.902Z'
      numEdits: 4
      reactions: []
      relatedEventId: 648b1e1fe91768e63a4fab7f
    id: 648b1e1fe91768e63a4fab73
    type: comment
  author: ctheodoris
  content: "Thank you for your question. In single cell data, the depth of sequencing\
    \ affects the number of counts detected in each cell. For example, for the same\
    \ exact cell, the counts for gene A and B may be 3 and 4, respectively, if sequenced\
    \ at a certain depth, or 6 and 8 if sequenced at another depth. Therefore, as\
    \ we describe in the Methods of the manuscript, it's important to normalize the\
    \ raw counts by the total counts per cell before comparing their values across\
    \ cells. This leads to the number being a non-integer value. \n\nAdditionally,\
    \ the normalization factors take advantage of the vast array of observations of\
    \ cell state in Genecorpus-30M to determine the genes that uniquely distinguish\
    \ cell state. This normalization factor for each gene is calculated once from\
    \ the pretraining corpus and is used for all future datasets presented to the\
    \ model. I see you are using mouse genes; so to accomplish this goal, the normalization\
    \ factor for the mouse genes should be calculated across your entire pretraining\
    \ corpus (with tens of millions of cells and a vast array of cell states represented)\
    \ to achieve the richness of gene expression variability expected within the organism.\
    \ Please note also that, as discussed in the Methods, we opted to use the non-zero\
    \ median value of expression rather than include zeros in the distribution so\
    \ as not to weight the value by tissue representation within Genecorpus-30M, assuming\
    \ that a representative range of transcript values would be observed within the\
    \ cells in which each gene was detected. Finally, because calculating a nonzero\
    \ median value of expression across tens of millions of cells can be memory intensive,\
    \ we recommend using the approach we describe in the Methods to aggregate the\
    \ transcript count distribution in a memory-efficient manner. \n\nAll of the above\
    \ information is included in the Methods, an excerpt of which is below for convenience:\n\
    \n\"To accomplish this, we first calculated the non-zero median value of expression\
    \ of each detected gene across all cells passing quality filtering from the entire\
    \ Genecorpus-30M. We aggregated the transcript count distribution for each gene\
    \ in a memory-efficient manner by scanning through chunks of .loom data using\
    \ loompy, normalizing the gene transcript counts in each cell by the total transcript\
    \ count of that cell to account for varying sequencing depth and updating the\
    \ normalized count distribution of the gene within the t-digest data structure\
    \ developed for accurate online accumulation of rank-based statistics. We then\
    \ normalized the genes in each single-cell transcriptome by the non-zero median\
    \ value of expression of that gene across Genecorpus-30M and ordered the genes\
    \ by the rank of their normalized expression in that specific cell. Of note, we\
    \ opted to use the non-zero median value of expression rather than include zeros\
    \ in the distribution so as not to weight the value by tissue representation within\
    \ Genecorpus-30M, assuming that a representative range of transcript values would\
    \ be observed within the cells in which each gene was detected. This normalization\
    \ factor for each gene is calculated once from the pretraining corpus and is used\
    \ for all future datasets presented to the model. The provided tokenizer code\
    \ includes this normalization procedure and should be used for tokenizing new\
    \ datasets presented to Geneformer to ensure consistency of the normalization\
    \ factor used for each gene.\""
  created_at: 2023-06-15 13:20:15+00:00
  edited: true
  hidden: false
  id: 648b1e1fe91768e63a4fab73
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-06-15T14:20:15.000Z'
    data:
      status: closed
    id: 648b1e1fe91768e63a4fab7f
    type: status-change
  author: ctheodoris
  created_at: 2023-06-15 13:20:15+00:00
  id: 648b1e1fe91768e63a4fab7f
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/ae859a330991691f7125208d8ab1906b.svg
      fullname: weilang chan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: weilangchan
      type: user
    createdAt: '2023-06-15T16:45:05.000Z'
    data:
      edited: false
      editors:
      - weilangchan
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7503184080123901
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/ae859a330991691f7125208d8ab1906b.svg
          fullname: weilang chan
          isHf: false
          isPro: false
          name: weilangchan
          type: user
        html: '<p>Could u pls open source the code related to calculate median values?</p>

          '
        raw: Could u pls open source the code related to calculate median values?
        updatedAt: '2023-06-15T16:45:05.338Z'
      numEdits: 0
      reactions: []
      relatedEventId: 648b4011dd8c4d00e258846f
    id: 648b4011dd8c4d00e258846d
    type: comment
  author: weilangchan
  content: Could u pls open source the code related to calculate median values?
  created_at: 2023-06-15 15:45:05+00:00
  edited: false
  hidden: false
  id: 648b4011dd8c4d00e258846d
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/ae859a330991691f7125208d8ab1906b.svg
      fullname: weilang chan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: weilangchan
      type: user
    createdAt: '2023-06-15T16:45:05.000Z'
    data:
      status: open
    id: 648b4011dd8c4d00e258846f
    type: status-change
  author: weilangchan
  created_at: 2023-06-15 15:45:05+00:00
  id: 648b4011dd8c4d00e258846f
  new_status: open
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/ae859a330991691f7125208d8ab1906b.svg
      fullname: weilang chan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: weilangchan
      type: user
    createdAt: '2023-06-15T17:04:24.000Z'
    data:
      edited: false
      editors:
      - weilangchan
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8346697092056274
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/ae859a330991691f7125208d8ab1906b.svg
          fullname: weilang chan
          isHf: false
          isPro: false
          name: weilangchan
          type: user
        html: '<p>Besides, i wanna know if the t-digest is applied after normalization.<br>Thank
          u in advance!</p>

          '
        raw: "Besides, i wanna know if the t-digest is applied after normalization.\
          \ \nThank u in advance!"
        updatedAt: '2023-06-15T17:04:24.412Z'
      numEdits: 0
      reactions: []
    id: 648b4498ef6d125d9f2de181
    type: comment
  author: weilangchan
  content: "Besides, i wanna know if the t-digest is applied after normalization.\
    \ \nThank u in advance!"
  created_at: 2023-06-15 16:04:24+00:00
  edited: false
  hidden: false
  id: 648b4498ef6d125d9f2de181
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-06-16T00:58:31.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9087619185447693
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your question. The t-digest is not "applied". It is
          a method for accurate online accumulation of rank-based statistics. Once
          the data is added to the t-digest, it updates the distribution; there is
          no way to apply the total counts normalization after the data is accumulated
          in the t-digest. Please read about t-digests in the reference provided in
          the Methods of the Geneformer manuscript in order to understand this method:</p>

          <p>Dunning, T. The t-digest: efficient estimates of distributions. Softw.
          Impacts 7, 100049 (2021).</p>

          <p>Upon request, we are providing the code that we used for obtaining the
          non-zero median expression value of each gene across the broad range of
          cell types represented in Genecorpus-30M that we use as a normalization
          factor to prioritize genes that uniquely distinguish cell state. </p>

          <p>However, we want to ensure the following is very clear to users:<br>If
          using Geneformer, to ensure consistency of the normalization factor used
          for each gene for all future datasets, <strong>users should use the Geneformer
          transcriptome tokenizer to tokenize their datasets and should not re-calculate
          this normalization factor for their individual dataset</strong>. This code
          for re-calculating the normalization factor should only be used by users
          who are pretraining a new model from scratch with a new pretraining corpus
          other than Genecorpus-30M.</p>

          <p>Furthermore, it is critical that this calculation is performed on a large-scale
          pretraining corpus that has tens of millions of cells from a broad range
          of human tissues. <strong>The richness of variable cell states in the pretraining
          corpus is what allows this normalization factor to accomplish the goal of
          prioritizing genes that uniquely distinguish cell states.</strong> This
          normalization factor for each gene is calculated once from the large-scale
          pretraining corpus and is used for all future datasets presented to the
          model. </p>

          <p>Also, as discussed in the Methods, we only included droplet-based sequencing
          platforms in the pretraining corpus to assure expression value unit comparability
          for the calculation of this normalization factor. Users wishing to pretrain
          a new model from scratch with a new pretraining corpus should choose either
          droplet-based or plate-based platforms for calculating this normalization
          factor, or they should exercise caution that including both platforms may
          cause unintended effects on the results. Once the normalization factor is
          calculated however, data from any platform can be used with the model because
          the expression value units will be consistent within each individual cell.</p>

          '
        raw: "Thank you for your question. The t-digest is not \"applied\". It is\
          \ a method for accurate online accumulation of rank-based statistics. Once\
          \ the data is added to the t-digest, it updates the distribution; there\
          \ is no way to apply the total counts normalization after the data is accumulated\
          \ in the t-digest. Please read about t-digests in the reference provided\
          \ in the Methods of the Geneformer manuscript in order to understand this\
          \ method:\n\nDunning, T. The t-digest: efficient estimates of distributions.\
          \ Softw. Impacts 7, 100049 (2021).\n\nUpon request, we are providing the\
          \ code that we used for obtaining the non-zero median expression value of\
          \ each gene across the broad range of cell types represented in Genecorpus-30M\
          \ that we use as a normalization factor to prioritize genes that uniquely\
          \ distinguish cell state. \n\nHowever, we want to ensure the following is\
          \ very clear to users:\nIf using Geneformer, to ensure consistency of the\
          \ normalization factor used for each gene for all future datasets, **users\
          \ should use the Geneformer transcriptome tokenizer to tokenize their datasets\
          \ and should not re-calculate this normalization factor for their individual\
          \ dataset**. This code for re-calculating the normalization factor should\
          \ only be used by users who are pretraining a new model from scratch with\
          \ a new pretraining corpus other than Genecorpus-30M.\n\nFurthermore, it\
          \ is critical that this calculation is performed on a large-scale pretraining\
          \ corpus that has tens of millions of cells from a broad range of human\
          \ tissues. **The richness of variable cell states in the pretraining corpus\
          \ is what allows this normalization factor to accomplish the goal of prioritizing\
          \ genes that uniquely distinguish cell states.** This normalization factor\
          \ for each gene is calculated once from the large-scale pretraining corpus\
          \ and is used for all future datasets presented to the model. \n\nAlso,\
          \ as discussed in the Methods, we only included droplet-based sequencing\
          \ platforms in the pretraining corpus to assure expression value unit comparability\
          \ for the calculation of this normalization factor. Users wishing to pretrain\
          \ a new model from scratch with a new pretraining corpus should choose either\
          \ droplet-based or plate-based platforms for calculating this normalization\
          \ factor, or they should exercise caution that including both platforms\
          \ may cause unintended effects on the results. Once the normalization factor\
          \ is calculated however, data from any platform can be used with the model\
          \ because the expression value units will be consistent within each individual\
          \ cell."
        updatedAt: '2023-06-16T00:58:31.739Z'
      numEdits: 0
      reactions: []
      relatedEventId: 648bb3b7d710ae8b58a15031
    id: 648bb3b7d710ae8b58a1502c
    type: comment
  author: ctheodoris
  content: "Thank you for your question. The t-digest is not \"applied\". It is a\
    \ method for accurate online accumulation of rank-based statistics. Once the data\
    \ is added to the t-digest, it updates the distribution; there is no way to apply\
    \ the total counts normalization after the data is accumulated in the t-digest.\
    \ Please read about t-digests in the reference provided in the Methods of the\
    \ Geneformer manuscript in order to understand this method:\n\nDunning, T. The\
    \ t-digest: efficient estimates of distributions. Softw. Impacts 7, 100049 (2021).\n\
    \nUpon request, we are providing the code that we used for obtaining the non-zero\
    \ median expression value of each gene across the broad range of cell types represented\
    \ in Genecorpus-30M that we use as a normalization factor to prioritize genes\
    \ that uniquely distinguish cell state. \n\nHowever, we want to ensure the following\
    \ is very clear to users:\nIf using Geneformer, to ensure consistency of the normalization\
    \ factor used for each gene for all future datasets, **users should use the Geneformer\
    \ transcriptome tokenizer to tokenize their datasets and should not re-calculate\
    \ this normalization factor for their individual dataset**. This code for re-calculating\
    \ the normalization factor should only be used by users who are pretraining a\
    \ new model from scratch with a new pretraining corpus other than Genecorpus-30M.\n\
    \nFurthermore, it is critical that this calculation is performed on a large-scale\
    \ pretraining corpus that has tens of millions of cells from a broad range of\
    \ human tissues. **The richness of variable cell states in the pretraining corpus\
    \ is what allows this normalization factor to accomplish the goal of prioritizing\
    \ genes that uniquely distinguish cell states.** This normalization factor for\
    \ each gene is calculated once from the large-scale pretraining corpus and is\
    \ used for all future datasets presented to the model. \n\nAlso, as discussed\
    \ in the Methods, we only included droplet-based sequencing platforms in the pretraining\
    \ corpus to assure expression value unit comparability for the calculation of\
    \ this normalization factor. Users wishing to pretrain a new model from scratch\
    \ with a new pretraining corpus should choose either droplet-based or plate-based\
    \ platforms for calculating this normalization factor, or they should exercise\
    \ caution that including both platforms may cause unintended effects on the results.\
    \ Once the normalization factor is calculated however, data from any platform\
    \ can be used with the model because the expression value units will be consistent\
    \ within each individual cell."
  created_at: 2023-06-15 23:58:31+00:00
  edited: false
  hidden: false
  id: 648bb3b7d710ae8b58a1502c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-06-16T00:58:31.000Z'
    data:
      status: closed
    id: 648bb3b7d710ae8b58a15031
    type: status-change
  author: ctheodoris
  created_at: 2023-06-15 23:58:31+00:00
  id: 648bb3b7d710ae8b58a15031
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 35
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: Problem abot median value
