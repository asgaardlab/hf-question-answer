!!python/object:huggingface_hub.community.DiscussionWithDetails
author: swang12
conflicting_files: null
created_at: 2023-08-03 03:53:18+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/dfad9b282f034de3ccdaf7ab2b999559.svg
      fullname: Su Wang
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: swang12
      type: user
    createdAt: '2023-08-03T04:53:18.000Z'
    data:
      edited: false
      editors:
      - swang12
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5305172204971313
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/dfad9b282f034de3ccdaf7ab2b999559.svg
          fullname: Su Wang
          isHf: false
          isPro: false
          name: swang12
          type: user
        html: '<p>Thank you very much for providing this powerful tool! I''m using
          the pre-trained Geneformer model for perturbation and encountered the error
          "_pickle.UnpicklingError: invalid load key, ''v''." when using InSilicoPerturberStats.
          I''m pasting the related code snippet and error message below:</p>

          <p>from geneformer import InSilicoPerturber<br>from geneformer import InSilicoPerturberStats</p>

          <p>isp = InSilicoPerturber(perturb_type=''delete'',<br>                        perturb_rank_shift=None,<br>                        genes_to_perturb=''all'',<br>                        combos=0,<br>                        anchor_gene=None,<br>                        model_type=''Pretrained'',<br>                        num_classes=0,<br>                        emb_mode=''cell'',<br>                        cell_emb_style=''mean_pool'',<br>                        cell_states_to_model={''state_key'':
          ''group'', ''start_state'': ''opc_gaba'', ''goal_state'': ''other'', ''alt_states'':
          []},<br>                        max_ncells=2000,<br>                        emb_layer=-1,<br>                        forward_batch_size=32,<br>                        nproc=16<br>                        )</p>

          <p>isp.perturb_data(model_directory=''Geneformer/'',<br>                 input_data_file=''tokenized_.dataset'',<br>                 output_directory=''./'',<br>                 output_prefix=''perturbed_''<br>                 )</p>

          <p>ispstats = InSilicoPerturberStats(mode=''goal_state_shift'',<br>                                  combos=0,<br>                                  anchor_gene=None,<br>                                  cell_states_to_model={''state_key'':
          ''group'', ''start_state'': ''opc_gaba'', ''goal_state'': ''other'', ''alt_states'':
          []}<br>                                  )</p>

          <p>Traceback (most recent call last):<br>  File "transformer.py", line 59,
          in <br>    ispstats = InSilicoPerturberStats(mode=''goal_state_shift'',<br>  File
          "/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber_stats.py",
          line 482, in <strong>init</strong><br>    self.gene_name_id_dict = pickle.load(f)<br>_pickle.UnpicklingError:
          invalid load key, ''v''.</p>

          <p>After running isp.perturb_data, I got two pickle files: in_silico_delete_perturbed__dict_1Kbatch0_raw.pickle
          and in_silico_delete_perturbed__dict_1Kbatch-1_raw.pickle. I found a similar
          discussion regarding this issue before but didn''t get the point of how
          to solve this issue. I reinstalled the latest version of Geneformer but
          still got this error. Could you help me with this? Thank you very much!</p>

          <p>Sincerely,<br>Su Wang</p>

          '
        raw: "Thank you very much for providing this powerful tool! I'm using the\
          \ pre-trained Geneformer model for perturbation and encountered the error\
          \ \"_pickle.UnpicklingError: invalid load key, 'v'.\" when using InSilicoPerturberStats.\
          \ I'm pasting the related code snippet and error message below:\r\n\r\n\
          from geneformer import InSilicoPerturber\r\nfrom geneformer import InSilicoPerturberStats\r\
          \n\r\nisp = InSilicoPerturber(perturb_type='delete', \r\n              \
          \          perturb_rank_shift=None, \r\n                        genes_to_perturb='all',\
          \ \r\n                        combos=0, \r\n                        anchor_gene=None,\
          \ \r\n                        model_type='Pretrained', \r\n            \
          \            num_classes=0, \r\n                        emb_mode='cell',\
          \ \r\n                        cell_emb_style='mean_pool', \r\n         \
          \               cell_states_to_model={'state_key': 'group', 'start_state':\
          \ 'opc_gaba', 'goal_state': 'other', 'alt_states': []}, \r\n           \
          \             max_ncells=2000, \r\n                        emb_layer=-1,\
          \ \r\n                        forward_batch_size=32, \r\n              \
          \          nproc=16\r\n                        )\r\n\r\nisp.perturb_data(model_directory='Geneformer/',\
          \ \r\n                 input_data_file='tokenized_.dataset', \r\n      \
          \           output_directory='./', \r\n                 output_prefix='perturbed_'\r\
          \n                 )\r\n\r\nispstats = InSilicoPerturberStats(mode='goal_state_shift',\
          \ \r\n                                  combos=0, \r\n                 \
          \                 anchor_gene=None, \r\n                               \
          \   cell_states_to_model={'state_key': 'group', 'start_state': 'opc_gaba',\
          \ 'goal_state': 'other', 'alt_states': []}\r\n                         \
          \         )\r\n\r\nTraceback (most recent call last):\r\n  File \"transformer.py\"\
          , line 59, in <module>\r\n    ispstats = InSilicoPerturberStats(mode='goal_state_shift',\
          \ \r\n  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber_stats.py\"\
          , line 482, in __init__\r\n    self.gene_name_id_dict = pickle.load(f)\r\
          \n_pickle.UnpicklingError: invalid load key, 'v'.\r\n\r\nAfter running isp.perturb_data,\
          \ I got two pickle files: in_silico_delete_perturbed__dict_1Kbatch0_raw.pickle\
          \ and in_silico_delete_perturbed__dict_1Kbatch-1_raw.pickle. I found a similar\
          \ discussion regarding this issue before but didn't get the point of how\
          \ to solve this issue. I reinstalled the latest version of Geneformer but\
          \ still got this error. Could you help me with this? Thank you very much!\r\
          \n\r\nSincerely,\r\nSu Wang\r\n"
        updatedAt: '2023-08-03T04:53:18.910Z'
      numEdits: 0
      reactions: []
    id: 64cb32be1af278541d619599
    type: comment
  author: swang12
  content: "Thank you very much for providing this powerful tool! I'm using the pre-trained\
    \ Geneformer model for perturbation and encountered the error \"_pickle.UnpicklingError:\
    \ invalid load key, 'v'.\" when using InSilicoPerturberStats. I'm pasting the\
    \ related code snippet and error message below:\r\n\r\nfrom geneformer import\
    \ InSilicoPerturber\r\nfrom geneformer import InSilicoPerturberStats\r\n\r\nisp\
    \ = InSilicoPerturber(perturb_type='delete', \r\n                        perturb_rank_shift=None,\
    \ \r\n                        genes_to_perturb='all', \r\n                   \
    \     combos=0, \r\n                        anchor_gene=None, \r\n           \
    \             model_type='Pretrained', \r\n                        num_classes=0,\
    \ \r\n                        emb_mode='cell', \r\n                        cell_emb_style='mean_pool',\
    \ \r\n                        cell_states_to_model={'state_key': 'group', 'start_state':\
    \ 'opc_gaba', 'goal_state': 'other', 'alt_states': []}, \r\n                 \
    \       max_ncells=2000, \r\n                        emb_layer=-1, \r\n      \
    \                  forward_batch_size=32, \r\n                        nproc=16\r\
    \n                        )\r\n\r\nisp.perturb_data(model_directory='Geneformer/',\
    \ \r\n                 input_data_file='tokenized_.dataset', \r\n            \
    \     output_directory='./', \r\n                 output_prefix='perturbed_'\r\
    \n                 )\r\n\r\nispstats = InSilicoPerturberStats(mode='goal_state_shift',\
    \ \r\n                                  combos=0, \r\n                       \
    \           anchor_gene=None, \r\n                                  cell_states_to_model={'state_key':\
    \ 'group', 'start_state': 'opc_gaba', 'goal_state': 'other', 'alt_states': []}\r\
    \n                                  )\r\n\r\nTraceback (most recent call last):\r\
    \n  File \"transformer.py\", line 59, in <module>\r\n    ispstats = InSilicoPerturberStats(mode='goal_state_shift',\
    \ \r\n  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber_stats.py\"\
    , line 482, in __init__\r\n    self.gene_name_id_dict = pickle.load(f)\r\n_pickle.UnpicklingError:\
    \ invalid load key, 'v'.\r\n\r\nAfter running isp.perturb_data, I got two pickle\
    \ files: in_silico_delete_perturbed__dict_1Kbatch0_raw.pickle and in_silico_delete_perturbed__dict_1Kbatch-1_raw.pickle.\
    \ I found a similar discussion regarding this issue before but didn't get the\
    \ point of how to solve this issue. I reinstalled the latest version of Geneformer\
    \ but still got this error. Could you help me with this? Thank you very much!\r\
    \n\r\nSincerely,\r\nSu Wang\r\n"
  created_at: 2023-08-03 03:53:18+00:00
  edited: false
  hidden: false
  id: 64cb32be1af278541d619599
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-08-03T06:29:17.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9103437066078186
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your question and interest in Geneformer! Based on
          the error message you pasted, this is related to unpickling the gene_name_id_dict,
          not the perturbation results. This can happen if you have cloned the repository
          without git lfs, which is used by Huggingface''s repositories to handle
          larger file storage. Alternatively to installing git lfs, you can download
          the file directly from the repository (using wget or the GUI download button)
          and supply it locally in the repository directory.</p>

          <p>Also, in the future, if you find a different discussion regarding the
          issue, it''s helpful if you add your note to that discussion and reopen
          it if need be, rather than starting a new separate discussion that does
          not reference the prior one. That way, when people have the same question
          in the future, the information is not dispersed in multiple places. Thank
          you for your collaboration on that!</p>

          '
        raw: 'Thank you for your question and interest in Geneformer! Based on the
          error message you pasted, this is related to unpickling the gene_name_id_dict,
          not the perturbation results. This can happen if you have cloned the repository
          without git lfs, which is used by Huggingface''s repositories to handle
          larger file storage. Alternatively to installing git lfs, you can download
          the file directly from the repository (using wget or the GUI download button)
          and supply it locally in the repository directory.


          Also, in the future, if you find a different discussion regarding the issue,
          it''s helpful if you add your note to that discussion and reopen it if need
          be, rather than starting a new separate discussion that does not reference
          the prior one. That way, when people have the same question in the future,
          the information is not dispersed in multiple places. Thank you for your
          collaboration on that!'
        updatedAt: '2023-08-03T06:29:17.784Z'
      numEdits: 0
      reactions: []
      relatedEventId: 64cb493db704b85147915765
    id: 64cb493db704b85147915764
    type: comment
  author: ctheodoris
  content: 'Thank you for your question and interest in Geneformer! Based on the error
    message you pasted, this is related to unpickling the gene_name_id_dict, not the
    perturbation results. This can happen if you have cloned the repository without
    git lfs, which is used by Huggingface''s repositories to handle larger file storage.
    Alternatively to installing git lfs, you can download the file directly from the
    repository (using wget or the GUI download button) and supply it locally in the
    repository directory.


    Also, in the future, if you find a different discussion regarding the issue, it''s
    helpful if you add your note to that discussion and reopen it if need be, rather
    than starting a new separate discussion that does not reference the prior one.
    That way, when people have the same question in the future, the information is
    not dispersed in multiple places. Thank you for your collaboration on that!'
  created_at: 2023-08-03 05:29:17+00:00
  edited: false
  hidden: false
  id: 64cb493db704b85147915764
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-08-03T06:29:17.000Z'
    data:
      status: closed
    id: 64cb493db704b85147915765
    type: status-change
  author: ctheodoris
  created_at: 2023-08-03 05:29:17+00:00
  id: 64cb493db704b85147915765
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 164
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: Encountered error when using InSilicoPerturberStats
