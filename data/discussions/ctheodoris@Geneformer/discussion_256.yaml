!!python/object:huggingface_hub.community.DiscussionWithDetails
author: junguyen
conflicting_files: null
created_at: 2023-10-05 12:49:34+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/ecd4d674b85b6b6038b47181966e7b53.svg
      fullname: Julie Nguyen
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: junguyen
      type: user
    createdAt: '2023-10-05T13:49:34.000Z'
    data:
      edited: false
      editors:
      - junguyen
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5640775561332703
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/ecd4d674b85b6b6038b47181966e7b53.svg
          fullname: Julie Nguyen
          isHf: false
          isPro: false
          name: junguyen
          type: user
        html: "<p>Hello,</p>\n<p>I've had success outputting cosine shifts in cell\
          \ embeddings when running <code>emb_mode=\"cell\"</code> with the parameters\
          \ listed below; however, when changing <code>emb_mode=\"cell_and_gene\"\
          </code> and keeping all other parameters unchanged, I get the exact same\
          \ output (cosine shifts in cell embeddings only). </p>\n<p>My goal is to\
          \ observe how all other gene embeddings are affected after a single gene\
          \ perturbation, to identify important proteins in a network (similar to\
          \ Fig5a/b in the paper). I'm currently using a small subset from the Genecorpus-30M\
          \ dataset as my input data.</p>\n<p>How should I change my parameters to\
          \ get gene embedding outputs?</p>\n<p>Thank you!</p>\n<pre><code># Set perturbation\
          \ parameters\nisp = InSilicoPerturber(perturb_type=\"delete\",\n       \
          \                 perturb_rank_shift=None,\n                        genes_to_perturb=[\"\
          ENSG00000196262\"],\n                        combos=0,\n               \
          \         anchor_gene=None,\n                        model_type=\"Pretrained\"\
          ,\n                        num_classes=0,\n                        emb_mode=\"\
          cell\",\n                        cell_emb_style=\"mean_pool\",\n       \
          \                 filter_data=None,\n                        cell_states_to_model=None,\n\
          \                        max_ncells=None,\n                        cell_inds_to_perturb={\"\
          start\":0, \"end\":50},\n                        emb_layer=-1,\n       \
          \                 forward_batch_size=50,\n                        nproc=16,\n\
          \                        token_dictionary_file = \"/home/ubuntu/Geneformer/geneformer/token_dictionary.pkl\"\
          )\n\n# Perturb data\nisp.perturb_data(\"/home/ubuntu/Geneformer/\",\n  \
          \               \"/data/genecorpus_filtered_nonhep/\",\n               \
          \  \"/data/genecorpus_filtered_nonhep/delete_cell/\",\n                \
          \ \"cell_and_gene_test_PPIA\")\n\n# Set perturbation stats\nispstats = InSilicoPerturberStats(mode=\"\
          aggregate_data\",\n                                  genes_perturbed=[\"\
          ENSG00000196262\"],\n                                  combos=0,\n     \
          \                             anchor_gene=None,\n                      \
          \            cell_states_to_model=None,\n                              \
          \    token_dictionary_file = \"/home/ubuntu/Geneformer/geneformer/token_dictionary.pkl\"\
          )\n\n# Get perturbation stats\nispstats.get_stats(\"/data/genecorpus_filtered_nonhep/delete_cell/\"\
          ,\n                   None,\n                   \"/data/genecorpus_filtered_nonhep/delete_cell/\"\
          ,\n                   \"delete_cell_and_gene_test_PPIA\")\n</code></pre>\n"
        raw: "Hello,\r\n\r\nI've had success outputting cosine shifts in cell embeddings\
          \ when running `emb_mode=\"cell\"` with the parameters listed below; however,\
          \ when changing `emb_mode=\"cell_and_gene\"` and keeping all other parameters\
          \ unchanged, I get the exact same output (cosine shifts in cell embeddings\
          \ only). \r\n\r\nMy goal is to observe how all other gene embeddings are\
          \ affected after a single gene perturbation, to identify important proteins\
          \ in a network (similar to Fig5a/b in the paper). I'm currently using a\
          \ small subset from the Genecorpus-30M dataset as my input data.\r\n\r\n\
          How should I change my parameters to get gene embedding outputs?\r\n\r\n\
          Thank you!\r\n```\r\n# Set perturbation parameters\r\nisp = InSilicoPerturber(perturb_type=\"\
          delete\",\r\n                        perturb_rank_shift=None,\r\n      \
          \                  genes_to_perturb=[\"ENSG00000196262\"],\r\n         \
          \               combos=0,\r\n                        anchor_gene=None,\r\
          \n                        model_type=\"Pretrained\",\r\n               \
          \         num_classes=0,\r\n                        emb_mode=\"cell\",\r\
          \n                        cell_emb_style=\"mean_pool\",\r\n            \
          \            filter_data=None,\r\n                        cell_states_to_model=None,\r\
          \n                        max_ncells=None,\r\n                        cell_inds_to_perturb={\"\
          start\":0, \"end\":50},\r\n                        emb_layer=-1,\r\n   \
          \                     forward_batch_size=50,\r\n                       \
          \ nproc=16,\r\n                        token_dictionary_file = \"/home/ubuntu/Geneformer/geneformer/token_dictionary.pkl\"\
          )\r\n\r\n# Perturb data\r\nisp.perturb_data(\"/home/ubuntu/Geneformer/\"\
          ,\r\n                 \"/data/genecorpus_filtered_nonhep/\",\r\n       \
          \          \"/data/genecorpus_filtered_nonhep/delete_cell/\",\r\n      \
          \           \"cell_and_gene_test_PPIA\")\r\n\r\n# Set perturbation stats\r\
          \nispstats = InSilicoPerturberStats(mode=\"aggregate_data\",\r\n       \
          \                           genes_perturbed=[\"ENSG00000196262\"],\r\n \
          \                                 combos=0,\r\n                        \
          \          anchor_gene=None,\r\n                                  cell_states_to_model=None,\r\
          \n                                  token_dictionary_file = \"/home/ubuntu/Geneformer/geneformer/token_dictionary.pkl\"\
          )\r\n\r\n# Get perturbation stats\r\nispstats.get_stats(\"/data/genecorpus_filtered_nonhep/delete_cell/\"\
          ,\r\n                   None,\r\n                   \"/data/genecorpus_filtered_nonhep/delete_cell/\"\
          ,\r\n                   \"delete_cell_and_gene_test_PPIA\")\r\n\r\n```"
        updatedAt: '2023-10-05T13:49:34.613Z'
      numEdits: 0
      reactions: []
    id: 651ebeee372c0f3dc7e3964b
    type: comment
  author: junguyen
  content: "Hello,\r\n\r\nI've had success outputting cosine shifts in cell embeddings\
    \ when running `emb_mode=\"cell\"` with the parameters listed below; however,\
    \ when changing `emb_mode=\"cell_and_gene\"` and keeping all other parameters\
    \ unchanged, I get the exact same output (cosine shifts in cell embeddings only).\
    \ \r\n\r\nMy goal is to observe how all other gene embeddings are affected after\
    \ a single gene perturbation, to identify important proteins in a network (similar\
    \ to Fig5a/b in the paper). I'm currently using a small subset from the Genecorpus-30M\
    \ dataset as my input data.\r\n\r\nHow should I change my parameters to get gene\
    \ embedding outputs?\r\n\r\nThank you!\r\n```\r\n# Set perturbation parameters\r\
    \nisp = InSilicoPerturber(perturb_type=\"delete\",\r\n                       \
    \ perturb_rank_shift=None,\r\n                        genes_to_perturb=[\"ENSG00000196262\"\
    ],\r\n                        combos=0,\r\n                        anchor_gene=None,\r\
    \n                        model_type=\"Pretrained\",\r\n                     \
    \   num_classes=0,\r\n                        emb_mode=\"cell\",\r\n         \
    \               cell_emb_style=\"mean_pool\",\r\n                        filter_data=None,\r\
    \n                        cell_states_to_model=None,\r\n                     \
    \   max_ncells=None,\r\n                        cell_inds_to_perturb={\"start\"\
    :0, \"end\":50},\r\n                        emb_layer=-1,\r\n                \
    \        forward_batch_size=50,\r\n                        nproc=16,\r\n     \
    \                   token_dictionary_file = \"/home/ubuntu/Geneformer/geneformer/token_dictionary.pkl\"\
    )\r\n\r\n# Perturb data\r\nisp.perturb_data(\"/home/ubuntu/Geneformer/\",\r\n\
    \                 \"/data/genecorpus_filtered_nonhep/\",\r\n                 \"\
    /data/genecorpus_filtered_nonhep/delete_cell/\",\r\n                 \"cell_and_gene_test_PPIA\"\
    )\r\n\r\n# Set perturbation stats\r\nispstats = InSilicoPerturberStats(mode=\"\
    aggregate_data\",\r\n                                  genes_perturbed=[\"ENSG00000196262\"\
    ],\r\n                                  combos=0,\r\n                        \
    \          anchor_gene=None,\r\n                                  cell_states_to_model=None,\r\
    \n                                  token_dictionary_file = \"/home/ubuntu/Geneformer/geneformer/token_dictionary.pkl\"\
    )\r\n\r\n# Get perturbation stats\r\nispstats.get_stats(\"/data/genecorpus_filtered_nonhep/delete_cell/\"\
    ,\r\n                   None,\r\n                   \"/data/genecorpus_filtered_nonhep/delete_cell/\"\
    ,\r\n                   \"delete_cell_and_gene_test_PPIA\")\r\n\r\n```"
  created_at: 2023-10-05 12:49:34+00:00
  edited: false
  hidden: false
  id: 651ebeee372c0f3dc7e3964b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-12-15T09:01:17.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9056812524795532
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your interest in Geneformer and for your patience!
          We pushed an update that should resolve this issue. If you continue to face
          errors after pulling the updated code, please let us know by either reopening
          this discussion if it''s the same error or opening a new discussion if it''s
          a new error. Thank you!</p>

          '
        raw: Thank you for your interest in Geneformer and for your patience! We pushed
          an update that should resolve this issue. If you continue to face errors
          after pulling the updated code, please let us know by either reopening this
          discussion if it's the same error or opening a new discussion if it's a
          new error. Thank you!
        updatedAt: '2023-12-15T09:01:17.554Z'
      numEdits: 0
      reactions: []
      relatedEventId: 657c15dd429a20edb51959d5
    id: 657c15dd429a20edb51959d1
    type: comment
  author: ctheodoris
  content: Thank you for your interest in Geneformer and for your patience! We pushed
    an update that should resolve this issue. If you continue to face errors after
    pulling the updated code, please let us know by either reopening this discussion
    if it's the same error or opening a new discussion if it's a new error. Thank
    you!
  created_at: 2023-12-15 09:01:17+00:00
  edited: false
  hidden: false
  id: 657c15dd429a20edb51959d1
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-12-15T09:01:17.000Z'
    data:
      status: closed
    id: 657c15dd429a20edb51959d5
    type: status-change
  author: ctheodoris
  created_at: 2023-12-15 09:01:17+00:00
  id: 657c15dd429a20edb51959d5
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 256
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: How to output gene embeddings after single gene perturbation, similar to Fig5a/b?
