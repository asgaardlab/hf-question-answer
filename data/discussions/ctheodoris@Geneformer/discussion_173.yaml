!!python/object:huggingface_hub.community.DiscussionWithDetails
author: swang12
conflicting_files: null
created_at: 2023-08-04 14:28:27+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/dfad9b282f034de3ccdaf7ab2b999559.svg
      fullname: Su Wang
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: swang12
      type: user
    createdAt: '2023-08-04T15:28:27.000Z'
    data:
      edited: false
      editors:
      - swang12
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.3837753236293793
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/dfad9b282f034de3ccdaf7ab2b999559.svg
          fullname: Su Wang
          isHf: false
          isPro: false
          name: swang12
          type: user
        html: '<p>Hi, I''m running InSilicoPerturberStats.get_stats using the pre-trained
          Geneformer model and got this error: UnboundLocalError: local variable ''alt_end_state_exists''
          referenced before assignment. I''m pasting the code and error message below:</p>

          <p>from geneformer import InSilicoPerturber<br>from geneformer import InSilicoPerturberStats</p>

          <p>isp = InSilicoPerturber(perturb_type=''delete'',<br>                        perturb_rank_shift=None,<br>                        genes_to_perturb=''all'',<br>                        combos=0,<br>                        anchor_gene=None,<br>                        model_type=''Pretrained'',<br>                        num_classes=0,<br>                        emb_mode=''cell'',<br>                        cell_emb_style=''mean_pool'',<br>                        cell_states_to_model={''state_key'':
          ''group'', ''start_state'': ''opc_gaba'', ''goal_state'': ''other'', ''alt_states'':
          []},<br>                        max_ncells=2000,<br>                        emb_layer=-1,<br>                        forward_batch_size=32,<br>                        nproc=16<br>                        )</p>

          <p>isp.perturb_data(model_directory=''Geneformer/'',<br>                 input_data_file=''tokenized_.dataset'',<br>                 output_directory=''./'',<br>                 output_prefix=''perturbed''<br>                 )</p>

          <p>ispstats = InSilicoPerturberStats(mode=''goal_state_shift'',<br>                                  combos=0,<br>                                  anchor_gene=None,<br>                                  cell_states_to_model={''state_key'':
          ''group'', ''start_state'': ''opc_gaba'', ''goal_state'': ''other'', ''alt_states'':
          []}<br>                                  )</p>

          <p>ispstats.get_stats(input_data_directory=''./'',<br>                   null_dist_data_directory=None,<br>                   output_directory=''./'',<br>                   output_prefix=''stats''<br>                   )</p>

          <p>Traceback (most recent call last):<br>  File "transformer.py", line 65,
          in <br>    ispstats.get_stats(input_data_directory=''./'',<br>  File "/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber_stats.py",
          line 694, in get_stats<br>    cos_sims_df = isp_stats_to_goal_state(cos_sims_df_initial,
          dict_list, self.cell_states_to_model, self.genes_perturbed)<br>  File "/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber_stats.py",
          line 167, in isp_stats_to_goal_state<br>    if alt_end_state_exists == False:<br>UnboundLocalError:
          local variable ''alt_end_state_exists'' referenced before assignment</p>

          <p>I have no idea how to fix it. Could you help me with this? Thank you
          very much!</p>

          '
        raw: "Hi, I'm running InSilicoPerturberStats.get_stats using the pre-trained\
          \ Geneformer model and got this error: UnboundLocalError: local variable\
          \ 'alt_end_state_exists' referenced before assignment. I'm pasting the code\
          \ and error message below:\r\n\r\nfrom geneformer import InSilicoPerturber\r\
          \nfrom geneformer import InSilicoPerturberStats\r\n\r\nisp = InSilicoPerturber(perturb_type='delete',\
          \ \r\n                        perturb_rank_shift=None, \r\n            \
          \            genes_to_perturb='all', \r\n                        combos=0,\
          \ \r\n                        anchor_gene=None, \r\n                   \
          \     model_type='Pretrained', \r\n                        num_classes=0,\
          \ \r\n                        emb_mode='cell', \r\n                    \
          \    cell_emb_style='mean_pool', \r\n                        cell_states_to_model={'state_key':\
          \ 'group', 'start_state': 'opc_gaba', 'goal_state': 'other', 'alt_states':\
          \ []}, \r\n                        max_ncells=2000, \r\n               \
          \         emb_layer=-1, \r\n                        forward_batch_size=32,\
          \ \r\n                        nproc=16\r\n                        )\r\n\r\
          \nisp.perturb_data(model_directory='Geneformer/', \r\n                 input_data_file='tokenized_.dataset',\
          \ \r\n                 output_directory='./', \r\n                 output_prefix='perturbed'\r\
          \n                 )\r\n\r\nispstats = InSilicoPerturberStats(mode='goal_state_shift',\
          \ \r\n                                  combos=0, \r\n                 \
          \                 anchor_gene=None, \r\n                               \
          \   cell_states_to_model={'state_key': 'group', 'start_state': 'opc_gaba',\
          \ 'goal_state': 'other', 'alt_states': []}\r\n                         \
          \         )\r\n\r\nispstats.get_stats(input_data_directory='./',\r\n   \
          \                null_dist_data_directory=None,\r\n                   output_directory='./',\r\
          \n                   output_prefix='stats'\r\n                   )\r\n\r\
          \nTraceback (most recent call last):\r\n  File \"transformer.py\", line\
          \ 65, in <module>\r\n    ispstats.get_stats(input_data_directory='./',\r\
          \n  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber_stats.py\"\
          , line 694, in get_stats\r\n    cos_sims_df = isp_stats_to_goal_state(cos_sims_df_initial,\
          \ dict_list, self.cell_states_to_model, self.genes_perturbed)\r\n  File\
          \ \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber_stats.py\"\
          , line 167, in isp_stats_to_goal_state\r\n    if alt_end_state_exists ==\
          \ False:\r\nUnboundLocalError: local variable 'alt_end_state_exists' referenced\
          \ before assignment\r\n\r\nI have no idea how to fix it. Could you help\
          \ me with this? Thank you very much!"
        updatedAt: '2023-08-04T15:28:27.850Z'
      numEdits: 0
      reactions: []
    id: 64cd191b39372cce5a3e89d2
    type: comment
  author: swang12
  content: "Hi, I'm running InSilicoPerturberStats.get_stats using the pre-trained\
    \ Geneformer model and got this error: UnboundLocalError: local variable 'alt_end_state_exists'\
    \ referenced before assignment. I'm pasting the code and error message below:\r\
    \n\r\nfrom geneformer import InSilicoPerturber\r\nfrom geneformer import InSilicoPerturberStats\r\
    \n\r\nisp = InSilicoPerturber(perturb_type='delete', \r\n                    \
    \    perturb_rank_shift=None, \r\n                        genes_to_perturb='all',\
    \ \r\n                        combos=0, \r\n                        anchor_gene=None,\
    \ \r\n                        model_type='Pretrained', \r\n                  \
    \      num_classes=0, \r\n                        emb_mode='cell', \r\n      \
    \                  cell_emb_style='mean_pool', \r\n                        cell_states_to_model={'state_key':\
    \ 'group', 'start_state': 'opc_gaba', 'goal_state': 'other', 'alt_states': []},\
    \ \r\n                        max_ncells=2000, \r\n                        emb_layer=-1,\
    \ \r\n                        forward_batch_size=32, \r\n                    \
    \    nproc=16\r\n                        )\r\n\r\nisp.perturb_data(model_directory='Geneformer/',\
    \ \r\n                 input_data_file='tokenized_.dataset', \r\n            \
    \     output_directory='./', \r\n                 output_prefix='perturbed'\r\n\
    \                 )\r\n\r\nispstats = InSilicoPerturberStats(mode='goal_state_shift',\
    \ \r\n                                  combos=0, \r\n                       \
    \           anchor_gene=None, \r\n                                  cell_states_to_model={'state_key':\
    \ 'group', 'start_state': 'opc_gaba', 'goal_state': 'other', 'alt_states': []}\r\
    \n                                  )\r\n\r\nispstats.get_stats(input_data_directory='./',\r\
    \n                   null_dist_data_directory=None,\r\n                   output_directory='./',\r\
    \n                   output_prefix='stats'\r\n                   )\r\n\r\nTraceback\
    \ (most recent call last):\r\n  File \"transformer.py\", line 65, in <module>\r\
    \n    ispstats.get_stats(input_data_directory='./',\r\n  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber_stats.py\"\
    , line 694, in get_stats\r\n    cos_sims_df = isp_stats_to_goal_state(cos_sims_df_initial,\
    \ dict_list, self.cell_states_to_model, self.genes_perturbed)\r\n  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber_stats.py\"\
    , line 167, in isp_stats_to_goal_state\r\n    if alt_end_state_exists == False:\r\
    \nUnboundLocalError: local variable 'alt_end_state_exists' referenced before assignment\r\
    \n\r\nI have no idea how to fix it. Could you help me with this? Thank you very\
    \ much!"
  created_at: 2023-08-04 14:28:27+00:00
  edited: false
  hidden: false
  id: 64cd191b39372cce5a3e89d2
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-08-04T17:54:14.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9072381258010864
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your question and interest in Geneformer! We added
          code to handle the case where the user may provide alt_states as an empty
          list. Please pull the updated version (or omit the alt_states key if there
          are no alt_states).</p>

          '
        raw: Thank you for your question and interest in Geneformer! We added code
          to handle the case where the user may provide alt_states as an empty list.
          Please pull the updated version (or omit the alt_states key if there are
          no alt_states).
        updatedAt: '2023-08-04T17:54:14.191Z'
      numEdits: 0
      reactions: []
      relatedEventId: 64cd3b46e13e7c2bc5678e66
    id: 64cd3b46e13e7c2bc5678e64
    type: comment
  author: ctheodoris
  content: Thank you for your question and interest in Geneformer! We added code to
    handle the case where the user may provide alt_states as an empty list. Please
    pull the updated version (or omit the alt_states key if there are no alt_states).
  created_at: 2023-08-04 16:54:14+00:00
  edited: false
  hidden: false
  id: 64cd3b46e13e7c2bc5678e64
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-08-04T17:54:14.000Z'
    data:
      status: closed
    id: 64cd3b46e13e7c2bc5678e66
    type: status-change
  author: ctheodoris
  created_at: 2023-08-04 16:54:14+00:00
  id: 64cd3b46e13e7c2bc5678e66
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 173
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: InSilicoPerturberStats.get_stats error
