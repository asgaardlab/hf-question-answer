!!python/object:huggingface_hub.community.DiscussionWithDetails
author: iftesha1
conflicting_files: null
created_at: 2023-06-22 12:42:26+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/6e1190850c86d6e55b7ca16be0ca1f58.svg
      fullname: Iftesha Najnin
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: iftesha1
      type: user
    createdAt: '2023-06-22T13:42:26.000Z'
    data:
      edited: false
      editors:
      - iftesha1
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8760513067245483
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/6e1190850c86d6e55b7ca16be0ca1f58.svg
          fullname: Iftesha Najnin
          isHf: false
          isPro: false
          name: iftesha1
          type: user
        html: '<p>I am using the geneformer-6L-30M model. I am fine tuning with custom
          data and I want to extract the cell embeddings and gene embeddings out of
          it. Is there any example code available?</p>

          '
        raw: I am using the geneformer-6L-30M model. I am fine tuning with custom
          data and I want to extract the cell embeddings and gene embeddings out of
          it. Is there any example code available?
        updatedAt: '2023-06-22T13:42:26.663Z'
      numEdits: 0
      reactions: []
    id: 64944fc21df5076b33bdc971
    type: comment
  author: iftesha1
  content: I am using the geneformer-6L-30M model. I am fine tuning with custom data
    and I want to extract the cell embeddings and gene embeddings out of it. Is there
    any example code available?
  created_at: 2023-06-22 12:42:26+00:00
  edited: false
  hidden: false
  id: 64944fc21df5076b33bdc971
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-06-22T13:53:14.000Z'
    data:
      edited: true
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.881690263748169
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: "<p>Thank you for you interest in Geneformer. Please see the following\
          \ closed issue and the Gene Embeddings and Cell Embeddings sections of the\
          \ Methods in the manuscript. </p>\n<p><a href=\"https://huggingface.co/ctheodoris/Geneformer/discussions/27\"\
          >https://huggingface.co/ctheodoris/Geneformer/discussions/27</a></p>\n<p>Update:<br><span\
          \ data-props=\"{&quot;user&quot;:&quot;iftesha1&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/iftesha1\">@<span class=\"\
          underline\">iftesha1</span></a></span>\n\n\t</span></span><br>We have now\
          \ added a function to extract and plot cell embeddings. Please see example\
          \ here:<br><a href=\"https://huggingface.co/ctheodoris/Geneformer/blob/main/examples/extract_and_plot_cell_embeddings.ipynb\"\
          >https://huggingface.co/ctheodoris/Geneformer/blob/main/examples/extract_and_plot_cell_embeddings.ipynb</a></p>\n"
        raw: "Thank you for you interest in Geneformer. Please see the following closed\
          \ issue and the Gene Embeddings and Cell Embeddings sections of the Methods\
          \ in the manuscript. \n\nhttps://huggingface.co/ctheodoris/Geneformer/discussions/27\n\
          \nUpdate:\n@iftesha1\nWe have now added a function to extract and plot cell\
          \ embeddings. Please see example here:\nhttps://huggingface.co/ctheodoris/Geneformer/blob/main/examples/extract_and_plot_cell_embeddings.ipynb"
        updatedAt: '2023-07-28T07:12:25.874Z'
      numEdits: 1
      reactions: []
      relatedEventId: 6494524ada36e1e4eb06f56e
    id: 6494524ada36e1e4eb06f569
    type: comment
  author: ctheodoris
  content: "Thank you for you interest in Geneformer. Please see the following closed\
    \ issue and the Gene Embeddings and Cell Embeddings sections of the Methods in\
    \ the manuscript. \n\nhttps://huggingface.co/ctheodoris/Geneformer/discussions/27\n\
    \nUpdate:\n@iftesha1\nWe have now added a function to extract and plot cell embeddings.\
    \ Please see example here:\nhttps://huggingface.co/ctheodoris/Geneformer/blob/main/examples/extract_and_plot_cell_embeddings.ipynb"
  created_at: 2023-06-22 12:53:14+00:00
  edited: true
  hidden: false
  id: 6494524ada36e1e4eb06f569
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-06-22T13:53:14.000Z'
    data:
      status: closed
    id: 6494524ada36e1e4eb06f56e
    type: status-change
  author: ctheodoris
  created_at: 2023-06-22 12:53:14+00:00
  id: 6494524ada36e1e4eb06f56e
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/1d1eb32b5afe15b8a8d83a4b6f60f5f0.svg
      fullname: Eric Kernfeld
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: ekernf01
      type: user
    createdAt: '2023-06-26T20:00:06.000Z'
    data:
      edited: true
      editors:
      - ekernf01
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9041799902915955
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/1d1eb32b5afe15b8a8d83a4b6f60f5f0.svg
          fullname: Eric Kernfeld
          isHf: false
          isPro: false
          name: ekernf01
          type: user
        html: '<p>If I want to combine this step with your in silico perturbation
          procedure, I think I need an intermediate file or object containing data
          that have been tokenized and also have had the ranks of the perturbed genes
          altered as usual. Is this type of object currently accessible to users?
          I''ve tried:</p>

          <ul>

          <li>Looking in the output directory passed to InSilicoPerturber.perturb_data
          (There is a pickle file containing a ragged array of floating point numbers
          but no tokenized data or CSV file.)</li>

          <li>Looking in the object returned by InSilicoPerturber.perturb_data (it''s
          just None)</li>

          <li>Looking for a different function to alter the ranks. I suspect the right
          function would be make_perturbation_batch, but I am not confident that this
          function is intended to be exposed to end users.</li>

          </ul>

          '
        raw: 'If I want to combine this step with your in silico perturbation procedure,
          I think I need an intermediate file or object containing data that have
          been tokenized and also have had the ranks of the perturbed genes altered
          as usual. Is this type of object currently accessible to users? I''ve tried:


          - Looking in the output directory passed to InSilicoPerturber.perturb_data
          (There is a pickle file containing a ragged array of floating point numbers
          but no tokenized data or CSV file.)

          - Looking in the object returned by InSilicoPerturber.perturb_data (it''s
          just None)

          - Looking for a different function to alter the ranks. I suspect the right
          function would be make_perturbation_batch, but I am not confident that this
          function is intended to be exposed to end users.'
        updatedAt: '2023-06-26T20:00:22.892Z'
      numEdits: 1
      reactions: []
    id: 6499ee46d03d717811406d9c
    type: comment
  author: ekernf01
  content: 'If I want to combine this step with your in silico perturbation procedure,
    I think I need an intermediate file or object containing data that have been tokenized
    and also have had the ranks of the perturbed genes altered as usual. Is this type
    of object currently accessible to users? I''ve tried:


    - Looking in the output directory passed to InSilicoPerturber.perturb_data (There
    is a pickle file containing a ragged array of floating point numbers but no tokenized
    data or CSV file.)

    - Looking in the object returned by InSilicoPerturber.perturb_data (it''s just
    None)

    - Looking for a different function to alter the ranks. I suspect the right function
    would be make_perturbation_batch, but I am not confident that this function is
    intended to be exposed to end users.'
  created_at: 2023-06-26 19:00:06+00:00
  edited: true
  hidden: false
  id: 6499ee46d03d717811406d9c
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-06-26T23:27:20.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9040896892547607
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your question. The in silico perturber will perturb
          genes according to provided options and output the cosine shifts of gene
          and/or cell embeddings in response to those perturbations. (It already extracts
          the embeddings of the original and perturbed states so you don''t need to
          pass it an intermediate file to do this). The output of the in silico perturber
          should then be passed to the in silico perturber stats, specifying the options
          for the analysis the user would like to accomplish. The output of that will
          be a .csv file similar to the supplementary files in our manuscript, which
          contain the Geneformer-predicted effect of each perturbation performed.</p>

          <p>If you would like to extract the embeddings themselves, you can follow
          the procedure I linked to in the response to your initial question. You
          can pass the model either the original cell or perturbed cell to output
          their respective embeddings.</p>

          '
        raw: 'Thank you for your question. The in silico perturber will perturb genes
          according to provided options and output the cosine shifts of gene and/or
          cell embeddings in response to those perturbations. (It already extracts
          the embeddings of the original and perturbed states so you don''t need to
          pass it an intermediate file to do this). The output of the in silico perturber
          should then be passed to the in silico perturber stats, specifying the options
          for the analysis the user would like to accomplish. The output of that will
          be a .csv file similar to the supplementary files in our manuscript, which
          contain the Geneformer-predicted effect of each perturbation performed.


          If you would like to extract the embeddings themselves, you can follow the
          procedure I linked to in the response to your initial question. You can
          pass the model either the original cell or perturbed cell to output their
          respective embeddings.'
        updatedAt: '2023-06-26T23:27:20.922Z'
      numEdits: 0
      reactions: []
    id: 649a1ed8f57df33a56a45064
    type: comment
  author: ctheodoris
  content: 'Thank you for your question. The in silico perturber will perturb genes
    according to provided options and output the cosine shifts of gene and/or cell
    embeddings in response to those perturbations. (It already extracts the embeddings
    of the original and perturbed states so you don''t need to pass it an intermediate
    file to do this). The output of the in silico perturber should then be passed
    to the in silico perturber stats, specifying the options for the analysis the
    user would like to accomplish. The output of that will be a .csv file similar
    to the supplementary files in our manuscript, which contain the Geneformer-predicted
    effect of each perturbation performed.


    If you would like to extract the embeddings themselves, you can follow the procedure
    I linked to in the response to your initial question. You can pass the model either
    the original cell or perturbed cell to output their respective embeddings.'
  created_at: 2023-06-26 22:27:20+00:00
  edited: false
  hidden: false
  id: 649a1ed8f57df33a56a45064
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/2a50f4c8015d0402180315ccbb534bbb.svg
      fullname: Gong
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Wuming
      type: user
    createdAt: '2023-06-29T23:40:46.000Z'
    data:
      edited: false
      editors:
      - Wuming
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8364546298980713
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/2a50f4c8015d0402180315ccbb534bbb.svg
          fullname: Gong
          isHf: false
          isPro: false
          name: Wuming
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;ctheodoris&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/ctheodoris\">@<span class=\"\
          underline\">ctheodoris</span></a></span>\n\n\t</span></span> Thanks for\
          \ the nice work. I have a question also regarding the cell embeddings. The\
          \ manuscript used the \"average of the embeddings of each gene in the second\
          \ to last layer\" as the cell embeddings (e.g. sth like <code>torch.mean(outputs.hidden_states[-2],\
          \ axis = 1)</code>). Another possible way of getting cell embedding is just\
          \ use the embedding of the <code>[CLS]</code> token (e.g. <code>outputs.pooler_output</code>).\
          \ Could you please elaborate why you chose to use the first way for cell\
          \ embeddings (e.g. what is the downside of just using the [CLS] embedding).\
          \ Thanks. </p>\n"
        raw: '@ctheodoris Thanks for the nice work. I have a question also regarding
          the cell embeddings. The manuscript used the "average of the embeddings
          of each gene in the second to last layer" as the cell embeddings (e.g. sth
          like `torch.mean(outputs.hidden_states[-2], axis = 1)`). Another possible
          way of getting cell embedding is just use the embedding of the `[CLS]` token
          (e.g. `outputs.pooler_output`). Could you please elaborate why you chose
          to use the first way for cell embeddings (e.g. what is the downside of just
          using the [CLS] embedding). Thanks. '
        updatedAt: '2023-06-29T23:40:46.114Z'
      numEdits: 0
      reactions: []
    id: 649e167ef9134a06ed151dc2
    type: comment
  author: Wuming
  content: '@ctheodoris Thanks for the nice work. I have a question also regarding
    the cell embeddings. The manuscript used the "average of the embeddings of each
    gene in the second to last layer" as the cell embeddings (e.g. sth like `torch.mean(outputs.hidden_states[-2],
    axis = 1)`). Another possible way of getting cell embedding is just use the embedding
    of the `[CLS]` token (e.g. `outputs.pooler_output`). Could you please elaborate
    why you chose to use the first way for cell embeddings (e.g. what is the downside
    of just using the [CLS] embedding). Thanks. '
  created_at: 2023-06-29 22:40:46+00:00
  edited: false
  hidden: false
  id: 649e167ef9134a06ed151dc2
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-06-29T23:57:02.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8427027463912964
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thanks for your question. Please see closed discussion 69: <a href="https://huggingface.co/ctheodoris/Geneformer/discussions/69#649a5b8357d49b8969ca1bda">https://huggingface.co/ctheodoris/Geneformer/discussions/69#649a5b8357d49b8969ca1bda</a></p>

          '
        raw: 'Thanks for your question. Please see closed discussion 69: https://huggingface.co/ctheodoris/Geneformer/discussions/69#649a5b8357d49b8969ca1bda'
        updatedAt: '2023-06-29T23:57:02.483Z'
      numEdits: 0
      reactions: []
    id: 649e1a4e40d0ed8a50de16d8
    type: comment
  author: ctheodoris
  content: 'Thanks for your question. Please see closed discussion 69: https://huggingface.co/ctheodoris/Geneformer/discussions/69#649a5b8357d49b8969ca1bda'
  created_at: 2023-06-29 22:57:02+00:00
  edited: false
  hidden: false
  id: 649e1a4e40d0ed8a50de16d8
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 53
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: How can I extract cell-embbedings?
