!!python/object:huggingface_hub.community.DiscussionWithDetails
author: pchiang5
conflicting_files: null
created_at: 2023-08-21 00:13:36+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/1092f31a9ffd1e9813369b91311f765a.svg
      fullname: PC
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: pchiang5
      type: user
    createdAt: '2023-08-21T01:13:36.000Z'
    data:
      edited: false
      editors:
      - pchiang5
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.46239331364631653
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/1092f31a9ffd1e9813369b91311f765a.svg
          fullname: PC
          isHf: false
          isPro: false
          name: pchiang5
          type: user
        html: "<p>After suceessful runing of the following steps:</p>\n<pre><code>import\
          \ os\nos.environ['TRANSFORMERS_CACHE'] = '/mnt/c/Users/pc/Downloads/cache/'\n\
          from geneformer import InSilicoPerturber\nfrom geneformer import InSilicoPerturberStats\n\
          isp = InSilicoPerturber(perturb_type=\"overexpress\",\n                \
          \        perturb_rank_shift=None,\n                        genes_to_perturb=\"\
          all\",\n                        combos=0,\n                        anchor_gene=None,\n\
          \                        model_type=\"CellClassifier\",\n              \
          \          num_classes=29,\n                        emb_mode=\"cell\",\n\
          \                        cell_emb_style=\"mean_pool\",\n               \
          \         cell_states_to_model={'state_key': 'cell_type', 'start_state':\
          \ 'A', 'goal_state': 'B', 'alt_states': []},\n                        max_ncells=52775,\
          \ \n                        emb_layer=0,\n                        forward_batch_size=400,\n\
          \                        nproc=44)\nisp.perturb_data(\"/mnt/c/Users/pc/Downloads/GF/230816_geneformer_CellClassifier_celltypes_L2048_B8_LR0.00028292192255361916_LSlinear_WU559.5193527108581_E10_Oadamw_F2\"\
          ,\n                 \"/mnt/c/Users/pc/Downloads/transformer.dataset\",\n\
          \                 \"/mnt/c/Users/pc/Downloads/GF2\",\n                 \"\
          full2\")\n#modify the file InSilicoPerturberStats in geneformer\n#GENE_NAME_ID_DICTIONARY_FILE\
          \ = \"/mnt/c/Users/pc/Downloads/Geneformer/Geneformer/gene_name_id_dict.pkl\"\
          \nispstats = InSilicoPerturberStats(mode=\"goal_state_shift\",\n       \
          \                           genes_perturbed=\"all\",\n                 \
          \                 combos=0,\n                                  anchor_gene=None,\n\
          \                                  cell_states_to_model={'state_key': 'cell_type',\
          \ 'start_state': 'A', 'goal_state': 'B', 'alt_states': []})\n</code></pre>\n\
          <p>Another error jumped out:</p>\n<pre><code>In [15]: ispstats.get_stats(\"\
          /mnt/c/Users/pc/Downloads\",\n    ...:                    None,\n    ...:\
          \                    \"/mnt/c/Users/pc/Downloads/GF2\",\n    ...:      \
          \              \"full\")\n  0%|          | 0/13 [00:00&lt;?, ?it/s]\n  0%|\
          \          | 0/15183 [00:00&lt;?, ?it/s]\n---------------------------------------------------------------------------\n\
          ValueError                                Traceback (most recent call last)\n\
          Cell In[15], line 1\n----&gt; 1 ispstats.get_stats(\"/mnt/c/Users/pc/Downloads\"\
          ,\n      2                    None,\n      3                    \"/mnt/c/Users/pc/Downloads/GF2\"\
          ,\n      4                    \"full\")\n\nFile /home/pc/miniconda3/envs/geneformer/lib/python3.10/site-packages/geneformer/in_silico_perturber_stats.py:696,\
          \ in InSilicoPerturberStats.get_stats(self, input_data_directory, null_dist_data_directory,\
          \ output_directory, output_prefix)\n    684 cos_sims_df_initial = pd.DataFrame({\"\
          Gene\": gene_list,\n    685                                     \"Gene_name\"\
          : [self.token_to_gene_name(item) \\\n    686                           \
          \                        for item in gene_list], \\\n   (...)\n    692 \
          \                                                   for genes in gene_list]},\
          \ \\\n    693                                      index=[i for i in range(len(gene_list))])\n\
          \    695 if self.mode == \"goal_state_shift\":\n--&gt; 696     cos_sims_df\
          \ = isp_stats_to_goal_state(cos_sims_df_initial, dict_list, self.cell_states_to_model,\
          \ self.genes_perturbed)\n    698 elif self.mode == \"vs_null\":\n    699\
          \     null_dict_list = read_dictionaries(null_dist_data_directory, \"cell\"\
          , self.anchor_token)\n\nFile /home/pc/miniconda3/envs/geneformer/lib/python3.10/site-packages/geneformer/in_silico_perturber_stats.py:170,\
          \ in isp_stats_to_goal_state(cos_sims_df, dict_list, cell_states_to_model,\
          \ genes_perturbed)\n    167         random_tuples += dict_i.get((token,\
          \ \"cell_emb\"),[])\n    169 if alt_end_state_exists == False:\n--&gt; 170\
          \     goal_end_random_megalist = [goal_end for start_state,goal_end in random_tuples]\n\
          \    171 elif alt_end_state_exists == True:\n    172     goal_end_random_megalist\
          \ = [goal_end for start_state,goal_end,alt_end in random_tuples]\n\nFile\
          \ /home/pc/miniconda3/envs/geneformer/lib/python3.10/site-packages/geneformer/in_silico_perturber_stats.py:170,\
          \ in &lt;listcomp&gt;(.0)\n    167         random_tuples += dict_i.get((token,\
          \ \"cell_emb\"),[])\n    169 if alt_end_state_exists == False:\n--&gt; 170\
          \     goal_end_random_megalist = [goal_end for start_state,goal_end in random_tuples]\n\
          \    171 elif alt_end_state_exists == True:\n    172     goal_end_random_megalist\
          \ = [goal_end for start_state,goal_end,alt_end in random_tuples]\n\nValueError:\
          \ too many values to unpack (expected 2)\n</code></pre>\n<p>Was it due to\
          \ the issues with cell_class assignment? I tried to remove the 'alt_states'\
          \ and not working.   Thank you.</p>\n"
        raw: "After suceessful runing of the following steps:\r\n```\r\nimport os\r\
          \nos.environ['TRANSFORMERS_CACHE'] = '/mnt/c/Users/pc/Downloads/cache/'\r\
          \nfrom geneformer import InSilicoPerturber\r\nfrom geneformer import InSilicoPerturberStats\r\
          \nisp = InSilicoPerturber(perturb_type=\"overexpress\",\r\n            \
          \            perturb_rank_shift=None,\r\n                        genes_to_perturb=\"\
          all\",\r\n                        combos=0,\r\n                        anchor_gene=None,\r\
          \n                        model_type=\"CellClassifier\",\r\n           \
          \             num_classes=29,\r\n                        emb_mode=\"cell\"\
          ,\r\n                        cell_emb_style=\"mean_pool\",\r\n         \
          \               cell_states_to_model={'state_key': 'cell_type', 'start_state':\
          \ 'A', 'goal_state': 'B', 'alt_states': []},\r\n                       \
          \ max_ncells=52775, \r\n                        emb_layer=0,\r\n       \
          \                 forward_batch_size=400,\r\n                        nproc=44)\r\
          \nisp.perturb_data(\"/mnt/c/Users/pc/Downloads/GF/230816_geneformer_CellClassifier_celltypes_L2048_B8_LR0.00028292192255361916_LSlinear_WU559.5193527108581_E10_Oadamw_F2\"\
          ,\r\n                 \"/mnt/c/Users/pc/Downloads/transformer.dataset\"\
          ,\r\n                 \"/mnt/c/Users/pc/Downloads/GF2\",\r\n           \
          \      \"full2\")\r\n#modify the file InSilicoPerturberStats in geneformer\r\
          \n#GENE_NAME_ID_DICTIONARY_FILE = \"/mnt/c/Users/pc/Downloads/Geneformer/Geneformer/gene_name_id_dict.pkl\"\
          \r\nispstats = InSilicoPerturberStats(mode=\"goal_state_shift\",\r\n   \
          \                               genes_perturbed=\"all\",\r\n           \
          \                       combos=0,\r\n                                  anchor_gene=None,\r\
          \n                                  cell_states_to_model={'state_key': 'cell_type',\
          \ 'start_state': 'A', 'goal_state': 'B', 'alt_states': []})\r\n```\r\n\r\
          \nAnother error jumped out:\r\n```\r\nIn [15]: ispstats.get_stats(\"/mnt/c/Users/pc/Downloads\"\
          ,\r\n    ...:                    None,\r\n    ...:                    \"\
          /mnt/c/Users/pc/Downloads/GF2\",\r\n    ...:                    \"full\"\
          )\r\n  0%|          | 0/13 [00:00<?, ?it/s]\r\n  0%|          | 0/15183\
          \ [00:00<?, ?it/s]\r\n---------------------------------------------------------------------------\r\
          \nValueError                                Traceback (most recent call\
          \ last)\r\nCell In[15], line 1\r\n----> 1 ispstats.get_stats(\"/mnt/c/Users/pc/Downloads\"\
          ,\r\n      2                    None,\r\n      3                    \"/mnt/c/Users/pc/Downloads/GF2\"\
          ,\r\n      4                    \"full\")\r\n\r\nFile /home/pc/miniconda3/envs/geneformer/lib/python3.10/site-packages/geneformer/in_silico_perturber_stats.py:696,\
          \ in InSilicoPerturberStats.get_stats(self, input_data_directory, null_dist_data_directory,\
          \ output_directory, output_prefix)\r\n    684 cos_sims_df_initial = pd.DataFrame({\"\
          Gene\": gene_list,\r\n    685                                     \"Gene_name\"\
          : [self.token_to_gene_name(item) \\\r\n    686                         \
          \                          for item in gene_list], \\\r\n   (...)\r\n  \
          \  692                                                    for genes in gene_list]},\
          \ \\\r\n    693                                      index=[i for i in range(len(gene_list))])\r\
          \n    695 if self.mode == \"goal_state_shift\":\r\n--> 696     cos_sims_df\
          \ = isp_stats_to_goal_state(cos_sims_df_initial, dict_list, self.cell_states_to_model,\
          \ self.genes_perturbed)\r\n    698 elif self.mode == \"vs_null\":\r\n  \
          \  699     null_dict_list = read_dictionaries(null_dist_data_directory,\
          \ \"cell\", self.anchor_token)\r\n\r\nFile /home/pc/miniconda3/envs/geneformer/lib/python3.10/site-packages/geneformer/in_silico_perturber_stats.py:170,\
          \ in isp_stats_to_goal_state(cos_sims_df, dict_list, cell_states_to_model,\
          \ genes_perturbed)\r\n    167         random_tuples += dict_i.get((token,\
          \ \"cell_emb\"),[])\r\n    169 if alt_end_state_exists == False:\r\n-->\
          \ 170     goal_end_random_megalist = [goal_end for start_state,goal_end\
          \ in random_tuples]\r\n    171 elif alt_end_state_exists == True:\r\n  \
          \  172     goal_end_random_megalist = [goal_end for start_state,goal_end,alt_end\
          \ in random_tuples]\r\n\r\nFile /home/pc/miniconda3/envs/geneformer/lib/python3.10/site-packages/geneformer/in_silico_perturber_stats.py:170,\
          \ in <listcomp>(.0)\r\n    167         random_tuples += dict_i.get((token,\
          \ \"cell_emb\"),[])\r\n    169 if alt_end_state_exists == False:\r\n-->\
          \ 170     goal_end_random_megalist = [goal_end for start_state,goal_end\
          \ in random_tuples]\r\n    171 elif alt_end_state_exists == True:\r\n  \
          \  172     goal_end_random_megalist = [goal_end for start_state,goal_end,alt_end\
          \ in random_tuples]\r\n\r\nValueError: too many values to unpack (expected\
          \ 2)\r\n```\r\n\r\nWas it due to the issues with cell_class assignment?\
          \ I tried to remove the 'alt_states' and not working.   Thank you.\r\n"
        updatedAt: '2023-08-21T01:13:36.665Z'
      numEdits: 0
      reactions: []
    id: 64e2ba40618cd90997c395a3
    type: comment
  author: pchiang5
  content: "After suceessful runing of the following steps:\r\n```\r\nimport os\r\n\
    os.environ['TRANSFORMERS_CACHE'] = '/mnt/c/Users/pc/Downloads/cache/'\r\nfrom\
    \ geneformer import InSilicoPerturber\r\nfrom geneformer import InSilicoPerturberStats\r\
    \nisp = InSilicoPerturber(perturb_type=\"overexpress\",\r\n                  \
    \      perturb_rank_shift=None,\r\n                        genes_to_perturb=\"\
    all\",\r\n                        combos=0,\r\n                        anchor_gene=None,\r\
    \n                        model_type=\"CellClassifier\",\r\n                 \
    \       num_classes=29,\r\n                        emb_mode=\"cell\",\r\n    \
    \                    cell_emb_style=\"mean_pool\",\r\n                       \
    \ cell_states_to_model={'state_key': 'cell_type', 'start_state': 'A', 'goal_state':\
    \ 'B', 'alt_states': []},\r\n                        max_ncells=52775, \r\n  \
    \                      emb_layer=0,\r\n                        forward_batch_size=400,\r\
    \n                        nproc=44)\r\nisp.perturb_data(\"/mnt/c/Users/pc/Downloads/GF/230816_geneformer_CellClassifier_celltypes_L2048_B8_LR0.00028292192255361916_LSlinear_WU559.5193527108581_E10_Oadamw_F2\"\
    ,\r\n                 \"/mnt/c/Users/pc/Downloads/transformer.dataset\",\r\n \
    \                \"/mnt/c/Users/pc/Downloads/GF2\",\r\n                 \"full2\"\
    )\r\n#modify the file InSilicoPerturberStats in geneformer\r\n#GENE_NAME_ID_DICTIONARY_FILE\
    \ = \"/mnt/c/Users/pc/Downloads/Geneformer/Geneformer/gene_name_id_dict.pkl\"\r\
    \nispstats = InSilicoPerturberStats(mode=\"goal_state_shift\",\r\n           \
    \                       genes_perturbed=\"all\",\r\n                         \
    \         combos=0,\r\n                                  anchor_gene=None,\r\n\
    \                                  cell_states_to_model={'state_key': 'cell_type',\
    \ 'start_state': 'A', 'goal_state': 'B', 'alt_states': []})\r\n```\r\n\r\nAnother\
    \ error jumped out:\r\n```\r\nIn [15]: ispstats.get_stats(\"/mnt/c/Users/pc/Downloads\"\
    ,\r\n    ...:                    None,\r\n    ...:                    \"/mnt/c/Users/pc/Downloads/GF2\"\
    ,\r\n    ...:                    \"full\")\r\n  0%|          | 0/13 [00:00<?,\
    \ ?it/s]\r\n  0%|          | 0/15183 [00:00<?, ?it/s]\r\n---------------------------------------------------------------------------\r\
    \nValueError                                Traceback (most recent call last)\r\
    \nCell In[15], line 1\r\n----> 1 ispstats.get_stats(\"/mnt/c/Users/pc/Downloads\"\
    ,\r\n      2                    None,\r\n      3                    \"/mnt/c/Users/pc/Downloads/GF2\"\
    ,\r\n      4                    \"full\")\r\n\r\nFile /home/pc/miniconda3/envs/geneformer/lib/python3.10/site-packages/geneformer/in_silico_perturber_stats.py:696,\
    \ in InSilicoPerturberStats.get_stats(self, input_data_directory, null_dist_data_directory,\
    \ output_directory, output_prefix)\r\n    684 cos_sims_df_initial = pd.DataFrame({\"\
    Gene\": gene_list,\r\n    685                                     \"Gene_name\"\
    : [self.token_to_gene_name(item) \\\r\n    686                               \
    \                    for item in gene_list], \\\r\n   (...)\r\n    692       \
    \                                             for genes in gene_list]}, \\\r\n\
    \    693                                      index=[i for i in range(len(gene_list))])\r\
    \n    695 if self.mode == \"goal_state_shift\":\r\n--> 696     cos_sims_df = isp_stats_to_goal_state(cos_sims_df_initial,\
    \ dict_list, self.cell_states_to_model, self.genes_perturbed)\r\n    698 elif\
    \ self.mode == \"vs_null\":\r\n    699     null_dict_list = read_dictionaries(null_dist_data_directory,\
    \ \"cell\", self.anchor_token)\r\n\r\nFile /home/pc/miniconda3/envs/geneformer/lib/python3.10/site-packages/geneformer/in_silico_perturber_stats.py:170,\
    \ in isp_stats_to_goal_state(cos_sims_df, dict_list, cell_states_to_model, genes_perturbed)\r\
    \n    167         random_tuples += dict_i.get((token, \"cell_emb\"),[])\r\n  \
    \  169 if alt_end_state_exists == False:\r\n--> 170     goal_end_random_megalist\
    \ = [goal_end for start_state,goal_end in random_tuples]\r\n    171 elif alt_end_state_exists\
    \ == True:\r\n    172     goal_end_random_megalist = [goal_end for start_state,goal_end,alt_end\
    \ in random_tuples]\r\n\r\nFile /home/pc/miniconda3/envs/geneformer/lib/python3.10/site-packages/geneformer/in_silico_perturber_stats.py:170,\
    \ in <listcomp>(.0)\r\n    167         random_tuples += dict_i.get((token, \"\
    cell_emb\"),[])\r\n    169 if alt_end_state_exists == False:\r\n--> 170     goal_end_random_megalist\
    \ = [goal_end for start_state,goal_end in random_tuples]\r\n    171 elif alt_end_state_exists\
    \ == True:\r\n    172     goal_end_random_megalist = [goal_end for start_state,goal_end,alt_end\
    \ in random_tuples]\r\n\r\nValueError: too many values to unpack (expected 2)\r\
    \n```\r\n\r\nWas it due to the issues with cell_class assignment? I tried to remove\
    \ the 'alt_states' and not working.   Thank you.\r\n"
  created_at: 2023-08-21 00:13:36+00:00
  edited: false
  hidden: false
  id: 64e2ba40618cd90997c395a3
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/1092f31a9ffd1e9813369b91311f765a.svg
      fullname: PC
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: pchiang5
      type: user
    createdAt: '2023-08-21T01:25:39.000Z'
    data:
      edited: false
      editors:
      - pchiang5
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9148778319358826
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/1092f31a9ffd1e9813369b91311f765a.svg
          fullname: PC
          isHf: false
          isPro: false
          name: pchiang5
          type: user
        html: '<p>I found it was caused by the misplacement of the 3 <code>_raw.pickle</code>
          files in <code>/mnt/c/Users/pc/Downloads/</code> when I set the output directory
          as ''/mnt/c/Users/pc/Downloads/GF2'' at <code>isp.perturb_data</code>. The
          script started running after moving the 3 files to the correct folder and
          trimming the first 3 characters ''GF2''. </p>

          '
        raw: 'I found it was caused by the misplacement of the 3 `_raw.pickle` files
          in `/mnt/c/Users/pc/Downloads/` when I set the output directory as ''/mnt/c/Users/pc/Downloads/GF2''
          at `isp.perturb_data`. The script started running after moving the 3 files
          to the correct folder and trimming the first 3 characters ''GF2''. '
        updatedAt: '2023-08-21T01:25:39.642Z'
      numEdits: 0
      reactions: []
      relatedEventId: 64e2bd13315c08ea11c8b1b1
    id: 64e2bd13315c08ea11c8b1ab
    type: comment
  author: pchiang5
  content: 'I found it was caused by the misplacement of the 3 `_raw.pickle` files
    in `/mnt/c/Users/pc/Downloads/` when I set the output directory as ''/mnt/c/Users/pc/Downloads/GF2''
    at `isp.perturb_data`. The script started running after moving the 3 files to
    the correct folder and trimming the first 3 characters ''GF2''. '
  created_at: 2023-08-21 00:25:39+00:00
  edited: false
  hidden: false
  id: 64e2bd13315c08ea11c8b1ab
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/1092f31a9ffd1e9813369b91311f765a.svg
      fullname: PC
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: pchiang5
      type: user
    createdAt: '2023-08-21T01:25:39.000Z'
    data:
      status: closed
    id: 64e2bd13315c08ea11c8b1b1
    type: status-change
  author: pchiang5
  created_at: 2023-08-21 00:25:39+00:00
  id: 64e2bd13315c08ea11c8b1b1
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 226
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: 'ispstats.get_stats: too many values to unpack (expected 2)'
