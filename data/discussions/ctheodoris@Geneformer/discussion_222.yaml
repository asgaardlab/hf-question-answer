!!python/object:huggingface_hub.community.DiscussionWithDetails
author: swang12
conflicting_files: null
created_at: 2023-08-17 03:52:36+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/dfad9b282f034de3ccdaf7ab2b999559.svg
      fullname: Su Wang
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: swang12
      type: user
    createdAt: '2023-08-17T04:52:36.000Z'
    data:
      edited: false
      editors:
      - swang12
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.43107762932777405
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/dfad9b282f034de3ccdaf7ab2b999559.svg
          fullname: Su Wang
          isHf: false
          isPro: false
          name: swang12
          type: user
        html: "<p>Hi, I was running InSilicoPerturber for 5,000 cells using the pre-trained\
          \ model and got an unexpected IndexError: Dimension out of range (expected\
          \ to be in range of [-2, 1], but got 2). I didn't have this error when I\
          \ conducted exactly the same for 2,000 cells before. I'm pasting the code\
          \ and error message below:</p>\n<p>isp = InSilicoPerturber(perturb_type='delete',<br>\
          \                        perturb_rank_shift=None,<br>                  \
          \      genes_to_perturb='all',<br>                        combos=0,<br>\
          \                        anchor_gene=None,<br>                        model_type='Pretrained',<br>\
          \                        num_classes=0,<br>                        emb_mode='cell_and_gene',<br>\
          \                        cell_emb_style='mean_pool',<br>               \
          \         cell_states_to_model={'state_key': 'group', 'start_state': 'opc_gaba',\
          \ 'goal_state': 'other', 'alt_states': []},<br>                        max_ncells=5000,<br>\
          \                        emb_layer=-1,<br>                        forward_batch_size=32,<br>\
          \                        nproc=16<br>                        )</p>\n<p>isp.perturb_data(model_directory='Geneformer/',<br>\
          \                 input_data_file='tokenized_.dataset',<br>            \
          \     output_directory='./',<br>                 output_prefix='perturbed'<br>\
          \                 )</p>\n<p>ispstats = InSilicoPerturberStats(mode='goal_state_shift',<br>\
          \                                  combos=0,<br>                       \
          \           anchor_gene=None,<br>                                  cell_states_to_model={'state_key':\
          \ 'group', 'start_state': 'opc_gaba', 'goal_state': 'other', 'alt_states':\
          \ []}<br>                                  )</p>\n<p>ispstats.get_stats(input_data_directory='./',<br>\
          \                   null_dist_data_directory=None,<br>                 \
          \  output_directory='./',<br>                   output_prefix='stats_emb_mode_gene'<br>\
          \                   )</p>\n<p>Traceback (most recent call last):\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u258C                                     | 1333/1985\
          \ [00:00&lt;00:00, 6268.01 examples/s]<br>  File \"transformer.py\", line\
          \ 53, in <br>    isp.perturb_data(model_directory='Geneformer/',<br>  File\
          \ \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
          , line 975, in perturb_data<br>    self.in_silico_perturb(model,<br>  File\
          \ \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
          , line 1128, in in_silico_perturb<br>    cos_sims_data = quant_cos_sims(model,<br>\
          \  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
          , line 449, in quant_cos_sims<br>    cos_sims_vs_alt_dict[state] += cos_sim_shift(original_emb,<br>\
          \  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
          , line 507, in cos_sim_shift<br>    perturb_v_end = cos(perturb_emb, end_emb)<br>\
          \  File \"/home/swang12/.local/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1501, in _call_impl<br>    return forward_call(*args, **kwargs)<br>\
          \  File \"/home/swang12/.local/lib/python3.8/site-packages/torch/nn/modules/distance.py\"\
          , line 87, in forward<br>    return F.cosine_similarity(x1, x2, self.dim,\
          \ self.eps)<br>IndexError: Dimension out of range (expected to be in range\
          \ of [-2, 1], but got 2)</p>\n<p>I was wondering if you have any clue about\
          \ how I should resolve this. Thank you very much!</p>\n<p>Sincerely,<br>Su\
          \ Wang </p>\n"
        raw: "Hi, I was running InSilicoPerturber for 5,000 cells using the pre-trained\
          \ model and got an unexpected IndexError: Dimension out of range (expected\
          \ to be in range of [-2, 1], but got 2). I didn't have this error when I\
          \ conducted exactly the same for 2,000 cells before. I'm pasting the code\
          \ and error message below:\r\n\r\nisp = InSilicoPerturber(perturb_type='delete',\
          \ \r\n                        perturb_rank_shift=None, \r\n            \
          \            genes_to_perturb='all', \r\n                        combos=0,\
          \ \r\n                        anchor_gene=None, \r\n                   \
          \     model_type='Pretrained', \r\n                        num_classes=0,\
          \ \r\n                        emb_mode='cell_and_gene', \r\n           \
          \             cell_emb_style='mean_pool', \r\n                        cell_states_to_model={'state_key':\
          \ 'group', 'start_state': 'opc_gaba', 'goal_state': 'other', 'alt_states':\
          \ []}, \r\n                        max_ncells=5000, \r\n               \
          \         emb_layer=-1, \r\n                        forward_batch_size=32,\
          \ \r\n                        nproc=16\r\n                        )\r\n\r\
          \nisp.perturb_data(model_directory='Geneformer/', \r\n                 input_data_file='tokenized_.dataset',\
          \ \r\n                 output_directory='./', \r\n                 output_prefix='perturbed'\r\
          \n                 )\r\n\r\nispstats = InSilicoPerturberStats(mode='goal_state_shift',\
          \ \r\n                                  combos=0, \r\n                 \
          \                 anchor_gene=None, \r\n                               \
          \   cell_states_to_model={'state_key': 'group', 'start_state': 'opc_gaba',\
          \ 'goal_state': 'other', 'alt_states': []}\r\n                         \
          \         )\r\n\r\nispstats.get_stats(input_data_directory='./',\r\n   \
          \                null_dist_data_directory=None,\r\n                   output_directory='./',\r\
          \n                   output_prefix='stats_emb_mode_gene'\r\n           \
          \        )\r\n\r\nTraceback (most recent call last):\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
          \u2588\u2588\u258C                                     | 1333/1985 [00:00<00:00,\
          \ 6268.01 examples/s]\r\n  File \"transformer.py\", line 53, in <module>\r\
          \n    isp.perturb_data(model_directory='Geneformer/', \r\n  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
          , line 975, in perturb_data\r\n    self.in_silico_perturb(model,\r\n  File\
          \ \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
          , line 1128, in in_silico_perturb\r\n    cos_sims_data = quant_cos_sims(model,\r\
          \n  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
          , line 449, in quant_cos_sims\r\n    cos_sims_vs_alt_dict[state] += cos_sim_shift(original_emb,\
          \ \r\n  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
          , line 507, in cos_sim_shift\r\n    perturb_v_end = cos(perturb_emb, end_emb)\r\
          \n  File \"/home/swang12/.local/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
          , line 1501, in _call_impl\r\n    return forward_call(*args, **kwargs)\r\
          \n  File \"/home/swang12/.local/lib/python3.8/site-packages/torch/nn/modules/distance.py\"\
          , line 87, in forward\r\n    return F.cosine_similarity(x1, x2, self.dim,\
          \ self.eps)\r\nIndexError: Dimension out of range (expected to be in range\
          \ of [-2, 1], but got 2)\r\n\r\nI was wondering if you have any clue about\
          \ how I should resolve this. Thank you very much!\r\n\r\nSincerely,\r\n\
          Su Wang "
        updatedAt: '2023-08-17T04:52:36.064Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\u2764\uFE0F"
        users:
        - xj2087
    id: 64dda7944996061b56ee72f1
    type: comment
  author: swang12
  content: "Hi, I was running InSilicoPerturber for 5,000 cells using the pre-trained\
    \ model and got an unexpected IndexError: Dimension out of range (expected to\
    \ be in range of [-2, 1], but got 2). I didn't have this error when I conducted\
    \ exactly the same for 2,000 cells before. I'm pasting the code and error message\
    \ below:\r\n\r\nisp = InSilicoPerturber(perturb_type='delete', \r\n          \
    \              perturb_rank_shift=None, \r\n                        genes_to_perturb='all',\
    \ \r\n                        combos=0, \r\n                        anchor_gene=None,\
    \ \r\n                        model_type='Pretrained', \r\n                  \
    \      num_classes=0, \r\n                        emb_mode='cell_and_gene', \r\
    \n                        cell_emb_style='mean_pool', \r\n                   \
    \     cell_states_to_model={'state_key': 'group', 'start_state': 'opc_gaba', 'goal_state':\
    \ 'other', 'alt_states': []}, \r\n                        max_ncells=5000, \r\n\
    \                        emb_layer=-1, \r\n                        forward_batch_size=32,\
    \ \r\n                        nproc=16\r\n                        )\r\n\r\nisp.perturb_data(model_directory='Geneformer/',\
    \ \r\n                 input_data_file='tokenized_.dataset', \r\n            \
    \     output_directory='./', \r\n                 output_prefix='perturbed'\r\n\
    \                 )\r\n\r\nispstats = InSilicoPerturberStats(mode='goal_state_shift',\
    \ \r\n                                  combos=0, \r\n                       \
    \           anchor_gene=None, \r\n                                  cell_states_to_model={'state_key':\
    \ 'group', 'start_state': 'opc_gaba', 'goal_state': 'other', 'alt_states': []}\r\
    \n                                  )\r\n\r\nispstats.get_stats(input_data_directory='./',\r\
    \n                   null_dist_data_directory=None,\r\n                   output_directory='./',\r\
    \n                   output_prefix='stats_emb_mode_gene'\r\n                 \
    \  )\r\n\r\nTraceback (most recent call last):\u2588\u2588\u2588\u2588\u2588\u2588\
    \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
    \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
    \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
    \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\
    \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C                       \
    \              | 1333/1985 [00:00<00:00, 6268.01 examples/s]\r\n  File \"transformer.py\"\
    , line 53, in <module>\r\n    isp.perturb_data(model_directory='Geneformer/',\
    \ \r\n  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
    , line 975, in perturb_data\r\n    self.in_silico_perturb(model,\r\n  File \"\
    /home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
    , line 1128, in in_silico_perturb\r\n    cos_sims_data = quant_cos_sims(model,\r\
    \n  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
    , line 449, in quant_cos_sims\r\n    cos_sims_vs_alt_dict[state] += cos_sim_shift(original_emb,\
    \ \r\n  File \"/home/swang12/.local/lib/python3.8/site-packages/geneformer/in_silico_perturber.py\"\
    , line 507, in cos_sim_shift\r\n    perturb_v_end = cos(perturb_emb, end_emb)\r\
    \n  File \"/home/swang12/.local/lib/python3.8/site-packages/torch/nn/modules/module.py\"\
    , line 1501, in _call_impl\r\n    return forward_call(*args, **kwargs)\r\n  File\
    \ \"/home/swang12/.local/lib/python3.8/site-packages/torch/nn/modules/distance.py\"\
    , line 87, in forward\r\n    return F.cosine_similarity(x1, x2, self.dim, self.eps)\r\
    \nIndexError: Dimension out of range (expected to be in range of [-2, 1], but\
    \ got 2)\r\n\r\nI was wondering if you have any clue about how I should resolve\
    \ this. Thank you very much!\r\n\r\nSincerely,\r\nSu Wang "
  created_at: 2023-08-17 03:52:36+00:00
  edited: false
  hidden: false
  id: 64dda7944996061b56ee72f1
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/2e19b0efd2e371d62a492c416f5d9ca1.svg
      fullname: Matthew Pace
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: Pingiotto
      type: user
    createdAt: '2023-08-21T15:46:13.000Z'
    data:
      edited: true
      editors: []
      hidden: true
      hiddenBy: ''
      latest:
        author:
          avatarUrl: /avatars/2e19b0efd2e371d62a492c416f5d9ca1.svg
          fullname: Matthew Pace
          isHf: false
          isPro: false
          name: Pingiotto
          type: user
        html: This comment has been hidden
        raw: This comment has been hidden
        updatedAt: '2023-08-21T15:48:37.730Z'
      numEdits: 0
      reactions: []
    id: 64e386c5f8d8389c1aa0f8c1
    type: comment
  author: Pingiotto
  content: This comment has been hidden
  created_at: 2023-08-21 14:46:13+00:00
  edited: true
  hidden: true
  id: 64e386c5f8d8389c1aa0f8c1
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/0294c70283e9d16d716264375133a5e6.svg
      fullname: Cai
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: SeRing
      type: user
    createdAt: '2023-11-02T06:40:02.000Z'
    data:
      edited: false
      editors:
      - SeRing
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9425191283226013
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/0294c70283e9d16d716264375133a5e6.svg
          fullname: Cai
          isHf: false
          isPro: false
          name: SeRing
          type: user
        html: '<p>i have the same problem.have you already resolve this problem?<br>looking
          forward to you reply.</p>

          '
        raw: 'i have the same problem.have you already resolve this problem?

          looking forward to you reply.'
        updatedAt: '2023-11-02T06:40:02.971Z'
      numEdits: 0
      reactions: []
    id: 65434442aeb460fccce0fb07
    type: comment
  author: SeRing
  content: 'i have the same problem.have you already resolve this problem?

    looking forward to you reply.'
  created_at: 2023-11-02 05:40:02+00:00
  edited: false
  hidden: false
  id: 65434442aeb460fccce0fb07
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-12-15T08:59:16.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9056812524795532
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your interest in Geneformer and for your patience!
          We pushed an update that should resolve this issue. If you continue to face
          errors after pulling the updated code, please let us know by either reopening
          this discussion if it''s the same error or opening a new discussion if it''s
          a new error. Thank you!</p>

          '
        raw: Thank you for your interest in Geneformer and for your patience! We pushed
          an update that should resolve this issue. If you continue to face errors
          after pulling the updated code, please let us know by either reopening this
          discussion if it's the same error or opening a new discussion if it's a
          new error. Thank you!
        updatedAt: '2023-12-15T08:59:16.812Z'
      numEdits: 0
      reactions: []
      relatedEventId: 657c1564eda715a4be54c835
    id: 657c1564eda715a4be54c832
    type: comment
  author: ctheodoris
  content: Thank you for your interest in Geneformer and for your patience! We pushed
    an update that should resolve this issue. If you continue to face errors after
    pulling the updated code, please let us know by either reopening this discussion
    if it's the same error or opening a new discussion if it's a new error. Thank
    you!
  created_at: 2023-12-15 08:59:16+00:00
  edited: false
  hidden: false
  id: 657c1564eda715a4be54c832
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-12-15T08:59:16.000Z'
    data:
      status: closed
    id: 657c1564eda715a4be54c835
    type: status-change
  author: ctheodoris
  created_at: 2023-12-15 08:59:16+00:00
  id: 657c1564eda715a4be54c835
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 222
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: 'InSilicoPerturber IndexError: Dimension out of range'
