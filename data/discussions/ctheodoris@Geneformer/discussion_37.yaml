!!python/object:huggingface_hub.community.DiscussionWithDetails
author: abayegan
conflicting_files: null
created_at: 2023-06-15 16:44:30+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/4447541e01b9f8594991e40972ba08ac.svg
      fullname: Amir Bayegan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: abayegan
      type: user
    createdAt: '2023-06-15T17:44:30.000Z'
    data:
      edited: false
      editors:
      - abayegan
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9226043224334717
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/4447541e01b9f8594991e40972ba08ac.svg
          fullname: Amir Bayegan
          isHf: false
          isPro: false
          name: abayegan
          type: user
        html: '<p>Hi,<br>Given a Anndata object as input, how can I run it through
          you pre-trained model and get cell and gene embeddings?<br>I tried figuring
          it out from the notebooks but getting errors in loading your example dataset
          and the model. Maybe I will post those separately.<br>Thanks!</p>

          '
        raw: "Hi,\r\nGiven a Anndata object as input, how can I run it through you\
          \ pre-trained model and get cell and gene embeddings? \r\nI tried figuring\
          \ it out from the notebooks but getting errors in loading your example dataset\
          \ and the model. Maybe I will post those separately. \r\nThanks!"
        updatedAt: '2023-06-15T17:44:30.573Z'
      numEdits: 0
      reactions: []
    id: 648b4dfe412f81cc0c1b363a
    type: comment
  author: abayegan
  content: "Hi,\r\nGiven a Anndata object as input, how can I run it through you pre-trained\
    \ model and get cell and gene embeddings? \r\nI tried figuring it out from the\
    \ notebooks but getting errors in loading your example dataset and the model.\
    \ Maybe I will post those separately. \r\nThanks!"
  created_at: 2023-06-15 16:44:30+00:00
  edited: false
  hidden: false
  id: 648b4dfe412f81cc0c1b363a
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-06-15T19:18:26.000Z'
    data:
      edited: true
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8270500898361206
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: "<p>Thank you for your interest in Geneformer. Please see the following\
          \ two closed issues:</p>\n<p>Regarding using Anndata: <a href=\"https://huggingface.co/ctheodoris/Geneformer/discussions/4\"\
          >https://huggingface.co/ctheodoris/Geneformer/discussions/4</a><br>Regarding\
          \ how to obtain embeddings: <a href=\"https://huggingface.co/ctheodoris/Geneformer/discussions/27\"\
          >https://huggingface.co/ctheodoris/Geneformer/discussions/27</a></p>\n<p>Update:<br><span\
          \ data-props=\"{&quot;user&quot;:&quot;abayegan&quot;}\" data-target=\"\
          UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\">\n\n<span class=\"\
          inline-block\"><span class=\"contents\"><a href=\"/abayegan\">@<span class=\"\
          underline\">abayegan</span></a></span>\n\n\t</span></span><br>We have now\
          \ added a function to extract and plot cell embeddings. Please see example\
          \ here:<br><a href=\"https://huggingface.co/ctheodoris/Geneformer/blob/main/examples/extract_and_plot_cell_embeddings.ipynb\"\
          >https://huggingface.co/ctheodoris/Geneformer/blob/main/examples/extract_and_plot_cell_embeddings.ipynb</a></p>\n"
        raw: "Thank you for your interest in Geneformer. Please see the following\
          \ two closed issues:\n\nRegarding using Anndata: https://huggingface.co/ctheodoris/Geneformer/discussions/4\n\
          Regarding how to obtain embeddings: https://huggingface.co/ctheodoris/Geneformer/discussions/27\n\
          \nUpdate: \n@abayegan \nWe have now added a function to extract and plot\
          \ cell embeddings. Please see example here:\nhttps://huggingface.co/ctheodoris/Geneformer/blob/main/examples/extract_and_plot_cell_embeddings.ipynb"
        updatedAt: '2023-07-28T07:11:04.589Z'
      numEdits: 1
      reactions: []
      relatedEventId: 648b6402df4710674c63d8bf
    id: 648b6402df4710674c63d8b7
    type: comment
  author: ctheodoris
  content: "Thank you for your interest in Geneformer. Please see the following two\
    \ closed issues:\n\nRegarding using Anndata: https://huggingface.co/ctheodoris/Geneformer/discussions/4\n\
    Regarding how to obtain embeddings: https://huggingface.co/ctheodoris/Geneformer/discussions/27\n\
    \nUpdate: \n@abayegan \nWe have now added a function to extract and plot cell\
    \ embeddings. Please see example here:\nhttps://huggingface.co/ctheodoris/Geneformer/blob/main/examples/extract_and_plot_cell_embeddings.ipynb"
  created_at: 2023-06-15 18:18:26+00:00
  edited: true
  hidden: false
  id: 648b6402df4710674c63d8b7
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-06-15T19:18:26.000Z'
    data:
      status: closed
    id: 648b6402df4710674c63d8bf
    type: status-change
  author: ctheodoris
  created_at: 2023-06-15 18:18:26+00:00
  id: 648b6402df4710674c63d8bf
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/4447541e01b9f8594991e40972ba08ac.svg
      fullname: Amir Bayegan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: abayegan
      type: user
    createdAt: '2023-06-21T15:36:07.000Z'
    data:
      edited: false
      editors:
      - abayegan
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9322208166122437
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/4447541e01b9f8594991e40972ba08ac.svg
          fullname: Amir Bayegan
          isHf: false
          isPro: false
          name: abayegan
          type: user
        html: '<p>Thanks very much for the links. I have two follow-up questions regarding
          the gene embeddings:</p>

          <ol>

          <li>In the paper, it is mentioned that you have obtained the second to last
          layer for the gene embeddings which contains 2048 tokens. I assume this
          list of 2048 tokens is different for each single cell and I would like to
          obtain the list of genes and their weights for each cell. Would it be right
          to use the geneformer.tokenizer object to map these tokens to Ensembl ids
          for each cell or am I missing sth? </li>

          <li>Have you compared the weights from model.bert.embeddings.word_embeddings.weight?
          This give a weight to every single gene instead of only 2048. Have you tried
          this for building the cell embeddings?</li>

          </ol>

          '
        raw: "Thanks very much for the links. I have two follow-up questions regarding\
          \ the gene embeddings:\n1) In the paper, it is mentioned that you have obtained\
          \ the second to last layer for the gene embeddings which contains 2048 tokens.\
          \ I assume this list of 2048 tokens is different for each single cell and\
          \ I would like to obtain the list of genes and their weights for each cell.\
          \ Would it be right to use the geneformer.tokenizer object to map these\
          \ tokens to Ensembl ids for each cell or am I missing sth? \n2) Have you\
          \ compared the weights from model.bert.embeddings.word_embeddings.weight?\
          \ This give a weight to every single gene instead of only 2048. Have you\
          \ tried this for building the cell embeddings? "
        updatedAt: '2023-06-21T15:36:07.681Z'
      numEdits: 0
      reactions: []
    id: 649318e740e33f30965d1a4b
    type: comment
  author: abayegan
  content: "Thanks very much for the links. I have two follow-up questions regarding\
    \ the gene embeddings:\n1) In the paper, it is mentioned that you have obtained\
    \ the second to last layer for the gene embeddings which contains 2048 tokens.\
    \ I assume this list of 2048 tokens is different for each single cell and I would\
    \ like to obtain the list of genes and their weights for each cell. Would it be\
    \ right to use the geneformer.tokenizer object to map these tokens to Ensembl\
    \ ids for each cell or am I missing sth? \n2) Have you compared the weights from\
    \ model.bert.embeddings.word_embeddings.weight? This give a weight to every single\
    \ gene instead of only 2048. Have you tried this for building the cell embeddings? "
  created_at: 2023-06-21 14:36:07+00:00
  edited: false
  hidden: false
  id: 649318e740e33f30965d1a4b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-06-21T17:18:11.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8985248804092407
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your question. Please see the manuscript Methods sections
          "Gene Embeddings" and "Cell Embeddings" to understand these methods. </p>

          <p>Briefly, gene embeddings are 256 dimensions for each gene, so a cell
          with 2048 genes would have gene embeddings output of 2048x256 (or a cell
          with 2030 genes would have gene embeddings output of 2030x256). If a different
          cell has different genes, it will have a different set of embeddings - the
          embeddings are unique to each gene in each context (they are context-aware
          embeddings). Gene embeddings are analogous to word embeddings in NLP. Cell
          embeddings are a composite of the gene embeddings in that cell, so for 1
          cell, the initial 2048x256 will be averaged across the gene dimension to
          become the shape 1x256. Cell embeddings are analogous to sentence embeddings
          in NLP.</p>

          '
        raw: "Thank you for your question. Please see the manuscript Methods sections\
          \ \"Gene Embeddings\" and \"Cell Embeddings\" to understand these methods.\
          \ \n\nBriefly, gene embeddings are 256 dimensions for each gene, so a cell\
          \ with 2048 genes would have gene embeddings output of 2048x256 (or a cell\
          \ with 2030 genes would have gene embeddings output of 2030x256). If a different\
          \ cell has different genes, it will have a different set of embeddings -\
          \ the embeddings are unique to each gene in each context (they are context-aware\
          \ embeddings). Gene embeddings are analogous to word embeddings in NLP.\
          \ Cell embeddings are a composite of the gene embeddings in that cell, so\
          \ for 1 cell, the initial 2048x256 will be averaged across the gene dimension\
          \ to become the shape 1x256. Cell embeddings are analogous to sentence embeddings\
          \ in NLP."
        updatedAt: '2023-06-21T17:18:11.675Z'
      numEdits: 0
      reactions: []
    id: 649330d3aba55bb7d1d9d6df
    type: comment
  author: ctheodoris
  content: "Thank you for your question. Please see the manuscript Methods sections\
    \ \"Gene Embeddings\" and \"Cell Embeddings\" to understand these methods. \n\n\
    Briefly, gene embeddings are 256 dimensions for each gene, so a cell with 2048\
    \ genes would have gene embeddings output of 2048x256 (or a cell with 2030 genes\
    \ would have gene embeddings output of 2030x256). If a different cell has different\
    \ genes, it will have a different set of embeddings - the embeddings are unique\
    \ to each gene in each context (they are context-aware embeddings). Gene embeddings\
    \ are analogous to word embeddings in NLP. Cell embeddings are a composite of\
    \ the gene embeddings in that cell, so for 1 cell, the initial 2048x256 will be\
    \ averaged across the gene dimension to become the shape 1x256. Cell embeddings\
    \ are analogous to sentence embeddings in NLP."
  created_at: 2023-06-21 16:18:11+00:00
  edited: false
  hidden: false
  id: 649330d3aba55bb7d1d9d6df
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/58015c33c4c76a3882ea428ae3c3d399.svg
      fullname: Yuxuan Du
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: DYXDAVE
      type: user
    createdAt: '2023-07-19T06:01:54.000Z'
    data:
      edited: false
      editors:
      - DYXDAVE
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9003965854644775
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/58015c33c4c76a3882ea428ae3c3d399.svg
          fullname: Yuxuan Du
          isHf: false
          isPro: false
          name: DYXDAVE
          type: user
        html: '<p>Thank you for your model!<br>I''m currently trying to analyze the
          cell embedding and I''m not sure I understand the extraction of cell embedding
          correctly.<br>The last layer I got from the pre-trained model should be
          a batch_size x 2048 x 256 matrix, right? So I need to average across gene
          dimension to get a matrix of batch_size x 256. I''m wondering do the dimension
          of gene still represent the input length? Since in the input if a cell got
          less gene than 2048, there will be padding filled into the input. </p>

          <p>In other words, do we add numbers in the gene dimension and divide by
          2048 or we should add numbers in the gene dimension and divide by the number
          of gene that cell actually has(for example, maybe we only detect 2000 genes
          in that cell and we should divide the result by 2000)</p>

          '
        raw: "Thank you for your model!\nI'm currently trying to analyze the cell\
          \ embedding and I'm not sure I understand the extraction of cell embedding\
          \ correctly. \nThe last layer I got from the pre-trained model should be\
          \ a batch_size x 2048 x 256 matrix, right? So I need to average across gene\
          \ dimension to get a matrix of batch_size x 256. I'm wondering do the dimension\
          \ of gene still represent the input length? Since in the input if a cell\
          \ got less gene than 2048, there will be padding filled into the input.\
          \ \n\nIn other words, do we add numbers in the gene dimension and divide\
          \ by 2048 or we should add numbers in the gene dimension and divide by the\
          \ number of gene that cell actually has(for example, maybe we only detect\
          \ 2000 genes in that cell and we should divide the result by 2000)\n"
        updatedAt: '2023-07-19T06:01:54.533Z'
      numEdits: 0
      reactions: []
    id: 64b77c528ba7d6c922d044fc
    type: comment
  author: DYXDAVE
  content: "Thank you for your model!\nI'm currently trying to analyze the cell embedding\
    \ and I'm not sure I understand the extraction of cell embedding correctly. \n\
    The last layer I got from the pre-trained model should be a batch_size x 2048\
    \ x 256 matrix, right? So I need to average across gene dimension to get a matrix\
    \ of batch_size x 256. I'm wondering do the dimension of gene still represent\
    \ the input length? Since in the input if a cell got less gene than 2048, there\
    \ will be padding filled into the input. \n\nIn other words, do we add numbers\
    \ in the gene dimension and divide by 2048 or we should add numbers in the gene\
    \ dimension and divide by the number of gene that cell actually has(for example,\
    \ maybe we only detect 2000 genes in that cell and we should divide the result\
    \ by 2000)\n"
  created_at: 2023-07-19 05:01:54+00:00
  edited: false
  hidden: false
  id: 64b77c528ba7d6c922d044fc
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-07-28T07:10:08.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9233158826828003
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your question. Yes, you can remove the padding prior
          to averaging the embedding. Please see the update in the initial response
          above as we have now added a function to extract and plot cell embeddings.</p>

          '
        raw: Thank you for your question. Yes, you can remove the padding prior to
          averaging the embedding. Please see the update in the initial response above
          as we have now added a function to extract and plot cell embeddings.
        updatedAt: '2023-07-28T07:10:08.194Z'
      numEdits: 0
      reactions: []
    id: 64c369d096b84732a32d0015
    type: comment
  author: ctheodoris
  content: Thank you for your question. Yes, you can remove the padding prior to averaging
    the embedding. Please see the update in the initial response above as we have
    now added a function to extract and plot cell embeddings.
  created_at: 2023-07-28 06:10:08+00:00
  edited: false
  hidden: false
  id: 64c369d096b84732a32d0015
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 37
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: Getting cell and gene embeddings
