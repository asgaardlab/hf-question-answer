!!python/object:huggingface_hub.community.DiscussionWithDetails
author: rkjaros
conflicting_files: null
created_at: 2023-07-18 02:06:59+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/dfa03e3406308485d93c5e7812945a3b.svg
      fullname: Rachel Jaros
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: rkjaros
      type: user
    createdAt: '2023-07-18T03:06:59.000Z'
    data:
      edited: false
      editors:
      - rkjaros
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5686888098716736
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/dfa03e3406308485d93c5e7812945a3b.svg
          fullname: Rachel Jaros
          isHf: false
          isPro: false
          name: rkjaros
          type: user
        html: '<p>Hello, thanks for your fantastic work. I am having trouble testing
          the In Silico Perturber. I am trying to perturb one gene to test our system.
          Here is my input and error message. It appears the model is not loading
          properly? </p>

          <p>isp = InSilicoPerturber(perturb_type = "delete",<br>                        perturb_rank_shift
          = None,<br>                        genes_to_perturb = ["ENSG00000127616"],<br>                        combos
          = 0,<br>                        anchor_gene = None,<br>                        model_type
          = "Pretrained",<br>                        num_classes = 0,<br>                        emb_mode
          = "cell_and_gene",<br>                        cell_emb_style = "mean_pool",<br>                        filter_data
          = None,<br>                        cell_states_to_model = None,<br>                        max_ncells
          = 2000,<br>                        emb_layer = -1,<br>                        forward_batch_size
          = 14,<br>                        nproc = 2,<br>                        save_raw_data
          = False)</p>

          <p>isp.perturb_data("/nesi/project/uoa03894/Geneformer/geneformer_30M_test",<br>                 "/nesi/nobackup/uoa03894/geneformer.dataset",<br>                 "/nesi/project/uoa03894/Geneformer/examples/test_in_silico",<br>                 "smarca_test")</p>

          <p><a rel="nofollow" href="https://cdn-uploads.huggingface.co/production/uploads/64b5ffeefa1a3eb025d4c689/CmIe2wRpQLvbKJmt90O0g.png"><img
          alt="image.png" src="https://cdn-uploads.huggingface.co/production/uploads/64b5ffeefa1a3eb025d4c689/CmIe2wRpQLvbKJmt90O0g.png"></a></p>

          <p>Thanks for your help! </p>

          '
        raw: "Hello, thanks for your fantastic work. I am having trouble testing the\
          \ In Silico Perturber. I am trying to perturb one gene to test our system.\
          \ Here is my input and error message. It appears the model is not loading\
          \ properly? \r\n\r\nisp = InSilicoPerturber(perturb_type = \"delete\",\r\
          \n                        perturb_rank_shift = None,\r\n               \
          \         genes_to_perturb = [\"ENSG00000127616\"], \r\n               \
          \         combos = 0,\r\n                        anchor_gene = None,\r\n\
          \                        model_type = \"Pretrained\",\r\n              \
          \          num_classes = 0,\r\n                        emb_mode = \"cell_and_gene\"\
          ,\r\n                        cell_emb_style = \"mean_pool\",\r\n       \
          \                 filter_data = None,\r\n                        cell_states_to_model\
          \ = None,\r\n                        max_ncells = 2000,\r\n            \
          \            emb_layer = -1,\r\n                        forward_batch_size\
          \ = 14,\r\n                        nproc = 2,\r\n                      \
          \  save_raw_data = False)\r\n\r\nisp.perturb_data(\"/nesi/project/uoa03894/Geneformer/geneformer_30M_test\"\
          ,\r\n                 \"/nesi/nobackup/uoa03894/geneformer.dataset\",\r\n\
          \                 \"/nesi/project/uoa03894/Geneformer/examples/test_in_silico\"\
          ,\r\n                 \"smarca_test\")\r\n\r\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/64b5ffeefa1a3eb025d4c689/CmIe2wRpQLvbKJmt90O0g.png)\r\
          \n\r\nThanks for your help! "
        updatedAt: '2023-07-18T03:06:59.291Z'
      numEdits: 0
      reactions: []
    id: 64b601d3600d7e872f457615
    type: comment
  author: rkjaros
  content: "Hello, thanks for your fantastic work. I am having trouble testing the\
    \ In Silico Perturber. I am trying to perturb one gene to test our system. Here\
    \ is my input and error message. It appears the model is not loading properly?\
    \ \r\n\r\nisp = InSilicoPerturber(perturb_type = \"delete\",\r\n             \
    \           perturb_rank_shift = None,\r\n                        genes_to_perturb\
    \ = [\"ENSG00000127616\"], \r\n                        combos = 0,\r\n       \
    \                 anchor_gene = None,\r\n                        model_type =\
    \ \"Pretrained\",\r\n                        num_classes = 0,\r\n            \
    \            emb_mode = \"cell_and_gene\",\r\n                        cell_emb_style\
    \ = \"mean_pool\",\r\n                        filter_data = None,\r\n        \
    \                cell_states_to_model = None,\r\n                        max_ncells\
    \ = 2000,\r\n                        emb_layer = -1,\r\n                     \
    \   forward_batch_size = 14,\r\n                        nproc = 2,\r\n       \
    \                 save_raw_data = False)\r\n\r\nisp.perturb_data(\"/nesi/project/uoa03894/Geneformer/geneformer_30M_test\"\
    ,\r\n                 \"/nesi/nobackup/uoa03894/geneformer.dataset\",\r\n    \
    \             \"/nesi/project/uoa03894/Geneformer/examples/test_in_silico\",\r\
    \n                 \"smarca_test\")\r\n\r\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/64b5ffeefa1a3eb025d4c689/CmIe2wRpQLvbKJmt90O0g.png)\r\
    \n\r\nThanks for your help! "
  created_at: 2023-07-18 02:06:59+00:00
  edited: false
  hidden: false
  id: 64b601d3600d7e872f457615
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/dfa03e3406308485d93c5e7812945a3b.svg
      fullname: Rachel Jaros
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: rkjaros
      type: user
    createdAt: '2023-07-18T03:14:19.000Z'
    data:
      edited: true
      editors:
      - rkjaros
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.5657690763473511
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/dfa03e3406308485d93c5e7812945a3b.svg
          fullname: Rachel Jaros
          isHf: false
          isPro: false
          name: rkjaros
          type: user
        html: '<p>I should probably add more to this. The _raw.pickle output files
          are created but not found when I run <code>ispstats.get_stats</code>. Even
          though the file path is correct and the _raw.pickle files are indeed there.
          I''m wondering if there was an error at the <code>isp.perturb_data</code>
          step. Any help is really appreciated. Thanks very much. </p>

          <p>ispstats = InSilicoPerturberStats(mode="vs_null",<br>                                  #genes_perturbed="all",<br>                                  combos=0,<br>                                  anchor_gene=None,<br>                                  cell_states_to_model=None)</p>

          <p>ispstats.get_stats("/nesi/project/uoa03894/Geneformer/examples/test_in_silico",<br>                   None,<br>                   "/nesi/project/uoa03894/Geneformer/examples/test_in_silico/output",<br>                   "smarca_test_stats")</p>

          <p><a rel="nofollow" href="https://cdn-uploads.huggingface.co/production/uploads/64b5ffeefa1a3eb025d4c689/Ru6FmMTXSKair2laV8lcn.png"><img
          alt="image.png" src="https://cdn-uploads.huggingface.co/production/uploads/64b5ffeefa1a3eb025d4c689/Ru6FmMTXSKair2laV8lcn.png"></a></p>

          <h2 id="no-raw-data-for-processing-found-within-provided-directory-please-ensure-data-files-end-with-_rawpickle">No
          raw data for processing found within provided directory. Please ensure data
          files end with ''_raw.pickle''.</h2>

          <p>RuntimeError                              Traceback (most recent call
          last)<br>Cell In[6], line 2<br>      1 # extracts data from intermediate
          files and processes stats to output in final .csv<br>----&gt; 2 ispstats.get_stats("/nesi/project/uoa03894/Geneformer/examples/test_in_silico",<br>      3                    None,<br>      4                    "/nesi/project/uoa03894/Geneformer/examples/test_in_silico/output",<br>      5                    "smarca_test_stats")</p>

          <p>File /scale_wlg_persistent/filesets/project/uoa03894/geneformer_pytorch2.1_cenv/lib/python3.11/site-packages/geneformer/in_silico_perturber_stats.py:537,
          in InSilicoPerturberStats.get_stats(self, input_data_directory, null_dist_data_directory,
          output_directory, output_prefix)<br>    534     cos_sims_df = isp_stats_to_goal_state(cos_sims_df_initial,
          dict_list, self.cell_states_to_model)<br>    536 elif self.mode == "vs_null":<br>--&gt;
          537     null_dict_list = read_dictionaries(null_dist_data_directory, "cell",
          self.anchor_token)<br>    538     cos_sims_df = isp_stats_vs_null(cos_sims_df_initial,
          dict_list, null_dict_list)<br>    540 elif self.mode == "mixture_model":</p>

          <p>File /scale_wlg_persistent/filesets/project/uoa03894/geneformer_pytorch2.1_cenv/lib/python3.11/site-packages/geneformer/in_silico_perturber_stats.py:64,
          in read_dictionaries(dir, cell_or_gene_emb, anchor_token)<br>     60 if
          file_found == 0:<br>     61     logger.error(<br>     62                 "No
          raw data for processing found within provided directory. " <br>     63                 "Please
          ensure data files end with ''_raw.pickle''.")<br>---&gt; 64     raise<br>     65
          return dict_list</p>

          <p>RuntimeError: No active exception to reraise</p>

          '
        raw: "I should probably add more to this. The _raw.pickle output files are\
          \ created but not found when I run `ispstats.get_stats`. Even though the\
          \ file path is correct and the _raw.pickle files are indeed there. I'm wondering\
          \ if there was an error at the `isp.perturb_data` step. Any help is really\
          \ appreciated. Thanks very much. \n\nispstats = InSilicoPerturberStats(mode=\"\
          vs_null\",\n                                  #genes_perturbed=\"all\",\n\
          \                                  combos=0,\n                         \
          \         anchor_gene=None,\n                                  cell_states_to_model=None)\n\
          \ \nispstats.get_stats(\"/nesi/project/uoa03894/Geneformer/examples/test_in_silico\"\
          ,\n                   None,\n                   \"/nesi/project/uoa03894/Geneformer/examples/test_in_silico/output\"\
          ,\n                   \"smarca_test_stats\")\n\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/64b5ffeefa1a3eb025d4c689/Ru6FmMTXSKair2laV8lcn.png)\n\
          \nNo raw data for processing found within provided directory. Please ensure\
          \ data files end with '_raw.pickle'.\n---------------------------------------------------------------------------\n\
          RuntimeError                              Traceback (most recent call last)\n\
          Cell In[6], line 2\n      1 # extracts data from intermediate files and\
          \ processes stats to output in final .csv\n----> 2 ispstats.get_stats(\"\
          /nesi/project/uoa03894/Geneformer/examples/test_in_silico\",\n      3  \
          \                  None,\n      4                    \"/nesi/project/uoa03894/Geneformer/examples/test_in_silico/output\"\
          ,\n      5                    \"smarca_test_stats\")\n\nFile /scale_wlg_persistent/filesets/project/uoa03894/geneformer_pytorch2.1_cenv/lib/python3.11/site-packages/geneformer/in_silico_perturber_stats.py:537,\
          \ in InSilicoPerturberStats.get_stats(self, input_data_directory, null_dist_data_directory,\
          \ output_directory, output_prefix)\n    534     cos_sims_df = isp_stats_to_goal_state(cos_sims_df_initial,\
          \ dict_list, self.cell_states_to_model)\n    536 elif self.mode == \"vs_null\"\
          :\n--> 537     null_dict_list = read_dictionaries(null_dist_data_directory,\
          \ \"cell\", self.anchor_token)\n    538     cos_sims_df = isp_stats_vs_null(cos_sims_df_initial,\
          \ dict_list, null_dict_list)\n    540 elif self.mode == \"mixture_model\"\
          :\n\nFile /scale_wlg_persistent/filesets/project/uoa03894/geneformer_pytorch2.1_cenv/lib/python3.11/site-packages/geneformer/in_silico_perturber_stats.py:64,\
          \ in read_dictionaries(dir, cell_or_gene_emb, anchor_token)\n     60 if\
          \ file_found == 0:\n     61     logger.error(\n     62                 \"\
          No raw data for processing found within provided directory. \" \\\n    \
          \ 63                 \"Please ensure data files end with '_raw.pickle'.\"\
          )\n---> 64     raise\n     65 return dict_list\n\nRuntimeError: No active\
          \ exception to reraise"
        updatedAt: '2023-07-18T07:51:48.956Z'
      numEdits: 1
      reactions: []
    id: 64b6038b61105fdf3e384feb
    type: comment
  author: rkjaros
  content: "I should probably add more to this. The _raw.pickle output files are created\
    \ but not found when I run `ispstats.get_stats`. Even though the file path is\
    \ correct and the _raw.pickle files are indeed there. I'm wondering if there was\
    \ an error at the `isp.perturb_data` step. Any help is really appreciated. Thanks\
    \ very much. \n\nispstats = InSilicoPerturberStats(mode=\"vs_null\",\n       \
    \                           #genes_perturbed=\"all\",\n                      \
    \            combos=0,\n                                  anchor_gene=None,\n\
    \                                  cell_states_to_model=None)\n \nispstats.get_stats(\"\
    /nesi/project/uoa03894/Geneformer/examples/test_in_silico\",\n               \
    \    None,\n                   \"/nesi/project/uoa03894/Geneformer/examples/test_in_silico/output\"\
    ,\n                   \"smarca_test_stats\")\n\n![image.png](https://cdn-uploads.huggingface.co/production/uploads/64b5ffeefa1a3eb025d4c689/Ru6FmMTXSKair2laV8lcn.png)\n\
    \nNo raw data for processing found within provided directory. Please ensure data\
    \ files end with '_raw.pickle'.\n---------------------------------------------------------------------------\n\
    RuntimeError                              Traceback (most recent call last)\n\
    Cell In[6], line 2\n      1 # extracts data from intermediate files and processes\
    \ stats to output in final .csv\n----> 2 ispstats.get_stats(\"/nesi/project/uoa03894/Geneformer/examples/test_in_silico\"\
    ,\n      3                    None,\n      4                    \"/nesi/project/uoa03894/Geneformer/examples/test_in_silico/output\"\
    ,\n      5                    \"smarca_test_stats\")\n\nFile /scale_wlg_persistent/filesets/project/uoa03894/geneformer_pytorch2.1_cenv/lib/python3.11/site-packages/geneformer/in_silico_perturber_stats.py:537,\
    \ in InSilicoPerturberStats.get_stats(self, input_data_directory, null_dist_data_directory,\
    \ output_directory, output_prefix)\n    534     cos_sims_df = isp_stats_to_goal_state(cos_sims_df_initial,\
    \ dict_list, self.cell_states_to_model)\n    536 elif self.mode == \"vs_null\"\
    :\n--> 537     null_dict_list = read_dictionaries(null_dist_data_directory, \"\
    cell\", self.anchor_token)\n    538     cos_sims_df = isp_stats_vs_null(cos_sims_df_initial,\
    \ dict_list, null_dict_list)\n    540 elif self.mode == \"mixture_model\":\n\n\
    File /scale_wlg_persistent/filesets/project/uoa03894/geneformer_pytorch2.1_cenv/lib/python3.11/site-packages/geneformer/in_silico_perturber_stats.py:64,\
    \ in read_dictionaries(dir, cell_or_gene_emb, anchor_token)\n     60 if file_found\
    \ == 0:\n     61     logger.error(\n     62                 \"No raw data for\
    \ processing found within provided directory. \" \\\n     63                 \"\
    Please ensure data files end with '_raw.pickle'.\")\n---> 64     raise\n     65\
    \ return dict_list\n\nRuntimeError: No active exception to reraise"
  created_at: 2023-07-18 02:14:19+00:00
  edited: true
  hidden: false
  id: 64b6038b61105fdf3e384feb
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-07-19T19:53:14.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9385971426963806
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your interest in Geneformer and for your clarification
          on the error. It looks like the error is coming from the in silico perturber
          stats module not finding any files ending with ''_raw.pickle'' in the specified
          directory. This error occurs only when not finding any files to process,
          and isn''t related to having issues loading them. I am not encountering
          this error when using the module, but I changed the way the input directory
          is defined in case that was causing the problem - please pull the updated
          version and retry. Otherwise please also check the directory you are providing
          and that the files are located there.</p>

          '
        raw: Thank you for your interest in Geneformer and for your clarification
          on the error. It looks like the error is coming from the in silico perturber
          stats module not finding any files ending with '_raw.pickle' in the specified
          directory. This error occurs only when not finding any files to process,
          and isn't related to having issues loading them. I am not encountering this
          error when using the module, but I changed the way the input directory is
          defined in case that was causing the problem - please pull the updated version
          and retry. Otherwise please also check the directory you are providing and
          that the files are located there.
        updatedAt: '2023-07-19T19:53:14.735Z'
      numEdits: 0
      reactions:
      - count: 1
        reaction: "\U0001F44D"
        users:
        - rkjaros
      relatedEventId: 64b83f2a894eb78e39403b38
    id: 64b83f2a894eb78e39403b34
    type: comment
  author: ctheodoris
  content: Thank you for your interest in Geneformer and for your clarification on
    the error. It looks like the error is coming from the in silico perturber stats
    module not finding any files ending with '_raw.pickle' in the specified directory.
    This error occurs only when not finding any files to process, and isn't related
    to having issues loading them. I am not encountering this error when using the
    module, but I changed the way the input directory is defined in case that was
    causing the problem - please pull the updated version and retry. Otherwise please
    also check the directory you are providing and that the files are located there.
  created_at: 2023-07-19 18:53:14+00:00
  edited: false
  hidden: false
  id: 64b83f2a894eb78e39403b34
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-07-19T19:53:14.000Z'
    data:
      status: closed
    id: 64b83f2a894eb78e39403b38
    type: status-change
  author: ctheodoris
  created_at: 2023-07-19 18:53:14+00:00
  id: 64b83f2a894eb78e39403b38
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/dfa03e3406308485d93c5e7812945a3b.svg
      fullname: Rachel Jaros
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: rkjaros
      type: user
    createdAt: '2023-07-20T09:49:26.000Z'
    data:
      edited: false
      editors:
      - rkjaros
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.46368739008903503
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/dfa03e3406308485d93c5e7812945a3b.svg
          fullname: Rachel Jaros
          isHf: false
          isPro: false
          name: rkjaros
          type: user
        html: '<p>Thank you! </p>

          '
        raw: 'Thank you! '
        updatedAt: '2023-07-20T09:49:26.202Z'
      numEdits: 0
      reactions: []
    id: 64b9032677ae61bcc80aa215
    type: comment
  author: rkjaros
  content: 'Thank you! '
  created_at: 2023-07-20 08:49:26+00:00
  edited: false
  hidden: false
  id: 64b9032677ae61bcc80aa215
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 124
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: Error loading geneformer model
