!!python/object:huggingface_hub.community.DiscussionWithDetails
author: xingjchen
conflicting_files: null
created_at: 2023-08-21 03:30:14+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e8735b97a987894cb21ead0d9d678e6f.svg
      fullname: Xingjian Chen
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: xingjchen
      type: user
    createdAt: '2023-08-21T04:30:14.000Z'
    data:
      edited: false
      editors:
      - xingjchen
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8900718092918396
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e8735b97a987894cb21ead0d9d678e6f.svg
          fullname: Xingjian Chen
          isHf: false
          isPro: false
          name: xingjchen
          type: user
        html: '<p>Congrats for the great work! I have a question reagarding the cell
          type annotation task. I see from your code that the model actually has only
          PAD and MASK two special tokens for MLM pretraining, but when it comes to
          the  downstream cell type annotation task, the used classifier in BertForSequenceClassification
          is actually get the first token of the hidden states, since you have no
          CLS token, so you actually use the first gene to represent the cell embedding
          for cell type annotation task?</p>

          '
        raw: Congrats for the great work! I have a question reagarding the cell type
          annotation task. I see from your code that the model actually has only PAD
          and MASK two special tokens for MLM pretraining, but when it comes to the  downstream
          cell type annotation task, the used classifier in BertForSequenceClassification
          is actually get the first token of the hidden states, since you have no
          CLS token, so you actually use the first gene to represent the cell embedding
          for cell type annotation task?
        updatedAt: '2023-08-21T04:30:14.776Z'
      numEdits: 0
      reactions: []
    id: 64e2e8567e7b923a532e80f8
    type: comment
  author: xingjchen
  content: Congrats for the great work! I have a question reagarding the cell type
    annotation task. I see from your code that the model actually has only PAD and
    MASK two special tokens for MLM pretraining, but when it comes to the  downstream
    cell type annotation task, the used classifier in BertForSequenceClassification
    is actually get the first token of the hidden states, since you have no CLS token,
    so you actually use the first gene to represent the cell embedding for cell type
    annotation task?
  created_at: 2023-08-21 03:30:14+00:00
  edited: false
  hidden: false
  id: 64e2e8567e7b923a532e80f8
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-08-28T23:07:07.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8979769349098206
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: "<p>Thank you for your interest in Geneformer! If you use the Huggingface\
          \ code for sequence (cell) classification, the first token's embedding is\
          \ used as a representation of the cell. Because these are contextual embeddings,\
          \ the embedding of the first token varies with the context of the remaining\
          \ genes for each cell. (This is also the concept of the CLS token.) The\
          \ first token in this case has additional information of being a particular\
          \ gene. If you'd like to use a CLS token instead, you can add it to the\
          \ model dictionary, tokenize the data with adding the CLS token in the front\
          \ of the encoding, and fine-tune the model with those encodings. Alternatively,\
          \ you can modify the Huggingface code to perform mean-pooling as it's pooling\
          \ layer if you prefer. </p>\n<p>Of note, extracting/plotting cell embeddings\
          \ with our emb_extractor function uses mean-pooling by default, as discussed\
          \ in closed discussion <a href=\"https://huggingface.co/ctheodoris/Geneformer/discussions/215\"\
          ></a><a href=\"/ctheodoris/Geneformer/discussions/215\">#215</a>. Additionally\
          \ it is important to note that, as discussed in closed discussion <a href=\"\
          https://huggingface.co/ctheodoris/Geneformer/discussions/69\"></a><a href=\"\
          /ctheodoris/Geneformer/discussions/69\">#69</a>, while the CLS token could\
          \ have been used for cell embeddings for cell classification, summarizing\
          \ the embedding in a single token presents an issue for the in silico perturbation\
          \ strategy. In this application, we derive the cell embedding shift in response\
          \ to perturbation by comparing the embedding of all genes aside from the\
          \ perturbed gene so that we are quantifying the perturbation\u2019s effect\
          \ on context. Therefore, we would not be able to use a CLS token to accomplish\
          \ this since the genes would be inseparable.</p>\n"
        raw: "Thank you for your interest in Geneformer! If you use the Huggingface\
          \ code for sequence (cell) classification, the first token's embedding is\
          \ used as a representation of the cell. Because these are contextual embeddings,\
          \ the embedding of the first token varies with the context of the remaining\
          \ genes for each cell. (This is also the concept of the CLS token.) The\
          \ first token in this case has additional information of being a particular\
          \ gene. If you'd like to use a CLS token instead, you can add it to the\
          \ model dictionary, tokenize the data with adding the CLS token in the front\
          \ of the encoding, and fine-tune the model with those encodings. Alternatively,\
          \ you can modify the Huggingface code to perform mean-pooling as it's pooling\
          \ layer if you prefer. \n\nOf note, extracting/plotting cell embeddings\
          \ with our emb_extractor function uses mean-pooling by default, as discussed\
          \ in closed discussion [#215](https://huggingface.co/ctheodoris/Geneformer/discussions/215).\
          \ Additionally it is important to note that, as discussed in closed discussion\
          \ [#69](https://huggingface.co/ctheodoris/Geneformer/discussions/69), while\
          \ the CLS token could have been used for cell embeddings for cell classification,\
          \ summarizing the embedding in a single token presents an issue for the\
          \ in silico perturbation strategy. In this application, we derive the cell\
          \ embedding shift in response to perturbation by comparing the embedding\
          \ of all genes aside from the perturbed gene so that we are quantifying\
          \ the perturbation\u2019s effect on context. Therefore, we would not be\
          \ able to use a CLS token to accomplish this since the genes would be inseparable."
        updatedAt: '2023-08-28T23:07:07.234Z'
      numEdits: 0
      reactions: []
      relatedEventId: 64ed289bac5b2353a62fecd7
    id: 64ed289bac5b2353a62fecd5
    type: comment
  author: ctheodoris
  content: "Thank you for your interest in Geneformer! If you use the Huggingface\
    \ code for sequence (cell) classification, the first token's embedding is used\
    \ as a representation of the cell. Because these are contextual embeddings, the\
    \ embedding of the first token varies with the context of the remaining genes\
    \ for each cell. (This is also the concept of the CLS token.) The first token\
    \ in this case has additional information of being a particular gene. If you'd\
    \ like to use a CLS token instead, you can add it to the model dictionary, tokenize\
    \ the data with adding the CLS token in the front of the encoding, and fine-tune\
    \ the model with those encodings. Alternatively, you can modify the Huggingface\
    \ code to perform mean-pooling as it's pooling layer if you prefer. \n\nOf note,\
    \ extracting/plotting cell embeddings with our emb_extractor function uses mean-pooling\
    \ by default, as discussed in closed discussion [#215](https://huggingface.co/ctheodoris/Geneformer/discussions/215).\
    \ Additionally it is important to note that, as discussed in closed discussion\
    \ [#69](https://huggingface.co/ctheodoris/Geneformer/discussions/69), while the\
    \ CLS token could have been used for cell embeddings for cell classification,\
    \ summarizing the embedding in a single token presents an issue for the in silico\
    \ perturbation strategy. In this application, we derive the cell embedding shift\
    \ in response to perturbation by comparing the embedding of all genes aside from\
    \ the perturbed gene so that we are quantifying the perturbation\u2019s effect\
    \ on context. Therefore, we would not be able to use a CLS token to accomplish\
    \ this since the genes would be inseparable."
  created_at: 2023-08-28 22:07:07+00:00
  edited: false
  hidden: false
  id: 64ed289bac5b2353a62fecd5
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-08-28T23:07:07.000Z'
    data:
      status: closed
    id: 64ed289bac5b2353a62fecd7
    type: status-change
  author: ctheodoris
  created_at: 2023-08-28 22:07:07+00:00
  id: 64ed289bac5b2353a62fecd7
  new_status: closed
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e8735b97a987894cb21ead0d9d678e6f.svg
      fullname: Xingjian Chen
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: xingjchen
      type: user
    createdAt: '2023-08-31T17:44:09.000Z'
    data:
      edited: true
      editors: []
      hidden: true
      hiddenBy: ''
      latest:
        author:
          avatarUrl: /avatars/e8735b97a987894cb21ead0d9d678e6f.svg
          fullname: Xingjian Chen
          isHf: false
          isPro: false
          name: xingjchen
          type: user
        html: This comment has been hidden
        raw: This comment has been hidden
        updatedAt: '2023-08-31T17:44:29.319Z'
      numEdits: 0
      reactions: []
    id: 64f0d169d1d77772e1ecf23b
    type: comment
  author: xingjchen
  content: This comment has been hidden
  created_at: 2023-08-31 16:44:09+00:00
  edited: true
  hidden: true
  id: 64f0d169d1d77772e1ecf23b
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/e8735b97a987894cb21ead0d9d678e6f.svg
      fullname: Xingjian Chen
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: xingjchen
      type: user
    createdAt: '2023-08-31T17:44:16.000Z'
    data:
      edited: true
      editors:
      - xingjchen
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9269150495529175
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/e8735b97a987894cb21ead0d9d678e6f.svg
          fullname: Xingjian Chen
          isHf: false
          isPro: false
          name: xingjchen
          type: user
        html: '<p>Thank you for your kind reply, I understand now and it makes sense!
          Another question is that I saw from your config file that you used the absolute
          position embedding, but in your paper, there is no position-related description,
          I wonder if you used a learnable positional embedding for the top 2048 genes
          obtained by ranking value encoding?</p>

          '
        raw: 'Thank you for your kind reply, I understand now and it makes sense!
          Another question is that I saw from your config file that you used the absolute
          position embedding, but in your paper, there is no position-related description,
          I wonder if you used a learnable positional embedding for the top 2048 genes
          obtained by ranking value encoding?


          '
        updatedAt: '2023-08-31T17:45:20.081Z'
      numEdits: 1
      reactions: []
      relatedEventId: 64f0d170dee051d6483d6a86
    id: 64f0d170dee051d6483d6a81
    type: comment
  author: xingjchen
  content: 'Thank you for your kind reply, I understand now and it makes sense! Another
    question is that I saw from your config file that you used the absolute position
    embedding, but in your paper, there is no position-related description, I wonder
    if you used a learnable positional embedding for the top 2048 genes obtained by
    ranking value encoding?


    '
  created_at: 2023-08-31 16:44:16+00:00
  edited: true
  hidden: false
  id: 64f0d170dee051d6483d6a81
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: /avatars/e8735b97a987894cb21ead0d9d678e6f.svg
      fullname: Xingjian Chen
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: xingjchen
      type: user
    createdAt: '2023-08-31T17:44:16.000Z'
    data:
      status: open
    id: 64f0d170dee051d6483d6a86
    type: status-change
  author: xingjchen
  created_at: 2023-08-31 16:44:16+00:00
  id: 64f0d170dee051d6483d6a86
  new_status: open
  type: status-change
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-09-13T07:46:09.000Z'
    data:
      edited: false
      editors:
      - ctheodoris
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8379801511764526
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
          fullname: Christina Theodoris
          isHf: false
          isPro: false
          name: ctheodoris
          type: user
        html: '<p>Thank you for your question! In this case the rank value encodings
          define the position based on the relative rank of the genes. We used the
          Huggingface implementation as in this repository with regard to presenting
          the encodings to the model.</p>

          '
        raw: Thank you for your question! In this case the rank value encodings define
          the position based on the relative rank of the genes. We used the Huggingface
          implementation as in this repository with regard to presenting the encodings
          to the model.
        updatedAt: '2023-09-13T07:46:09.868Z'
      numEdits: 0
      reactions: []
      relatedEventId: 650168c17f91f940402628cb
    id: 650168c17f91f940402628c9
    type: comment
  author: ctheodoris
  content: Thank you for your question! In this case the rank value encodings define
    the position based on the relative rank of the genes. We used the Huggingface
    implementation as in this repository with regard to presenting the encodings to
    the model.
  created_at: 2023-09-13 06:46:09+00:00
  edited: false
  hidden: false
  id: 650168c17f91f940402628c9
  type: comment
- !!python/object:huggingface_hub.community.DiscussionStatusChange
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1671502872617-622d085c8d04fd29a9ccf169.png?w=200&h=200&f=face
      fullname: Christina Theodoris
      isHf: false
      isOrgMember: false
      isOwner: true
      isPro: false
      name: ctheodoris
      type: user
    createdAt: '2023-09-13T07:46:09.000Z'
    data:
      status: closed
    id: 650168c17f91f940402628cb
    type: status-change
  author: ctheodoris
  created_at: 2023-09-13 06:46:09+00:00
  id: 650168c17f91f940402628cb
  new_status: closed
  type: status-change
is_pull_request: false
merge_commit_oid: null
num: 227
repo_id: ctheodoris/Geneformer
repo_type: model
status: closed
target_branch: null
title: Question about the CLS token in cell type annotation task
