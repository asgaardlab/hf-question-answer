!!python/object:huggingface_hub.community.DiscussionWithDetails
author: JonnoFTW
conflicting_files: null
created_at: 2023-02-14 09:01:25+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/d36fc1670dde552d3c0f745ba8221648.svg
      fullname: Jonathan
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: JonnoFTW
      type: user
    createdAt: '2023-02-14T09:01:25.000Z'
    data:
      edited: true
      editors:
      - JonnoFTW
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/d36fc1670dde552d3c0f745ba8221648.svg
          fullname: Jonathan
          isHf: false
          isPro: false
          name: JonnoFTW
          type: user
        html: "<p>I get this error running the latest diffusers version <code>0.13.0.dev0</code>:</p>\n\
          <pre><code>/home/jonno/diffusers/src/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion_upscale.py:104:\
          \ FutureWarning: The configuration file of the vae does not contain `scaling_factor`\n\
          \ or it is set to 0.18215, which seems highly unlikely. If your checkpoint\
          \ is a fine-tuned version of `stabilityai/stable-diffusion-x4-upscaler`\
          \ you should change 'scaling_factor' to 0.08333 \nPlease make sure to update\
          \ the config accordingly, as not doing so might lead to incorrect results\
          \ in future versions. If you have downloaded this checkpoint from the Hugging\
          \ Face Hub, \nit would be very nice if you could open a Pull Request for\
          \ the `vae/config.json` file\n  deprecate(\"wrong scaling_factor\", \"1.0.0\"\
          , deprecation_message, standard_warn=False)\n</code></pre>\n<p>I ran the\
          \ following code:</p>\n<pre><code class=\"language-py\"><span class=\"hljs-keyword\"\
          >import</span> sys\n<span class=\"hljs-keyword\">from</span> PIL <span class=\"\
          hljs-keyword\">import</span> Image\n\n<span class=\"hljs-keyword\">import</span>\
          \ torch\n<span class=\"hljs-keyword\">from</span> diffusers <span class=\"\
          hljs-keyword\">import</span> StableDiffusionUpscalePipeline\n\n<span class=\"\
          hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span\
          \ class=\"hljs-params\">image: Image, prompt, negative_prompt</span>):\n\
          \    model_id = <span class=\"hljs-string\">\"stabilityai/stable-diffusion-x4-upscaler\"\
          </span>\n    pipeline = StableDiffusionUpscalePipeline.from_pretrained(model_id,\
          \ torch_dtype=torch.float16)\n    pipeline.enable_xformers_memory_efficient_attention()\n\
          \    pipeline = pipeline.to(<span class=\"hljs-string\">\"cpu\"</span>)\n\
          \    <span class=\"hljs-keyword\">return</span> pipeline(\n        prompt=prompt,\n\
          \        image=image,\n        negative_prompt=negative_prompt,\n    ).images[<span\
          \ class=\"hljs-number\">0</span>]\n\n<span class=\"hljs-keyword\">if</span>\
          \ __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    im_name\
          \ = sys.argv[<span class=\"hljs-number\">1</span>]\n    im = Image.<span\
          \ class=\"hljs-built_in\">open</span>(im_name)\n    im = run(im)\n    im.save(im_name\
          \ + <span class=\"hljs-string\">\"upscaled.png\"</span>, sys.argv[<span\
          \ class=\"hljs-number\">2</span>], sys.argv[<span class=\"hljs-number\"\
          >3</span>])\n</code></pre>\n"
        raw: "I get this error running the latest diffusers version `0.13.0.dev0`:\n\
          ```\n/home/jonno/diffusers/src/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion_upscale.py:104:\
          \ FutureWarning: The configuration file of the vae does not contain `scaling_factor`\n\
          \ or it is set to 0.18215, which seems highly unlikely. If your checkpoint\
          \ is a fine-tuned version of `stabilityai/stable-diffusion-x4-upscaler`\
          \ you should change 'scaling_factor' to 0.08333 \nPlease make sure to update\
          \ the config accordingly, as not doing so might lead to incorrect results\
          \ in future versions. If you have downloaded this checkpoint from the Hugging\
          \ Face Hub, \nit would be very nice if you could open a Pull Request for\
          \ the `vae/config.json` file\n  deprecate(\"wrong scaling_factor\", \"1.0.0\"\
          , deprecation_message, standard_warn=False)\n```\n\nI ran the following\
          \ code:\n\n```py\nimport sys\nfrom PIL import Image\n\nimport torch\nfrom\
          \ diffusers import StableDiffusionUpscalePipeline\n\ndef run(image: Image,\
          \ prompt, negative_prompt):\n    model_id = \"stabilityai/stable-diffusion-x4-upscaler\"\
          \n    pipeline = StableDiffusionUpscalePipeline.from_pretrained(model_id,\
          \ torch_dtype=torch.float16)\n    pipeline.enable_xformers_memory_efficient_attention()\n\
          \    pipeline = pipeline.to(\"cpu\")\n    return pipeline(\n        prompt=prompt,\n\
          \        image=image,\n        negative_prompt=negative_prompt,\n    ).images[0]\n\
          \nif __name__ == \"__main__\":\n    im_name = sys.argv[1]\n    im = Image.open(im_name)\n\
          \    im = run(im)\n    im.save(im_name + \"upscaled.png\", sys.argv[2],\
          \ sys.argv[3])\n```"
        updatedAt: '2023-02-14T09:01:50.075Z'
      numEdits: 1
      reactions: []
    id: 63eb4de5d64e6436e22b8707
    type: comment
  author: JonnoFTW
  content: "I get this error running the latest diffusers version `0.13.0.dev0`:\n\
    ```\n/home/jonno/diffusers/src/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion_upscale.py:104:\
    \ FutureWarning: The configuration file of the vae does not contain `scaling_factor`\n\
    \ or it is set to 0.18215, which seems highly unlikely. If your checkpoint is\
    \ a fine-tuned version of `stabilityai/stable-diffusion-x4-upscaler` you should\
    \ change 'scaling_factor' to 0.08333 \nPlease make sure to update the config accordingly,\
    \ as not doing so might lead to incorrect results in future versions. If you have\
    \ downloaded this checkpoint from the Hugging Face Hub, \nit would be very nice\
    \ if you could open a Pull Request for the `vae/config.json` file\n  deprecate(\"\
    wrong scaling_factor\", \"1.0.0\", deprecation_message, standard_warn=False)\n\
    ```\n\nI ran the following code:\n\n```py\nimport sys\nfrom PIL import Image\n\
    \nimport torch\nfrom diffusers import StableDiffusionUpscalePipeline\n\ndef run(image:\
    \ Image, prompt, negative_prompt):\n    model_id = \"stabilityai/stable-diffusion-x4-upscaler\"\
    \n    pipeline = StableDiffusionUpscalePipeline.from_pretrained(model_id, torch_dtype=torch.float16)\n\
    \    pipeline.enable_xformers_memory_efficient_attention()\n    pipeline = pipeline.to(\"\
    cpu\")\n    return pipeline(\n        prompt=prompt,\n        image=image,\n \
    \       negative_prompt=negative_prompt,\n    ).images[0]\n\nif __name__ == \"\
    __main__\":\n    im_name = sys.argv[1]\n    im = Image.open(im_name)\n    im =\
    \ run(im)\n    im.save(im_name + \"upscaled.png\", sys.argv[2], sys.argv[3])\n\
    ```"
  created_at: 2023-02-14 09:01:25+00:00
  edited: true
  hidden: false
  id: 63eb4de5d64e6436e22b8707
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/7d729b91ac7246efc1236c78e9010629.svg
      fullname: PEXAVC
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: pexavc
      type: user
    createdAt: '2023-04-15T22:50:48.000Z'
    data:
      edited: true
      editors:
      - pexavc
      hidden: false
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/7d729b91ac7246efc1236c78e9010629.svg
          fullname: PEXAVC
          isHf: false
          isPro: false
          name: pexavc
          type: user
        html: '<p>To fix this can follow this change: <a href="https://huggingface.co/stabilityai/stable-diffusion-x4-upscaler/discussions/9">https://huggingface.co/stabilityai/stable-diffusion-x4-upscaler/discussions/9</a></p>

          '
        raw: 'To fix this can follow this change: https://huggingface.co/stabilityai/stable-diffusion-x4-upscaler/discussions/9'
        updatedAt: '2023-04-15T22:51:51.366Z'
      numEdits: 2
      reactions: []
    id: 643b2a481f16272335729342
    type: comment
  author: pexavc
  content: 'To fix this can follow this change: https://huggingface.co/stabilityai/stable-diffusion-x4-upscaler/discussions/9'
  created_at: 2023-04-15 21:50:48+00:00
  edited: true
  hidden: false
  id: 643b2a481f16272335729342
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 8
repo_id: stabilityai/stable-diffusion-x4-upscaler
repo_type: model
status: open
target_branch: null
title: VAE scaling factor config bug
