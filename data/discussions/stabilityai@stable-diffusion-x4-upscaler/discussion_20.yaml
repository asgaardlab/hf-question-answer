!!python/object:huggingface_hub.community.DiscussionWithDetails
author: aschunem
conflicting_files: null
created_at: 2023-06-12 15:14:30+00:00
diff: null
endpoint: https://huggingface.co
events:
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/701f79b80b8b6922f3067faf27dcaca0.svg
      fullname: Alan Schunemann
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: aschunem
      type: user
    createdAt: '2023-06-12T16:14:30.000Z'
    data:
      edited: false
      editors:
      - aschunem
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.18411800265312195
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/701f79b80b8b6922f3067faf27dcaca0.svg
          fullname: Alan Schunemann
          isHf: false
          isPro: false
          name: aschunem
          type: user
        html: "<p>Hi, </p>\n<p>I'm a first time user,  so I'm running through the\
          \ simple demo (deepfloyd_if_free_tier_google_colab.ipynb). It fails in the\
          \ last step (1.6) with the following message:</p>\n<p>\u2502 in &lt;cell\
          \ line: 1&gt;:1                                                        \
          \                      \u2502<br>\u2502                                \
          \                                                                  \u2502\
          <br>\u2502 /usr/local/lib/python3.10/dist-packages/diffusers/pipelines/pipeline_utils.py:1063\
          \ in            \u2502<br>\u2502 from_pretrained                       \
          \                                                           \u2502<br>\u2502\
          \                                                                      \
          \                            \u2502<br>\u2502   1060 \u2502   \u2502   \u2502\
          \   \u2502   loaded_sub_model = passed_class_obj[name]                 \
          \                \u2502<br>\u2502   1061 \u2502   \u2502   \u2502   else:\
          \                                                                      \
          \   \u2502<br>\u2502   1062 \u2502   \u2502   \u2502   \u2502   # load sub\
          \ model                                                          \u2502\
          <br>\u2502 \u2771 1063 \u2502   \u2502   \u2502   \u2502   loaded_sub_model\
          \ = load_sub_model(                                        \u2502<br>\u2502\
          \   1064 \u2502   \u2502   \u2502   \u2502   \u2502   library_name=library_name,\
          \                                            \u2502<br>\u2502   1065 \u2502\
          \   \u2502   \u2502   \u2502   \u2502   class_name=class_name,         \
          \                                       \u2502<br>\u2502   1066 \u2502 \
          \  \u2502   \u2502   \u2502   \u2502   importable_classes=importable_classes,\
          \                                \u2502<br>\u2502                      \
          \                                                                      \
          \      \u2502<br>\u2502 /usr/local/lib/python3.10/dist-packages/diffusers/pipelines/pipeline_utils.py:451\
          \ in             \u2502<br>\u2502 load_sub_model                       \
          \                                                            \u2502<br>\u2502\
          \                                                                      \
          \                            \u2502<br>\u2502    448 \u2502            \
          \                                                                      \
          \       \u2502<br>\u2502    449 \u2502   # check if the module is in a subdirectory\
          \                                            \u2502<br>\u2502    450 \u2502\
          \   if os.path.isdir(os.path.join(cached_folder, name)):               \
          \                   \u2502<br>\u2502 \u2771  451 \u2502   \u2502   loaded_sub_model\
          \ = load_method(os.path.join(cached_folder, name), **loading_kwar  \u2502\
          <br>\u2502    452 \u2502   else:                                       \
          \                                          \u2502<br>\u2502    453 \u2502\
          \   \u2502   # else load from the root directory                       \
          \                        \u2502<br>\u2502    454 \u2502   \u2502   loaded_sub_model\
          \ = load_method(cached_folder, **loading_kwargs)                   \u2502\
          <br>\u2502                                                             \
          \                                     \u2502<br>\u2502 /usr/local/lib/python3.10/dist-packages/diffusers/models/modeling_utils.py:649\
          \ in                \u2502<br>\u2502 from_pretrained                   \
          \                                                               \u2502<br>\u2502\
          \                                                                      \
          \                            \u2502<br>\u2502   646 \u2502   \u2502   \u2502\
          \   \u2502   else:  # else let accelerate handle loading and dispatching.\
          \               \u2502<br>\u2502   647 \u2502   \u2502   \u2502   \u2502\
          \   \u2502   # Load weights and dispatch according to the device_map   \
          \             \u2502<br>\u2502   648 \u2502   \u2502   \u2502   \u2502 \
          \  \u2502   # by default the device_map is None and the weights are loaded\
          \ on th   \u2502<br>\u2502 \u2771 649 \u2502   \u2502   \u2502   \u2502\
          \   \u2502   accelerate.load_checkpoint_and_dispatch(                  \
          \             \u2502<br>\u2502   650 \u2502   \u2502   \u2502   \u2502 \
          \  \u2502   \u2502   model,                                            \
          \                 \u2502<br>\u2502   651 \u2502   \u2502   \u2502   \u2502\
          \   \u2502   \u2502   model_file,                                      \
          \                  \u2502<br>\u2502   652 \u2502   \u2502   \u2502   \u2502\
          \   \u2502   \u2502   device_map,                                      \
          \                  \u2502<br>\u2502                                    \
          \                                                              \u2502<br>\u2502\
          \ /usr/local/lib/python3.10/dist-packages/accelerate/big_modeling.py:486\
          \ in                        \u2502<br>\u2502 load_checkpoint_and_dispatch\
          \                                                                     \u2502\
          <br>\u2502                                                             \
          \                                     \u2502<br>\u2502   483 \u2502   \u2502\
          \   )                                                                  \
          \                \u2502<br>\u2502   484 \u2502   if offload_state_dict is\
          \ None and device_map is not None and \"disk\" in device_map.va   \u2502\
          <br>\u2502   485 \u2502   \u2502   offload_state_dict = True           \
          \                                               \u2502<br>\u2502 \u2771\
          \ 486 \u2502   load_checkpoint_in_model(                               \
          \                               \u2502<br>\u2502   487 \u2502   \u2502 \
          \  model,                                                              \
          \               \u2502<br>\u2502   488 \u2502   \u2502   checkpoint,   \
          \                                                                     \u2502\
          <br>\u2502   489 \u2502   \u2502   device_map=device_map,              \
          \                                               \u2502<br>\u2502       \
          \                                                                      \
          \                     \u2502<br>\u2502 /usr/local/lib/python3.10/dist-packages/accelerate/utils/modeling.py:1116\
          \ in                     \u2502<br>\u2502 load_checkpoint_in_model     \
          \                                                                    \u2502\
          <br>\u2502                                                             \
          \                                     \u2502<br>\u2502   1113 \u2502   \u2502\
          \   \u2502   \u2502   \u2502   set_module_tensor_to_device(model, param_name,\
          \ \"meta\")                \u2502<br>\u2502   1114 \u2502   \u2502   \u2502\
          \   \u2502   \u2502   offload_weight(param, param_name, state_dict_folder,\
          \ index=state_dic  \u2502<br>\u2502   1115 \u2502   \u2502   \u2502   \u2502\
          \   else:                                                              \
          \       \u2502<br>\u2502 \u2771 1116 \u2502   \u2502   \u2502   \u2502 \
          \  \u2502   set_module_tensor_to_device(model, param_name, param_device,\
          \ value=p  \u2502<br>\u2502   1117 \u2502   \u2502                     \
          \                                                                \u2502\
          <br>\u2502   1118 \u2502   \u2502   # Force Python to clean up.        \
          \                                               \u2502<br>\u2502   1119\
          \ \u2502   \u2502   del checkpoint                                     \
          \                               \u2502<br>\u2502                       \
          \                                                                      \
          \     \u2502<br>\u2502 /usr/local/lib/python3.10/dist-packages/accelerate/utils/modeling.py:142\
          \ in                      \u2502<br>\u2502 set_module_tensor_to_device \
          \                                                                     \u2502\
          <br>\u2502                                                             \
          \                                     \u2502<br>\u2502    139 \u2502   if\
          \ \".\" in tensor_name:                                                \
          \                \u2502<br>\u2502    140 \u2502   \u2502   splits = tensor_name.split(\"\
          .\")                                                   \u2502<br>\u2502\
          \    141 \u2502   \u2502   for split in splits[:-1]:                   \
          \                                      \u2502<br>\u2502 \u2771  142 \u2502\
          \   \u2502   \u2502   new_module = getattr(module, split)              \
          \                             \u2502<br>\u2502    143 \u2502   \u2502  \
          \ \u2502   if new_module is None:                                      \
          \                  \u2502<br>\u2502    144 \u2502   \u2502   \u2502   \u2502\
          \   raise ValueError(f\"{module} has no attribute {split}.\")          \
          \         \u2502<br>\u2502    145 \u2502   \u2502   \u2502   module = new_module\
          \                                                           \u2502<br>\u2502\
          \                                                                      \
          \                            \u2502<br>\u2502 /usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py:1614\
          \ in <strong>getattr</strong>           \u2502<br>\u2502               \
          \                                                                      \
          \             \u2502<br>\u2502   1611 \u2502   \u2502   \u2502   modules\
          \ = self.<strong>dict</strong>['_modules']                             \
          \              \u2502<br>\u2502   1612 \u2502   \u2502   \u2502   if name\
          \ in modules:                                                          \
          \ \u2502<br>\u2502   1613 \u2502   \u2502   \u2502   \u2502   return modules[name]\
          \                                                      \u2502<br>\u2502\
          \ \u2771 1614 \u2502   \u2502   raise AttributeError(\"'{}' object has no\
          \ attribute '{}'\".format(                  \u2502<br>\u2502   1615 \u2502\
          \   \u2502   \u2502   type(self).<strong>name</strong>, name))         \
          \                                          \u2502<br>\u2502   1616 \u2502\
          \                                                                      \
          \                   \u2502<br>\u2502   1617 \u2502   def <strong>setattr</strong>(self,\
          \ name: str, value: Union[Tensor, 'Module']) -&gt; None:             \u2502\
          <br>\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u256F<br>AttributeError: 'Attention' object has no attribute\
          \ 'key'</p>\n<p>It looks like library errors. Please help, thanks!</p>\n"
        raw: "Hi, \r\n\r\nI'm a first time user,  so I'm running through the simple\
          \ demo (deepfloyd_if_free_tier_google_colab.ipynb). It fails in the last\
          \ step (1.6) with the following message:\r\n\r\n\u2502 in <cell line: 1>:1\
          \                                                                      \
          \        \u2502\r\n\u2502                                              \
          \                                                    \u2502\r\n\u2502 /usr/local/lib/python3.10/dist-packages/diffusers/pipelines/pipeline_utils.py:1063\
          \ in            \u2502\r\n\u2502 from_pretrained                       \
          \                                                           \u2502\r\n\u2502\
          \                                                                      \
          \                            \u2502\r\n\u2502   1060 \u2502   \u2502   \u2502\
          \   \u2502   loaded_sub_model = passed_class_obj[name]                 \
          \                \u2502\r\n\u2502   1061 \u2502   \u2502   \u2502   else:\
          \                                                                      \
          \   \u2502\r\n\u2502   1062 \u2502   \u2502   \u2502   \u2502   # load sub\
          \ model                                                          \u2502\r\
          \n\u2502 \u2771 1063 \u2502   \u2502   \u2502   \u2502   loaded_sub_model\
          \ = load_sub_model(                                        \u2502\r\n\u2502\
          \   1064 \u2502   \u2502   \u2502   \u2502   \u2502   library_name=library_name,\
          \                                            \u2502\r\n\u2502   1065 \u2502\
          \   \u2502   \u2502   \u2502   \u2502   class_name=class_name,         \
          \                                       \u2502\r\n\u2502   1066 \u2502 \
          \  \u2502   \u2502   \u2502   \u2502   importable_classes=importable_classes,\
          \                                \u2502\r\n\u2502                      \
          \                                                                      \
          \      \u2502\r\n\u2502 /usr/local/lib/python3.10/dist-packages/diffusers/pipelines/pipeline_utils.py:451\
          \ in             \u2502\r\n\u2502 load_sub_model                       \
          \                                                            \u2502\r\n\u2502\
          \                                                                      \
          \                            \u2502\r\n\u2502    448 \u2502            \
          \                                                                      \
          \       \u2502\r\n\u2502    449 \u2502   # check if the module is in a subdirectory\
          \                                            \u2502\r\n\u2502    450 \u2502\
          \   if os.path.isdir(os.path.join(cached_folder, name)):               \
          \                   \u2502\r\n\u2502 \u2771  451 \u2502   \u2502   loaded_sub_model\
          \ = load_method(os.path.join(cached_folder, name), **loading_kwar  \u2502\
          \r\n\u2502    452 \u2502   else:                                       \
          \                                          \u2502\r\n\u2502    453 \u2502\
          \   \u2502   # else load from the root directory                       \
          \                        \u2502\r\n\u2502    454 \u2502   \u2502   loaded_sub_model\
          \ = load_method(cached_folder, **loading_kwargs)                   \u2502\
          \r\n\u2502                                                             \
          \                                     \u2502\r\n\u2502 /usr/local/lib/python3.10/dist-packages/diffusers/models/modeling_utils.py:649\
          \ in                \u2502\r\n\u2502 from_pretrained                   \
          \                                                               \u2502\r\
          \n\u2502                                                               \
          \                                   \u2502\r\n\u2502   646 \u2502   \u2502\
          \   \u2502   \u2502   else:  # else let accelerate handle loading and dispatching.\
          \               \u2502\r\n\u2502   647 \u2502   \u2502   \u2502   \u2502\
          \   \u2502   # Load weights and dispatch according to the device_map   \
          \             \u2502\r\n\u2502   648 \u2502   \u2502   \u2502   \u2502 \
          \  \u2502   # by default the device_map is None and the weights are loaded\
          \ on th   \u2502\r\n\u2502 \u2771 649 \u2502   \u2502   \u2502   \u2502\
          \   \u2502   accelerate.load_checkpoint_and_dispatch(                  \
          \             \u2502\r\n\u2502   650 \u2502   \u2502   \u2502   \u2502 \
          \  \u2502   \u2502   model,                                            \
          \                 \u2502\r\n\u2502   651 \u2502   \u2502   \u2502   \u2502\
          \   \u2502   \u2502   model_file,                                      \
          \                  \u2502\r\n\u2502   652 \u2502   \u2502   \u2502   \u2502\
          \   \u2502   \u2502   device_map,                                      \
          \                  \u2502\r\n\u2502                                    \
          \                                                              \u2502\r\n\
          \u2502 /usr/local/lib/python3.10/dist-packages/accelerate/big_modeling.py:486\
          \ in                        \u2502\r\n\u2502 load_checkpoint_and_dispatch\
          \                                                                     \u2502\
          \r\n\u2502                                                             \
          \                                     \u2502\r\n\u2502   483 \u2502   \u2502\
          \   )                                                                  \
          \                \u2502\r\n\u2502   484 \u2502   if offload_state_dict is\
          \ None and device_map is not None and \"disk\" in device_map.va   \u2502\
          \r\n\u2502   485 \u2502   \u2502   offload_state_dict = True           \
          \                                               \u2502\r\n\u2502 \u2771\
          \ 486 \u2502   load_checkpoint_in_model(                               \
          \                               \u2502\r\n\u2502   487 \u2502   \u2502 \
          \  model,                                                              \
          \               \u2502\r\n\u2502   488 \u2502   \u2502   checkpoint,   \
          \                                                                     \u2502\
          \r\n\u2502   489 \u2502   \u2502   device_map=device_map,              \
          \                                               \u2502\r\n\u2502       \
          \                                                                      \
          \                     \u2502\r\n\u2502 /usr/local/lib/python3.10/dist-packages/accelerate/utils/modeling.py:1116\
          \ in                     \u2502\r\n\u2502 load_checkpoint_in_model     \
          \                                                                    \u2502\
          \r\n\u2502                                                             \
          \                                     \u2502\r\n\u2502   1113 \u2502   \u2502\
          \   \u2502   \u2502   \u2502   set_module_tensor_to_device(model, param_name,\
          \ \"meta\")                \u2502\r\n\u2502   1114 \u2502   \u2502   \u2502\
          \   \u2502   \u2502   offload_weight(param, param_name, state_dict_folder,\
          \ index=state_dic  \u2502\r\n\u2502   1115 \u2502   \u2502   \u2502   \u2502\
          \   else:                                                              \
          \       \u2502\r\n\u2502 \u2771 1116 \u2502   \u2502   \u2502   \u2502 \
          \  \u2502   set_module_tensor_to_device(model, param_name, param_device,\
          \ value=p  \u2502\r\n\u2502   1117 \u2502   \u2502                     \
          \                                                                \u2502\r\
          \n\u2502   1118 \u2502   \u2502   # Force Python to clean up.          \
          \                                             \u2502\r\n\u2502   1119 \u2502\
          \   \u2502   del checkpoint                                            \
          \                        \u2502\r\n\u2502                              \
          \                                                                    \u2502\
          \r\n\u2502 /usr/local/lib/python3.10/dist-packages/accelerate/utils/modeling.py:142\
          \ in                      \u2502\r\n\u2502 set_module_tensor_to_device \
          \                                                                     \u2502\
          \r\n\u2502                                                             \
          \                                     \u2502\r\n\u2502    139 \u2502   if\
          \ \".\" in tensor_name:                                                \
          \                \u2502\r\n\u2502    140 \u2502   \u2502   splits = tensor_name.split(\"\
          .\")                                                   \u2502\r\n\u2502\
          \    141 \u2502   \u2502   for split in splits[:-1]:                   \
          \                                      \u2502\r\n\u2502 \u2771  142 \u2502\
          \   \u2502   \u2502   new_module = getattr(module, split)              \
          \                             \u2502\r\n\u2502    143 \u2502   \u2502  \
          \ \u2502   if new_module is None:                                      \
          \                  \u2502\r\n\u2502    144 \u2502   \u2502   \u2502   \u2502\
          \   raise ValueError(f\"{module} has no attribute {split}.\")          \
          \         \u2502\r\n\u2502    145 \u2502   \u2502   \u2502   module = new_module\
          \                                                           \u2502\r\n\u2502\
          \                                                                      \
          \                            \u2502\r\n\u2502 /usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py:1614\
          \ in __getattr__           \u2502\r\n\u2502                            \
          \                                                                      \u2502\
          \r\n\u2502   1611 \u2502   \u2502   \u2502   modules = self.__dict__['_modules']\
          \                                           \u2502\r\n\u2502   1612 \u2502\
          \   \u2502   \u2502   if name in modules:                              \
          \                             \u2502\r\n\u2502   1613 \u2502   \u2502  \
          \ \u2502   \u2502   return modules[name]                               \
          \                       \u2502\r\n\u2502 \u2771 1614 \u2502   \u2502   raise\
          \ AttributeError(\"'{}' object has no attribute '{}'\".format(         \
          \         \u2502\r\n\u2502   1615 \u2502   \u2502   \u2502   type(self).__name__,\
          \ name))                                                   \u2502\r\n\u2502\
          \   1616 \u2502                                                        \
          \                                 \u2502\r\n\u2502   1617 \u2502   def __setattr__(self,\
          \ name: str, value: Union[Tensor, 'Module']) -> None:             \u2502\
          \r\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
          \u2500\u2500\u2500\u256F\r\nAttributeError: 'Attention' object has no attribute\
          \ 'key'\r\n\r\nIt looks like library errors. Please help, thanks!"
        updatedAt: '2023-06-12T16:14:30.329Z'
      numEdits: 0
      reactions: []
    id: 648744666d3a5db3c8253b02
    type: comment
  author: aschunem
  content: "Hi, \r\n\r\nI'm a first time user,  so I'm running through the simple\
    \ demo (deepfloyd_if_free_tier_google_colab.ipynb). It fails in the last step\
    \ (1.6) with the following message:\r\n\r\n\u2502 in <cell line: 1>:1        \
    \                                                                      \u2502\r\
    \n\u2502                                                                     \
    \                             \u2502\r\n\u2502 /usr/local/lib/python3.10/dist-packages/diffusers/pipelines/pipeline_utils.py:1063\
    \ in            \u2502\r\n\u2502 from_pretrained                             \
    \                                                     \u2502\r\n\u2502       \
    \                                                                            \
    \               \u2502\r\n\u2502   1060 \u2502   \u2502   \u2502   \u2502   loaded_sub_model\
    \ = passed_class_obj[name]                                 \u2502\r\n\u2502  \
    \ 1061 \u2502   \u2502   \u2502   else:                                      \
    \                                   \u2502\r\n\u2502   1062 \u2502   \u2502  \
    \ \u2502   \u2502   # load sub model                                         \
    \                 \u2502\r\n\u2502 \u2771 1063 \u2502   \u2502   \u2502   \u2502\
    \   loaded_sub_model = load_sub_model(                                       \
    \ \u2502\r\n\u2502   1064 \u2502   \u2502   \u2502   \u2502   \u2502   library_name=library_name,\
    \                                            \u2502\r\n\u2502   1065 \u2502  \
    \ \u2502   \u2502   \u2502   \u2502   class_name=class_name,                 \
    \                               \u2502\r\n\u2502   1066 \u2502   \u2502   \u2502\
    \   \u2502   \u2502   importable_classes=importable_classes,                 \
    \               \u2502\r\n\u2502                                             \
    \                                                     \u2502\r\n\u2502 /usr/local/lib/python3.10/dist-packages/diffusers/pipelines/pipeline_utils.py:451\
    \ in             \u2502\r\n\u2502 load_sub_model                             \
    \                                                      \u2502\r\n\u2502      \
    \                                                                            \
    \                \u2502\r\n\u2502    448 \u2502                              \
    \                                                           \u2502\r\n\u2502 \
    \   449 \u2502   # check if the module is in a subdirectory                  \
    \                          \u2502\r\n\u2502    450 \u2502   if os.path.isdir(os.path.join(cached_folder,\
    \ name)):                                  \u2502\r\n\u2502 \u2771  451 \u2502\
    \   \u2502   loaded_sub_model = load_method(os.path.join(cached_folder, name),\
    \ **loading_kwar  \u2502\r\n\u2502    452 \u2502   else:                     \
    \                                                            \u2502\r\n\u2502\
    \    453 \u2502   \u2502   # else load from the root directory               \
    \                                \u2502\r\n\u2502    454 \u2502   \u2502   loaded_sub_model\
    \ = load_method(cached_folder, **loading_kwargs)                   \u2502\r\n\u2502\
    \                                                                            \
    \                      \u2502\r\n\u2502 /usr/local/lib/python3.10/dist-packages/diffusers/models/modeling_utils.py:649\
    \ in                \u2502\r\n\u2502 from_pretrained                         \
    \                                                         \u2502\r\n\u2502   \
    \                                                                            \
    \                   \u2502\r\n\u2502   646 \u2502   \u2502   \u2502   \u2502 \
    \  else:  # else let accelerate handle loading and dispatching.              \
    \ \u2502\r\n\u2502   647 \u2502   \u2502   \u2502   \u2502   \u2502   # Load weights\
    \ and dispatch according to the device_map                \u2502\r\n\u2502   648\
    \ \u2502   \u2502   \u2502   \u2502   \u2502   # by default the device_map is\
    \ None and the weights are loaded on th   \u2502\r\n\u2502 \u2771 649 \u2502 \
    \  \u2502   \u2502   \u2502   \u2502   accelerate.load_checkpoint_and_dispatch(\
    \                               \u2502\r\n\u2502   650 \u2502   \u2502   \u2502\
    \   \u2502   \u2502   \u2502   model,                                        \
    \                     \u2502\r\n\u2502   651 \u2502   \u2502   \u2502   \u2502\
    \   \u2502   \u2502   model_file,                                            \
    \            \u2502\r\n\u2502   652 \u2502   \u2502   \u2502   \u2502   \u2502\
    \   \u2502   device_map,                                                     \
    \   \u2502\r\n\u2502                                                         \
    \                                         \u2502\r\n\u2502 /usr/local/lib/python3.10/dist-packages/accelerate/big_modeling.py:486\
    \ in                        \u2502\r\n\u2502 load_checkpoint_and_dispatch    \
    \                                                                 \u2502\r\n\u2502\
    \                                                                            \
    \                      \u2502\r\n\u2502   483 \u2502   \u2502   )            \
    \                                                                      \u2502\r\
    \n\u2502   484 \u2502   if offload_state_dict is None and device_map is not None\
    \ and \"disk\" in device_map.va   \u2502\r\n\u2502   485 \u2502   \u2502   offload_state_dict\
    \ = True                                                          \u2502\r\n\u2502\
    \ \u2771 486 \u2502   load_checkpoint_in_model(                              \
    \                                \u2502\r\n\u2502   487 \u2502   \u2502   model,\
    \                                                                            \
    \ \u2502\r\n\u2502   488 \u2502   \u2502   checkpoint,                       \
    \                                                 \u2502\r\n\u2502   489 \u2502\
    \   \u2502   device_map=device_map,                                          \
    \                   \u2502\r\n\u2502                                         \
    \                                                         \u2502\r\n\u2502 /usr/local/lib/python3.10/dist-packages/accelerate/utils/modeling.py:1116\
    \ in                     \u2502\r\n\u2502 load_checkpoint_in_model           \
    \                                                              \u2502\r\n\u2502\
    \                                                                            \
    \                      \u2502\r\n\u2502   1113 \u2502   \u2502   \u2502   \u2502\
    \   \u2502   set_module_tensor_to_device(model, param_name, \"meta\")        \
    \        \u2502\r\n\u2502   1114 \u2502   \u2502   \u2502   \u2502   \u2502  \
    \ offload_weight(param, param_name, state_dict_folder, index=state_dic  \u2502\
    \r\n\u2502   1115 \u2502   \u2502   \u2502   \u2502   else:                  \
    \                                                   \u2502\r\n\u2502 \u2771 1116\
    \ \u2502   \u2502   \u2502   \u2502   \u2502   set_module_tensor_to_device(model,\
    \ param_name, param_device, value=p  \u2502\r\n\u2502   1117 \u2502   \u2502 \
    \                                                                            \
    \        \u2502\r\n\u2502   1118 \u2502   \u2502   # Force Python to clean up.\
    \                                                       \u2502\r\n\u2502   1119\
    \ \u2502   \u2502   del checkpoint                                           \
    \                         \u2502\r\n\u2502                                   \
    \                                                               \u2502\r\n\u2502\
    \ /usr/local/lib/python3.10/dist-packages/accelerate/utils/modeling.py:142 in\
    \                      \u2502\r\n\u2502 set_module_tensor_to_device          \
    \                                                            \u2502\r\n\u2502\
    \                                                                            \
    \                      \u2502\r\n\u2502    139 \u2502   if \".\" in tensor_name:\
    \                                                                \u2502\r\n\u2502\
    \    140 \u2502   \u2502   splits = tensor_name.split(\".\")                 \
    \                                  \u2502\r\n\u2502    141 \u2502   \u2502   for\
    \ split in splits[:-1]:                                                      \
    \   \u2502\r\n\u2502 \u2771  142 \u2502   \u2502   \u2502   new_module = getattr(module,\
    \ split)                                           \u2502\r\n\u2502    143 \u2502\
    \   \u2502   \u2502   if new_module is None:                                 \
    \                       \u2502\r\n\u2502    144 \u2502   \u2502   \u2502   \u2502\
    \   raise ValueError(f\"{module} has no attribute {split}.\")                \
    \   \u2502\r\n\u2502    145 \u2502   \u2502   \u2502   module = new_module   \
    \                                                        \u2502\r\n\u2502    \
    \                                                                            \
    \                  \u2502\r\n\u2502 /usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py:1614\
    \ in __getattr__           \u2502\r\n\u2502                                  \
    \                                                                \u2502\r\n\u2502\
    \   1611 \u2502   \u2502   \u2502   modules = self.__dict__['_modules']      \
    \                                     \u2502\r\n\u2502   1612 \u2502   \u2502\
    \   \u2502   if name in modules:                                             \
    \              \u2502\r\n\u2502   1613 \u2502   \u2502   \u2502   \u2502   return\
    \ modules[name]                                                      \u2502\r\n\
    \u2502 \u2771 1614 \u2502   \u2502   raise AttributeError(\"'{}' object has no\
    \ attribute '{}'\".format(                  \u2502\r\n\u2502   1615 \u2502   \u2502\
    \   \u2502   type(self).__name__, name))                                     \
    \              \u2502\r\n\u2502   1616 \u2502                                \
    \                                                         \u2502\r\n\u2502   1617\
    \ \u2502   def __setattr__(self, name: str, value: Union[Tensor, 'Module']) ->\
    \ None:             \u2502\r\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\
    \u256F\r\nAttributeError: 'Attention' object has no attribute 'key'\r\n\r\nIt\
    \ looks like library errors. Please help, thanks!"
  created_at: 2023-06-12 15:14:30+00:00
  edited: false
  hidden: false
  id: 648744666d3a5db3c8253b02
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/26baabf77f038ffbd955c0e89ebab584.svg
      fullname: Nguyen Tan Hung
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: coolbirdv
      type: user
    createdAt: '2023-06-18T08:48:48.000Z'
    data:
      edited: false
      editors:
      - coolbirdv
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.8310567736625671
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/26baabf77f038ffbd955c0e89ebab584.svg
          fullname: Nguyen Tan Hung
          isHf: false
          isPro: false
          name: coolbirdv
          type: user
        html: '<p>Same to me</p>

          '
        raw: Same to me
        updatedAt: '2023-06-18T08:48:48.538Z'
      numEdits: 0
      reactions: []
    id: 648ec4f041aa8acdac9143a2
    type: comment
  author: coolbirdv
  content: Same to me
  created_at: 2023-06-18 07:48:48+00:00
  edited: false
  hidden: false
  id: 648ec4f041aa8acdac9143a2
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: /avatars/098534b319757e44e858fabbbff77bdd.svg
      fullname: xuehy
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: hyxue
      type: user
    createdAt: '2023-06-26T05:06:56.000Z'
    data:
      edited: false
      editors:
      - hyxue
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.784019410610199
      isReport: false
      latest:
        author:
          avatarUrl: /avatars/098534b319757e44e858fabbbff77bdd.svg
          fullname: xuehy
          isHf: false
          isPro: false
          name: hyxue
          type: user
        html: '<p>any fix?</p>

          '
        raw: any fix?
        updatedAt: '2023-06-26T05:06:56.046Z'
      numEdits: 0
      reactions: []
    id: 64991cf042d585137eba072f
    type: comment
  author: hyxue
  content: any fix?
  created_at: 2023-06-26 04:06:56+00:00
  edited: false
  hidden: false
  id: 64991cf042d585137eba072f
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
      fullname: Patrick von Platen
      isHf: true
      isOrgMember: true
      isOwner: false
      isPro: false
      name: patrickvonplaten
      type: user
    createdAt: '2023-06-26T09:29:35.000Z'
    data:
      edited: false
      editors:
      - patrickvonplaten
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.9452623724937439
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1584435275418-5dfcb1aada6d0311fd3d5448.jpeg?w=200&h=200&f=face
          fullname: Patrick von Platen
          isHf: true
          isPro: false
          name: patrickvonplaten
          type: user
        html: "<p><span data-props=\"{&quot;user&quot;:&quot;williamberman&quot;}\"\
          \ data-target=\"UserMention\" class=\"SVELTE_PARTIAL_HYDRATER contents\"\
          >\n\n<span class=\"inline-block\"><span class=\"contents\"><a href=\"/williamberman\"\
          >@<span class=\"underline\">williamberman</span></a></span>\n\n\t</span></span>\
          \ could you check this quickly?</p>\n"
        raw: '@williamberman could you check this quickly?'
        updatedAt: '2023-06-26T09:29:35.880Z'
      numEdits: 0
      reactions: []
    id: 64995a7fbe8fd92c27ae74a2
    type: comment
  author: patrickvonplaten
  content: '@williamberman could you check this quickly?'
  created_at: 2023-06-26 08:29:35+00:00
  edited: false
  hidden: false
  id: 64995a7fbe8fd92c27ae74a2
  type: comment
- !!python/object:huggingface_hub.community.DiscussionComment
  _event:
    author:
      avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1668468846504-63407fadb78ed99eab00203d.jpeg?w=200&h=200&f=face
      fullname: Will Berman
      isHf: false
      isOrgMember: false
      isOwner: false
      isPro: false
      name: williamberman
      type: user
    createdAt: '2023-06-26T16:39:50.000Z'
    data:
      edited: true
      editors:
      - williamberman
      hidden: false
      identifiedLanguage:
        language: en
        probability: 0.7350764870643616
      isReport: false
      latest:
        author:
          avatarUrl: https://aeiljuispo.cloudimg.io/v7/https://cdn-uploads.huggingface.co/production/uploads/1668468846504-63407fadb78ed99eab00203d.jpeg?w=200&h=200&f=face
          fullname: Will Berman
          isHf: false
          isPro: false
          name: williamberman
          type: user
        html: '<p>hey y''all sorry about that, if you install from diffusers main,
          this should be fixed :) </p>

          '
        raw: 'hey y''all sorry about that, if you install from diffusers main, this
          should be fixed :) '
        updatedAt: '2023-06-26T16:40:00.470Z'
      numEdits: 1
      reactions: []
    id: 6499bf5648bf56b95e4c1697
    type: comment
  author: williamberman
  content: 'hey y''all sorry about that, if you install from diffusers main, this
    should be fixed :) '
  created_at: 2023-06-26 15:39:50+00:00
  edited: true
  hidden: false
  id: 6499bf5648bf56b95e4c1697
  type: comment
is_pull_request: false
merge_commit_oid: null
num: 20
repo_id: stabilityai/stable-diffusion-x4-upscaler
repo_type: model
status: open
target_branch: null
title: 'Error in DeepFloyd IF - Stability AI''s x4 Upscaler '
